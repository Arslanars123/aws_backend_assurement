import{r as m,b as V,a as k,c as A,j as e,R as n,C as a}from"./index-CAFh8Qe-.js";import{C as L}from"./ComponentContainerCard-BHLb5dlU.js";import{P as O}from"./PageMetaData-BdrMy3rA.js";import{B as u}from"./urls-D84fNQqS.js";import{F as o}from"./FormLabel-DJooOqJq.js";import{F as i}from"./FormControl-D6Fi2fvk.js";import{F as T}from"./FormSelect-DckZIl1p.js";import{A as B,C as U,T as G}from"./TextField-DXeN24BL.js";import{I as J}from"./Image-CbaU3Ogc.js";import{B as b}from"./Button-DUm19Z6r.js";import"./Card-B6ongrnB.js";import"./divWithClassName-Ds10gy6J.js";import"./FormContext-CVQotS7s.js";import"./useFormControl-BV-vA5Rt.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-C8K2eoCJ.js";const oe=()=>{const[r,x]=m.useState({username:"",role:"Worker",phone:"",startDate:"",name:"",address:"",postalCode:"",city:"",isProjectManager:null}),{companyId:h,projectId:S,workerId:p}=V(),[w,D]=m.useState([]),[N,y]=m.useState([]),[C,v]=m.useState(null),[P,f]=m.useState(null),j=m.useRef(null),F=k(),{setLoading:d}=A(),I=async()=>{try{const s=await(await fetch(`${u}/get-company-professions?companyId=${h}&projectId=${S}`)).json();D(s)}catch(t){console.error("Error fetching professions:",t)}},c=t=>{const{name:s,value:l}=t.target;x({...r,[s]:l})},E=t=>{const{name:s,value:l}=t.target;x({...r,[s]:l})},R=t=>{const s=t.target.files[0];if(s){v(s);const l=new FileReader;l.onload=g=>{f(g.target.result)},l.readAsDataURL(s)}},$=()=>{v(null),f(null),j.current&&(j.current.value="")};m.useEffect(()=>{p&&(d(!0),I(),fetch(`${u}/get-user-detail/${p}`).then(async t=>{const s=await t.json();if(x({username:s.username||"",role:s.role||"Worker",phone:s.phone||"",startDate:s.startDate||"",name:s.name||"",address:s.address||"",postalCode:s.postalCode||"",city:s.city||"",isProjectManager:s.isProjectManager||null}),s.userProfession&&Array.isArray(s.userProfession)&&y(s.userProfession),s.picture){const l=s.picture.startsWith("http")?s.picture:`${u.replace("/api","")}/uploads/${s.picture}`;f(l)}console.log("Worker data for form:",s)}).catch(t=>console.error(t)).finally(()=>d(!1)))},[p,d]);const M=async()=>{d(!0);const t=new FormData;Object.keys(r).forEach(s=>{s==="picture"&&C?t.append(s,C):s==="isProjectManager"||s==="userProfession"?t.append(s,JSON.stringify(r[s])):t.append(s,r[s])}),t.append("userProfession",JSON.stringify(N));try{const s=await fetch(`${u}/update-user/${p}`,{method:"POST",body:t});s.ok?F(`/dashboard/companies/view/${h}`):console.error("Error:",s.statusText)}catch(s){console.error("Fetch error:",s)}d(!1)},W=()=>{F(`/dashboard/companies/view/${h}`)};return e.jsxs(e.Fragment,{children:[e.jsx(O,{title:"Edit Worker"}),e.jsx("form",{onSubmit:t=>{t.preventDefault(),M()},children:e.jsx(n,{className:"justify-content-center",children:e.jsx(a,{children:e.jsx(L,{title:"Edit Worker Details",children:e.jsxs(n,{children:[e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Email"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:r.username,onChange:c,name:"username",type:"email",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Name"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:r.name,onChange:c,name:"name",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Phone"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:r.phone,onChange:c,name:"phone",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Address"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:r.address,onChange:c,name:"address",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"City"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:r.city,onChange:c,name:"city",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Post Code"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:r.postalCode,onChange:c,name:"postalCode",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Start Date"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:r.startDate,onChange:c,name:"startDate",type:"date",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{className:"col-sm-2 col-form-label text-end",children:"Is project Manager"}),e.jsx(a,{sm:"10",children:e.jsxs(T,{value:r.isProjectManager,name:"isProjectManager",onChange:E,children:[e.jsx("option",{defaultValue:"",children:"Select"}),e.jsx("option",{value:"yes",children:"Yes"}),e.jsx("option",{value:"No",children:"No"})]})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Profession"}),e.jsx(a,{sm:"10",children:e.jsx(B,{multiple:!0,options:w,getOptionLabel:t=>t.GroupName,value:N,onChange:(t,s)=>{y(s)},renderInput:t=>e.jsx(G,{...t,variant:"outlined",placeholder:"Search and select professions..."}),renderTags:(t,s)=>t.map((l,g)=>e.jsx(U,{label:l.GroupName,...s({index:g})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Picture"}),e.jsxs(a,{sm:"10",children:[e.jsx(i,{type:"file",id:"file-input",name:"picture",onChange:R,accept:"image/*",ref:j}),P&&e.jsxs("div",{className:"mt-3 position-relative",children:[e.jsx(J,{src:P,alt:"Preview",fluid:!0,rounded:!0,style:{maxWidth:"200px",maxHeight:"200px"}}),e.jsx(b,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:$,style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"Ã—"})]})]})]})}),e.jsx(n,{className:"mb-3 d-flex justify-content-center",children:e.jsxs(a,{sm:"12",className:"d-flex justify-content-end",children:[e.jsx(b,{type:"button",variant:"secondary",className:"me-2",onClick:W,children:"Cancel"}),e.jsx(b,{type:"submit",variant:"primary",children:"Update Worker"})]})})]})})})})})]})};export{oe as default};
