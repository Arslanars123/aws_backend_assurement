import{r as n,j as e,R as S,C as N,a as $,m as k,aq as I}from"./index-CEbbE1Sf.js";import{P as L}from"./PageMetaData-qE4R9bbS.js";import{c as P,a as j,u as C,o as F,b as B}from"./index.esm-DCL929i9.js";import{T as w}from"./TextFormInput-bH67EBYG.js";import{I as b}from"./IconifyIcon-D36SGIkR.js";import{a as q}from"./index-Dq7h7Pqt.js";import{B as E}from"./urls-CvG9cD6N.js";import{l as T}from"./jpo-Ci11ADWT.js";import{C as U}from"./Card-mt6mV6AB.js";import"./FormControl-DFJ9Ydzw.js";import"./FormContext-CSwRqVJr.js";import"./FormGroup-Dn5oDdrP.js";import"./FormLabel-WQTNbj7P.js";import"./divWithClassName-CT9nWrpT.js";const A=({email:s,onCodeVerified:r})=>{const[i,a]=n.useState(!1),[t,c]=n.useState({success:!1,message:""}),l=P({code:j().required("Verification code is required").length(6,"Code must be 6 digits")}),{control:d,handleSubmit:f,reset:p}=C({resolver:F(l),defaultValues:{code:""}}),g=async x=>{var m,u;a(!0),c({success:!1,message:""});try{const o=await q.post(`${E}/verify-forgot-password-code`,{email:s,code:x.code,platform:"react"});o.data.success?(c({success:!0,message:"Code verified successfully!"}),p(),setTimeout(()=>{r(s,x.code)},1e3)):c({success:!1,message:o.data.error||"Invalid verification code."})}catch(o){c({success:!1,message:((u=(m=o.response)==null?void 0:m.data)==null?void 0:u.error)||"Failed to verify code. Please try again."})}finally{a(!1)}};return e.jsxs("form",{onSubmit:f(g),className:"p-3",children:[t.message&&e.jsx("div",{className:`alert ${t.success?"alert-success":"alert-danger"} mb-3`,children:t.message}),e.jsx("div",{className:"text-center mb-3",children:e.jsxs("p",{className:"text-muted",children:["We've sent a 6-digit verification code to ",e.jsx("strong",{children:s})]})}),e.jsx(w,{control:d,name:"code",label:"Verification Code",placeholder:"Enter 6-digit code",containerClassName:"form-group mb-2",disabled:i,maxLength:6}),e.jsx(S,{className:"form-group mb-0",children:e.jsx(N,{xs:12,children:e.jsx("div",{className:"d-grid mt-3",children:e.jsx("button",{className:"btn btn-primary flex-centered",type:"submit",disabled:i,children:i?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Verifying..."]}):e.jsxs(e.Fragment,{children:["Verify Code ",e.jsx(b,{icon:"fa6-solid:check",className:"ms-1"})]})})})})})]})},D=({email:s})=>{const[r,i]=n.useState(!1),[a,t]=n.useState({success:!1,message:""}),c=$(),l=P({newPassword:j().required("New password is required").min(6,"Password must be at least 6 characters"),confirmPassword:j().required("Please confirm your password").oneOf([B("newPassword")],"Passwords must match")}),{control:d,handleSubmit:f,reset:p}=C({resolver:F(l),defaultValues:{newPassword:"",confirmPassword:""}}),g=async x=>{var m,u;i(!0),t({success:!1,message:""});try{const o=await q.post(`${E}/reset-password`,{email:s,newPassword:x.newPassword,platform:"react"});o.data.success?(t({success:!0,message:"Password reset successfully! Redirecting to login..."}),p(),setTimeout(()=>{c("/auth/login")},2e3)):t({success:!1,message:o.data.error||"Failed to reset password."})}catch(o){t({success:!1,message:((u=(m=o.response)==null?void 0:m.data)==null?void 0:u.error)||"Failed to reset password. Please try again."})}finally{i(!1)}};return e.jsxs("form",{onSubmit:f(g),className:"p-3",children:[a.message&&e.jsx("div",{className:`alert ${a.success?"alert-success":"alert-danger"} mb-3`,children:a.message}),e.jsx("div",{className:"text-center mb-3",children:e.jsxs("p",{className:"text-muted",children:["Create a new password for ",e.jsx("strong",{children:s})]})}),e.jsx(w,{control:d,name:"newPassword",label:"New Password",placeholder:"Enter new password",type:"password",containerClassName:"form-group mb-2",disabled:r}),e.jsx(w,{control:d,name:"confirmPassword",label:"Confirm New Password",placeholder:"Confirm new password",type:"password",containerClassName:"form-group mb-2",disabled:r}),e.jsx(S,{className:"form-group mb-0",children:e.jsx(N,{xs:12,children:e.jsx("div",{className:"d-grid mt-3",children:e.jsx("button",{className:"btn btn-primary flex-centered",type:"submit",disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Resetting..."]}):e.jsxs(e.Fragment,{children:["Reset Password ",e.jsx(b,{icon:"fa6-solid:key",className:"ms-1"})]})})})})})]})},M=({onStepChange:s})=>{const[r,i]=n.useState(!1),[a,t]=n.useState({success:!1,message:""}),[c,l]=n.useState("request"),[d,f]=n.useState(""),p=P({email:j().email("Enter a valid email").required("Email is required")}),{control:g,handleSubmit:x,reset:m}=C({resolver:F(p),defaultValues:{email:""}}),u=async y=>{var v,V;i(!0),t({success:!1,message:""});try{const h=await q.post(`${E}/forgot-password-request`,{email:y.email,platform:"react"});h.data.success?(t({success:!0,message:h.data.message||"Password reset code sent to your email."}),f(y.email),l("verify"),s&&s("verify"),m()):t({success:!1,message:h.data.error||"Failed to send reset code."})}catch(h){t({success:!1,message:((V=(v=h.response)==null?void 0:v.data)==null?void 0:V.error)||"Failed to send reset code. Please try again."})}finally{i(!1)}},o=(y,v)=>{l("reset"),s&&s("reset")},R=()=>{l("request"),s&&s("request"),f(""),t({success:!1,message:""})};return c==="verify"?e.jsxs("div",{className:"p-3",children:[e.jsx(A,{email:d,onCodeVerified:o}),e.jsx("div",{className:"text-center mt-3",children:e.jsxs("button",{type:"button",className:"btn btn-link text-muted",onClick:R,children:[e.jsx(b,{icon:"fa6-solid:arrow-left",className:"me-1"}),"Back to email request"]})})]}):c==="reset"?e.jsxs("div",{className:"p-3",children:[e.jsx(D,{email:d}),e.jsx("div",{className:"text-center mt-3",children:e.jsxs("button",{type:"button",className:"btn btn-link text-muted",onClick:R,children:[e.jsx(b,{icon:"fa6-solid:arrow-left",className:"me-1"}),"Start over"]})})]}):e.jsxs("form",{onSubmit:x(u),className:"p-3",children:[a.message&&e.jsx("div",{className:`alert ${a.success?"alert-success":"alert-danger"} mb-3`,children:a.message}),e.jsx(w,{control:g,name:"email",label:"Email",placeholder:"Enter your email",containerClassName:"form-group mb-2",disabled:r}),e.jsx(S,{className:"form-group mb-0",children:e.jsx(N,{xs:12,children:e.jsx("div",{className:"d-grid mt-3",children:e.jsx("button",{className:"btn btn-primary flex-centered",type:"submit",disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Sending..."]}):e.jsxs(e.Fragment,{children:["Reset ",e.jsx(b,{icon:"fa6-solid:right-to-bracket",className:"ms-1"})]})})})})})]})},ae=()=>{const[s,r]=n.useState("request"),a=(()=>{switch(s){case"verify":return{title:"Verify Code",subtitle:"Enter the verification code sent to your email"};case"reset":return{title:"Create New Password",subtitle:"Enter your new password"};default:return{title:"Reset Password",subtitle:"Enter your Email and instructions will be sent to you!"}}})();return e.jsxs(e.Fragment,{children:[e.jsx(L,{title:a.title}),e.jsx(N,{lg:4,className:"mx-auto",children:e.jsxs(U,{children:[e.jsx(k,{className:"p-0 bg-black auth-header-box rounded-top",children:e.jsxs("div",{className:"text-center p-3",children:[e.jsx(I,{to:"/",className:"logo logo-admin",children:e.jsx("img",{src:T,height:50,alt:"logo",className:"auth-logo"})}),e.jsx("h4",{className:"mt-3 mb-1 fw-semibold text-white fs-18",children:a.title}),e.jsx("p",{className:"text-muted fw-medium mb-0",children:a.subtitle})]})}),e.jsxs(k,{className:"pt-0",children:[e.jsx(M,{onStepChange:r}),e.jsx("div",{className:"text-center  mb-2",children:e.jsxs("p",{className:"text-muted",children:["Remember It ?"," ",e.jsx(I,{to:"/auth/login",className:"text-primary ms-2",children:"Sign in here"})]})})]})]})})]})};export{ae as default};
