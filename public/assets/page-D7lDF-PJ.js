import{r as c,a as _,b as G,j as e,R as i,C as o}from"./index-BfjhYpb5.js";import{C as K}from"./ComponentContainerCard-BbSfpbsX.js";import{P as Q}from"./PageMetaData-CFx5C9vJ.js";import{B as m}from"./urls-CXtk4x-h.js";import{D as X}from"./page-ByyqFTLL.js";import{F as p}from"./FormLabel-9Op50W6F.js";import{F as C}from"./FormControl-u0lKnE3u.js";import{F as Y}from"./FormSelect-CIOplRxv.js";import{A as g,T as j,C as f}from"./TextField-55yUiIyZ.js";import{I as Z}from"./Image-D3CG5EY4.js";import{B as ee}from"./Button-0d7iDM-S.js";import"./Card-CjeZJw7I.js";import"./divWithClassName-CLs3g5aQ.js";import"./Modal-Cs5seNFI.js";import"./useWindow-DCmLp1st.js";import"./DataKey-COGXBUcQ.js";import"./NoopTransition-dAavQWp2.js";import"./FormRange-fPwVophq.js";import"./useSlot-gx2Y3tCc.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-BcofISFZ.js";const te={supplementory:"",time:"",item:null,selectedDrawing:null,projectManager:null,recipients:null},ve=()=>{var v,N;const[n,l]=c.useState(te),[I,b]=c.useState(!1),[A,D]=c.useState([]),[h,w]=c.useState({show:!1,imgUrl:null}),k=c.useRef(),[y,F]=c.useState(null),[M,$]=c.useState([]),[T,O]=c.useState([]),[P,E]=c.useState([]),[R,B]=c.useState(10),U=_(),{companyId:u,projectId:d}=G(),S=t=>{const{name:s,value:a}=t.target;l({...n,[s]:a})};c.useEffect(()=>{L(),W(),V()},[d]);const L=async()=>{try{const s=await(await fetch(`${m}/get-draws?companyId=${u}&projectId=${d}`)).json();D(s)}catch(t){console.error("Error fetching workers:",t)}},J=t=>{const{name:s,value:a,multiple:r,options:z}=t.target;if(r){const H=Array.from(z).filter(x=>x.selected).map(x=>x.value);l({...n,[s]:H})}else l({...n,[s]:a})},W=async()=>{try{const t=`${m}/get-project-managers?companyId=${u}&projectId=${d}`,a=await(await fetch(t)).json();$(a)}catch(t){console.error("Error fetching project managers:",t)}},V=async()=>{try{const t=`${m}/get-filter-users`,r=await(await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({companyId:u,projectId:d})})).json();O(r)}catch(t){console.error("Error fetching users:",t)}},q=async t=>{t.preventDefault(),b(!0);try{const s=new FormData;Object.keys(n).forEach(r=>{r==="projectManager"||r==="selectedDrawing"||r==="recipients"||s.append(r,n[r])}),s.append("companyId",u),s.append("projectsId",d),s.append("drawing",JSON.stringify(n.selectedDrawing)),s.append("projectManager",JSON.stringify(n.projectManager)),s.append("recipients",JSON.stringify(n.recipients)),y&&s.append("annotatedImage",y);const a=await fetch(`${m}/store-new`,{method:"POST",body:s});if(a.ok){const r=await a.json();U(`/dashboard/companies/view/${u}/projects/view/${d}`,{state:{success:"New Aggrement added successfully!"}})}else console.error("Error:",a.statusText)}catch(s){console.error("Fetch error:",s)}b(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(Q,{title:"Add New Aggrement"}),e.jsx("form",{onSubmit:q,children:e.jsx(i,{className:"justify-content-center",children:e.jsx(o,{children:e.jsx(K,{title:"Add New Aggrement",children:e.jsxs(i,{children:[e.jsx(o,{lg:"6",children:e.jsxs(i,{className:"mb-3",children:[e.jsx(p,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Supplementory"}),e.jsx(o,{sm:"10",children:e.jsx(C,{value:n.supplementory,onChange:S,name:"supplementory",type:"text",id:"example-text-input"})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(i,{className:"mb-3",children:[e.jsx(p,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Days | Hours"}),e.jsx(o,{sm:"10",children:e.jsx(C,{value:n.time,onChange:S,name:"time",type:"text",id:"example-text-input"})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(i,{className:"mb-3",children:[e.jsx(p,{className:"col-sm-2 col-form-label text-end",children:"Select Item"}),e.jsx(o,{sm:"10",children:e.jsxs(Y,{value:n.item,name:"item",onChange:J,children:[e.jsx("option",{defaultValue:"",children:"Select Item"}),e.jsx("option",{value:"A new agreement has been concluded with construction management today.",children:"A new agreement has been concluded with construction management today."}),e.jsx("option",{value:"Change work has been notified.",children:"Change work has been notified."}),e.jsx("option",{value:"Forced work must be agreed, due to delays from other contractors",children:"Forced work must be agreed, due to delays from other contractors"}),e.jsx("option",{value:"The construction management has instructed a change in the work that must be carried out in accounting work.",children:"The construction management has instructed a change in the work that must be carried out in accounting work."}),e.jsx("option",{value:"Work that has been necessary for safety or for the sake of construction.",children:"Work that has been necessary for safety or for the sake of construction."}),e.jsx("option",{value:"Someone has destroyed my work after final inspection.",children:"Someone has destroyed my work after final inspection."})]})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(i,{className:"mb-3",children:[e.jsx(p,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Recipients"}),e.jsx(o,{sm:"10",children:e.jsx(g,{multiple:!1,options:T,getOptionLabel:t=>t.name,value:n==null?void 0:n.recipients,onChange:(t,s)=>{l({...n,recipients:s})},renderInput:t=>e.jsx(j,{...t,variant:"outlined",placeholder:"Search and select Project Users..."}),renderTags:(t,s)=>t.map((a,r)=>e.jsx(f,{label:a.name,...s({index:r})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(i,{className:"mb-3",children:[e.jsx(p,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Project Manager"}),e.jsx(o,{sm:"10",children:e.jsx(g,{multiple:!1,options:M,getOptionLabel:t=>t.name,value:n==null?void 0:n.projectManager,onChange:(t,s)=>{l({...n,projectManager:s})},renderInput:t=>e.jsx(j,{...t,variant:"outlined",placeholder:"Search and select Project Manager..."}),renderTags:(t,s)=>t.map((a,r)=>e.jsx(f,{label:a.name,...s({index:r})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(i,{className:"mb-3",children:[e.jsx(p,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Drawing"}),e.jsx(o,{sm:"10",children:e.jsx(g,{multiple:!1,options:A,getOptionLabel:t=>t.name,value:n==null?void 0:n.selectedDrawing,onChange:(t,s)=>{l({...n,selectedDrawing:s})},renderInput:t=>e.jsx(j,{...t,variant:"outlined",placeholder:"Search and select drawing..."}),renderTags:(t,s)=>t.map((a,r)=>e.jsx(f,{label:a.name,...s({index:r})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(o,{lg:"6",children:e.jsx(i,{className:"",children:(N=(v=n==null?void 0:n.selectedDrawing)==null?void 0:v.pictures)==null?void 0:N.map((t,s)=>e.jsx("div",{className:"position-relative me-2 mb-2",children:e.jsx(Z,{src:`${m}/uploads/${t}`,onClick:()=>{w({show:!0,imgUrl:`${m}/uploads/${t}`})},alt:`Existing Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}})},`existing-${s}`))})}),(h==null?void 0:h.show)&&e.jsx(o,{lg:"6",children:e.jsx(i,{children:e.jsx("div",{className:"position-relative",style:{maxWidth:"100%",height:"auto"},children:e.jsx(X,{ref:k,drawDotsOnImage:h,setDrawDotsAnImage:w,onSave:t=>{F(t)},setMarkers:E,markers:P,dotSize:R,setDotSize:B})})})}),e.jsx(i,{className:"mb-3 d-flex justify-content-center",children:e.jsx(o,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(ee,{disabled:I,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{ve as default};
