import{r as l,a as q,b as K,j as e,R as o,C as r}from"./index-BaEXYFjf.js";import{C as Q}from"./ComponentContainerCard-r7D-7GT6.js";import{P as X}from"./PageMetaData-PSLyQQbJ.js";import{B as h}from"./urls-D3INM0xz.js";import{F as m}from"./FormLabel-BbxHmEpm.js";import{F as p}from"./FormControl-ZQh5JFHF.js";import{F as Z}from"./FormSelect-Bf0Zl-q8.js";import{A as I,C as W,T as O}from"./TextField-UgdUJxiT.js";import{I as ee}from"./Image-CFc3DKY_.js";import{B as g}from"./Button-CHKoWH3g.js";import"./Card-Dy9P-MVM.js";import"./divWithClassName-C80pLmVh.js";import"./FormContext-kuoxlIs5.js";import"./useFormControl-ct2n4dLn.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-C8K2eoCJ.js";const se={username:"",role:"Worker",phone:"",startDate:"",name:"",address:"",postalCode:"",city:"",isProjectManager:null},te=()=>{const[n,b]=l.useState(se),[y,v]=l.useState(!1),f=q(),[N,C]=l.useState(null),[P,S]=l.useState(null),j=l.useRef(null),[x,R]=l.useState([]),[k,T]=l.useState([]),[$,E]=l.useState([]),[w,A]=l.useState([]),F=l.useRef(!1),{companyId:d,projectId:i}=K(),u=t=>{const{name:s,value:a}=t.target;b({...n,[s]:a})},V=t=>{const s=t.target.files[0];if(C(s),s){const a=URL.createObjectURL(s);S(a)}},D=async t=>{t.preventDefault();for(const[s,a]of Object.entries(n))if(a===""||a===null){alert(`Please fill out the "${s}" field.`);return}v(!0);try{const s=new FormData;Object.keys(n).forEach(c=>{s.append(c,n[c])}),N&&s.append("picture",N),s.append("companyId",d),s.append("projectsId",i),s.append("userProfession",JSON.stringify(k));const a=await fetch(`${h}/store-user`,{method:"POST",body:s});if(a.ok){const c=await a.json();f(`/dashboard/companies/view/${d}`,{state:{success:"Worker added successfully!"}})}else console.error("Error:",a.statusText)}catch(s){console.error("Fetch error:",s)}v(!1)},M=t=>{n[t.target.name]=t.target.value,b({...n})},L=()=>{C(null),S(null),j.current&&(j.current.value="")},U=async()=>{try{const s=await(await fetch(`${h}/get-company-professions?companyId=${d}&projectId=${i}`)).json();if(!(s!=null&&s.length)&&!F.current){if(F.current=!0,i){alert("You did not have any Profession so need to add Profession in a Project"),f(`/dashboard/companies/view/${d}/projects/view/${i}`);return}alert("You did not have any Profession so need to add Profession in a Company"),f(`/dashboard/companies/view/${d}`);return}R(s)}catch(t){console.error("Error fetching professions:",t)}},_=async t=>{try{const s={companyId:d,professionsIds:t,roles:["Worker"]},c=await(await fetch(`${h}/get-filter-users`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json(),J={companyId:d,professionsIds:t,projectId:i,roles:["Worker"]},Y=await(await fetch(`${h}/get-filter-users`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(J)})).json(),G=c.filter(z=>!Y.some(H=>H._id===z._id));E(G)}catch(s){console.error("Error fetching workers:",s)}};l.useEffect(()=>{d&&U()},[d,i]),l.useEffect(()=>{if(x!=null&&x.length&&d&&i){const t=x.map(s=>s._id);_(t)}},[x]);const B=async()=>{try{if(!i)return;const s={userIds:w.map(c=>c._id),projectId:i},a=await fetch(`${h}/updateUser`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(a.ok){const c=await a.json();f(`/dashboard/companies/view/${d}/projects/view/${i}`,{state:{success:"Worker added successfully!"}})}else console.error("Error:",a.statusText)}catch(t){console.log("Error adding worker to project:",t)}};return e.jsxs(e.Fragment,{children:[e.jsx(X,{title:"Add Worker"}),!i&&e.jsx("form",{onSubmit:D,children:e.jsx(o,{className:"justify-content-center",children:e.jsx(r,{children:e.jsx(Q,{title:"Add Worker",children:e.jsxs(o,{children:[e.jsx(r,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(m,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Email"}),e.jsx(r,{sm:"10",children:e.jsx(p,{value:n.username,onChange:u,name:"username",type:"email",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(r,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(m,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Name"}),e.jsx(r,{sm:"10",children:e.jsx(p,{value:n.name,onChange:u,name:"name",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(r,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(m,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Phone"}),e.jsx(r,{sm:"10",children:e.jsx(p,{value:n.phone,onChange:u,name:"phone",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(r,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(m,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Address"}),e.jsx(r,{sm:"10",children:e.jsx(p,{value:n.address,onChange:u,name:"address",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(r,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(m,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"City"}),e.jsx(r,{sm:"10",children:e.jsx(p,{value:n.city,onChange:u,name:"city",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(r,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(m,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Post Code"}),e.jsx(r,{sm:"10",children:e.jsx(p,{value:n.postalCode,onChange:u,name:"postalCode",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(r,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(m,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Start Date"}),e.jsx(r,{sm:"10",children:e.jsx(p,{value:n.startDate,onChange:u,name:"startDate",type:"date",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(r,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Is project Manager"}),e.jsx(r,{sm:"10",children:e.jsxs(Z,{value:n.isProjectManager,name:"isProjectManager",onChange:M,children:[e.jsx("option",{defaultValue:"",children:"Select"}),e.jsx("option",{value:"yes",children:"Yes"}),e.jsx("option",{value:"No",children:"No"})]})})]})}),e.jsx(r,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(m,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Profession"}),e.jsx(r,{sm:"10",children:e.jsx(I,{multiple:!0,options:x,getOptionLabel:t=>t.GroupName,value:k,onChange:(t,s)=>{T(s)},renderInput:t=>e.jsx(O,{...t,variant:"outlined",placeholder:"Search and select professions..."}),renderTags:(t,s)=>t.map((a,c)=>e.jsx(W,{label:a.GroupName,...s({index:c})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(r,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(m,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Picture"}),e.jsxs(r,{sm:"10",children:[e.jsx(p,{type:"file",id:"file-input",name:"picture",onChange:V,accept:"image/*",ref:j}),P&&e.jsxs("div",{className:"mt-3 position-relative",children:[e.jsx(ee,{src:P,alt:"Preview",fluid:!0,rounded:!0,style:{maxWidth:"200px",maxHeight:"200px"}}),e.jsx(g,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:L,style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"Ã—"})]})]})]})}),e.jsx(o,{className:"mb-3 d-flex justify-content-center",children:e.jsx(r,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(g,{disabled:y,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})}),i&&e.jsxs(o,{className:"mb-3",children:[e.jsx(m,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Select Worker for this Projects"}),e.jsxs(r,{sm:"10",children:[e.jsx(I,{multiple:!0,options:$,getOptionLabel:t=>t.name,value:w,onChange:(t,s)=>{A(s)},renderInput:t=>e.jsx(O,{...t,variant:"outlined",placeholder:"Search and select worker..."}),renderTags:(t,s)=>t.map((a,c)=>e.jsx(W,{label:a.name,...s({index:c})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}}),e.jsx(o,{className:"mb-3 mt-3 d-flex justify-content-center",children:e.jsx(r,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(g,{disabled:y,type:"submit",variant:"primary",className:"me-1",onClick:B,children:"Submit"})})})]})]})]})},ye=l.memo(te);export{ye as default};
