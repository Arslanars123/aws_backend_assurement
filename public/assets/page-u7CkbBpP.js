import{r,a as k,G as v,j as e,R as l,C as c}from"./index-B9-Fw72-.js";import{C as N}from"./ComponentContainerCard-CQST7gBQ.js";import{P as F}from"./PageMetaData-D2p2uQ5O.js";import{B as u}from"./urls-BhGeBsON.js";import{F as x}from"./FormLabel-Npy4DC-M.js";import{F as S}from"./FormSelect-DDDEprLJ.js";import{B as I}from"./Button-CN5PJwBC.js";import"./Card-ZzJPZ8wj.js";import"./divWithClassName-COkzKTYF.js";const R={project:null,worker:null,projectId:null,professionId:null},Y=()=>{const[a,g]=r.useState(R),[b,m]=r.useState(!1),p=k(),[f,G]=r.useState(null);r.useState(null),r.useRef(null);const{selectedCompany:i,selectedProjects:d,companies:W,projects:A}=r.useContext(v),[h,B]=r.useState([]);r.useState([]),r.useRef(null),r.useEffect(()=>{},[]);const j=t=>{a[t.target.name]=t.target.value,g({...a})},y=async t=>{if(t.preventDefault(),!d||d.length===0){alert("You must select company and project"),p("/dashboard/companies");return}m(!0);try{const s=new FormData;Object.keys(a).forEach(o=>{s.append(o,a[o])}),f&&s.append("picture",f),s.append("companyId",i),s.append("projectsId",d),h.length>0&&h.forEach(o=>{s.append("pictures",o)});const n=await fetch(`${u}/store-group`,{method:"POST",body:s});if(n.ok){const o=await n.json();p("/dashboard/groups",{state:{success:"Group added successfully!"}})}else console.error("Error:",n.statusText)}catch(s){console.error("Fetch error:",s)}m(!1)};r.useEffect(()=>{(async()=>{try{const n=await(await fetch(`${u}/get-professions`)).json();P(n)}catch(s){console.error("Error fetching projects:",s)}})()},[]);const[w,P]=r.useState([]);r.useEffect(()=>{(async()=>{try{const s=new URLSearchParams;i&&s.append("companyId",i);const o=await(await fetch(`${u}/get-workers?${s.toString()}`)).json();E(o)}catch(s){console.error("Error fetching workers:",s)}})()},[i]);const[C,E]=r.useState([]);return e.jsxs(e.Fragment,{children:[e.jsx(F,{title:"Add Group"}),e.jsx("form",{onSubmit:y,children:e.jsx(l,{className:"justify-content-center",children:e.jsx(c,{children:e.jsx(N,{title:"Add Group",children:e.jsxs(l,{children:[e.jsx(c,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(x,{className:"col-sm-2 col-form-label text-end",children:"Select Profession"}),e.jsx(c,{sm:"10",children:e.jsxs(S,{value:a.professionId,name:"professionId",onChange:j,children:[e.jsx("option",{defaultValue:"",children:"Select Profession"}),w.map(t=>e.jsxs("option",{value:t._id,children:[t.name," "]},t.id))]})})]})}),e.jsx(c,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(x,{className:"col-sm-2 col-form-label text-end",children:"Select Worker"}),e.jsx(c,{sm:"10",children:e.jsxs(S,{value:a.worker,name:"worker",onChange:j,children:[e.jsx("option",{defaultValue:"",children:"Select Worker"}),C.map(t=>e.jsx("option",{value:t._id,children:t.username},t.id))]})})]})}),e.jsx(l,{className:"mb-3 d-flex justify-content-center",children:e.jsx(c,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(I,{disabled:b,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{Y as default};
