import{r as i,a as ee,b as te,j as e,R as l,C as o}from"./index-DpbIAROa.js";import{C as se}from"./ComponentContainerCard-kAFFVE0Z.js";import{P as ae}from"./PageMetaData-C6UhIQjj.js";import{B as p}from"./urls-CXtk4x-h.js";import{D as ne}from"./page-BNX7ZN3D.js";import{F as u}from"./FormLabel-BVfCwwhh.js";import{F as re}from"./FormSelect-CT6NOnnm.js";import{A as S,T as f,C as y}from"./TextField-FXRTZwW7.js";import{I as P}from"./Image-B69svh6Q.js";import{F as oe}from"./FormControl-CRveXHIl.js";import{B as $}from"./Button-DGaw8vsr.js";import"./Card-DYgbdisJ.js";import"./divWithClassName-DPLQ3Lm2.js";import"./Modal-C9CqSm-2.js";import"./useWindow-9G6U8rOx.js";import"./DataKey-COGXBUcQ.js";import"./NoopTransition-YmUpd_Fy.js";import"./FormRange-BeCgdMae.js";import"./useSlot-DUXHA9fQ.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-BcofISFZ.js";const ie={item:null,users:null,selectedDrawing:null,projectManager:null,recipients:null,comment:null},Ae=()=>{var A,F;const[a,d]=i.useState(ie),[R,N]=i.useState(!1),O=ee(),{companyId:h,projectId:m}=te(),[T,k]=i.useState([]),[g,C]=i.useState({show:!1,imgUrl:null}),E=i.useRef(),[I,L]=i.useState(null),[U,B]=i.useState([]),[j,M]=i.useState([]),[b,D]=i.useState([]),w=i.useRef(null),[z,W]=i.useState([]),[J,V]=i.useState([]),[_,q]=i.useState(10),H=async()=>{try{const s=await(await fetch(`${p}/get-draws?companyId=${h}&projectId=${m}`)).json();k(s)}catch(t){console.error("Error fetching workers:",t)}},G=async()=>{try{const t=`${p}/get-project-managers?companyId=${h}&projectId=${m}`,r=await(await fetch(t)).json();W(r)}catch(t){console.error("Error fetching project managers:",t)}},K=async()=>{try{const t=`${p}/get-filter-users`,n=await(await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({companyId:h,projectId:m})})).json();V(n)}catch(t){console.error("Error fetching users:",t)}};i.useEffect(()=>{H(),G(),K()},[m]);const Q=t=>{const s=Array.from(t.target.files),r=[...j,...s],n=[...b,...s.map(c=>URL.createObjectURL(c))];M(r),D(n)},X=t=>{const s=j.filter((c,x)=>x!==t),r=b.filter((c,x)=>x!==t);M(s),D(r);const n=new DataTransfer;s.forEach(c=>n.items.add(c)),w.current&&(w.current.files=n.files)},Y=t=>{const{name:s,value:r,multiple:n,options:c}=t.target;if(n){const x=Array.from(c).filter(v=>v.selected).map(v=>v.value);d({...a,[s]:x})}else d({...a,[s]:r})},Z=async t=>{t.preventDefault(),N(!0);try{const s=new FormData;Object.keys(a).forEach(n=>{n==="projectManager"||n==="selectedDrawing"||n==="recipients"||s.append(n,a[n])}),s.append("companyId",h),s.append("projectsId",m),s.append("comment",a.comment),s.append("drawing",JSON.stringify(a.selectedDrawing)),s.append("projectManager",JSON.stringify(a.projectManager)),s.append("recipients",JSON.stringify(a.recipients)),I&&s.append("annotatedImage",I),j.length>0&&j.forEach(n=>{s.append("pictures",n)});const r=await fetch(`${p}/store-mention`,{method:"POST",body:s});if(r.ok){const n=await r.json();O(`/dashboard/companies/view/${h}/projects/view/${m}`,{state:{success:"Safety Mention added successfully!"}})}else console.error("Error:",r.statusText)}catch(s){console.error("Fetch error:",s)}N(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(ae,{title:"Add Safety Mention"}),e.jsx("form",{onSubmit:Z,children:e.jsx(l,{className:"justify-content-center",children:e.jsx(o,{children:e.jsx(se,{title:"Add Safety Mention",children:e.jsxs(l,{children:[e.jsx(o,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(u,{className:"col-sm-2 col-form-label text-end",children:"Select Item"}),e.jsx(o,{sm:"10",children:e.jsxs(re,{value:a.item,name:"item",onChange:Y,children:[e.jsx("option",{defaultValue:"",children:"Select Item"}),e.jsx("option",{value:"Work has stopped",children:"Work has stopped"}),e.jsx("option",{value:"Shielding is missing here",children:"Shielding is missing here"}),e.jsx("option",{value:"A safety hazard",children:"A safety hazard"}),e.jsx("option",{value:"Lacks cleanup",children:"Lacks cleanup"}),e.jsx("option",{value:"Security shielding inhibits my work",children:"Security shielding inhibits my work"}),e.jsx("option",{value:"Scaffolding is not done appropriately",children:"Scaffolding is not done appropriately"})]})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(u,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Recipients"}),e.jsx(o,{sm:"10",children:e.jsx(S,{multiple:!1,options:J,getOptionLabel:t=>t.name,value:a==null?void 0:a.recipients,onChange:(t,s)=>{d({...a,recipients:s})},renderInput:t=>e.jsx(f,{...t,variant:"outlined",placeholder:"Search and select Project Users..."}),renderTags:(t,s)=>t.map((r,n)=>e.jsx(y,{label:r.name,...s({index:n})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(u,{className:"col-sm-2 col-form-label text-end",children:"Comment"}),e.jsx(o,{sm:"10",children:e.jsx(f,{style:{width:"100%"},variant:"outlined",placeholder:"Add some comments...",value:a==null?void 0:a.comment,onChange:t=>{var s;d({...a,comment:(s=t==null?void 0:t.target)==null?void 0:s.value})}})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(u,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Project Manager"}),e.jsx(o,{sm:"10",children:e.jsx(S,{multiple:!1,options:z,getOptionLabel:t=>t.name,value:a==null?void 0:a.projectManager,onChange:(t,s)=>{d({...a,projectManager:s})},renderInput:t=>e.jsx(f,{...t,variant:"outlined",placeholder:"Search and select Project Manager..."}),renderTags:(t,s)=>t.map((r,n)=>e.jsx(y,{label:r.name,...s({index:n})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(u,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Drawing"}),e.jsx(o,{sm:"10",children:e.jsx(S,{multiple:!1,options:T,getOptionLabel:t=>t.name,value:a==null?void 0:a.selectedDrawing,onChange:(t,s)=>{d({...a,selectedDrawing:s})},renderInput:t=>e.jsx(f,{...t,variant:"outlined",placeholder:"Search and select drawing..."}),renderTags:(t,s)=>t.map((r,n)=>e.jsx(y,{label:r.name,...s({index:n})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(o,{lg:"6",children:e.jsx(l,{className:"",children:(F=(A=a==null?void 0:a.selectedDrawing)==null?void 0:A.pictures)==null?void 0:F.map((t,s)=>e.jsx("div",{className:"position-relative me-2 mb-2",children:e.jsx(P,{src:`${p}/uploads/${t}`,onClick:()=>{C({show:!0,imgUrl:`${p}/uploads/${t}`})},alt:`Existing Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}})},`existing-${s}`))})}),(g==null?void 0:g.show)&&e.jsx(o,{lg:"6",children:e.jsx(l,{children:e.jsx("div",{className:"position-relative",style:{maxWidth:"100%",height:"auto"},children:e.jsx(ne,{ref:E,drawDotsOnImage:g,setDrawDotsAnImage:C,onSave:t=>{L(t)},setMarkers:B,markers:U,dotSize:_,setDotSize:q})})})}),e.jsx(o,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(u,{htmlFor:"multiple-file-input",className:"col-sm-2 col-form-label text-end",children:"Pictures"}),e.jsxs(o,{sm:"10",children:[e.jsx(oe,{type:"file",id:"multiple-file-input",name:"pictures",onChange:Q,accept:"image/*",multiple:!0,ref:w}),e.jsx("div",{className:"mt-3 d-flex flex-wrap",children:b.map((t,s)=>e.jsxs("div",{className:"position-relative me-2 mb-2",children:[e.jsx(P,{src:t,alt:`Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),e.jsx($,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>X(s),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"Ã—"})]},s))})]})]})}),e.jsx(l,{className:"mb-3 d-flex justify-content-center",children:e.jsx(o,{sm:"12",className:"d-flex justify-content-end",children:e.jsx($,{disabled:R,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{Ae as default};
