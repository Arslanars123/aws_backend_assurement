import{r as o,a as ee,b as te,j as e,R as l,C as i}from"./index-y2AWh0VN.js";import{C as se}from"./ComponentContainerCard-WVgzLRCL.js";import{P as re}from"./PageMetaData-C9BjEYqK.js";import{B as d}from"./urls-BhGeBsON.js";import{D as ae}from"./page-GkYNIA8m.js";import{F as j}from"./FormLabel-B8nDnblu.js";import{F as ne}from"./FormSelect-RXFBsqyf.js";import{A as v,C as S,T as y}from"./TextField-CHOGXvH3.js";import{I as R}from"./Image-CSkiN27t.js";import{F as oe}from"./FormControl-BCsmvP-o.js";import{B as P}from"./Button-CUrgqYc1.js";import"./Card-pTEwvOBz.js";import"./divWithClassName-BLHGuKp8.js";import"./Modal-DUmHr7nc.js";import"./useWindow-BUTI6O21.js";import"./DataKey-BZN51oXa.js";import"./NoopTransition-1KXwFEeZ.js";import"./FormRange-CO87Iy6V.js";import"./useFormControl-C5hsiBKt.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-C8K2eoCJ.js";const ie={item:null,selectedDrawing:null,projectUsers:null,projectManager:null},Fe=()=>{var F,M;const[r,p]=o.useState(ie),[T,N]=o.useState(!1),$=ee(),{companyId:m,projectId:u}=te(),[U,O]=o.useState([]),[E,q]=o.useState([]),[k,B]=o.useState([]),[x,I]=o.useState([]),[f,C]=o.useState([]),b=o.useRef(null),L=o.useRef(),[D,J]=o.useState(null),[z,V]=o.useState([]),[W,_]=o.useState(10),[g,A]=o.useState({show:!1,imgUrl:null}),H=t=>{const s=Array.from(t.target.files),a=[...x,...s],n=[...f,...s.map(c=>URL.createObjectURL(c))];I(a),C(n)},G=t=>{const s=x.filter((c,h)=>h!==t),a=f.filter((c,h)=>h!==t);I(s),C(a);const n=new DataTransfer;s.forEach(c=>n.items.add(c)),b.current&&(b.current.files=n.files)},K=t=>{const{name:s,value:a,multiple:n,options:c}=t.target;if(n){const h=Array.from(c).filter(w=>w.selected).map(w=>w.value);p({...r,[s]:h})}else p({...r,[s]:a})},Q=async()=>{try{const t=`${d}/get-project-managers?companyId=${m}&projectId=${u}`,a=await(await fetch(t)).json();O(a)}catch(t){console.error("Error fetching project managers:",t)}},X=async()=>{try{const s=await(await fetch(`${d}/get-draws?companyId=${m}&projectId=${u}`)).json();B(s)}catch(t){console.error("Error fetching workers:",t)}},Y=async()=>{try{const t=`${d}/get-filter-users`,n=await(await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({companyId:m,projectId:u})})).json();q(n)}catch(t){console.error("Error fetching users:",t)}};o.useEffect(()=>{Q(),Y(),X()},[]);const Z=async t=>{t.preventDefault(),N(!0);try{const s=new FormData;s.append("companyId",m),s.append("projectsId",u),s.append("item",r.item),s.append("projectUsers",JSON.stringify(r.projectUsers)),s.append("projectManager",JSON.stringify(r.projectManager)),s.append("drawing",JSON.stringify(r.selectedDrawing)),D&&s.append("annotatedImage",D),x.length>0&&x.forEach(n=>{s.append("pictures",n)});const a=await fetch(`${d}/store-request`,{method:"POST",body:s});if(a.ok){const n=await a.json();$(`/dashboard/companies/view/${m}/projects/view/${u}`)}else console.error("Error:",a.statusText)}catch(s){console.error("Fetch error:",s)}N(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(re,{title:"Add Technical Request"}),e.jsx("form",{onSubmit:Z,children:e.jsx(l,{className:"justify-content-center",children:e.jsx(i,{children:e.jsx(se,{title:"Add Technical Request",children:e.jsxs(l,{children:[e.jsx(i,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(j,{className:"col-sm-2 col-form-label text-end",children:"Select Item"}),e.jsx(i,{sm:"10",children:e.jsxs(ne,{value:r.item,name:"item",onChange:K,children:[e.jsx("option",{defaultValue:"",children:"Select Item"}),e.jsx("option",{value:"Does not include project material.",children:"Does not include project material."}),e.jsx("option",{value:"Meeting at the construction site is required.",children:"Meeting at the construction site is required."}),e.jsx("option",{value:"There is no preparation as told.",children:"There is no preparation as told."}),e.jsx("option",{value:"A new instruction is requested here, as it is not possible",children:"A new instruction is requested here, as it is not possible"})]})})]})}),e.jsx(i,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(j,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Project Manager"}),e.jsx(i,{sm:"10",children:e.jsx(v,{multiple:!1,options:U,getOptionLabel:t=>t.name,value:r==null?void 0:r.projectManager,onChange:(t,s)=>{p({...r,projectManager:s})},renderInput:t=>e.jsx(y,{...t,variant:"outlined",placeholder:"Search and select Project Manager..."}),renderTags:(t,s)=>t.map((a,n)=>e.jsx(S,{label:a.name,...s({index:n})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(i,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(j,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Recipients"}),e.jsx(i,{sm:"10",children:e.jsx(v,{multiple:!1,options:E,getOptionLabel:t=>t.name,value:r==null?void 0:r.projectUsers,onChange:(t,s)=>{p({...r,projectUsers:s})},renderInput:t=>e.jsx(y,{...t,variant:"outlined",placeholder:"Search and project Users drawing..."}),renderTags:(t,s)=>t.map((a,n)=>e.jsx(S,{label:a.name,...s({index:n})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(i,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(j,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Drawing"}),e.jsx(i,{sm:"10",children:e.jsx(v,{multiple:!1,options:k,getOptionLabel:t=>t.name,value:r==null?void 0:r.selectedDrawing,onChange:(t,s)=>{p({...r,selectedDrawing:s})},renderInput:t=>e.jsx(y,{...t,variant:"outlined",placeholder:"Search and select drawing..."}),renderTags:(t,s)=>t.map((a,n)=>e.jsx(S,{label:a.name,...s({index:n})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(i,{lg:"6",children:e.jsx(l,{className:"",children:(M=(F=r==null?void 0:r.selectedDrawing)==null?void 0:F.pictures)==null?void 0:M.map((t,s)=>e.jsx("div",{className:"position-relative me-2 mb-2",children:e.jsx(R,{src:`${d}/uploads/${t}`,onClick:()=>{A({show:!0,imgUrl:`${d}/uploads/${t}`})},alt:`Existing Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}})},`existing-${s}`))})}),(g==null?void 0:g.show)&&e.jsx(i,{lg:"6",children:e.jsx(l,{children:e.jsx("div",{className:"position-relative",style:{maxWidth:"100%",height:"auto"},children:e.jsx(ae,{ref:L,drawDotsOnImage:g,setDrawDotsAnImage:A,onSave:t=>{J(t)},setMarkers:V,markers:z,dotSize:W,setDotSize:_})})})}),e.jsx(i,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(j,{htmlFor:"multiple-file-input",className:"col-sm-2 col-form-label text-end",children:"Pictures"}),e.jsxs(i,{sm:"10",children:[e.jsx(oe,{type:"file",id:"multiple-file-input",name:"pictures",onChange:H,accept:"image/*",multiple:!0,ref:b}),e.jsx("div",{className:"mt-3 d-flex flex-wrap",children:f.map((t,s)=>e.jsxs("div",{className:"position-relative me-2 mb-2",children:[e.jsx(R,{src:t,alt:`Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),e.jsx(P,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>G(s),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"Ã—"})]},s))})]})]})}),e.jsx(l,{className:"mb-3 d-flex justify-content-center",children:e.jsx(i,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(P,{disabled:T,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{Fe as default};
