import{a as I,r as d,b,j as t,R as u,C as g}from"./index-CEbbE1Sf.js";import{P as A}from"./PageMetaData-qE4R9bbS.js";import{B as p}from"./urls-CvG9cD6N.js";import{F as C}from"./FormLabel-WQTNbj7P.js";import{A as $,C as w,T as v}from"./TextField-CeDJPKh1.js";import{B as F}from"./Button-CWQV4UHt.js";import"./FormContext-CSwRqVJr.js";import"./useFormControl-BPpZZpE7.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-C8K2eoCJ.js";const U=()=>{const f=I(),[h,x]=d.useState([]),[m,y]=d.useState([]),{companyId:n,projectId:r}=b();d.useEffect(()=>{n&&r&&M()},[n,r]);const M=async()=>{try{const o=await(await fetch(`${p}/get-project-managers?companyId=${n}`)).json(),s=await(await fetch(`${p}/get-project-managers?companyId=${n}&projectId=${r}`)).json();console.log("All project managers:",o.length),console.log("Already assigned:",s.length);const j=o.filter(c=>{const i=s.some(l=>l._id===c._id&&l.projectsId&&l.projectsId.includes(r));return console.log(`Manager ${c.name} (${c._id}):`,{projectsId:c.projectsId,isAlreadyAssigned:i,shouldInclude:!i}),!i});console.log("Filtered project managers:",j.length),x(j)}catch(e){console.error("Error fetching project managers:",e)}},P=async()=>{try{const o={userIds:m.map(s=>s._id),projectId:r,userRole:"Project Manager"},a=await fetch(`${p}/updateUser`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(a.ok){const s=await a.json();f(`/dashboard/companies/view/${n}/projects/view/${r}`,{state:{success:"Project Manager added successfully!"}})}else console.error("Error:",a.statusText)}catch(e){console.log("Error adding Project Manager to project:",e)}};return t.jsxs(t.Fragment,{children:[t.jsx(A,{title:"Add Construction Manager"}),t.jsxs(u,{className:"mb-3",children:[t.jsx(C,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Select Construction Manager for this Project"}),t.jsxs(g,{sm:"10",children:[t.jsx($,{multiple:!0,options:h,getOptionLabel:e=>e.name,value:m,onChange:(e,o)=>{y(o)},renderInput:e=>t.jsx(v,{...e,variant:"outlined",placeholder:"Search and select Construction Manager..."}),renderTags:(e,o)=>e.map((a,s)=>t.jsx(w,{label:a.name,...o({index:s})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}}),t.jsx(u,{className:"mb-3 mt-3 d-flex justify-content-center",children:t.jsx(g,{sm:"12",className:"d-flex justify-content-end",children:t.jsx(F,{type:"submit",variant:"primary",className:"me-1",onClick:P,children:"Submit"})})})]})]})]})};export{U as default};
