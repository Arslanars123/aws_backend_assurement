import{r as u,a as P,ad as L,ab as F,ar as I,G as E,j as e,aq as h,C as x,m as p}from"./index-BMHGnWcK.js";import{I as k}from"./IconifyIcon-BZrnxXiy.js";import{P as T}from"./PasswordFormInput-Bhl53MA5.js";import{T as A}from"./TextFormInput-JZRm43de.js";import{c as B,a as g,u as G,o as R}from"./index.esm-XXa4UCb8.js";import{B as U}from"./urls-CvG9cD6N.js";import{l as $}from"./jpo-Ci11ADWT.js";import{P as q}from"./PageMetaData-Bgn24qMg.js";import{C as D}from"./Card-BQIi55Il.js";import"./FormControl-BhCdWsRE.js";import"./FormContext-_pJuLZf_.js";import"./FormGroup-lh_nrrWS.js";import"./FormLabel-BBJljh0R.js";import"./divWithClassName-BnTSImTn.js";const O=()=>{const[t,n]=u.useState(!1),a=P(),{saveSession:f}=L(),[j]=F(),{showNotification:i}=I(),b=B({username:g(),password:g().required("Please enter your password")}),{control:y,handleSubmit:N}=G({resolver:R(b),defaultValues:{username:"",password:""}}),w=()=>{const o=j.get("redirectTo");a(o||"/dashboard/companies")},{companies:M,projects:V,selectedCompany:_,selectedProject:z,setSelectedCompany:C,setSelectedProject:H}=u.useContext(E),S=N(async o=>{var c,m,l,d;try{fetch(`${U}/users/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then(async s=>{if(!s.ok){const v=await s.json();throw new Error(v.error||"Login failed")}const r=await s.json();r.token&&(r.user.role=="Admin"&&C(r.user.companyId),f(r),w(),i({message:"Successfully logged in. Redirecting....",variant:"success"}))}).catch(s=>{i({message:s.message,variant:"danger"}),console.log("Error occurred:",s.message)})}catch(s){(m=(c=s.response)==null?void 0:c.data)!=null&&m.error&&i({message:(d=(l=s.response)==null?void 0:l.data)==null?void 0:d.error,variant:"danger"})}finally{n(!1)}});return{loading:t,login:S,control:y}},J=()=>{const{loading:t,login:n,control:a}=O();return e.jsxs("form",{onSubmit:n,className:"my-4",children:[e.jsx(A,{control:a,name:"username",label:"Username",containerClassName:"form-group mb-2",placeholder:"Enter your username"}),e.jsx(T,{control:a,name:"password",label:"Password",containerClassName:"form-group",placeholder:"Enter your password"}),e.jsx("div",{className:"text-end mb-3",children:e.jsx(h,{to:"/auth/reset-pass",className:"text-muted",children:e.jsx("small",{children:"Forgot your password?"})})}),e.jsx("div",{className:"form-group mb-0 row",children:e.jsx(x,{xs:12,children:e.jsx("div",{className:"d-grid mt-3",children:e.jsxs("button",{className:"btn btn-primary flex-centered",type:"submit",disabled:t,children:["Log In ",e.jsx(k,{icon:"fa6-solid:right-to-bracket",className:"ms-1"})]})})})})]})},ce=()=>e.jsxs(e.Fragment,{children:[e.jsx(q,{title:"Login"}),e.jsx(x,{lg:4,className:"mx-auto",children:e.jsxs(D,{children:[e.jsx(p,{className:"p-0 auth-header-box rounded-top",style:{backgroundColor:"#1F2C68"},children:e.jsxs("div",{className:"text-center p-3",children:[e.jsx(h,{to:"/",className:"logo logo-admin",children:e.jsx("img",{src:$,height:50,alt:"logo",className:"auth-logo"})}),e.jsx("h4",{className:"mt-3 mb-1 fw-semibold text-white fs-18",children:"Let's Get Started"}),e.jsx("p",{className:"text-muted fw-medium mb-0",children:"Sign in to continue to Assurement."})]})}),e.jsx(p,{className:"pt-0",children:e.jsx(J,{})})]})})]});export{ce as default};
