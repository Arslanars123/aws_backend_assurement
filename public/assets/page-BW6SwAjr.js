import{r as a,b as Z,ab as ee,a as se,G as te,j as e,R as c,C as o}from"./index-BMHGnWcK.js";import{C as ne}from"./ComponentContainerCard-DqzcDgtW.js";import{P as re}from"./PageMetaData-Bgn24qMg.js";import{B as h}from"./urls-CvG9cD6N.js";import{F as m}from"./FormLabel-BBJljh0R.js";import{F as v}from"./FormControl-BhCdWsRE.js";import{F as p}from"./FormSelect-Dr1VIvZ_.js";import{I as R}from"./Image-BWlBzfxc.js";import{B as N}from"./Button-Dwvyfso6.js";import"./Card-BQIi55Il.js";import"./divWithClassName-BnTSImTn.js";import"./FormContext-_pJuLZf_.js";const ve=()=>{const[r,f]=a.useState(null),[A,S]=a.useState(!1),[_,U]=a.useState(!0),[P,ae]=a.useState(null),[oe,V]=a.useState(null),[j,C]=a.useState([]),[g,E]=a.useState([]),{newId:x,companyId:w,projectId:$}=Z(),[L]=ee(),T=se();a.useRef(null);const b=a.useRef(null),[B,F]=a.useState([]),{selectedCompany:ce,selectedProjects:I,selectedProfession:ie,companies:le}=a.useContext(te),k=L.get("report");a.useEffect(()=>{x&&fetch(`${h}/get-new-detail/${x}`).then(async t=>{const s=await t.json();f({...s,picture2:s.picture,pictures2:s.pictures}),s.picture&&s.picture!=="null"&&V(`https://147.93.94.31/uploads/${s.picture}`),s.pictures&&s.pictures.length>0&&F(s.pictures.map(n=>`https://147.93.94.31/uploads/${n}`))}).catch(t=>console.error(t)).finally(()=>U(!1))},[x]);const D=t=>{const{name:s,value:n}=t.target;f({...r,[s]:n})},u=t=>{const{name:s,value:n,multiple:l,options:i}=t.target;if(l){const d=Array.from(i).filter(y=>y.selected).map(y=>y.value);f({...r,[s]:d})}else f({...r,[s]:n})};a.useEffect(()=>{(async()=>{try{const n=await(await fetch(`${h}/get-projects`)).json();H(n)}catch(s){console.error("Error fetching projects:",s)}})()},[]);const[W,H]=a.useState([]);a.useEffect(()=>{(async()=>{try{const n=await(await fetch(`${h}/get-users?projectId=${I}`)).json();O(n)}catch(s){console.error("Error fetching draws:",s)}})()},[I]);const[M,O]=a.useState([]);a.useEffect(()=>{(async()=>{try{const n=await(await fetch(`${h}/get-draws`)).json();G(n)}catch(s){console.error("Error fetching draws:",s)}})()},[]);const[z,G]=a.useState([]),Q=t=>{const s=Array.from(t.target.files),n=[...j,...s],l=[...g,...s.map(i=>URL.createObjectURL(i))];C(n),E(l)},q=t=>{const s=j.filter((i,d)=>d!==t),n=g.filter((i,d)=>d!==t);C(s),E(n);const l=new DataTransfer;s.forEach(i=>l.items.add(i)),b.current&&(b.current.files=l.files)},J=async t=>{t.preventDefault(),S(!0);const s=new FormData;Object.keys(r).forEach(n=>{s.append(n,r[n])}),P&&s.append("picture",P),j.forEach(n=>{s.append("pictures",n)});try{const n=await fetch(`${h}/update-new/${x}`,{method:"POST",body:s});if(n.ok){const l=await n.json(),i=$?`/dashboard/companies/view/${w}/projects/view/${$}`:w?`/dashboard/companies/view/${w}/news`:"/dashboard/news",d=k?`?report=${encodeURIComponent(k)}`:"";T(`${i}${d}`,{state:{success:"New Agreement updated successfully!"}})}else console.error("Error:",n.statusText)}catch(n){console.error("Fetch error:",n)}S(!1)},K=t=>{F(s=>s.filter((n,l)=>l!==t)),f(s=>{if(!s)return null;const n=s.pictures2.filter((l,i)=>i!==t);return{...s,pictures2:n.length>0?n:[]}})};a.useEffect(()=>{(async()=>{try{const n=await(await fetch(`${h}/get-professions`)).json();Y(n)}catch(s){console.error("Error fetching professions:",s)}})()},[]);const[X,Y]=a.useState([]);return e.jsxs(e.Fragment,{children:[e.jsx(re,{title:"Edit New Agreement"}),_?null:e.jsx("form",{onSubmit:J,children:e.jsx(c,{className:"justify-content-center",children:e.jsx(o,{children:e.jsx(ne,{title:"Edit New Agreement",children:e.jsxs(c,{children:[e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Extra info"}),e.jsx(o,{sm:"10",children:e.jsx(v,{value:r==null?void 0:r.supplementory,onChange:D,name:"supplementory",type:"text",id:"example-text-input"})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Days | Hours"}),e.jsx(o,{sm:"10",children:e.jsx(v,{value:r==null?void 0:r.time,onChange:D,name:"time",type:"text",id:"example-text-input"})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Item"}),e.jsx(o,{sm:"10",children:e.jsxs(p,{value:r==null?void 0:r.item,name:"item",onChange:u,children:[e.jsx("option",{defaultValue:"",children:"Select Item"}),e.jsx("option",{value:"A new agreement has been concluded with construction management today.",children:"A new agreement has been concluded with construction management today."}),e.jsx("option",{value:"Change work has been notified.",children:"Change work has been notified."}),e.jsx("option",{value:"Forced work must be agreed, due to delays from other contractors",children:"Forced work must be agreed, due to delays from other contractors"}),e.jsx("option",{value:"The construction management has instructed a change in the work that must be carried out in accounting work.",children:"The construction management has instructed a change in the work that must be carried out in accounting work."}),e.jsx("option",{value:"Work that has been necessary for safety or for the sake of construction.",children:"Work that has been necessary for safety or for the sake of construction."}),e.jsx("option",{value:"Someone has destroyed my work after final inspection.",children:"Someone has destroyed my work after final inspection."})]})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Discipline"}),e.jsx(o,{sm:"10",children:e.jsxs(p,{value:r==null?void 0:r.discipline,name:"discipline",onChange:u,children:[e.jsx("option",{defaultValue:"",children:"Select Discipline"}),e.jsx("option",{value:"admin",children:"Admin"})]})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Drawing"}),e.jsx(o,{sm:"10",children:e.jsxs(p,{value:r.drawing,name:"drawing",onChange:u,children:[e.jsx("option",{defaultValue:"",children:"Select drawing"}),z.map(t=>{const s=t.name||(t.mainDrawings&&t.mainDrawings.length>0?t.mainDrawings[0].original:"No name available");return e.jsx("option",{value:t._id,children:s},t._id)})]})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Projects"}),e.jsx(o,{sm:"10",children:e.jsxs(p,{value:r.projectsId,name:"projectsId",onChange:u,multiple:!0,children:[e.jsx("option",{defaultValue:"",children:"Select Projects"}),W.map(t=>e.jsxs("option",{value:t._id,children:[t.name," "]},t.id))]})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{htmlFor:"multiple-file-input",className:"col-sm-2 col-form-label text-end",children:"Pictures"}),e.jsxs(o,{sm:"10",children:[e.jsx(v,{type:"file",id:"multiple-file-input",name:"pictures",onChange:Q,accept:"image/*",multiple:!0,ref:b}),e.jsxs("div",{className:"mt-3 d-flex flex-wrap",children:[g.map((t,s)=>e.jsxs("div",{className:"position-relative me-2 mb-2",children:[e.jsx(R,{src:t,alt:`Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),e.jsx(N,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>q(s),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]},s)),B.map((t,s)=>e.jsxs("div",{className:"position-relative me-2 mb-2",children:[e.jsx(R,{src:t,alt:`Existing Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),e.jsx(N,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>K(s),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]},`existing-${s}`))]})]})]})}),e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select profession"}),e.jsx(o,{sm:"10",children:e.jsxs(p,{value:r.profession,name:"profession",onChange:u,children:[e.jsx("option",{defaultValue:"",children:"Select profession"}),X.map(t=>e.jsx("option",{value:t.indexNumber,children:t.indexNumber},t.id))]})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Receipients"}),e.jsx(o,{sm:"10",children:e.jsxs(p,{value:r.users,name:"users",onChange:u,multiple:!0,children:[e.jsx("option",{defaultValue:"",children:"Select"}),M.map(t=>e.jsxs("option",{value:t._id,children:[t.username," "]},t.id))]})})]})}),e.jsx(c,{className:"mb-3 d-flex justify-content-center",children:e.jsx(o,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(N,{disabled:A,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{ve as default};
