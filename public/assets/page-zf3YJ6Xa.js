import{j as e,R as K,C as z,b as re,r as s,m as os,a as bs,ab as vs,G as is,c as ls}from"./index-S4cPkaXI.js";import{C as cs}from"./ComponentContainerCard-CPsL5TPV.js";import{P as Ns}from"./PageMetaData-u0IuTTri.js";import{B as g}from"./urls-DHmWp6-I.js";import{F as ke,a as Fe,b as ws,c as Cs}from"./index-DW4LpbCk.js";import{A as Ds}from"./AllDataTables-DNVyHeS1.js";import{A as As}from"./AllDataTables-zjCoq9yc.js";import{A as ks}from"./AllDataTables-CV8RlYn0.js";import{A as Ts}from"./AllDataTables-D7JC5XHc.js";import{A as Es}from"./AllDataTables-D6PPDErh.js";import{A as Ps}from"./AllDataTables-BexLMB-e.js";import{A as ts}from"./AllDataTables-3E6cH1r8.js";import{R as $s}from"./index-C5CN5ils.js";import{A as Is}from"./AllDataTables-3kuOukZx.js";import{A as Ls}from"./AllDataTables-CJboiS_T.js";import{A as Fs}from"./AllDataTables-BPjVHrMg.js";import{A as Rs}from"./AllDataTables-BjjJITc6.js";import{I as Y}from"./IconifyIcon-Ci7BO_Ix.js";import{S as as}from"./index-DVY2HDN-.js";import{F as I}from"./Form-B6IVgYSx.js";import{B as T}from"./Button-BdLFNPe1.js";import{C as oe}from"./Card-DerqaWgt.js";import{T as Ee}from"./Table-ByaT0vBF.js";import{I as Re}from"./Image-C0iuPhbd.js";import{M as B}from"./Modal-CdPnefrM.js";import{A as Oe}from"./Alert-BmsiN9DY.js";import{S as ds}from"./index-Bd0YA9dg.js";import{S as Te}from"./Spinner-CZ_ALDwt.js";import{F as he}from"./FormGroup-DoXrZngg.js";import{F as pe}from"./FormLabel-xT7fLwVI.js";import{F as Se}from"./FormControl-DZh-Msrb.js";import{B as Ue}from"./Badge-B85Z7x1y.js";import{C as Ms}from"./Collapse-DekUYmW9.js";import{A as ns,T as rs}from"./TextField-BSYfgtkt.js";import{U as Os}from"./UsersTab-BD_CqCSe.js";import{A as Us}from"./AllDataTables-CwLSLsDC.js";import{P as Gs}from"./page-DRiEaboB.js";import{A as _s}from"./AllDataTables-D5kC0Z-S.js";import{A as Bs}from"./AllDataTables-cRiXVX0Y.js";import{A as zs}from"./AllDataTables-Dt92odI_.js";import{A as qs}from"./AllDataTables-wZ6cc0U_.js";import{N as Me}from"./Nav-DooatmZF.js";import"./ListGroup-PqP_5vgk.js";import"./hook-DAlenwRK.js";import"./Nav-Bpuuug6q.js";import"./DataKey-COGXBUcQ.js";import"./NavContext-CvhVsp9X.js";import"./NoopTransition-DS4YuUbl.js";import"./useEventCallback-CbKveW3s.js";import"./FormContext-3vyf8OR-.js";import"./ElementChildren-fnQRsVCu.js";import"./FormRange-Dn1-Ecm8.js";import"./FormSelect--prDjbZc.js";import"./divWithClassName-23-JlBVG.js";import"./useWindow-BrvFrb9Q.js";import"./Anchor-BFbjON2V.js";import"./createSuper-QWyrB2J6.js";import"./assertThisInitialized-B9jnkVVz.js";import"./useFormControl-CQ-iehwM.js";import"./createPopper-C8K2eoCJ.js";import"./AllDataTables-e-4QA21y.js";import"./AllDataTables-BkyK3sOw.js";import"./menu-DqvORbfx.js";import"./AllDataTables-_PNwm8Y0.js";import"./AllDataTables-D99bejbr.js";import"./AllDataTables-cnty8piv.js";import"./AllDataTables-BXBgSPqj.js";import"./AllDataTables-DZulqwHu.js";import"./AllDataTables-C8ezT4-b.js";import"./PDFButton-1i9cSyXj.js";import"./NavbarContext-DztLa5vb.js";const Hs=[{header:"Comment",accessorKey:"comment"},{header:"Profession",cell:({row:j})=>{var d;const f=(d=j==null?void 0:j.original)==null?void 0:d.profession;return e.jsx("span",{className:"text-primary",children:f==null?void 0:f.GroupName})}},{header:"BuildingParts",cell:({row:j})=>{var d;const f=(d=j==null?void 0:j.original)==null?void 0:d.buildingParts;return e.jsx("span",{className:"text-primary",children:f==null?void 0:f.name})}}],Qs=({specialControle:j,refreshData:f,selectedReport:d})=>{const m=[2,5,10,20,50],{companyId:o,projectId:u}=re(),h=u?`/dashboard/companies/view/${o}/projects/view/${u}/specialControle/view/`:`/dashboard/companies/view/${o}/specialControle/view/`;return e.jsx(cs,{title:"Special Controle Poin",addUrl:"specialControle/add",children:e.jsx($s,{refreshData:f,columns:Hs,data:j,viewUrl:h,rowsPerPageList:m,pageSize:10,tableClass:"datatable",theadClass:"table-light",showPagination:!0,searchable:!0,selectedReport:d})})},Js=({specialControle:j,refreshData:f,selectedReport:d})=>e.jsx(e.Fragment,{children:e.jsx(K,{className:"justify-content-center",children:e.jsx(z,{xs:12,children:e.jsx(Qs,{refreshData:f,specialControle:j,selectedReport:d})})})});function Vs(){const{companyId:j,projectId:f}=re(),[d,m]=s.useState([]),[o,u]=s.useState(!1),[h,r]=s.useState(!1),[S,N]=s.useState(!1),[i,c]=s.useState(null),[p,G]=s.useState(""),[q,W]=s.useState(!1),[D,C]=s.useState({name:"",signature:null});s.useEffect(()=>{M()},[j,f]);const M=async()=>{u(!0);try{const w=await fetch(`${g}/get-name-signatures?companyId=${j}&projectId=${f}`);if(w.ok){const k=await w.json();m(k)}}catch(w){console.error("Error fetching signatures:",w)}finally{u(!1)}},P=w=>{const{name:k,value:X}=w.target;C({...D,[k]:X})},L=()=>{C({name:"",signature:null}),r(!0)},A=w=>{c(w),C({name:w.name||"",signature:null}),N(!0)},F=async w=>{if(w.preventDefault(),!D.name.trim()||!D.signature){alert("Please fill in the name and add a signature");return}W(!0);try{const k=new FormData;k.append("name",D.name),k.append("companyId",j),k.append("projectId",f),k.append("signature",D.signature,"signature.png");const X=S?`${g}/update-name-signature/${i._id}`:`${g}/add-name-signature`,ee=await fetch(X,{method:S?"PUT":"POST",body:k});if(ee.ok)r(!1),N(!1),C({name:"",signature:null}),c(null),M();else{const ie=await ee.json();alert(ie.error||"Failed to save signature")}}catch(k){console.error("Error saving signature:",k),alert("Failed to save signature")}finally{W(!1)}},E=async w=>{if(window.confirm("Are you sure you want to delete this signature?"))try{const k=await fetch(`${g}/delete-name-signature/${w}`,{method:"DELETE"});if(k.ok)M();else{const X=await k.json();alert(X.error||"Failed to delete signature")}}catch(k){console.error("Error deleting signature:",k),alert("Failed to delete signature")}},Z=d.filter(w=>{var k;return(k=w.name)==null?void 0:k.toLowerCase().includes(p.toLowerCase())});return e.jsxs("div",{children:[e.jsxs(K,{className:"mb-3",children:[e.jsx(z,{md:"6",children:e.jsx(I.Control,{type:"text",placeholder:"Search by name...",value:p,onChange:w=>G(w.target.value)})}),e.jsx(z,{md:"6",className:"text-end",children:e.jsxs(T,{variant:"primary",onClick:L,disabled:o,children:[e.jsx(Y,{icon:"mdi:plus",className:"me-2"}),"Add Name & Signature"]})})]}),e.jsxs(oe,{children:[e.jsx(oe.Header,{children:e.jsx("h5",{className:"mb-0",children:"Name and Signatures"})}),e.jsx(oe.Body,{children:o?e.jsx("div",{className:"text-center py-4",children:e.jsx("div",{className:"spinner-border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):Z.length===0?e.jsx("div",{className:"text-center py-4 text-muted",children:"No signatures found. Add your first signature above."}):e.jsxs(Ee,{responsive:!0,striped:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Signature"}),e.jsx("th",{children:"Created Date"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:Z.map(w=>e.jsxs("tr",{children:[e.jsx("td",{children:w.name}),e.jsx("td",{children:w.signature&&e.jsx(Re,{src:`${g}/uploads/${w.signature}`,alt:"Signature",style:{maxWidth:"100px",maxHeight:"50px"},fluid:!0})}),e.jsx("td",{children:w.createdAt?new Date(w.createdAt).toLocaleDateString():"-"}),e.jsxs("td",{children:[e.jsx(T,{variant:"outline-primary",size:"sm",className:"me-2",onClick:()=>A(w),children:e.jsx(Y,{icon:"mdi:pencil"})}),e.jsx(T,{variant:"outline-danger",size:"sm",onClick:()=>E(w._id),children:e.jsx(Y,{icon:"mdi:delete"})})]})]},w._id))})]})})]}),e.jsxs(B,{show:h,onHide:()=>r(!1),size:"lg",children:[e.jsx(B.Header,{closeButton:!0,children:e.jsx(B.Title,{children:"Add Name & Signature"})}),e.jsxs("form",{onSubmit:F,children:[e.jsxs(B.Body,{children:[e.jsx(K,{children:e.jsx(z,{md:"12",children:e.jsxs(I.Group,{className:"mb-3",children:[e.jsx(I.Label,{children:"Name *"}),e.jsx(I.Control,{type:"text",name:"name",value:D.name,onChange:P,required:!0,placeholder:"Enter full name"})]})})}),e.jsx(K,{children:e.jsx(z,{md:"12",children:e.jsxs(I.Group,{className:"mb-3",children:[e.jsx(I.Label,{children:"Signature *"}),e.jsx(as,{onSave:w=>C({...D,signature:w}),onClear:()=>C({...D,signature:null}),width:400,height:200}),D.signature&&e.jsx("div",{className:"mt-2",children:e.jsx(Re,{src:URL.createObjectURL(D.signature),alt:"Signature Preview",fluid:!0,style:{maxWidth:"200px",maxHeight:"100px"}})})]})})})]}),e.jsxs(B.Footer,{children:[e.jsx(T,{variant:"secondary",onClick:()=>r(!1),children:"Cancel"}),e.jsx(T,{variant:"primary",type:"submit",disabled:q||!D.name.trim()||!D.signature,children:q?"Saving...":"Save Signature"})]})]})]}),e.jsxs(B,{show:S,onHide:()=>N(!1),size:"lg",children:[e.jsx(B.Header,{closeButton:!0,children:e.jsx(B.Title,{children:"Edit Name & Signature"})}),e.jsxs("form",{onSubmit:F,children:[e.jsxs(B.Body,{children:[e.jsx(K,{children:e.jsx(z,{md:"12",children:e.jsxs(I.Group,{className:"mb-3",children:[e.jsx(I.Label,{children:"Name *"}),e.jsx(I.Control,{type:"text",name:"name",value:D.name,onChange:P,required:!0,placeholder:"Enter full name"})]})})}),e.jsx(K,{children:e.jsx(z,{md:"12",children:e.jsxs(I.Group,{className:"mb-3",children:[e.jsx(I.Label,{children:"Signature *"}),e.jsx(as,{onSave:w=>C({...D,signature:w}),onClear:()=>C({...D,signature:null}),width:400,height:200}),(D.signature||(i==null?void 0:i.signature))&&e.jsx("div",{className:"mt-2",children:e.jsx(Re,{src:D.signature?URL.createObjectURL(D.signature):`${g}/uploads/${i.signature}`,alt:"Signature Preview",fluid:!0,style:{maxWidth:"200px",maxHeight:"100px"}})})]})})})]}),e.jsxs(B.Footer,{children:[e.jsx(T,{variant:"secondary",onClick:()=>N(!1),children:"Cancel"}),e.jsx(T,{variant:"primary",type:"submit",disabled:q||!D.name.trim(),children:q?"Saving...":"Update Signature"})]})]})]})]})}function Ks(){const{companyId:j,projectId:f}=re(),[d,m]=s.useState(""),[o,u]=s.useState(null),[h,r]=s.useState(!1),[S,N]=s.useState(!1),[i,c]=s.useState(!1),[p,G]=s.useState({show:!1,message:"",variant:"success"});s.useEffect(()=>{q()},[f]);const q=async()=>{r(!0);try{const A=await fetch(`${g}/get-project-special-text?projectId=${f}`);if(A.ok){const F=await A.json();F.success&&F.data&&(u(F.data),m(F.data.specialText||""))}}catch(A){console.error("Error fetching special text:",A)}finally{r(!1)}},W=A=>{m(A.target.value)},D=async()=>{if(!d.trim()){G({show:!0,message:"Please enter some text before saving.",variant:"danger"});return}c(!0);try{const A=await fetch(`${g}/save-project-special-text`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:f,specialText:d.trim()})});if(A.ok){const F=await A.json();G({show:!0,message:F.message,variant:"success"}),u({projectId:f,specialText:d.trim()}),N(!1),q()}else{const F=await A.json();G({show:!0,message:F.error||"Failed to save special text",variant:"danger"})}}catch(A){console.error("Error saving special text:",A),G({show:!0,message:"An error occurred while saving special text",variant:"danger"})}finally{c(!1)}},C=async()=>{if(o&&window.confirm("Are you sure you want to delete the special text? This action cannot be undone.")){c(!0);try{const A=await fetch(`${g}/delete-project-special-text?projectId=${f}`,{method:"DELETE"});if(A.ok)G({show:!0,message:"Special text deleted successfully",variant:"success"}),u(null),m(""),N(!1);else{const F=await A.json();G({show:!0,message:F.error||"Failed to delete special text",variant:"danger"})}}catch(A){console.error("Error deleting special text:",A),G({show:!0,message:"An error occurred while deleting special text",variant:"danger"})}finally{c(!1)}}},M=()=>{N(!0)},P=()=>{m(""),N(!0)},L=()=>{N(!1),m((o==null?void 0:o.specialText)||"")};return h?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"200px"},children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):e.jsxs("div",{children:[e.jsx(K,{children:e.jsx(z,{lg:"12",children:e.jsxs(oe,{children:[e.jsxs(oe.Header,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h5",{className:"mb-0",children:"Project Special Text"}),e.jsxs(T,{variant:o?"outline-primary":"primary",onClick:o?M:P,disabled:i,children:[e.jsx(Y,{icon:"mdi:plus",className:"me-1"}),o?"Edit Special Text":"Add Special Text"]})]}),e.jsxs(oe.Body,{children:[p.show&&e.jsx(Oe,{variant:p.variant,dismissible:!0,onClose:()=>G({show:!1,message:"",variant:"success"}),className:"mb-3",children:p.message}),o?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Current Special Text:"}),e.jsx("div",{className:"border rounded p-3 bg-light",children:e.jsx("p",{className:"mb-0",style:{whiteSpace:"pre-wrap"},children:o.specialText})})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(T,{variant:"outline-primary",onClick:M,disabled:i,children:[e.jsx(Y,{icon:"mdi:pencil",className:"me-1"}),"Edit"]}),e.jsxs(T,{variant:"outline-danger",onClick:C,disabled:i,children:[e.jsx(Y,{icon:"mdi:delete",className:"me-1"}),"Delete"]})]})]}):e.jsxs("div",{className:"text-center py-5",children:[e.jsx(Y,{icon:"mdi:text-box-outline",className:"text-muted",style:{fontSize:"3rem"}}),e.jsx("h6",{className:"text-muted mt-3",children:"No Special Text Added"}),e.jsx("p",{className:"text-muted",children:'Click "Add Special Text" to add special text for this project.'})]})]})]})})}),e.jsxs(B,{show:S,onHide:L,size:"lg",children:[e.jsx(B.Header,{closeButton:!0,children:e.jsx(B.Title,{children:o?"Edit Special Text":"Add Special Text"})}),e.jsx(B.Body,{children:e.jsx(I,{children:e.jsxs(I.Group,{className:"mb-3",children:[e.jsx(I.Label,{children:"Special Text *"}),e.jsx(I.Control,{as:"textarea",rows:8,value:d,onChange:W,placeholder:"Enter special text for this project...",disabled:i}),e.jsx(I.Text,{className:"text-muted",children:"Enter any special notes, instructions, or additional information for this project."})]})})}),e.jsxs(B.Footer,{children:[e.jsx(T,{variant:"secondary",onClick:L,disabled:i,children:"Cancel"}),e.jsx(T,{variant:"primary",onClick:D,disabled:i||!d.trim(),children:i?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{icon:"mdi:content-save",className:"me-1"}),o?"Update":"Save"]})})]})]})]})}const Ws=({show:j,onHide:f,companyId:d,projectId:m,subjectMatterId:o})=>{console.log("StaticReportSignaturesModal props:",{show:j,companyId:d,projectId:m,subjectMatterId:o});const[u,h]=s.useState(null),[r,S]=s.useState({1:null,2:null,3:null}),[N,i]=s.useState({name:"",description:"",signatureType:1}),[c,p]=s.useState({}),[G,q]=s.useState([]),[W,D]=s.useState(!1),[C,M]=s.useState(!1),[P,L]=s.useState(null),[A,F]=s.useState("list"),[E,Z]=s.useState(1),w=s.useCallback(async()=>{try{const R=(await(await fetch(`${g}/get-gammas?companyId=${d}&projectId=${m}`)).json()).map(J=>J.profession);q(R)}catch(l){console.error("Error loading professions:",l),L({type:"danger",text:"Error loading professions"})}},[d,m]),k=s.useCallback(async l=>{if(!l){S({1:null,2:null,3:null});return}try{console.log("Loading signatures for profession:",l),console.log("Selected profession SubjectMatterId:",l.SubjectMatterId),console.log("Searching with:",{companyId:d,projectId:m,subjectMatterId:l.SubjectMatterId});const R=await(await fetch(`${g}/get-static-report-signatures`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({companyId:d,projectId:m})})).json();console.log("ALL signatures for company/project:",R);const J=R.filter(te=>te.subjectMatterId===l.SubjectMatterId);console.log("Filtered by subjectMatterId:",J);const se={1:null,2:null,3:null};J.forEach(te=>{console.log("Processing signature:",te),se[te.signatureType]=te}),console.log("Organized signatures:",se),S(se)}catch(v){console.error("Error loading signatures:",v),L({type:"danger",text:"Error loading signatures"})}},[d,m]);s.useEffect(()=>{console.log("Modal useEffect triggered:",{show:j,companyId:d,projectId:m}),j&&d&&m&&(console.log("Loading professions..."),D(!0),w().finally(()=>D(!1)))},[j,d,m,w]),s.useEffect(()=>{u&&k(u)},[u,k]);const X=l=>{const v=G.find(R=>R._id===l);h(v),F("list")},ee=s.useCallback((l,v)=>{console.log("Input change:",{field:l,value:v}),i(R=>{const J={...R,[l]:v};return console.log("New form data:",J),J})},[]),ie=s.useCallback((l,v)=>{v&&p(R=>R[l]===v?R:{...R,[l]:v})},[]),le=s.useCallback(l=>{c[l]&&c[l].clear()},[c]),ge=s.useCallback(async()=>{var l,v,R,J;if(console.log("Save signature called with:",{selectedProfession:u,formData:N,activeTab:E,companyId:d,projectId:m}),console.log("Form data details:",{name:N.name,nameLength:(l=N.name)==null?void 0:l.length,nameTrimmed:(v=N.name)==null?void 0:v.trim(),nameTrimmedLength:(J=(R=N.name)==null?void 0:R.trim())==null?void 0:J.length,description:N.description}),!u){L({type:"danger",text:"Please select a profession first"});return}if(!d||!m){L({type:"danger",text:"Missing company or project ID"});return}if(!N.name.trim()){L({type:"danger",text:"Name is required"});return}if(!c[E]){L({type:"danger",text:"Signature pad not ready. Please try again."});return}if(c[E].isEmpty()){L({type:"danger",text:"Signature is required"});return}M(!0),L(null);try{if(await new Promise(Ne=>setTimeout(Ne,200)),!c[E]){L({type:"danger",text:"Signature pad not ready. Please try again."});return}const se=c[E].toDataURL(),te={companyId:d,projectId:m,subjectMatterId:u.SubjectMatterId,signatureType:E,name:N.name,description:N.description,profession:u._id,signature:se,signatureDate:new Date().toISOString()};console.log("Sending payload:",te),console.log("Payload validation:",{companyId:!!d,projectId:!!m,signatureType:!!E,name:!!N.name,profession:!!u._id});const ne=r[E],Pe=ne?`${g}/update-static-report-signature/${ne._id}`:`${g}/create-static-report-signature`,ve=await fetch(Pe,{method:ne?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(te)});if(ve.ok)L({type:"success",text:`Signature ${E} ${ne?"updated":"created"} successfully`}),await k(u),F("list"),i({name:"",description:"",signatureType:E}),c[E]&&c[E].clear();else{const Ne=await ve.json();L({type:"danger",text:Ne.error||"Error saving signature"})}}catch(se){console.error("Error saving signature:",se),L({type:"danger",text:"Error saving signature"})}finally{M(!1)}},[u,N,E,c,r,d,m,k]),fe=s.useCallback(async l=>{const v=r[l];if(v&&window.confirm(`Are you sure you want to delete Signature ${l}?`))try{const R=await fetch(`${g}/delete-static-report-signature/${v._id}`,{method:"DELETE"});if(R.ok)L({type:"success",text:`Signature ${l} deleted successfully`}),await k(u);else{const J=await R.json();L({type:"danger",text:J.error||"Error deleting signature"})}}catch(R){console.error("Error deleting signature:",R),L({type:"danger",text:"Error deleting signature"})}},[r,u,k]),de=s.useCallback(l=>{const v=r[l];Z(l),i({name:(v==null?void 0:v.name)||"",description:(v==null?void 0:v.description)||"",signatureType:l}),F("form"),setTimeout(()=>{c[l]&&c[l].clear()},100)},[r,c]),ue=s.useCallback(l=>{console.log("Adding signature for type:",l),console.log("Selected profession:",u),console.log("Company ID:",d),console.log("Project ID:",m),Z(l),i({name:"",description:"",signatureType:l}),F("form")},[u,d,m]),a=()=>e.jsx("div",{className:"mb-4",children:e.jsxs(he,{children:[e.jsx(pe,{children:"Select Profession"}),e.jsxs(Se,{as:"select",value:(u==null?void 0:u._id)||"",onChange:l=>X(l.target.value),children:[e.jsx("option",{value:"",children:"Choose a profession..."}),G.map(l=>e.jsxs("option",{value:l._id,children:[l.GroupName," (",l.SubjectMatterId,")"]},l._id))]})]})}),x=()=>u?e.jsxs("div",{children:[e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-3",children:e.jsxs("h5",{children:["Signatures for ",u.GroupName," (",u.SubjectMatterId,")"]})}),e.jsxs(Ee,{striped:!0,bordered:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Signature Type"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Subject Matter ID"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:[1,2,3].map(l=>{const v=r[l];return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs(Ue,{bg:v?"success":"secondary",children:["Signature ",l]})}),e.jsx("td",{children:v?v.name:"-"}),e.jsx("td",{children:v?v.description:"-"}),e.jsx("td",{children:v?v.subjectMatterId:"-"}),e.jsx("td",{children:v?new Date(v.signatureDate).toLocaleDateString():"-"}),e.jsx("td",{children:e.jsx("div",{className:"d-flex gap-2",children:v?e.jsxs(e.Fragment,{children:[e.jsx(T,{size:"sm",variant:"outline-primary",onClick:()=>de(l),children:"Edit"}),e.jsx(T,{size:"sm",variant:"outline-danger",onClick:()=>fe(l),children:"Delete"})]}):e.jsx(T,{size:"sm",variant:"success",onClick:()=>ue(l),children:"Add"})})})]},l)})})]})]}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{children:"Please select a profession to view signatures"})}),H=()=>u?e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("h5",{children:["Signature ",E," - ",u.GroupName," (",u.SubjectMatterId,")"]}),e.jsx(T,{variant:"outline-secondary",onClick:()=>F("list"),children:"Back to List"})]}),e.jsxs(I,{children:[e.jsxs(K,{children:[e.jsx(z,{md:6,children:e.jsxs(he,{className:"mb-3",children:[e.jsx(pe,{children:"Name *"}),e.jsx(Se,{type:"text",value:N.name,onChange:l=>ee("name",l.target.value),placeholder:"Enter name"})]})}),e.jsx(z,{md:6,children:e.jsxs(he,{className:"mb-3",children:[e.jsx(pe,{children:"Description"}),e.jsx(Se,{type:"text",value:N.description,onChange:l=>ee("description",l.target.value),placeholder:"Enter description"})]})})]}),e.jsxs(he,{className:"mb-3",children:[e.jsx(pe,{children:"Signature *"}),e.jsx(oe,{children:e.jsxs(os,{children:[e.jsx(ds,{ref:l=>ie(E,l),canvasProps:{width:500,height:200,className:"signature-canvas"}},`signature-pad-${E}`),e.jsx("div",{className:"mt-2",children:e.jsx(T,{size:"sm",variant:"outline-secondary",onClick:()=>le(E),children:"Clear"})})]})})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(T,{variant:"primary",onClick:ge,disabled:C,children:C?e.jsx(Te,{size:"sm"}):"Save Signature"}),e.jsx(T,{variant:"outline-secondary",onClick:()=>F("list"),children:"Cancel"})]})]})]}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{children:"Please select a profession first"})});return W?e.jsxs(e.Fragment,{children:[e.jsx(Te,{animation:"border"}),e.jsx("p",{className:"mt-2",children:"Loading..."})]}):e.jsxs(e.Fragment,{children:[P&&e.jsx(Oe,{variant:P.type,className:"mb-3",children:P.text}),a(),A==="list"?x():H()]})},Xs=({show:j,onHide:f,companyId:d,projectId:m})=>{console.log("QualityAssuranceSignaturesModal props:",{show:j,companyId:d,projectId:m});const[o,u]=s.useState(null),[h,r]=s.useState(null),[S,N]=s.useState({name:"",description:""}),[i,c]=s.useState(null),[p,G]=s.useState([]),[q,W]=s.useState(!1),[D,C]=s.useState(!1),[M,P]=s.useState(null),[L,A]=s.useState("list"),F=s.useCallback(async()=>{try{console.log("Loading professions for project:",{companyId:d,projectId:m});const x=await(await fetch(`${g}/get-project-professions?companyId=${d}&projectId=${m}`)).json();console.log("Project professions response:",x),G(x)}catch(a){console.error("Error loading professions:",a),P({type:"danger",text:"Error loading professions"})}},[d,m]),E=s.useCallback(async a=>{if(!a){r(null);return}try{console.log("Loading signature for profession:",a);const H=await(await fetch(`${g}/get-quality-assurance-signature`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({companyId:d,projectId:m,professionId:a._id})})).json();console.log("Signature response:",H),r(H.length>0?H[0]:null)}catch(x){console.error("Error loading signature:",x),P({type:"danger",text:"Error loading signature"})}},[d,m]);s.useEffect(()=>{console.log("Modal useEffect triggered:",{show:j,companyId:d,projectId:m}),j&&d&&m&&(console.log("Loading professions..."),W(!0),F().finally(()=>W(!1)))},[j,d,m,F]),s.useEffect(()=>{o&&E(o)},[o,E]);const Z=a=>{const x=p.find(H=>H._id===a);u(x),A("list")},w=s.useCallback((a,x)=>{console.log("Input change:",{field:a,value:x}),N(H=>{const l={...H,[a]:x};return console.log("New form data:",l),l})},[]),k=s.useCallback(a=>{a&&c(x=>x===a?x:a)},[]),X=s.useCallback(()=>{i&&i.clear()},[i]),ee=s.useCallback(async()=>{var a,x,H,l;if(console.log("Save signature called with:",{selectedProfession:o,formData:S,companyId:d,projectId:m}),console.log("Form data details:",{name:S.name,nameLength:(a=S.name)==null?void 0:a.length,nameTrimmed:(x=S.name)==null?void 0:x.trim(),nameTrimmedLength:(l=(H=S.name)==null?void 0:H.trim())==null?void 0:l.length,description:S.description}),!o){P({type:"danger",text:"Please select a profession first"});return}if(!d||!m){P({type:"danger",text:"Missing company or project ID"});return}if(!S.name.trim()){P({type:"danger",text:"Name is required"});return}if(!i){P({type:"danger",text:"Signature pad not ready. Please try again."});return}if(i.isEmpty()){P({type:"danger",text:"Signature is required"});return}C(!0),P(null);try{if(await new Promise(ne=>setTimeout(ne,200)),!i){P({type:"danger",text:"Signature pad not ready. Please try again."});return}const v=i.toDataURL(),R={companyId:d,projectId:m,professionId:o._id,professionName:o.name||o.GroupName,name:S.name,description:S.description,profession:o._id,signature:v,signatureDate:new Date().toISOString()};console.log("Sending payload:",R),console.log("Payload validation:",{companyId:!!d,projectId:!!m,professionId:!!o._id,name:!!S.name,profession:!!o._id});const J=h?`${g}/update-quality-assurance-signature/${h._id}`:`${g}/create-quality-assurance-signature`,te=await fetch(J,{method:h?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(R)});if(te.ok)P({type:"success",text:`Signature ${h?"updated":"created"} successfully`}),await E(o),A("list"),N({name:"",description:""}),i&&i.clear();else{const ne=await te.json();P({type:"danger",text:ne.error||"Error saving signature"})}}catch(v){console.error("Error saving signature:",v),P({type:"danger",text:"Error saving signature"})}finally{C(!1)}},[o,S,i,h,d,m,E]),ie=s.useCallback(async()=>{if(h&&window.confirm("Are you sure you want to delete this signature?"))try{const a=await fetch(`${g}/delete-quality-assurance-signature/${h._id}`,{method:"DELETE"});if(a.ok)P({type:"success",text:"Signature deleted successfully"}),await E(o);else{const x=await a.json();P({type:"danger",text:x.error||"Error deleting signature"})}}catch(a){console.error("Error deleting signature:",a),P({type:"danger",text:"Error deleting signature"})}},[h,o,E]),le=s.useCallback(()=>{h&&(N({name:h.name||"",description:h.description||""}),A("form"),setTimeout(()=>{i&&i.clear()},100))},[h,i]),ge=s.useCallback(()=>{console.log("Adding signature"),console.log("Selected profession:",o),console.log("Company ID:",d),console.log("Project ID:",m),N({name:"",description:""}),A("form")},[o,d,m]),fe=()=>e.jsx("div",{className:"mb-4",children:e.jsxs(he,{children:[e.jsx(pe,{children:"Select Profession"}),e.jsxs(Se,{as:"select",value:(o==null?void 0:o._id)||"",onChange:a=>Z(a.target.value),children:[e.jsx("option",{value:"",children:"Choose a profession..."}),p.map(a=>e.jsxs("option",{value:a._id,children:[a.name||a.GroupName," (",a.SubjectMatterId||a._id,")"]},a._id))]})]})}),de=()=>o?e.jsxs("div",{children:[e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-3",children:e.jsxs("h5",{children:["Signature for ",o.name||o.GroupName]})}),e.jsxs(Ee,{striped:!0,bordered:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(Ue,{bg:h?"success":"secondary",children:h?"Signed":"Not Signed"})}),e.jsx("td",{children:h?h.name:"-"}),e.jsx("td",{children:h?h.description:"-"}),e.jsx("td",{children:h?new Date(h.signatureDate).toLocaleDateString():"-"}),e.jsx("td",{children:e.jsx("div",{className:"d-flex gap-2",children:h?e.jsxs(e.Fragment,{children:[e.jsx(T,{size:"sm",variant:"outline-primary",onClick:le,children:"Edit"}),e.jsx(T,{size:"sm",variant:"outline-danger",onClick:ie,children:"Delete"})]}):e.jsx(T,{size:"sm",variant:"success",onClick:ge,children:"Add"})})})]})})]})]}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{children:"Please select a profession to view signature"})}),ue=()=>o?e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("h5",{children:["Signature - ",o.name||o.GroupName]}),e.jsx(T,{variant:"outline-secondary",onClick:()=>A("list"),children:"Back to List"})]}),e.jsxs(I,{children:[e.jsxs(K,{children:[e.jsx(z,{md:6,children:e.jsxs(he,{className:"mb-3",children:[e.jsx(pe,{children:"Name *"}),e.jsx(Se,{type:"text",value:S.name,onChange:a=>w("name",a.target.value),placeholder:"Enter name"})]})}),e.jsx(z,{md:6,children:e.jsxs(he,{className:"mb-3",children:[e.jsx(pe,{children:"Description"}),e.jsx(Se,{type:"text",value:S.description,onChange:a=>w("description",a.target.value),placeholder:"Enter description"})]})})]}),e.jsxs(he,{className:"mb-3",children:[e.jsx(pe,{children:"Signature *"}),e.jsx(oe,{children:e.jsxs(os,{children:[e.jsx(ds,{ref:k,canvasProps:{width:500,height:200,className:"signature-canvas"}},"quality-assurance-signature-pad"),e.jsx("div",{className:"mt-2",children:e.jsx(T,{size:"sm",variant:"outline-secondary",onClick:X,children:"Clear"})})]})})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(T,{variant:"primary",onClick:ee,disabled:D,children:D?e.jsx(Te,{size:"sm"}):"Save Signature"}),e.jsx(T,{variant:"outline-secondary",onClick:()=>A("list"),children:"Cancel"})]})]})]}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{children:"Please select a profession first"})});return q?e.jsxs(e.Fragment,{children:[e.jsx(Te,{animation:"border"}),e.jsx("p",{className:"mt-2",children:"Loading..."})]}):e.jsxs(e.Fragment,{children:[M&&e.jsx(Oe,{variant:M.type,className:"mb-3",children:M.text}),fe(),L==="list"?de():ue()]})};function Ys(){const j=bs(),[f,d]=vs(),{setClickTask:m,selectedProfessionKey:o,setSelectedProfessionKey:u}=s.useContext(is),{loading:h,setLoading:r}=ls(),[S,N]=s.useState({"Any Report":!0,"Quality Assurance":!1,"Static Report":!1,"Final Report":!1}),{companyId:i,projectId:c}=re(),[p,G]=s.useState(()=>f.get("report")||"Address Notes"),[q,W]=s.useState([]),[D,C]=s.useState([]),[M,P]=s.useState([]),[L,A]=s.useState([]),[F,E]=s.useState([]),[Z,w]=s.useState([]),[k,X]=s.useState([]),[ee,ie]=s.useState([]),[le,ge]=s.useState([]),[fe,de]=s.useState([]),[ue,a]=s.useState([]),[x,H]=s.useState([]),[l,v]=s.useState([]),[R,J]=s.useState([]),[se,te]=s.useState([]),[ne,Pe]=s.useState([]),[$e,ve]=s.useState([]),[Ne,us]=s.useState([]),[ms,Ge]=s.useState(!1),[hs,_e]=s.useState(!1),[me,je]=s.useState([]),[we,rt]=s.useState(""),[be,Be]=s.useState("DK"),[Ce,De]=s.useState([]),_=o||we;s.useEffect(()=>{we&&u(we)},[we,u]),s.useEffect(()=>{const t=f.get("report");if(t&&t!==p){G(t);const n=Object.keys(ye).find(y=>ye[y].includes(t));n&&N(y=>({...y,[n]:!0}))}},[f,p]);const ps=t=>{N(n=>{const y=!n[t];return Object.keys(n).reduce((O,U)=>(O[U]=U===t?y:!1,O),{})})},Ie=t=>{if(G(t),d({report:t}),t==="Static Report Signatures"){Ge(!0);return}if(t==="Quality Assurance Signatures"){_e(!0);return}const n=Object.keys(ye).find(y=>ye[y].includes(t));n&&N(y=>({...y,[n]:!0}))},ye={"Any Report":["Address Notes","New Agreement","Saftey Mention","Technical Request"],"Quality Assurance":["CONTROLPLAN","Supervision note Report","Deviation In Quality Assurance","Name and Signature","Quality Assurance Signatures"],"Static Report":["Static Document Checklist","Static Report Registration","Static control plan","Deviation In Static Report","Special Control Point","Static Report Signatures"],"Final Report":[]},ze=async()=>{try{r(!0);const n=await(await fetch(`${g}/get-notes?companyId=${i}&projectId=${c}`)).json();W(n)}catch(t){console.error("Error fetching workers:",t)}finally{r(!1)}},qe=async()=>{try{r(!0);const n=await(await fetch(`${g}/get-news?companyId=${i}&projectId=${c}`)).json();C(n)}catch(t){console.error("Error fetching workers:",t)}finally{r(!1)}},He=async()=>{try{r(!0);const n=await(await fetch(`${g}/get-mentions?companyId=${i}&projectId=${c}`)).json();P(n)}catch(t){console.error("Error fetching workers:",t)}finally{r(!1)}},Qe=async()=>{try{r(!0);const n=await(await fetch(`${g}/get-requests?companyId=${i}&projectId=${c}`)).json();A(n)}catch(t){console.error("Error fetching workers:",t)}finally{r(!1)}},Le=async()=>{var t;try{r(!0);const y=await(await fetch(`${g}/get-project-detail`,{method:"POST",body:JSON.stringify({projectId:c}),headers:{"Content-Type":"application/json"}})).json(),O=[...new Set(y==null?void 0:y.tasks.map(Q=>Q.SubjectMatterId))],U=new URLSearchParams;U.append("companyId",i),U.append("projectId",c),O.forEach(Q=>U.append("SubjectMatterId[]",Q));const b=await(await fetch(`${g}/get-company-professions?${U}`)).json();je(b),u((t=b==null?void 0:b[0])==null?void 0:t.SubjectMatterId),w((y==null?void 0:y.tasks)||[]),Ze(O[0])}catch(n){console.error("Error fetching task:",n)}finally{r(!1)}},Je=async()=>{try{r(!0);const n=await(await fetch(`${g}/get-supers?companyId=${i}&projectId=${c}`)).json();X(n)}catch(t){console.error("Error fetching workers:",t)}finally{r(!1)}},Ve=async()=>{try{r(!0);const n=await(await fetch(`${g}/get-deviations?companyId=${i}&projectId=${c}&type=Quality Assurance`)).json();ie(n)}catch(t){console.error("Error fetching workers:",t)}finally{r(!1)}},Ke=async()=>{try{r(!0);const n=await(await fetch(`${g}/get-deviations?companyId=${i}&projectId=${c}&type=Static Report`)).json();ge(n)}catch(t){console.error("Error fetching workers:",t)}finally{r(!1)}},We=async()=>{try{r(!0);const n=await(await fetch(`${g}/get-special-control?companyId=${i}&projectId=${c}`)).json();de(n)}catch(t){console.error("Error fetching workers:",t)}finally{r(!1)}},Xe=async()=>{var t;try{r(!0);const y=await(await fetch(`${g}/get-project-detail`,{method:"POST",body:JSON.stringify({projectId:c}),headers:{"Content-Type":"application/json"}})).json();if(y!=null&&y.professionAssociatedData){const O=y.professionAssociatedData;H(O);const U=Object.keys(O),$=U[0];je(U),u($);const b=((t=O[$])==null?void 0:t.staticDocumentCheckList)||[];a(b),b.length>0&&c?(console.log("Calling fetchSubmittedStatus from staticDocumentChecklistTableApi..."),Ye($,b)):console.log("Not calling fetchSubmittedStatus from staticDocumentChecklistTableApi - conditions not met:",{checklistDataLength:b.length,projectId:c})}else{const O=`${g}/get-checklist`,$=await(await fetch(O)).json();a($==null?void 0:$.data)}}catch(n){console.error("Error fetching workers:",n)}finally{r(!1)}};s.useEffect(()=>{_&&p==="Static Document Checklist"&&gs(_),_&&p==="Static Report Registration"&&fs(_),_&&p==="CONTROLPLAN"&&Ze(_)},[_,Z,x]);const gs=t=>{var y;console.log("fetchChecklistForProfession called with key:",t);const n=((y=x==null?void 0:x[t])==null?void 0:y.staticDocumentCheckList)||[];console.log("checklistData length:",n.length),a(n),u(t),n.length>0&&c?(console.log("Calling fetchSubmittedStatus..."),Ye(t,n)):console.log("Not calling fetchSubmittedStatus - conditions not met:",{checklistDataLength:n.length,projectId:c})},Ye=async(t,n)=>{var y;try{console.log("fetchSubmittedStatus called with:",{professionKey:t,checklistDataLength:n.length,projectId:c});const O=x==null?void 0:x[t];console.log("professionData:",O);const U=(O==null?void 0:O.SubjectMatterId)||((y=O==null?void 0:O.profession)==null?void 0:y.SubjectMatterId);if(console.log("professionId (SubjectMatterId):",U),!U){console.log("No profession SubjectMatterId found, returning early");return}const $=n.map(ae=>ae._id);console.log("checklistIds:",$);const b=`${g}/check-static-document-checklist-status?projectId=${c}&professionId=${U}&checklistIds=${JSON.stringify($)}`;console.log("Making API call to:",b);const ce=await(await fetch(b)).json();console.log("API response:",ce),ce.success&&(v(ce.submittedChecklistIds),console.log("Set submittedChecklistIds:",ce.submittedChecklistIds))}catch(O){console.error("Error fetching submitted status:",O)}},fs=t=>{var y;const n=((y=se==null?void 0:se[t])==null?void 0:y.staticReportRegistration)||[];J(n),u(t)},Ze=t=>{const n=Z.filter(y=>y.SubjectMatterId.toLowerCase()===t.toLowerCase());E(n),u(t)},Ae=async()=>{try{if(r(!0),me.length===0||Ce.length===0)try{const b=await(await fetch(`${g}/get-project-detail/${c}`)).json();if(b!=null&&b.professionAssociatedData){const Q=Object.keys(b.professionAssociatedData).map(ae=>{const V=b.professionAssociatedData[ae];return console.log("=== EXTRACTING PROFESSION DATA ==="),console.log("Profession key:",ae),console.log("Raw profession data:",V),console.log("All keys in profData:",Object.keys(V)),console.log("EuroCode field (EuroCode):",V.EuroCode),console.log("EuroCode field (euroCode):",V.euroCode),console.log("EuroCode field (eurocode):",V.eurocode),console.log("EuroCode field (Eurocode):",V.Eurocode),console.log("=== END EXTRACTING ==="),{name:ae,SubjectMatterId:V.SubjectMatterId||V.subjectMatterId||ae,GroupName:V.GroupName||V.groupName||ae,euroCode:V.EuroCode||V.euroCode||V.eurocode||V.Eurocode||[]}});console.log("=== LOADING PROJECT PROFESSIONS ==="),console.log("Raw project data:",b.professionAssociatedData),console.log("Extracted project professions:",Q),console.log("Sample profession structure:",Q[0]),console.log("=== END LOADING PROJECT PROFESSIONS ==="),De(Q);const ce=Q.map(ae=>ae.name);je(ce),ce.length>0&&!_&&u(ce[0])}else{const ae=(await(await fetch(`${g}/get-company-professions?companyId=${i}`)).json()).map(xe=>({...xe,euroCode:xe.EuroCode||xe.euroCode||[]}));De(ae);const V=ae.map(xe=>xe.name||xe.professionName||xe._id);je(V),V.length>0&&!_&&u(V[0])}}catch($){console.error("Error loading professions:",$)}const t=new URLSearchParams;let n=null;_&&(n=Ce.find($=>($.name||$.professionName||$._id)===_),console.log("=== DEBUGGING PROFESSION SELECTION ==="),console.log("Selected profession key:",_),console.log("Found profession data:",n),console.log("=== COMPLETE PROFESSION OBJECT ==="),console.log("Complete profession object (JSON):",JSON.stringify(n,null,2)),console.log("Complete profession object (console):",n),console.log("=== END COMPLETE OBJECT ==="),console.log("All available professions:",Ce),console.log("Profession data keys:",n?Object.keys(n):"No profession found"),n!=null&&n.euroCode&&n.euroCode.length>0?(console.log("✅ EuroCode found:",n.euroCode),console.log("EuroCode type:",typeof n.euroCode),console.log("EuroCode length:",n.euroCode.length)):(console.log("❌ No euroCode found for profession:",_),console.log("Available fields in profession:",n?Object.keys(n):"No profession"),console.log("EuroCode field value:",n==null?void 0:n.euroCode),console.log("Using empty euroCode array as fallback")),console.log("=== END DEBUGGING ==="));const y={subjectMatterId:(n==null?void 0:n.SubjectMatterId)||_,language:be,projectId:c};console.log("POST body:",y);const U=await(await fetch(`${g}/get-controls-of-static-report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)})).json();if(console.log("API Response received:",U),U.entries&&Array.isArray(U.entries)){const $=U.entries.map((b,Q)=>({_id:b._id||`entry_${Q}`,pos:b.pos||"N/A",checkingThe:b.checkingThe||"N/A",subject:b.subject||"N/A",constructionPart:b.constructionPart||"N/A",basis:b.basis||"N/A",controlMethod:b.controlMethod||"N/A",circumference:b.circumference||"N/A",acceptanceCriteria:b.acceptanceCriteria||"N/A",time:b.time||"N/A",rowIndex:b.rowIndex||"N/A",language:be,subjectMatterId:(n==null?void 0:n.SubjectMatterId)||_,entries:[b]}));console.log("Transformed data:",$),J($)}else console.error("Invalid API response format:",U),J([])}catch(t){console.error("Error fetching static report registration:",t),J([])}finally{r(!1)}},es=async()=>{try{r(!0);const n=await(await fetch(`${g}/get-gammas?companyId=${i}&projectId=${c}`)).json();Pe(n)}catch(t){console.error("Error fetching workers:",t)}finally{r(!1)}},xs=async(t,n)=>{try{r(!0);const y={taskId:t,projectId:c,isActive:n};(await fetch(`${g}/approv-task`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)})).ok&&await Le()}catch(y){console.error("Error fetching workers:",y)}finally{r(!1)}},ss=async()=>{try{r(!0);const n=await(await fetch(`${g}/get-signatures?companyId=${i}&projectId=${c}`)).json();ve(n)}catch(t){console.error("Error fetching signatures:",t)}finally{r(!1)}},js=async()=>{try{r(!0);const n=await(await fetch(`${g}/get-name-signatures?companyId=${i}&projectId=${c}`)).json();us(n)}catch(t){console.error("Error fetching name signatures:",t)}finally{r(!1)}},ys=async t=>{t==="Address Notes"&&await ze(),t==="New Agreement"&&await qe(),t==="Saftey Mention"&&await He(),t==="Technical Request"&&await Qe(),t==="CONTROLPLAN"&&await Le(),t==="Supervision note Report"&&await Je(),t==="Deviation In Quality Assurance"&&await Ve(),t==="Name and Signature"&&await js(),t==="Deviation In Static Report"&&await Ke(),t==="Special Control Point"&&await We(),t==="Static Document Checklist"&&await Xe(),t==="Static Report Registration"&&await Ae(),t==="Static control plan"&&await es()};s.useEffect(()=>{p&&(p==="Signatures"?ss():ys(p)),m(null)},[p]),s.useEffect(()=>{p==="Static Report Registration"&&(_||be)&&Ae()},[_,be]),s.useEffect(()=>{i&&c&&me.length===0&&(async()=>{try{const y=await(await fetch(`${g}/get-project-detail/${c}`)).json();if(y!=null&&y.professionAssociatedData){const O=Object.keys(y.professionAssociatedData).map($=>{const b=y.professionAssociatedData[$];return{name:$,SubjectMatterId:b.SubjectMatterId||b.subjectMatterId,GroupName:b.GroupName||b.groupName,euroCode:b.EuroCode||b.euroCode||[]}});De(O);const U=O.map($=>$.name);je(U),U.length>0&&!_&&u(U[0])}else{const $=(await(await fetch(`${g}/get-company-professions?companyId=${i}`)).json()).map(Q=>({...Q,euroCode:Q.EuroCode||Q.euroCode||[]}));De($);const b=$.map(Q=>Q.name||Q.professionName||Q._id);je(b),b.length>0&&!_&&u(b[0])}}catch(n){console.error("Error loading professions:",n)}})()},[i,c]);const Ss=()=>{if(p==="Signatures")return $e?e.jsx(Rs,{refreshData:ss,signatures:$e,selectedReport:p}):null;if(p==="Special Text")return e.jsx(Ks,{});switch(p){case"Address Notes":return q?e.jsx(Ds,{refreshData:ze,notes:q,selectedReport:p}):null;case"New Agreement":return D?e.jsx(As,{refreshData:qe,news:D,selectedReport:p}):null;case"Saftey Mention":return M?e.jsx(ks,{refreshData:He,mentions:M,selectedReport:p}):null;case"Technical Request":return L?e.jsx(Ts,{refreshData:Qe,requests:L,selectedReport:p}):null;case"CONTROLPLAN":return F?e.jsxs(e.Fragment,{children:[me.length>0&&e.jsx(ns,{options:me,getOptionLabel:t=>`${t.SubjectMatterId} ${t.GroupName}`,value:me.find(t=>t.SubjectMatterId===_)||null,onChange:(t,n)=>{u(n==null?void 0:n.SubjectMatterId)},disableClearable:!0,renderInput:t=>e.jsx(rs,{...t,label:"Select Profession",variant:"outlined",size:"small"}),style:{maxWidth:300,marginBottom:20}}),e.jsx(Es,{refreshData:Le,tasks:F,navigate:j,options:{showSubmitAction:!0,setClickTask:m,aprovedTask:xs},projectId:c,selectedReport:p})]}):null;case"Supervision note Report":return k?e.jsx(Ps,{refreshData:Je,supers:k,selectedReport:p}):null;case"Deviation In Quality Assurance":return ee?e.jsx(ts,{refreshData:Ve,deviations:ee,selectedReport:p}):null;case"Name and Signature":return e.jsx(Vs,{});case"Deviation In Static Report":return le?e.jsx(ts,{refreshData:Ke,deviations:le,selectedReport:p}):null;case"Special Control Point":return le?e.jsx(Js,{refreshData:We,specialControle:fe,selectedReport:p}):null;case"Static Document Checklist":return ue?e.jsxs(e.Fragment,{children:[me.length>0&&e.jsx(ns,{options:me,value:_,onChange:(t,n)=>{u(n)},disableClearable:!0,renderInput:t=>e.jsx(rs,{...t,label:"Select Profession",variant:"outlined",size:"small"}),style:{maxWidth:300,marginBottom:20}}),e.jsx(Is,{refreshData:Xe,checkList:ue,navigate:j,options:{showSubmitAction:!0,submittedChecklistIds:l},selectedReport:p})]}):null;case"Static Report Registration":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"alert alert-info mb-3",children:[e.jsx("strong",{children:"Debug Info:"}),e.jsx("br",{}),"Company ID: ",i||"Not found",e.jsx("br",{}),"Project ID: ",c||"Not found",e.jsx("br",{}),"Loading: ",h?"Yes":"No",e.jsx("br",{}),"Selected Profession: ",_||"None",e.jsx("br",{}),"Professions Data: ",Ce.length," items",e.jsx("br",{}),"Static Report Data: ",R?R.length:"No data"," items",e.jsx("br",{}),e.jsx("strong",{children:"Status:"})," IDs are being passed to StaticReportRegistration component"]}),R?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card mb-4",children:[e.jsx("div",{className:"card-header",children:e.jsx("h6",{className:"mb-0",children:"Filters"})}),e.jsx("div",{className:"card-body",children:e.jsxs(K,{children:[e.jsx(z,{md:4,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Profession"}),e.jsxs("select",{className:"form-select",value:_||"",onChange:t=>u(t.target.value),children:[e.jsx("option",{value:"",children:"All Professions"}),me.map(t=>e.jsx("option",{value:t,children:t},t))]})]})}),e.jsx(z,{md:4,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Language"}),e.jsxs("select",{className:"form-select",value:be,onChange:t=>Be(t.target.value),children:[e.jsx("option",{value:"DK",children:"Danish (DK)"}),e.jsx("option",{value:"EN",children:"English (EN)"})]})]})}),e.jsx(z,{md:4,className:"d-flex align-items-end",children:e.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>{u(""),Be("")},children:"Clear Filters"})})]})})]}),e.jsx(Ls,{refreshData:Ae,staticsReport:R,navigate:j,options:{showSubmitAction:!0},selectedReport:p,companyId:i,projectId:c})]}):e.jsxs("div",{className:"alert alert-warning",children:[e.jsx("strong",{children:"No static report data available."}),e.jsx("br",{}),h?"Loading...":'Click "Refresh Data" to load data.',e.jsx("button",{className:"btn btn-primary ms-3",onClick:Ae,disabled:h,children:h?"Loading...":"Refresh Data"})]})]});case"Static control plan":return ne?e.jsx(Fs,{refreshData:es,gammas:ne,selectedReport:p}):null;case"Static Report Signatures":return e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsx("div",{className:"text-center",children:e.jsx(Ws,{show:ms,onHide:()=>Ge(!1),companyId:i,projectId:c,subjectMatterId:_})})});case"Quality Assurance Signatures":return e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsx("div",{className:"text-center",children:e.jsx(Xs,{show:hs,onHide:()=>_e(!1),companyId:i,projectId:c})})});default:return e.jsxs("p",{children:["Content for ",p," will be displayed here."]})}};return console.log("selectedProfessionKey",_),e.jsxs("div",{children:[e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-3",children:e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",children:"Reports"}),e.jsx("p",{className:"text-muted mb-0",children:"All profession are listed below"})]})}),e.jsx("hr",{className:"my-3"}),e.jsxs(K,{children:[e.jsx(z,{md:3,className:"border-end",children:e.jsxs("div",{className:"nav flex-column bg-light p-3 rounded",children:[Object.keys(ye).map(t=>e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex align-items-center bg-light text-primary rounded p-2",onClick:()=>ps(t),style:{cursor:"pointer"},children:[e.jsx(ke,{icon:Fe,className:"me-2 text-primary"}),e.jsx("span",{className:"flex-grow-1",children:t}),e.jsx(ke,{icon:S[t]?ws:Cs,className:"ms-auto"})]}),e.jsx(Ms,{in:S[t],children:e.jsx("div",{className:"ps-4 ms-2 border-start border-2 mt-2",children:ye[t].map(n=>e.jsx("div",{className:`py-2 ps-3 ${p===n?"bg-light text-primary fw-medium":"text-secondary"}`,onClick:()=>Ie(n),style:{cursor:"pointer"},children:n},n))})})]},t)),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:`d-flex align-items-center bg-light rounded p-2 ${p==="Signatures"?"text-primary fw-medium":"text-secondary"}`,onClick:()=>Ie("Signatures"),style:{cursor:"pointer"},children:[e.jsx(ke,{icon:Fe,className:"me-2"}),e.jsx("span",{className:"flex-grow-1",children:"Signatures"})]})}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:`d-flex align-items-center bg-light rounded p-2 ${p==="Special Text"?"text-primary fw-medium":"text-secondary"}`,onClick:()=>Ie("Special Text"),style:{cursor:"pointer"},children:[e.jsx(ke,{icon:Fe,className:"me-2"}),e.jsx("span",{className:"flex-grow-1",children:"Special Text"})]})})]})}),e.jsx(z,{md:9,children:p?e.jsx("div",{children:Ss()}):e.jsx("div",{className:"d-flex align-items-center justify-content-center h-100",children:e.jsx("p",{className:"text-muted",children:"Select a report type from the sidebar to view details"})})})]})]})}function Zs(){const{companyId:j,projectId:f}=re(),[d,m]=s.useState([]),[o,u]=s.useState(""),h=async()=>{try{const S=await(await fetch(`${g}/get-draws?companyId=${j}&projectId=${f}`)).json();m(S)}catch(r){console.error("Error fetching workers:",r)}};return s.useEffect(()=>{h()},[]),e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",children:"Drawing"}),e.jsx("p",{className:"text-muted mb-0",children:"All Drawing that are in this project are listed below"})]}),e.jsx("div",{className:"d-flex align-items-center",children:e.jsxs("div",{className:"d-flex align-items-center me-3",children:[e.jsx("label",{htmlFor:"tradeType",className:"text-nowrap me-2 mb-0",children:"Search"}),e.jsx("input",{type:"text",id:"tradeType",className:"form-control",value:o,onChange:r=>u(r.target.value),placeholder:"Search by project name"})]})})]}),e.jsx("hr",{className:"my-3"}),e.jsx(K,{children:e.jsx(z,{md:12,children:e.jsx(Us,{refreshData:h,draws:d,globalFilter:o})})})]})}function et(){const{companyId:j,projectId:f}=re(),[d,m]=s.useState([]),[o,u]=s.useState(""),[h,r]=s.useState(!1),[S,N]=s.useState(!1),[i,c]=s.useState([]),[p,G]=s.useState(""),[q,W]=s.useState(""),[D,C]=s.useState(!1),[M,P]=s.useState(null),[L,A]=s.useState({show:!1,pdfFile:"",name:""}),[F,E]=s.useState({}),[Z,w]=s.useState(8),k=[{value:"contracts",label:"Contracts"},{value:"permits",label:"Permits"},{value:"specifications",label:"Specifications"},{value:"reports",label:"Reports"},{value:"certificates",label:"Certificates"},{value:"other",label:"Other"}],X=async()=>{try{const x=await(await fetch(`${g}/get-documents?companyId=${j}&projectId=${f}`)).json();m(x)}catch(a){console.error("Error fetching documents:",a)}};s.useEffect(()=>{X()},[j,f]);const ee=a=>{const x=Array.from(a.target.files);c(x)},ie=async()=>{if(i.length===0||!p){alert("Please select files and choose a category");return}N(!0);const a=new FormData;a.append("companyId",j),a.append("projectsId",f),a.append("category",p),a.append("description",q),i.forEach(x=>{a.append("documents",x)});try{(await fetch(`${g}/store-documents`,{method:"POST",body:a})).ok?(r(!1),c([]),G(""),W(""),X(),alert("Documents uploaded successfully!")):alert("Failed to upload documents")}catch(x){console.error("Upload error:",x),alert("Error uploading documents")}finally{N(!1)}},le=a=>{const x=`${g}/uploads/${a.storedName}`,H=a.originalName||"Document",l=H.split(".").pop().toLowerCase();l==="pdf"?A({show:!0,pdfFile:x,name:H}):(["jpg","jpeg","png","gif","bmp","webp"].includes(l),window.open(x,"_blank"))},ge=a=>{P(a),C(!0)},fe=async()=>{if(M)try{(await fetch(`${g}/delete-document/${M._id}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})).ok?(C(!1),P(null),X(),alert("Document deleted successfully!")):alert("Failed to delete document")}catch(a){console.error("Delete error:",a),alert("Error deleting document")}},de=d.filter(a=>{var x,H,l;return((x=a.category)==null?void 0:x.toLowerCase().includes(o.toLowerCase()))||((H=a.description)==null?void 0:H.toLowerCase().includes(o.toLowerCase()))||((l=a.originalName)==null?void 0:l.toLowerCase().includes(o.toLowerCase()))}),ue=a=>({contracts:"primary",permits:"success",specifications:"info",reports:"warning",certificates:"danger",other:"secondary"})[a]||"secondary";return e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",children:"Documents"}),e.jsx("p",{className:"text-muted mb-0",children:"All documents uploaded to this project are listed below"})]}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{className:"d-flex align-items-center me-3",children:[e.jsx("label",{htmlFor:"searchDocuments",className:"text-nowrap me-2 mb-0",children:"Search"}),e.jsx("input",{type:"text",id:"searchDocuments",className:"form-control",value:o,onChange:a=>u(a.target.value),placeholder:"Search documents..."})]}),e.jsxs(T,{variant:"primary",onClick:()=>r(!0),className:"d-flex align-items-center",children:[e.jsx(Y,{icon:"mdi:upload",className:"me-2"}),"Upload Documents"]})]})]}),e.jsx("hr",{className:"my-3"}),e.jsx(oe,{children:e.jsx(oe.Body,{children:e.jsxs(Ee,{responsive:!0,striped:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Document Name"}),e.jsx("th",{children:"Category"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Upload Date"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:de.length>0?de.map((a,x)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(Y,{icon:"mdi:file-document",className:"me-2 text-primary"}),a.originalName||"Untitled Document"]})}),e.jsx("td",{children:e.jsx(Ue,{bg:ue(a.category),children:a.category||"Uncategorized"})}),e.jsx("td",{children:a.description||"No description"}),e.jsx("td",{children:a.uploadedAt?new Date(a.uploadedAt).toLocaleDateString():"Unknown"}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(T,{variant:"outline-info",size:"sm",onClick:()=>le(a),title:"View Document",children:e.jsx(Y,{icon:"mdi:eye"})}),e.jsx(T,{variant:"outline-danger",size:"sm",onClick:()=>ge(a),title:"Delete Document",children:e.jsx(Y,{icon:"mdi:delete"})})]})})]},a._id||x)):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center text-muted",children:"No documents found"})})})]})})}),e.jsxs(B,{show:h,onHide:()=>r(!1),size:"lg",children:[e.jsx(B.Header,{closeButton:!0,children:e.jsx(B.Title,{children:"Upload Documents"})}),e.jsx(B.Body,{children:e.jsxs(I,{children:[e.jsxs(I.Group,{className:"mb-3",children:[e.jsx(I.Label,{children:"Document Category"}),e.jsxs(I.Select,{value:p,onChange:a=>G(a.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select a category"}),k.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]}),e.jsxs(I.Group,{className:"mb-3",children:[e.jsx(I.Label,{children:"Description (Optional)"}),e.jsx(I.Control,{as:"textarea",rows:3,value:q,onChange:a=>W(a.target.value),placeholder:"Enter document description..."})]}),e.jsxs(I.Group,{className:"mb-3",children:[e.jsx(I.Label,{children:"Select Files"}),e.jsx(I.Control,{type:"file",multiple:!0,onChange:ee,accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png"}),e.jsx(I.Text,{className:"text-muted",children:"Supported formats: PDF, DOC, DOCX, TXT, JPG, JPEG, PNG"})]}),i.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Selected Files:"}),e.jsx("ul",{className:"list-unstyled",children:i.map((a,x)=>e.jsxs("li",{className:"text-muted",children:[e.jsx(Y,{icon:"mdi:file",className:"me-2"}),a.name," (",(a.size/1024/1024).toFixed(2)," MB)"]},x))})]})]})}),e.jsxs(B.Footer,{children:[e.jsx(T,{variant:"secondary",onClick:()=>r(!1),children:"Cancel"}),e.jsx(T,{variant:"primary",onClick:ie,disabled:S||i.length===0||!p,children:S?e.jsxs(e.Fragment,{children:[e.jsx(Y,{icon:"mdi:loading",className:"me-2",spin:!0}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{icon:"mdi:upload",className:"me-2"}),"Upload Documents"]})})]})]}),e.jsxs(B,{show:D,onHide:()=>C(!1),children:[e.jsx(B.Header,{closeButton:!0,children:e.jsx(B.Title,{children:"Confirm Deletion"})}),e.jsxs(B.Body,{children:['Are you sure you want to delete the document "',M==null?void 0:M.originalName,'"? This action cannot be undone.']}),e.jsxs(B.Footer,{children:[e.jsx(T,{variant:"secondary",onClick:()=>C(!1),children:"Cancel"}),e.jsx(T,{variant:"danger",onClick:fe,children:"Yes, Delete"})]})]}),L.show&&e.jsx(Gs,{drawDotsOnPdf:L,setDrawDotsOnPdf:A,markers:F,setMarkers:E,dotSize:Z,setDotSize:w,readOnly:!0})]})}function st(){const{companyId:j,projectId:f}=re(),[d,m]=s.useState([]),[o,u]=s.useState(""),h=async()=>{try{const M=await(await fetch(`${g}/get-project-detail`,{method:"POST",body:JSON.stringify({projectId:f}),headers:{"Content-Type":"application/json"}})).json();m(M==null?void 0:M.checks)}catch(C){console.error("Error fetching workers:",C)}};s.useEffect(()=>{h()},[]);const[r,S]=s.useState(!1),[N,i]=s.useState(null),[c,p]=s.useState(""),[G,q]=s.useState(!1),W=async C=>{i(C),p(""),S(!0)},D=async()=>{if(!c.trim()){alert("Please enter a note before approving");return}q(!0);try{const C={checkId:N,projectId:f,note:c.trim()};(await fetch(`${g}/submit-checklist`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(C)})).ok?(S(!1),i(null),p(""),h(),alert("Checklist approved successfully!")):alert("Failed to approve checklist")}catch(C){console.log("error",C),alert("Error approving checklist")}finally{q(!1)}};return e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",children:"Checklist"}),e.jsx("p",{className:"text-muted mb-0",children:"All Checklist that are in this project are listed below"})]}),e.jsx("div",{className:"d-flex align-items-center",children:e.jsxs("div",{className:"d-flex align-items-center me-3",children:[e.jsx("label",{htmlFor:"tradeType",className:"text-nowrap me-2 mb-0",children:"Search"}),e.jsx("input",{type:"text",id:"tradeType",className:"form-control",value:o,onChange:C=>u(C.target.value),placeholder:"Search by project name"})]})})]}),e.jsx("hr",{className:"my-3"}),e.jsx(K,{children:e.jsx(z,{md:12,children:e.jsx(_s,{refreshData:h,checks:d,globalFilter:o,aprovedCheckList:W,options:{showAprovedAction:!0}})})}),r&&e.jsx("div",{className:"modal fade show",style:{display:"block"},tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"mdi mdi-check-circle text-primary me-2"}),"Approve Checklist"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>S(!1)})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"approvalNote",className:"form-label",children:["Approval Note ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("textarea",{id:"approvalNote",className:"form-control",rows:"4",value:c,onChange:C=>p(C.target.value),placeholder:"Enter your approval note...",required:!0})]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>S(!1),disabled:G,children:"Cancel"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:D,disabled:G||!c.trim(),children:G?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status"}),"Approving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-check-circle me-2"}),"Approve"]})})]})]})})}),r&&e.jsx("div",{className:"modal-backdrop fade show"})]})}function tt(){const{companyId:j,projectId:f}=re(),[d,m]=s.useState([]),[o,u]=s.useState(""),h=async()=>{try{const S=await(await fetch(`${g}/get-plans?companyId=${j}&projectId=${f}`)).json();m(S)}catch(r){console.error("Error fetching workers:",r)}};return s.useEffect(()=>{h()},[]),e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",children:"Plans"}),e.jsx("p",{className:"text-muted mb-0",children:"All Plans that are in this project are listed below"})]}),e.jsx("div",{className:"d-flex align-items-center",children:e.jsxs("div",{className:"d-flex align-items-center me-3",children:[e.jsx("label",{htmlFor:"tradeType",className:"text-nowrap me-2 mb-0",children:"Search"}),e.jsx("input",{type:"text",id:"tradeType",className:"form-control",value:o,onChange:r=>u(r.target.value),placeholder:"Search by project name"})]})})]}),e.jsx("hr",{className:"my-3"}),e.jsx(K,{children:e.jsx(z,{md:12,children:e.jsx(Bs,{refreshData:h,plans:d,globalFilter:o})})})]})}const at=()=>{const{companyId:j,projectId:f}=re(),[d,m]=s.useState([]),[o,u]=s.useState(""),h=async()=>{try{const S=await(await fetch(`${g}/get-company-professions?companyId=${j}&projectId=${f}`)).json();m(S)}catch(r){console.error("Error fetching workers:",r)}};return s.useEffect(()=>{h()},[]),e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",children:"Professions"}),e.jsx("p",{className:"text-muted mb-0",children:"All Professions list is listed below"})]}),e.jsx("div",{className:"d-flex align-items-center",children:e.jsxs("div",{className:"d-flex align-items-center me-3",children:[e.jsx("label",{htmlFor:"tradeType",className:"text-nowrap me-2 mb-0",children:"Search"}),e.jsx("input",{type:"text",id:"tradeType",className:"form-control",value:o,onChange:r=>u(r.target.value),placeholder:"Search by professions name"})]})})]}),e.jsx("hr",{className:"my-3"}),e.jsx(K,{children:e.jsx(z,{md:12,children:e.jsx(zs,{refreshData:h,professions:d,globalFilter:o})})})]})};function nt(){const{companyId:j,projectId:f}=re(),[d,m]=s.useState([]),[o,u]=s.useState(""),h=async()=>{try{const S=await(await fetch(`${g}/get-schemes?companyId=${j}&projectId=${f}`)).json();m(S)}catch(r){console.error("Error fetching workers:",r)}};return s.useEffect(()=>{h()},[]),e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",children:"Certificate Schemes "}),e.jsx("p",{className:"text-muted mb-0",children:"All Certificate Schemes that are in this project are listed below"})]}),e.jsx("div",{className:"d-flex align-items-center",children:e.jsxs("div",{className:"d-flex align-items-center me-3",children:[e.jsx("label",{htmlFor:"tradeType",className:"text-nowrap me-2 mb-0",children:"Search"}),e.jsx("input",{type:"text",id:"tradeType",className:"form-control",value:o,onChange:r=>u(r.target.value),placeholder:"Search by project name"})]})})]}),e.jsx("hr",{className:"my-3"}),e.jsx(K,{children:e.jsx(z,{md:12,children:e.jsx(qs,{refreshData:h,schemes:d,globalFilter:o})})})]})}const Na=()=>{const{setLoading:j}=ls(),[f,d]=s.useState(null),{companyId:m,projectId:o}=re(),{selectedProjectDetailPageTab:u,setSelectedProjectDetailPageTab:h,setSelectedCompany:r}=s.useContext(is);s.useEffect(()=>{r(m)},[m,o]);const S=[{id:"reports",label:"Reports",content:e.jsx(Ys,{})},{id:"users",label:"Users",content:e.jsx(Os,{})},{id:"drawingAndDocument",label:"Drawing",content:e.jsx(Zs,{})},{id:"documents",label:"Documents",content:e.jsx(et,{})},{id:"checkList",label:"Check List",content:e.jsx(st,{})},{id:"plans",label:"Plans",content:e.jsx(tt,{})},{id:"professions",label:"Professions",content:e.jsx(at,{})},{id:"certificateSchemes",label:"Certificate Schemes",content:e.jsx(nt,{})}];s.useEffect(()=>{(async()=>{if(o){j(!0);try{const p=await(await fetch(`${g}/get-project-detail/${o}`)).json();d(p)}catch(c){console.error("Error fetching project details:",c)}finally{j(!1)}}})()},[m,o]);const N=()=>{const i=S.find(c=>c.id===u);return i?i.content:null};return e.jsxs(e.Fragment,{children:[e.jsx(Ns,{title:(f==null?void 0:f.name)||"Project Details"}),e.jsx(K,{className:"justify-content-center",children:e.jsx(z,{lg:"12",children:e.jsxs(cs,{title:(f==null?void 0:f.name)||"Companies Name",children:[e.jsx(Me,{variant:"tabs",className:"custom-tabs mb-3",children:S.map(i=>e.jsx(Me.Item,{children:e.jsx(Me.Link,{active:u===i.id,onClick:()=>h(i.id),className:u===i.id?"fw-bold":"",children:i.label})},i.id))}),e.jsx("div",{className:"tab-content",children:e.jsx("div",{className:"tab-pane fade show active",children:N()})})]})})})]})};export{Na as default};
