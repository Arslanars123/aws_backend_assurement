import{r as o,a as X,b as Y,j as e,R as c,C as i}from"./index-CFC_skDo.js";import{C as Z}from"./ComponentContainerCard-BgtLXH2x.js";import{P as ee}from"./PageMetaData--AH9Un1H.js";import{B as p}from"./urls-BhGeBsON.js";import{D as te}from"./page-D5pKxfhO.js";import{F as j}from"./FormLabel-S5bDb0w7.js";import{F as se}from"./FormSelect-D_Be58Ty.js";import{A as v,T as y,C as S}from"./TextField-IDun-2ph.js";import{I as k}from"./Image-xOOuaExf.js";import{F as ae}from"./FormControl-CiIjeg_-.js";import{B as F}from"./Button-2F6J7aEx.js";import"./Card-DSVzyJ_p.js";import"./divWithClassName-Dn3DrZ5P.js";import"./Modal-DU8OHNhS.js";import"./useWindow-BqbRBza5.js";import"./DataKey-COGXBUcQ.js";import"./NoopTransition-DRW2_py_.js";import"./FormRange-CNLHcOIM.js";import"./useSlot-CMJ6u0xq.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-BcofISFZ.js";const re={item:null,selectedDrawing:null,projectUsers:null,projectManager:null},Ie=()=>{var D,M;const[r,m]=o.useState(re),[P,N]=o.useState(!1),[$,R]=o.useState([]),[U,O]=o.useState([]),E=X(),{companyId:u,projectId:h}=Y(),[f,C]=o.useState({show:!1,imgUrl:null}),[g,I]=o.useState([]),[w,T]=o.useState([]),[B,L]=o.useState([]),b=o.useRef(null),J=o.useRef(),[A,z]=o.useState(null),[V,W]=o.useState([]),[_,q]=o.useState(10);o.useEffect(()=>{const s=async()=>{try{const l=await(await fetch(`${p}/get-draws?companyId=${u}&projectId=${h}`)).json();R(l)}catch(a){console.error("Error fetching workers:",a)}},t=async()=>{try{const a=`${p}/get-filter-users`,x=await(await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({companyId:u,projectId:h})})).json();O(x)}catch(a){console.error("Error fetching users:",a)}};(async()=>{try{const a=`${p}/get-project-managers?companyId=${u}&projectId=${h}`,d=await(await fetch(a)).json();L(d)}catch(a){console.error("Error fetching project managers:",a)}})(),t(),s()},[]);const H=s=>{const t=Array.from(s.target.files),n=[...g,...t],a=[...w,...t.map(l=>URL.createObjectURL(l))];I(n),T(a)},G=s=>{const t=g.filter((l,d)=>d!==s),n=w.filter((l,d)=>d!==s);I(t),T(n);const a=new DataTransfer;t.forEach(l=>a.items.add(l)),b.current&&(b.current.files=a.files)},K=s=>{const{name:t,value:n,multiple:a,options:l}=s.target;if(a){const d=Array.from(l).filter(x=>x.selected).map(x=>x.value);m({...r,[t]:d})}else m({...r,[t]:n})},Q=async s=>{s.preventDefault(),N(!0);try{const t=new FormData;t.append("companyId",u),t.append("projectsId",h),t.append("item",r.item),t.append("projectUsers",JSON.stringify(r.projectUsers)),t.append("projectManager",JSON.stringify(r.projectManager)),t.append("drawing",JSON.stringify(r.selectedDrawing)),A&&t.append("annotatedImage",A),g.length>0&&g.forEach(a=>{t.append("pictures",a)});const n=await fetch(`${p}/store-note`,{method:"POST",body:t});n.ok?E(`/dashboard/companies/view/${u}/projects/view/${h}`):console.error("Error:",n.statusText)}catch(t){console.error("Fetch error:",t)}N(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(ee,{title:"Add Address Note"}),e.jsx("form",{onSubmit:Q,children:e.jsx(c,{className:"justify-content-center",children:e.jsx(i,{children:e.jsx(Z,{title:"Add Address Note",children:e.jsxs(c,{children:[e.jsx(i,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(j,{className:"col-sm-2 col-form-label text-end",children:"Select Item"}),e.jsx(i,{sm:"10",children:e.jsxs(se,{value:r.item,name:"item",onChange:K,children:[e.jsx("option",{defaultValue:"",children:"Select Item"}),e.jsx("option",{value:"The work does not follow the schedule.",children:"The work does not follow the schedule."}),e.jsx("option",{value:"The work is not completed.",children:"The work is not completed."}),e.jsx("option",{value:"The relationship causes delays",children:"The relationship causes delays"}),e.jsx("option",{value:"The interfaces cannot receive in that state.",children:"The interfaces cannot receive in that state."}),e.jsx("option",{value:"Manpower must be provided here if the schedule is to be adhered to.",children:"Manpower must be provided here if the schedule is to be adhered to."}),e.jsx("option",{value:"Someone has destroyed my work after final inspection.",children:"Someone has destroyed my work after final inspection."}),e.jsx("option",{value:"Conditions that are taken up at the next building meeting",children:"Conditions that are taken up at the next building meeting"}),e.jsx("option",{value:"The work is notified to be stopped in 3 days, due to non-payment. cf. AB18",children:"The work is notified to be stopped in 3 days, due to non-payment. cf. AB18"})]})})]})}),e.jsx(i,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(j,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Project Manager"}),e.jsx(i,{sm:"10",children:e.jsx(v,{multiple:!1,options:B,getOptionLabel:s=>s.name,value:r==null?void 0:r.projectManager,onChange:(s,t)=>{m({...r,projectManager:t})},renderInput:s=>e.jsx(y,{...s,variant:"outlined",placeholder:"Search and select Project Manager..."}),renderTags:(s,t)=>s.map((n,a)=>e.jsx(S,{label:n.name,...t({index:a})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(i,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(j,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Recipients"}),e.jsx(i,{sm:"10",children:e.jsx(v,{multiple:!1,options:U,getOptionLabel:s=>s.name,value:r==null?void 0:r.projectUsers,onChange:(s,t)=>{m({...r,projectUsers:t})},renderInput:s=>e.jsx(y,{...s,variant:"outlined",placeholder:"Search and project Users drawing..."}),renderTags:(s,t)=>s.map((n,a)=>e.jsx(S,{label:n.name,...t({index:a})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(i,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(j,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Drawing"}),e.jsx(i,{sm:"10",children:e.jsx(v,{multiple:!1,options:$,getOptionLabel:s=>s.name,value:r==null?void 0:r.selectedDrawing,onChange:(s,t)=>{m({...r,selectedDrawing:t})},renderInput:s=>e.jsx(y,{...s,variant:"outlined",placeholder:"Search and select drawing..."}),renderTags:(s,t)=>s.map((n,a)=>e.jsx(S,{label:n.name,...t({index:a})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(i,{lg:"6",children:e.jsx(c,{className:"",children:(M=(D=r==null?void 0:r.selectedDrawing)==null?void 0:D.pictures)==null?void 0:M.map((s,t)=>e.jsx("div",{className:"position-relative me-2 mb-2",children:e.jsx(k,{src:`${p}/uploads/${s}`,onClick:()=>{C({show:!0,imgUrl:`${p}/uploads/${s}`})},alt:`Existing Preview ${t}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}})},`existing-${t}`))})}),(f==null?void 0:f.show)&&e.jsx(i,{lg:"6",children:e.jsx(c,{children:e.jsx("div",{className:"position-relative",style:{maxWidth:"100%",height:"auto"},children:e.jsx(te,{ref:J,drawDotsOnImage:f,setDrawDotsAnImage:C,onSave:s=>{z(s)},setMarkers:W,markers:V,dotSize:_,setDotSize:q})})})}),e.jsx(i,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(j,{htmlFor:"multiple-file-input",className:"col-sm-2 col-form-label text-end",children:"Pictures"}),e.jsxs(i,{sm:"10",children:[e.jsx(ae,{type:"file",id:"multiple-file-input",name:"pictures",onChange:H,accept:"image/*",multiple:!0,ref:b}),e.jsx("div",{className:"mt-3 d-flex flex-wrap",children:w.map((s,t)=>e.jsxs("div",{className:"position-relative me-2 mb-2",children:[e.jsx(k,{src:s,alt:`Preview ${t}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),e.jsx(F,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>G(t),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"Ã—"})]},t))})]})]})}),e.jsx(c,{className:"mb-3 d-flex justify-content-center",children:e.jsx(i,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(F,{disabled:P,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{Ie as default};
