import{r as i,a as Y,b as Z,j as e,R as l,C as o}from"./index-Ccc50bvq.js";import{C as ee}from"./ComponentContainerCard-jOvJBIs5.js";import{P as te}from"./PageMetaData-CwfTEKnL.js";import{B as d}from"./urls-BhGeBsON.js";import{D as se}from"./page-h5XIzvWu.js";import{F as j}from"./FormLabel-MCMdPdRI.js";import{F as re}from"./FormSelect-Bt2BskkO.js";import{A as v,T as y,C as S}from"./TextField-DlT7K7k6.js";import{I as R}from"./Image-JoqgvPfO.js";import{F as ae}from"./FormControl-CO_Uebzp.js";import{B as P}from"./Button-Czdzc6_d.js";import"./Card-Bd-5a1Ef.js";import"./divWithClassName-B0s-A9qq.js";import"./Modal-p4tRgnEt.js";import"./useWindow-yc1yIKZN.js";import"./DataKey-COGXBUcQ.js";import"./NoopTransition-ClZX65CP.js";import"./FormRange-DAlMXWTQ.js";import"./useSlot-CggVarzL.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-BcofISFZ.js";const ne={item:null,selectedDrawing:null,projectUsers:null,projectManager:null},De=()=>{var F,M;const[r,p]=i.useState(ne),[T,N]=i.useState(!1),$=Y(),{companyId:m,projectId:u}=Z(),[U,O]=i.useState([]),[E,q]=i.useState([]),[k,B]=i.useState([]),[x,I]=i.useState([]),[f,C]=i.useState([]),b=i.useRef(null),L=i.useRef(),[D,J]=i.useState(null),[V,W]=i.useState([]),[g,A]=i.useState({show:!1,imgUrl:null}),_=t=>{const s=Array.from(t.target.files),a=[...x,...s],n=[...f,...s.map(c=>URL.createObjectURL(c))];I(a),C(n)},H=t=>{const s=x.filter((c,h)=>h!==t),a=f.filter((c,h)=>h!==t);I(s),C(a);const n=new DataTransfer;s.forEach(c=>n.items.add(c)),b.current&&(b.current.files=n.files)},z=t=>{const{name:s,value:a,multiple:n,options:c}=t.target;if(n){const h=Array.from(c).filter(w=>w.selected).map(w=>w.value);p({...r,[s]:h})}else p({...r,[s]:a})},G=async()=>{try{const t=`${d}/get-project-managers?companyId=${m}&projectId=${u}`,a=await(await fetch(t)).json();O(a)}catch(t){console.error("Error fetching project managers:",t)}},K=async()=>{try{const s=await(await fetch(`${d}/get-draws?companyId=${m}&projectId=${u}`)).json();B(s)}catch(t){console.error("Error fetching workers:",t)}},Q=async()=>{try{const t=`${d}/get-filter-users`,n=await(await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({companyId:m,projectId:u})})).json();q(n)}catch(t){console.error("Error fetching users:",t)}};i.useEffect(()=>{G(),Q(),K()},[]);const X=async t=>{t.preventDefault(),N(!0);try{const s=new FormData;s.append("companyId",m),s.append("projectsId",u),s.append("item",r.item),s.append("projectUsers",JSON.stringify(r.projectUsers)),s.append("projectManager",JSON.stringify(r.projectManager)),s.append("drawing",JSON.stringify(r.selectedDrawing)),D&&s.append("annotatedImage",D),x.length>0&&x.forEach(n=>{s.append("pictures",n)});const a=await fetch(`${d}/store-request`,{method:"POST",body:s});if(a.ok){const n=await a.json();$(`/dashboard/companies/view/${m}/projects/view/${u}`)}else console.error("Error:",a.statusText)}catch(s){console.error("Fetch error:",s)}N(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(te,{title:"Add Technical Request"}),e.jsx("form",{onSubmit:X,children:e.jsx(l,{className:"justify-content-center",children:e.jsx(o,{children:e.jsx(ee,{title:"Add Technical Request",children:e.jsxs(l,{children:[e.jsx(o,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(j,{className:"col-sm-2 col-form-label text-end",children:"Select Item"}),e.jsx(o,{sm:"10",children:e.jsxs(re,{value:r.item,name:"item",onChange:z,children:[e.jsx("option",{defaultValue:"",children:"Select Item"}),e.jsx("option",{value:"Does not include project material.",children:"Does not include project material."}),e.jsx("option",{value:"Meeting at the construction site is required.",children:"Meeting at the construction site is required."}),e.jsx("option",{value:"There is no preparation as told.",children:"There is no preparation as told."}),e.jsx("option",{value:"A new instruction is requested here, as it is not possible",children:"A new instruction is requested here, as it is not possible"})]})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(j,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Project Manager"}),e.jsx(o,{sm:"10",children:e.jsx(v,{multiple:!1,options:U,getOptionLabel:t=>t.name,value:r==null?void 0:r.projectManager,onChange:(t,s)=>{p({...r,projectManager:s})},renderInput:t=>e.jsx(y,{...t,variant:"outlined",placeholder:"Search and select Project Manager..."}),renderTags:(t,s)=>t.map((a,n)=>e.jsx(S,{label:a.name,...s({index:n})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(j,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Recipients"}),e.jsx(o,{sm:"10",children:e.jsx(v,{multiple:!1,options:E,getOptionLabel:t=>t.name,value:r==null?void 0:r.projectUsers,onChange:(t,s)=>{p({...r,projectUsers:s})},renderInput:t=>e.jsx(y,{...t,variant:"outlined",placeholder:"Search and project Users drawing..."}),renderTags:(t,s)=>t.map((a,n)=>e.jsx(S,{label:a.name,...s({index:n})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(j,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Drawing"}),e.jsx(o,{sm:"10",children:e.jsx(v,{multiple:!1,options:k,getOptionLabel:t=>t.name,value:r==null?void 0:r.selectedDrawing,onChange:(t,s)=>{p({...r,selectedDrawing:s})},renderInput:t=>e.jsx(y,{...t,variant:"outlined",placeholder:"Search and select drawing..."}),renderTags:(t,s)=>t.map((a,n)=>e.jsx(S,{label:a.name,...s({index:n})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(o,{lg:"6",children:e.jsx(l,{className:"",children:(M=(F=r==null?void 0:r.selectedDrawing)==null?void 0:F.pictures)==null?void 0:M.map((t,s)=>e.jsx("div",{className:"position-relative me-2 mb-2",children:e.jsx(R,{src:`${d}/uploads/${t}`,onClick:()=>{A({show:!0,imgUrl:`${d}/uploads/${t}`})},alt:`Existing Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}})},`existing-${s}`))})}),(g==null?void 0:g.show)&&e.jsx(o,{lg:"6",children:e.jsx(l,{children:e.jsx("div",{className:"position-relative",style:{maxWidth:"100%",height:"auto"},children:e.jsx(se,{ref:L,drawDotsOnImage:g,setDrawDotsAnImage:A,onSave:t=>{J(t)},setMarkers:W,markers:V})})})}),e.jsx(o,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(j,{htmlFor:"multiple-file-input",className:"col-sm-2 col-form-label text-end",children:"Pictures"}),e.jsxs(o,{sm:"10",children:[e.jsx(ae,{type:"file",id:"multiple-file-input",name:"pictures",onChange:_,accept:"image/*",multiple:!0,ref:b}),e.jsx("div",{className:"mt-3 d-flex flex-wrap",children:f.map((t,s)=>e.jsxs("div",{className:"position-relative me-2 mb-2",children:[e.jsx(R,{src:t,alt:`Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),e.jsx(P,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>H(s),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"Ã—"})]},s))})]})]})}),e.jsx(l,{className:"mb-3 d-flex justify-content-center",children:e.jsx(o,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(P,{disabled:T,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{De as default};
