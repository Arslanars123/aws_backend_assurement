import{r as n,b as W,a as J,G as K,j as e,R as l,C as a}from"./index-BfjhYpb5.js";import{C as Q}from"./ComponentContainerCard-BbSfpbsX.js";import{P as X}from"./PageMetaData-CFx5C9vJ.js";import{B as u}from"./urls-CXtk4x-h.js";import{F as d}from"./FormLabel-9Op50W6F.js";import{F as h}from"./FormSelect-CIOplRxv.js";import{F as Y}from"./FormControl-u0lKnE3u.js";import{I as R}from"./Image-D3CG5EY4.js";import{B as v}from"./Button-0d7iDM-S.js";import"./Card-CjeZJw7I.js";import"./divWithClassName-CLs3g5aQ.js";const fe=()=>{const[i,f]=n.useState(null),[F,S]=n.useState(!1),[q,I]=n.useState(!0),[y,Z]=n.useState(null),[ee,$]=n.useState(null),[j,P]=n.useState([]),[g,N]=n.useState([]),{requestId:x}=W(),D=J();n.useRef(null);const b=n.useRef(null),[T,E]=n.useState([]),{selectedCompany:se,selectedProjects:C,selectedProfession:te,companies:re}=useContext(K);n.useEffect(()=>{x&&fetch(`${u}/get-request-detail/${x}`).then(async t=>{const s=await t.json();f({...s,picture2:s.picture,pictures2:s.pictures}),s.picture&&s.picture!=="null"&&$(`https://147.93.94.31/uploads/${s.picture}`),s.pictures&&s.pictures.length>0&&E(s.pictures.map(r=>`https://147.93.94.31/uploads/${r}`))}).catch(t=>console.error(t)).finally(()=>I(!1))},[x]);const m=t=>{const{name:s,value:r,multiple:o,options:c}=t.target;if(o){const p=Array.from(c).filter(w=>w.selected).map(w=>w.value);f({...i,[s]:p})}else f({...i,[s]:r})};n.useEffect(()=>{(async()=>{try{const r=await(await fetch(`${u}/get-projects`)).json();L(r)}catch(s){console.error("Error fetching projects:",s)}})()},[]);const[_,L]=n.useState([]);n.useEffect(()=>{(async()=>{try{const r=await(await fetch(`${u}/get-users?projectId=${C}`)).json();V(r)}catch(s){console.error("Error fetching draws:",s)}})()},[C]);const[U,V]=n.useState([]);n.useEffect(()=>{(async()=>{try{const r=await(await fetch(`${u}/get-draws`)).json();M(r)}catch(s){console.error("Error fetching draws:",s)}})()},[]);const[A,M]=n.useState([]),B=t=>{const s=Array.from(t.target.files),r=[...j,...s],o=[...g,...s.map(c=>URL.createObjectURL(c))];P(r),N(o)},k=t=>{const s=j.filter((c,p)=>p!==t),r=g.filter((c,p)=>p!==t);P(s),N(r);const o=new DataTransfer;s.forEach(c=>o.items.add(c)),b.current&&(b.current.files=o.files)},O=async t=>{t.preventDefault(),S(!0);const s=new FormData;Object.keys(i).forEach(r=>{s.append(r,i[r])}),y&&s.append("picture",y),j.forEach(r=>{s.append("pictures",r)});try{const r=await fetch(`${u}/update-request/${x}`,{method:"POST",body:s});if(r.ok){const o=await r.json();D("/dashboard/requests",{state:{success:"Technity Request request updated successfully!"}})}else console.error("Error:",r.statusText)}catch(r){console.error("Fetch error:",r)}S(!1)},z=t=>{E(s=>s.filter((r,o)=>o!==t)),f(s=>{if(!s)return null;const r=s.pictures2.filter((o,c)=>c!==t);return{...s,pictures2:r.length>0?r:[]}})};n.useEffect(()=>{(async()=>{try{const r=await(await fetch(`${u}/get-professions`)).json();H(r)}catch(s){console.error("Error fetching professions:",s)}})()},[]);const[G,H]=n.useState([]);return e.jsxs(e.Fragment,{children:[e.jsx(X,{title:"Edit Technity Request"}),q?null:e.jsx("form",{onSubmit:O,children:e.jsx(l,{className:"justify-content-center",children:e.jsx(a,{children:e.jsx(Q,{title:"Edit Techenity Request",children:e.jsxs(l,{children:[e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(d,{className:"col-sm-2 col-form-label text-end",children:"Select Item"}),e.jsx(a,{sm:"10",children:e.jsxs(h,{value:i==null?void 0:i.item,name:"item",onChange:m,children:[e.jsx("option",{defaultValue:"",children:"Select Item"}),e.jsx("option",{value:"Does not include project material.",children:"Does not include project material."}),e.jsx("option",{value:"Meeting at the construction site is required.",children:"Meeting at the construction site is required."}),e.jsx("option",{value:"There is no preparation as told.",children:"There is no preparation as told."}),e.jsx("option",{value:"A new instruction is requested here, as it is not possible",children:"A new instruction is requested here, as it is not possible"})]})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(d,{className:"col-sm-2 col-form-label text-end",children:"Select Receipients"}),e.jsx(a,{sm:"10",children:e.jsxs(h,{value:i.users,name:"users",onChange:m,multiple:!0,children:[e.jsx("option",{defaultValue:"",children:"Select"}),U.map(t=>e.jsxs("option",{value:t._id,children:[t.username," "]},t.id))]})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(d,{className:"col-sm-2 col-form-label text-end",children:"Select Drawing"}),e.jsx(a,{sm:"10",children:e.jsxs(h,{value:i.drawing,name:"drawing",onChange:m,children:[e.jsx("option",{defaultValue:"",children:"Select drawing"}),A.map(t=>e.jsxs("option",{value:t._id,children:[t.name," "]},t.id))]})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(d,{className:"col-sm-2 col-form-label text-end",children:"Select Projects"}),e.jsx(a,{sm:"10",children:e.jsxs(h,{value:i.projectsId,name:"projectsId",onChange:m,multiple:!0,children:[e.jsx("option",{defaultValue:"",children:"Select Projects"}),_.map(t=>e.jsxs("option",{value:t._id,children:[t.name," "]},t.id))]})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(d,{htmlFor:"multiple-file-input",className:"col-sm-2 col-form-label text-end",children:"Pictures"}),e.jsxs(a,{sm:"10",children:[e.jsx(Y,{type:"file",id:"multiple-file-input",name:"pictures",onChange:B,accept:"image/*",multiple:!0,ref:b}),e.jsxs("div",{className:"mt-3 d-flex flex-wrap",children:[g.map((t,s)=>e.jsxs("div",{className:"position-relative me-2 mb-2",children:[e.jsx(R,{src:t,alt:`Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),e.jsx(v,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>k(s),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]},s)),T.map((t,s)=>e.jsxs("div",{className:"position-relative me-2 mb-2",children:[e.jsx(R,{src:t,alt:`Existing Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),e.jsx(v,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>z(s),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]},`existing-${s}`))]})]})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(d,{className:"col-sm-2 col-form-label text-end",children:"Select Profession"}),e.jsx(a,{sm:"10",children:e.jsxs(h,{value:i.profession,name:"profession",onChange:m,children:[e.jsx("option",{defaultValue:"",children:"Select profession"}),G.map(t=>e.jsx("option",{value:t.indexNumber,children:t.indexNumber},t._id))]})})]})}),e.jsx(l,{className:"mb-3 d-flex justify-content-center",children:e.jsx(a,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(v,{disabled:F,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{fe as default};
