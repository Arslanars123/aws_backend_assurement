import{r as n,b as q,a as J,G as K,j as e,R as c,C as a}from"./index-CItDa9oU.js";import{C as Q}from"./ComponentContainerCard-DyAqISya.js";import{P as X}from"./PageMetaData-nkbvOvdN.js";import{B as d}from"./urls-BhGeBsON.js";import{F as m}from"./FormLabel-j7WrMQh4.js";import{F as h}from"./FormSelect-CxlmXlJB.js";import{F as Y}from"./FormControl-LKz46Evr.js";import{I as F}from"./Image-DVbcr1bY.js";import{B as v}from"./Button-NHMpYk4g.js";import"./Card-BvLctnu1.js";import"./divWithClassName-D5RkLRGN.js";const fe=()=>{const[i,f]=n.useState(null),[I,w]=n.useState(!1),[R,$]=n.useState(!0),[y,Z]=n.useState(null),[ee,k]=n.useState(null),[j,P]=n.useState([]),[g,N]=n.useState([]),{mentionId:x}=q(),D=J();n.useRef(null);const S=n.useRef(null),[L,E]=n.useState([]),{selectedCompany:se,selectedProjects:C,selectedProfession:te,companies:re}=n.useContext(K);n.useEffect(()=>{x&&fetch(`${d}/get-mention-detail/${x}`).then(async t=>{const s=await t.json();f({...s,picture2:s.picture,pictures2:s.pictures}),s.picture&&s.picture!=="null"&&k(`https://147.93.94.31/uploads/${s.picture}`),s.pictures&&s.pictures.length>0&&E(s.pictures.map(r=>`https://147.93.94.31/uploads/${r}`))}).catch(t=>console.error(t)).finally(()=>$(!1))},[x]);const u=t=>{const{name:s,value:r,multiple:o,options:l}=t.target;if(o){const p=Array.from(l).filter(b=>b.selected).map(b=>b.value);f({...i,[s]:p})}else f({...i,[s]:r})};n.useEffect(()=>{(async()=>{try{const r=await(await fetch(`${d}/get-projects`)).json();A(r)}catch(s){console.error("Error fetching projects:",s)}})()},[]);const[_,A]=n.useState([]);n.useEffect(()=>{(async()=>{try{const r=await(await fetch(`${d}/get-draws`)).json();V(r)}catch(s){console.error("Error fetching draws:",s)}})()},[]);const[U,V]=n.useState([]);n.useEffect(()=>{(async()=>{try{const r=await(await fetch(`${d}/get-users?projectId=${C}`)).json();z(r)}catch(s){console.error("Error fetching draws:",s)}})()},[C]);const[M,z]=n.useState([]),B=t=>{const s=Array.from(t.target.files),r=[...j,...s],o=[...g,...s.map(l=>URL.createObjectURL(l))];P(r),N(o)},T=t=>{const s=j.filter((l,p)=>p!==t),r=g.filter((l,p)=>p!==t);P(s),N(r);const o=new DataTransfer;s.forEach(l=>o.items.add(l)),S.current&&(S.current.files=o.files)},W=async t=>{t.preventDefault(),w(!0);const s=new FormData;Object.keys(i).forEach(r=>{s.append(r,i[r])}),y&&s.append("picture",y),j.forEach(r=>{s.append("pictures",r)});try{const r=await fetch(`${d}/update-mention/${x}`,{method:"POST",body:s});if(r.ok){const o=await r.json();D("/dashboard/mentions",{state:{success:"Safety Mention updated successfully!"}})}else console.error("Error:",r.statusText)}catch(r){console.error("Fetch error:",r)}w(!1)},O=t=>{E(s=>s.filter((r,o)=>o!==t)),f(s=>{if(!s)return null;const r=s.pictures2.filter((o,l)=>l!==t);return{...s,pictures2:r.length>0?r:[]}})};n.useEffect(()=>{(async()=>{try{const r=await(await fetch(`${d}/get-professions`)).json();H(r)}catch(s){console.error("Error fetching professions:",s)}})()},[]);const[G,H]=n.useState([]);return e.jsxs(e.Fragment,{children:[e.jsx(X,{title:"Edit Address mention"}),R?null:e.jsx("form",{onSubmit:W,children:e.jsx(c,{className:"justify-content-center",children:e.jsx(a,{children:e.jsx(Q,{title:"Edit Address mention",children:e.jsxs(c,{children:[e.jsx(a,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Item"}),e.jsx(a,{sm:"10",children:e.jsxs(h,{value:i==null?void 0:i.item,name:"item",onChange:u,children:[e.jsx("option",{defaultValue:"",children:"Select Item"}),e.jsx("option",{value:"Work has stopped",children:"Work has stopped"}),e.jsx("option",{value:"Shielding is missing here",children:"Shielding is missing here"}),e.jsx("option",{value:"A safety hazard",children:"A safety hazard"}),e.jsx("option",{value:"Lacks cleanup",children:"Lacks cleanup"}),e.jsx("option",{value:"Security shielding inhibits my work",children:"Security shielding inhibits my work"}),e.jsx("option",{value:"Scaffolding is not done appropriately",children:"Scaffolding is not done appropriately"})]})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Receipients"}),e.jsx(a,{sm:"10",children:e.jsxs(h,{value:i.users,name:"users",onChange:u,multiple:!0,children:[e.jsx("option",{defaultValue:"",children:"Select"}),M.map(t=>e.jsxs("option",{value:t._id,children:[t.username," "]},t.id))]})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Drawing"}),e.jsx(a,{sm:"10",children:e.jsxs(h,{value:i.drawing,name:"drawing",onChange:u,children:[e.jsx("option",{defaultValue:"",children:"Select drawing"}),U.map(t=>e.jsxs("option",{value:t._id,children:[t.name," "]},t.id))]})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{htmlFor:"multiple-file-input",className:"col-sm-2 col-form-label text-end",children:"Pictures"}),e.jsxs(a,{sm:"10",children:[e.jsx(Y,{type:"file",id:"multiple-file-input",name:"pictures",onChange:B,accept:"image/*",multiple:!0,ref:S}),e.jsxs("div",{className:"mt-3 d-flex flex-wrap",children:[g.map((t,s)=>e.jsxs("div",{className:"position-relative me-2 mb-2",children:[e.jsx(F,{src:t,alt:`Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),e.jsx(v,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>T(s),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]},s)),L.map((t,s)=>e.jsxs("div",{className:"position-relative me-2 mb-2",children:[e.jsx(F,{src:t,alt:`Existing Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),e.jsx(v,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>O(s),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]},`existing-${s}`))]})]})]})}),e.jsx(a,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Profession"}),e.jsx(a,{sm:"10",children:e.jsxs(h,{value:i.profession,name:"profession",onChange:u,children:[e.jsx("option",{defaultValue:"",children:"Select profession"}),G.map(t=>e.jsx("option",{value:t.indexNumber,children:t.indexNumber},t.id))]})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Projects"}),e.jsx(a,{sm:"10",children:e.jsxs(h,{value:i.projectsId,name:"projectsId",onChange:u,multiple:!0,children:[e.jsx("option",{defaultValue:"",children:"Select Projects"}),_.map(t=>e.jsxs("option",{value:t._id,children:[t.name," "]},t.id))]})})]})}),e.jsx(c,{className:"mb-3 d-flex justify-content-center",children:e.jsx(a,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(v,{disabled:I,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{fe as default};
