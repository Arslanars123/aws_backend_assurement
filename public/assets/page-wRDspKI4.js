import{r as p,a as R,b as _,j as s,R as u,C as m}from"./index-Bhcfarzr.js";import{C as F}from"./ComponentContainerCard-CdRpaZOK.js";import{P as k}from"./PageMetaData-D1yst4PP.js";import{B as h}from"./urls-BhGeBsON.js";import{F as I}from"./FormLabel-DMds24G0.js";import{A as E,T as v,C as B}from"./TextField-Cu90f4AT.js";import{B as O}from"./Button-COOVOJrI.js";import"./Card-CWpROabE.js";import"./divWithClassName-DTdHczRx.js";import"./useSlot-B59Th0xZ.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-BcofISFZ.js";const Y=()=>{const[d,j]=p.useState([]),[x,g]=p.useState([]),[S,y]=p.useState(!1),[c,P]=p.useState([]),[N,b]=p.useState(null),$=R(),{companyId:n,projectId:a}=_(),T=async()=>{try{const o=await(await fetch(`${h}/get-company-professions?companyId=${n}`)).json(),e=`${h}/get-global-professions`,l=(await(await fetch(e)).json()).filter(f=>!o.some(D=>{var C;return D.professionID===((C=f==null?void 0:f._id)==null?void 0:C.toString())}));g(l)}catch(t){console.error("Error fetching professions:",t)}},w=async()=>{try{const o=await(await fetch(`${h}/get-company-professions?companyId=${n}&projectId=${a}`)).json(),i=(await(await fetch(`${h}/get-company-professions?companyId=${n}`)).json()).filter(l=>!o.some(f=>f.professionID===(l==null?void 0:l.professionID)));g(i)}catch(t){console.error("Error fetching professions:",t)}};p.useEffect(()=>{a&&n?w():n&&T()},[]);const A=async t=>{let o;a?o=d.map(e=>{var i;const r=((i=e==null?void 0:e.projectsId)==null?void 0:i.filter(l=>l!==null))||[];return{...e,projectsId:[...r,a]}}):o=d.map(e=>({...e,companyId:n,professionID:e._id})),t.preventDefault(),y(!0);try{const e=await fetch(`${h}/add/professions_in_a_company`,{method:"POST",body:JSON.stringify({professions:o,projectsId:a}),headers:{"Content-Type":"application/json"}});if(e.ok){const r=a?`/dashboard/companies/view/${n}/projects/view/${a}`:`/dashboard/companies/view/${n}`;$(r,{state:{success:"Professions added successfully!"}})}else console.error("Error:",e.statusText)}catch(e){console.error("Fetch error:",e)}y(!1)};return s.jsxs(s.Fragment,{children:[s.jsx(k,{title:"Add Professions"}),s.jsx(u,{className:"justify-content-center",children:s.jsx(m,{children:s.jsx(F,{title:"Add Professions",children:s.jsxs(u,{children:[s.jsx(m,{lg:"12",children:s.jsxs(u,{className:"mb-3",children:[s.jsx(I,{className:"col-sm-2 col-form-label text-end",children:"Professions"}),s.jsxs(m,{sm:"10",children:[s.jsx(E,{multiple:!0,disabled:c==null?void 0:c.length,options:x,getOptionLabel:t=>t.GroupName,value:d,onChange:(t,o)=>{var e;if(a){const r=o==null?void 0:o[o.length-1];((e=r==null?void 0:r.EuroCode)==null?void 0:e.length)>1?(P(r==null?void 0:r.EuroCode),b(null),alert("This Profession have multi Euro Code select 1st euro code whihc 1 you want to add")):j(o)}else j(o)},renderInput:t=>s.jsx(v,{...t,variant:"outlined",placeholder:"Search and select professions..."}),renderTags:(t,o)=>t.map((e,r)=>s.jsx(B,{label:e.GroupName,...o({index:r})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}}),s.jsxs("div",{style:{fontSize:"0.875rem",color:"#495057",marginTop:"6px"},children:["Selected: ",s.jsx("strong",{children:d.length})," ",d.length===1?"profession":"professions"]})]})]})}),(c==null?void 0:c.length)>0&&s.jsx(m,{lg:"12",children:s.jsxs(u,{className:"mb-3",children:[s.jsx(I,{className:"col-sm-2 col-form-label text-end",children:"Please select one Euro Codes"}),s.jsx(m,{sm:"10",children:s.jsx(E,{options:c,value:N,onChange:(t,o)=>{const e=x.find(r=>{var i;return(i=r.EuroCode)==null?void 0:i.includes(o)});e&&j(r=>[...r,{...e,EuroCode:[o]}]),b(null),P([])},renderInput:t=>s.jsx(v,{...t,variant:"outlined",placeholder:"Select one Euro Code..."}),renderOption:(t,o)=>s.jsx("li",{...t,children:o}),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),s.jsx(u,{className:"mb-3 d-flex justify-content-center",children:s.jsx(m,{sm:"12",className:"d-flex justify-content-end",children:s.jsx(O,{disabled:S||d.length===0,onClick:A,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})]})};export{Y as default};
