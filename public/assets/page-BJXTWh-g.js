import{r,a as q,G as J,j as e,R as c,C as l}from"./index-y2AWh0VN.js";import{C as K}from"./ComponentContainerCard-WVgzLRCL.js";import{P as Q}from"./PageMetaData-C9BjEYqK.js";import{B as p}from"./urls-BhGeBsON.js";import{F as i}from"./FormLabel-B8nDnblu.js";import{F as m}from"./FormControl-BCsmvP-o.js";import{F as u}from"./FormSelect-RXFBsqyf.js";import{I as T}from"./Image-CSkiN27t.js";import{B as y}from"./Button-CUrgqYc1.js";import"./Card-pTEwvOBz.js";import"./divWithClassName-BLHGuKp8.js";const X={project:null,Index:null,professionGroup:null,Type:null,item:null,Activity:null,criteria:"",time:null,method:null,comment:"",drawing:null,buildingPart:null,projectId:null,professionGroupId:null,buildingPartId:null,SubjectMatterId:"",ControlId:""},he=()=>{const[n,N]=r.useState(X),[G,w]=r.useState(!1),S=q(),[C,P]=r.useState(null),[I,F]=r.useState(null),j=r.useRef(null),{selectedCompany:k,selectedProjects:D,selectedProfession:E,companies:Z,projects:ee}=r.useContext(J),[f,A]=r.useState([]),[g,R]=r.useState([]),b=r.useRef(null),h=t=>{const{name:s,value:a}=t.target;N({...n,[s]:a})},V=t=>{const s=t.target.files[0];if(P(s),s){const a=URL.createObjectURL(s);F(a)}};r.useEffect(()=>{},[]),r.useEffect(()=>{(async()=>{try{const a=await(await fetch(`${p}/get-professions`)).json();M(a)}catch(s){console.error("Error fetching projects:",s)}})()},[]);const[se,M]=r.useState([]);r.useEffect(()=>{(async()=>{try{const a=await(await fetch(`${p}/get-draws`)).json();B(a)}catch(s){console.error("Error fetching draws:",s)}})()},[]);const[U,B]=r.useState([]);r.useEffect(()=>{(async()=>{try{const a=await(await fetch(`${p}/get-groups`)).json();_(a)}catch(s){console.error("Error fetching projects:",s)}})()},[]);const[L,_]=r.useState([]);r.useEffect(()=>{(async()=>{try{const a=await(await fetch(`${p}/get-parts`)).json();O(a)}catch(s){console.error("Error fetching projects:",s)}})()},[]);const[$,O]=r.useState([]),z=()=>{P(null),F(null),j.current&&(j.current.value="")},H=t=>{const s=Array.from(t.target.files),a=[...f,...s],o=[...g,...s.map(x=>URL.createObjectURL(x))];A(a),R(o)},W=t=>{const s=f.filter((x,v)=>v!==t),a=g.filter((x,v)=>v!==t);A(s),R(a);const o=new DataTransfer;s.forEach(x=>o.items.add(x)),b.current&&(b.current.files=o.files)},d=t=>{n[t.target.name]=t.target.value,N({...n})},Y=async t=>{if(t.preventDefault(),!E){alert("You must select company, project and profession"),S("/dashboard/companies");return}w(!0);try{const s=new FormData;Object.keys(n).forEach(o=>{s.append(o,n[o])}),C&&s.append("file",C),s.append("companyId",k),D.forEach(o=>{s.append("projectsId",o)}),s.append("SubjectMatterId",E),f.length>0&&f.forEach(o=>{s.append("pictures",o)});const a=await fetch(`${p}/store-task`,{method:"POST",body:s});if(a.ok){const o=await a.json();S("/dashboard/tasks",{state:{success:"Task added successfully!"}})}else console.error("Error:",a.statusText)}catch(s){console.error("Fetch error:",s)}w(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(Q,{title:"Add Task"}),e.jsx("form",{onSubmit:Y,children:e.jsx(c,{className:"justify-content-center",children:e.jsx(l,{children:e.jsx(K,{title:"Add Task",children:e.jsxs(c,{children:[e.jsx(l,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(i,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Acceptance Criteria"}),e.jsx(l,{sm:"10",children:e.jsx(m,{value:n.criteria,onChange:h,name:"criteria",type:"text",id:"example-text-input"})})]})}),e.jsx(l,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(i,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Time"}),e.jsx(l,{sm:"10",children:e.jsx(m,{value:n.time,onChange:h,name:"time",type:"text",id:"example-text-input"})})]})}),e.jsx(l,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(i,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Comment"}),e.jsx(l,{sm:"10",children:e.jsx(m,{value:n.comment,onChange:h,name:"comment",type:"text",id:"example-text-input"})})]})}),e.jsx(l,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(i,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Index"}),e.jsx(l,{sm:"10",children:e.jsx(m,{value:n.Index,onChange:h,name:"Index",type:"text",id:"example-text-input"})})]})}),e.jsx(l,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(i,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Control Id"}),e.jsx(l,{sm:"10",children:e.jsx(m,{value:n==null?void 0:n.ControlId,onChange:h,name:"ControlId",type:"text",id:"example-text-input"})})]})}),e.jsx(l,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(i,{className:"col-sm-2 col-form-label text-end",children:"Select Profession Group"}),e.jsx(l,{sm:"10",children:e.jsxs(u,{value:n.professionGroupId,name:"professionGroupId",onChange:d,children:[e.jsx("option",{defaultValue:"",children:"Select Profession Group"}),L.map(t=>e.jsxs("option",{value:t._id,children:[t.type," "]},t.id))]})})]})}),e.jsx(l,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(i,{className:"col-sm-2 col-form-label text-end",children:"Select Building Part"}),e.jsx(l,{sm:"10",children:e.jsxs(u,{value:n.buildingPartId,name:"buildingPartId",onChange:d,children:[e.jsx("option",{defaultValue:"",children:"Select Building Part"}),$.map(t=>e.jsxs("option",{value:t._id,children:[t.name," "]},t.id))]})})]})}),e.jsx(l,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(i,{className:"col-sm-2 col-form-label text-end",children:"Select Activity Type"}),e.jsx(l,{sm:"10",children:e.jsxs(u,{value:n.Type,name:"Type",onChange:d,children:[e.jsx("option",{defaultValue:"",children:"Select Activity Type"}),e.jsx("option",{value:"admin",children:"Admin"})]})})]})}),e.jsx(l,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(i,{className:"col-sm-2 col-form-label text-end",children:"Select Item"}),e.jsx(l,{sm:"10",children:e.jsxs(u,{value:n.item,name:"item",onChange:d,children:[e.jsx("option",{defaultValue:"",children:"Select Item"}),e.jsx("option",{value:"admin",children:"Admin"})]})})]})}),e.jsx(l,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(i,{className:"col-sm-2 col-form-label text-end",children:"Select Activity"}),e.jsx(l,{sm:"10",children:e.jsxs(u,{value:n.Activity,name:"Activity",onChange:d,children:[e.jsx("option",{defaultValue:"",children:"Select Activity"}),e.jsx("option",{value:"admin",children:"Admin"})]})})]})}),e.jsx(l,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(i,{className:"col-sm-2 col-form-label text-end",children:"Select Method"}),e.jsx(l,{sm:"10",children:e.jsxs(u,{value:n.method,name:"method",onChange:d,children:[e.jsx("option",{defaultValue:"",children:"Select Method"}),e.jsx("option",{value:"admin",children:"Admin"})]})})]})}),e.jsx(l,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(i,{className:"col-sm-2 col-form-label text-end",children:"Select Drawing"}),e.jsx(l,{sm:"10",children:e.jsxs(u,{value:n.drawing,name:"drawing",onChange:d,children:[e.jsx("option",{defaultValue:"",children:"Select drawing"}),U.map(t=>e.jsxs("option",{value:t._id,children:[t.name," "]},t.id))]})})]})}),e.jsxs(l,{lg:"6",children:[e.jsxs(c,{className:"mb-3",children:[e.jsx(i,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Upload Excel File"}),e.jsxs(l,{sm:"10",children:[e.jsx(m,{type:"file",id:"file-input",name:"picture",onChange:V,ref:j}),I&&e.jsxs("div",{className:"mt-3 position-relative",children:[e.jsx(T,{src:I,alt:"Preview",fluid:!0,rounded:!0,style:{maxWidth:"200px",maxHeight:"200px"}}),e.jsx(y,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:z,style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]})]})]}),e.jsxs(c,{className:"mb-3",children:[e.jsx(i,{htmlFor:"multiple-file-input",className:"col-sm-2 col-form-label text-end",children:"Pictures"}),e.jsxs(l,{sm:"10",children:[e.jsx(m,{type:"file",id:"multiple-file-input",name:"pictures",onChange:H,accept:"image/*",multiple:!0,ref:b}),e.jsx("div",{className:"mt-3 d-flex flex-wrap",children:g.map((t,s)=>e.jsxs("div",{className:"position-relative me-2 mb-2",children:[e.jsx(T,{src:t,alt:`Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),e.jsx(y,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>W(s),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]},s))})]})]})]}),e.jsx(c,{className:"mb-3 d-flex justify-content-center",children:e.jsx(l,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(y,{disabled:G,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{he as default};
