import{b as k,r as a,j as e,R as g,C as l}from"./index-CAFh8Qe-.js";import{P as G}from"./PageMetaData-BdrMy3rA.js";import{A as B}from"./AllDataTables-BFs8o9We.js";import{B as L}from"./urls-D84fNQqS.js";import{C as j}from"./Card-B6ongrnB.js";import{F as n}from"./Form-cPeREZGd.js";import"./ComponentContainerCard-BHLb5dlU.js";import"./Button-DUm19Z6r.js";import"./index-V1ytkxP2.js";import"./IconifyIcon-DIoPZGOh.js";import"./index-CFsCAHnL.js";import"./Table-C7xwyyyl.js";import"./Modal-CXhHI7_p.js";import"./useWindow-9TrldcIQ.js";import"./useEventCallback-CZjKJ66g.js";import"./DataKey-COGXBUcQ.js";import"./NoopTransition-Cm1DoMSP.js";import"./divWithClassName-Ds10gy6J.js";import"./Spinner-DyAiQOaj.js";import"./Alert-DEk8m-Z5.js";import"./hook-f2Z_u6VT.js";import"./Anchor-Dqz5KG5G.js";import"./Image-CbaU3Ogc.js";import"./FormCheck-woMCjg_3.js";import"./FormControl-D6Fi2fvk.js";import"./FormContext-CVQotS7s.js";import"./FormGroup-C4HhIO73.js";import"./FormLabel-DJooOqJq.js";import"./FormRange-BHW8Q9KG.js";import"./FormSelect-DckZIl1p.js";const ue=()=>{const{companyId:o,projectId:i}=k(),s=i,[f,x]=a.useState([]),[b,I]=a.useState(!1),[C,E]=a.useState([]),[c,S]=a.useState(""),[d,y]=a.useState(""),P=async()=>{try{const t=`${L}/get-company-professions?companyId=${o}&projectId=${s}`,N=await(await fetch(t)).json();E(N)}catch(t){console.error("Error loading professions:",t)}},p=async()=>{if(console.log("ðŸ” refreshUsers called with:",{companyId:o,projectId:s}),!o||!s){console.log("âŒ Company ID or Project ID not available"),console.log("âŒ Current state:",{companyId:o,projectId:s});return}console.log("âœ… Both IDs available, proceeding with API call"),I(!0);try{const t={companyId:o,projectId:s};if(c){const r=C.find(u=>u._id===c);r!=null&&r.SubjectMatterId&&(t.subjectMatterId=r.SubjectMatterId)}d&&(t.language=d);const h=`${L}/get-controls-of-static-report`;console.log("ðŸ” API Call Details:"),console.log("  URL:",h),console.log("  Request Body:",t),console.log("  Stringified Body:",JSON.stringify(t)),console.log("  companyId type:",typeof o,"value:",o),console.log("  projectId type:",typeof s,"value:",s);const m=await(await fetch(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json(),v=m.entries.map(r=>{var u,w,D;return{_id:r._id,DS_GroupId:r.euroCode||"N/A",SubjectMatterId:t.subjectMatterId||"N/A","Contol of":r.kontrolAf||"N/A",Subject:r.emne||"N/A","Construction part":r.konstruktionsdel||"N/A","Control methode":r.kontrolMetode||"N/A",language:r.language||"N/A",totalEntries:((u=m.meta)==null?void 0:u.entriesCount)||0,entries:[r],euroCodeSource:((w=m.meta)==null?void 0:w.euroCodeSource)||"unknown",projectEuroCodes:((D=m.meta)==null?void 0:D.euroCodes)||[]}});x(v),console.log("Loaded control documents:",v.length)}catch(t){console.error("Error loading control documents:",t),x([])}finally{I(!1)}};a.useEffect(()=>{console.log("ðŸ” useParams extracted:",{companyId:o,urlProjectId:i,projectId:s}),console.log("ðŸ” Using fallback project ID:",!i),console.log("ðŸ” Current URL:",window.location.href),console.log("ðŸ” Current pathname:",window.location.pathname),console.log("ðŸ” Current search params:",window.location.search)},[o,i,s]),a.useEffect(()=>{console.log("ðŸ”„ Professions useEffect triggered:",{companyId:o,projectId:s}),o&&s?(console.log("âœ… Loading professions for:",{companyId:o,projectId:s}),P()):console.log("âŒ Missing IDs for professions:",{companyId:o,projectId:s})},[o,s]),a.useEffect(()=>{console.log("ðŸ”„ Initial load useEffect triggered:",{companyId:o,projectId:s}),o&&s?(console.log("âœ… Initial load of control documents for:",{companyId:o,projectId:s}),p()):console.log("âŒ Missing IDs for initial load:",{companyId:o,projectId:s})},[o,s]),a.useEffect(()=>{console.log("ðŸ”„ useEffect triggered:",{companyId:o,projectId:s,selectedProfession:c,selectedLanguage:d}),o&&s?(console.log("âœ… Both IDs available, calling refreshUsers"),p()):console.log("âŒ Missing IDs, skipping refreshUsers:",{companyId:o,projectId:s})},[c,d,o,s]);const A=t=>{S(t.target.value)},R=t=>{y(t.target.value)},M=()=>{S(""),y("")};return e.jsxs(e.Fragment,{children:[e.jsx(G,{title:"Static Reports"}),e.jsx(g,{children:e.jsx(l,{children:e.jsxs(j,{children:[e.jsx(j.Header,{children:e.jsx("h4",{className:"card-title mb-0",children:"Static Reports"})}),e.jsxs(j.Body,{children:[e.jsxs(g,{className:"mb-3",children:[o&&e.jsx(l,{md:3,children:e.jsx(n.Group,{children:e.jsxs(n.Label,{children:["Company ID: ",o||"Not found"]})})}),s&&e.jsx(l,{md:3,children:e.jsx(n.Group,{children:e.jsxs(n.Label,{children:["Project ID: ",s,!i&&e.jsx("span",{className:"text-warning",children:" (Fallback)"})]})})}),o&&s&&e.jsx(l,{md:3,children:e.jsx(n.Group,{children:e.jsxs(n.Label,{children:["Status: ",o&&s?"Ready":"Missing IDs"]})})}),e.jsx(l,{md:3,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{children:"Â "}),e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-info me-2",onClick:()=>window.location.href="/dashboard/statics/management",children:"ðŸ“Š Document Entries Management"}),o&&s&&e.jsx("button",{className:"btn btn-success",onClick:()=>window.location.href=`/dashboard/companies/view/${o}/projects/view/${s}/statics/signatures`,children:"âœï¸ Static Report Signatures"})]})]})})]}),e.jsxs(g,{className:"mb-3",children:[e.jsx(l,{md:4,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{children:"Profession"}),e.jsxs(n.Select,{value:c,onChange:A,children:[e.jsx("option",{value:"",children:"All Professions"}),C.map(t=>e.jsxs("option",{value:t._id,children:[t.GroupName," (",t.SubjectMatterId,")"]},t._id))]})]})}),e.jsx(l,{md:4,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{children:"Language"}),e.jsxs(n.Select,{value:d,onChange:R,children:[e.jsx("option",{value:"",children:"All Languages"}),e.jsx("option",{value:"DK",children:"Danish"}),e.jsx("option",{value:"EN",children:"English"})]})]})}),e.jsx(l,{md:4,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{children:"Â "}),e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-secondary me-2",onClick:M,children:"Clear Filters"}),e.jsx("button",{className:"btn btn-primary",onClick:p,disabled:!o||!s,children:"Refresh Data"})]})]})})]}),b&&e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"spinner-border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}),f&&!b&&e.jsx("div",{children:e.jsx(B,{staticsReport:f,refreshData:p,options:{showSubmitAction:!0},companyId:o,projectId:s})})]})]})})})]})};export{ue as default};
