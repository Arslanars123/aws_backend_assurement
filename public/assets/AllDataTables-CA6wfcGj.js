import{r as u,j as e,R as M,C as A,b as k}from"./index-B342vN8a.js";import{C as L}from"./ComponentContainerCard-BIxSgnld.js";import{R as $}from"./index-Hgp5nCRV.js";import{B,U as I}from"./urls-CvG9cD6N.js";import{M as b}from"./Modal-DqlySIHa.js";import{S as F}from"./Spinner-DxS-A3GF.js";import{A as K}from"./Alert-BV-oDDo6.js";import{I as D}from"./Image-B0PQ6faj.js";import{B as R}from"./Button-BnzdNfRx.js";const _=({show:c,onHide:o,staticReportId:m,projectId:a,rowData:s,companyId:t})=>{const[n,l]=u.useState([]),[g,j]=u.useState(!1),[x,d]=u.useState("");u.useEffect(()=>{c&&a&&s&&t&&P()},[c,a,s,t]);const P=async()=>{if(!s||!a||!t){d("Missing required data");return}j(!0),d("");try{console.log("Fetching entries with:",{rowData:s,projectId:a,companyId:t});const i=await(await fetch(`${B}/get-static-report-entries-by-position`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entryDataPos:s.pos,projectId:a,companyId:t,subjectMatterId:s.subjectMatterId})})).json();i.success?(console.log("Entries fetched successfully:",i.entries),l(i.entries||[])):d(i.message||"Failed to fetch entries")}catch(r){console.error("Error fetching entries:",r),d("Failed to fetch entries")}finally{j(!1)}},S=r=>r?new Date(r).toLocaleDateString():"-";return e.jsxs(b,{show:c,onHide:o,size:"xl",dialogClassName:"modal-90w",children:[e.jsx(b.Header,{closeButton:!0,children:e.jsx(b.Title,{children:"Static Report Entries"})}),e.jsxs(b.Body,{children:[e.jsxs("div",{className:"mb-3",children:[s&&e.jsxs("div",{className:"p-3 border rounded bg-info bg-opacity-10",children:[e.jsx("h6",{children:"Searching for entries with:"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Position:"})," ",s.pos]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Subject:"})," ",s.subject]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Profession:"})," ",s.subjectMatterId]})]}),g&&e.jsxs("div",{className:"text-center mt-3",children:[e.jsx(F,{animation:"border"}),e.jsx("p",{className:"mt-2",children:"Loading entries..."})]})]}),x&&e.jsx(K,{variant:"danger",className:"mb-3",children:x}),n.map((r,i)=>{var h,C,N,E,p,f,y;return e.jsxs("div",{className:"mb-5 p-3 border rounded bg-light",children:[e.jsxs("h5",{children:["Entry ",((h=r.staticReportItem)==null?void 0:h.DS_GroupId)||"-"," ",((C=r.staticReportItem)==null?void 0:C.ItemId)||"-"," #",i+1]}),e.jsxs("p",{children:[e.jsx("strong",{children:"User:"})," ",((N=r.user)==null?void 0:N.name)||"—"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Role:"})," ",((E=r.user)==null?void 0:E.userRole)||((p=r.user)==null?void 0:p.role)||"—"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Control Plan:"})," ",r.controlPlan||"—"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Comment:"})," ",r.comment||"—"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",S(r.date)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"}),e.jsx("span",{className:`badge ms-2 ${r.isSubmitted?"bg-success":"bg-warning"}`,children:r.isSubmitted?"Submitted":"Draft"})]}),((f=r.annotatedPdfs)==null?void 0:f.length)>0&&e.jsxs("div",{className:"my-4",children:[e.jsx("h6",{children:"Annotated PDF"}),e.jsx(D,{src:`${I}/uploads/${r.annotatedPdfs[0].filename}`,fluid:!0,style:{width:"100%",maxHeight:"500px",objectFit:"contain",border:"1px solid #ccc"},alt:r.annotatedPdfs[0].originalName})]}),((y=r.pictures)==null?void 0:y.length)>0&&e.jsxs("div",{children:[e.jsx("h6",{children:"Pictures & Mark Descriptions"}),e.jsx(M,{children:r.pictures.map((v,T)=>e.jsxs(A,{xs:12,md:4,className:"mb-4",children:[e.jsx(D,{src:`${I}/uploads/${v.filename}`,thumbnail:!0,alt:v.originalName,style:{width:"100%",height:"auto"}}),e.jsx("p",{className:"mt-2",children:v.description||"No description"})]},T))})]})]},r._id||i)}),!g&&!x&&n.length===0&&e.jsx(K,{variant:"info",children:"No entries found for this position and profession."})]}),e.jsx(b.Footer,{children:e.jsx(R,{variant:"secondary",onClick:o,children:"Close"})})]})},U=(c,o,m)=>{const a=[{header:"Position",accessorKey:"pos"},{header:"Checking The",accessorKey:"checkingThe"},{header:"Subject",accessorKey:"subject"},{header:"Construction Part",accessorKey:"constructionPart"},{header:"Basis",accessorKey:"basis"},{header:"Control Method",accessorKey:"controlMethod"},{header:"Circumference",accessorKey:"circumference"},{header:"Acceptance Criteria",accessorKey:"acceptanceCriteria",cell:({row:s})=>{const t=s.original.acceptanceCriteria;return t&&t.length>100?e.jsxs("div",{title:t,children:[t.substring(0,100),"..."]}):t||"N/A"}},{header:"Time/Status",accessorKey:"time"},{header:"Row Index",accessorKey:"rowIndex"},{header:"Language",accessorKey:"language",cell:({row:s})=>{const t=s.original.language;return t==="DK"?e.jsx("span",{className:"badge bg-primary",children:"Danish"}):t==="GB"||t==="EN"?e.jsx("span",{className:"badge bg-success",children:"English"}):e.jsx("span",{className:"badge bg-secondary",children:t})}},{header:"EuroCodes",accessorKey:"projectEuroCodes",cell:({row:s})=>{const t=s.original.projectEuroCodes||[],n=s.original.euroCodeSource||"unknown";return t.length===0?e.jsx("span",{className:"text-muted",children:"No EuroCodes"}):e.jsxs("div",{children:[e.jsx("div",{className:"mb-1",children:t.map((l,g)=>e.jsx("span",{className:"badge bg-info me-1",children:l},g))}),e.jsxs("small",{className:"text-muted",children:["Source: ",n==="projectprofessioeurocode"?"Project Selection":"Default Profession"]})]})}},{header:"Actions",cell:({row:s})=>e.jsx(R,{variant:"outline-primary",size:"sm",onClick:()=>m(s.original._id,s.original),children:"Entries"})}];return o!=null&&o.showSubmitAction&&c&&a.push({header:"Submit Action",cell:({row:s})=>{var n;return((n=s==null?void 0:s.original)==null?void 0:n.isSubmitted)?null:e.jsx(R,{variant:"info",className:"me-2",onClick:()=>{var l;c(`statics/submit/${(l=s==null?void 0:s.original)==null?void 0:l._id}`,{state:{entryData:s.original,selectedProfessionKey:s.original.subjectMatterId||"KP07"}})},children:"Submit Task"})}}),a},w=({staticsReport:c,refreshData:o,navigate:m,options:a,selectedReport:s,companyId:t,projectId:n})=>{const l=[2,5,10,20,50],[g,j]=u.useState(!1),[x,d]=u.useState(null),[P,S]=u.useState(null),r=k(),i=t||r.companyId,h=n||r.projectId,C=h?`/dashboard/companies/view/${i}/projects/view/${h}/statics/view/`:i?`/dashboard/companies/view/${i}/statics/view/`:"/dashboard/statics/view/",N=(p,f)=>{console.log("Entries clicked for:",{staticReportId:p,rowData:f}),d(p),S(f),j(!0)};console.log("StaticDetailTable - IDs from props:",{companyId:t,projectId:n}),console.log("StaticDetailTable - Final IDs:",{finalCompanyId:i,finalProjectId:h});const E=()=>{j(!1),d(null),S(null)};return e.jsxs(e.Fragment,{children:[e.jsx(L,{title:"Static Reports",children:e.jsx($,{url:"get-statics",refreshData:o,viewUrl:C,columns:U(m,a,N),data:c,rowsPerPageList:l,pageSize:10,tableClass:"datatable",theadClass:"table-light",showPagination:!0,searchable:!0,selectedReport:s})}),e.jsx(_,{show:g,onHide:E,staticReportId:x,projectId:h,rowData:P,companyId:i})]})},X=({staticsReport:c,refreshData:o,navigate:m,options:a,selectedReport:s,companyId:t,projectId:n})=>e.jsx(e.Fragment,{children:e.jsx(M,{className:"justify-content-center",children:e.jsx(A,{xs:12,children:e.jsx(w,{refreshData:o,staticsReport:c,navigate:m,options:a,selectedReport:s,companyId:t,projectId:n})})})});export{X as A};
