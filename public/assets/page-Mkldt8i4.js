import{r as i,a as B,b as W,j as s,R as l,C as o}from"./index-CF9SjLWQ.js";import{C as _}from"./ComponentContainerCard-n9fGDRyA.js";import{B as m}from"./urls-BhGeBsON.js";import{D as G}from"./index-CkpYTQ0u.js";import{P as U}from"./page-kGDYU_lm.js";import{F as u}from"./FormLabel-CaO2MFER.js";import{A as g,C as j,T as h}from"./TextField-FXpElbHG.js";import{B as Y}from"./Button-UcXSk4np.js";import"./Card-Bx1F2r4C.js";import"./divWithClassName-13-QUwjt.js";import"./page-DbZ3f2yu.js";import"./Modal-CQeUVPXG.js";import"./useWindow-BQWBaX9C.js";import"./DataKey-KKZij2X9.js";import"./NoopTransition-BChfWke-.js";import"./FormRange-C_Mxfksa.js";import"./PDFButton-CY5rODRi.js";import"./Alert-DVLUPR3Z.js";import"./Anchor-taqs8bUs.js";import"./useFormControl-Bd5Uj6AV.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-C8K2eoCJ.js";const q={profession:null,user:null,controlPlan:null,comment:null,date:null,drawing:null},H=["understood and is buildable","Approved","is not clearly described","Accepted","Follows the project material"];function be(){var b,N,S,y,w,v;const[n,p]=i.useState(q),[C,I]=i.useState(!0),P=B(),{companyId:f,projectId:c,staticReportId:D}=W(),[$,O]=i.useState([]),[d,x]=i.useState({show:!1,pdfFile:null,name:null}),[k,F]=i.useState({}),[E,A]=i.useState([]),[T,R]=i.useState([]);i.useEffect(()=>{(async()=>{try{const a=await(await fetch(`${m}/get-company-professions?companyId=${f}&projectId=${c}`)).json();A(a)}catch(t){console.error("Error fetching professions:",t)}})()},[]),i.useEffect(()=>{n.profession&&n.controlPlan&&n.comment&&n.date&&n.drawing&&I(!1),n.profession&&M()},[n]);const M=async()=>{var e;try{const t={companyId:f,projectId:c,professionsIds:[(e=n==null?void 0:n.profession)==null?void 0:e._id],roles:["Sub Contractor","Worker"]},r=await(await fetch(`${m}/get-filter-users`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();O(r)}catch(t){console.error("Error fetching project managers:",t)}},J=async()=>{try{const t=await(await fetch(`${m}/get-draws?companyId=${f}&projectId=${c}`)).json();R(t)}catch(e){console.error("Error fetching workers:",e)}};i.useEffect(()=>{c&&J()},[f,c]);const L=async()=>{try{const e=new FormData;e.append("projectId",c),e.append("staticReportId",D),e.append("profession",JSON.stringify(n.profession)),e.append("user",JSON.stringify(n.user)),e.append("controlPlan",JSON.stringify(n.controlPlan)),e.append("comment",n.comment),e.append("date",n.date),e.append("drawing",JSON.stringify(n.drawing)),Object.entries(k).forEach(([a,r])=>{if(r){const z=`${a.replace(/[^\w\s.-]/g,"").replace(/\s+/g,"_").split("/").pop().split(".")[0]}.png`;e.append("annotatedPdfs",r,z)}}),(await fetch(`${m}/submit-static-report`,{method:"POST",body:e})).ok&&P(`/dashboard/companies/view/${f}/projects/view/${c}`)}catch(e){console.log("error",e)}};return s.jsx(l,{className:"justify-content-center",children:s.jsx(o,{children:s.jsx(_,{title:"Static Reports Submit",children:s.jsxs(l,{children:[s.jsx(o,{lg:"6",children:s.jsxs(l,{className:"mb-3",children:[s.jsx(u,{className:"col-sm-2 col-form-label text-end",children:"Select Profession"}),s.jsx(o,{sm:"10",children:s.jsx(g,{multiple:!1,options:E,getOptionLabel:e=>e.GroupName,value:n.profession??null,onChange:(e,t)=>{var a;((a=t==null?void 0:t.EuroCode)==null?void 0:a.length)>0&&(t==null?void 0:t.Static_report)==="Y"||!t?p({...n,profession:t}):alert("you can't submit this checklist against this profession")},renderInput:e=>s.jsx(h,{...e,variant:"outlined",placeholder:"Search and select profession..."}),renderTags:(e,t)=>e.map((a,r)=>s.jsx(j,{label:a.GroupName,...t({index:r})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),s.jsx(o,{lg:"6",children:s.jsxs(l,{className:"mb-3",children:[s.jsx(u,{className:"col-sm-2 col-form-label text-end",children:"Select User"}),s.jsx(o,{sm:"10",children:s.jsx(g,{multiple:!1,options:$,getOptionLabel:e=>{var t;return`${e.name} (${(t=e.userProfession)==null?void 0:t.map(a=>a.GroupName).join(", ")})`},value:n.user??null,onChange:(e,t)=>{p({...n,user:t})},renderInput:e=>s.jsx(h,{...e,variant:"outlined",placeholder:"Search and select project Manager..."}),renderTags:(e,t)=>e.map((a,r)=>s.jsx(j,{label:a.name,...t({index:r})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),s.jsx(o,{lg:"6",children:s.jsxs(l,{className:"mb-3",children:[s.jsx(u,{className:"col-sm-2 col-form-label text-end",children:"Select Item"}),s.jsx(o,{sm:"10",children:s.jsx(g,{multiple:!1,options:H,value:n.controlPlan??null,onChange:(e,t)=>{p({...n,controlPlan:t})},renderInput:e=>s.jsx(h,{...e,variant:"outlined",placeholder:"Search and select worker..."}),renderTags:(e,t)=>e.map((a,r)=>s.jsx(j,{label:a,...t({index:r})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),s.jsx(o,{lg:"6",children:s.jsxs(l,{className:"mb-3",children:[s.jsx(u,{className:"col-sm-2 col-form-label text-end",children:"Comment"}),s.jsx(o,{sm:"10",children:s.jsx(h,{variant:"outlined",placeholder:"Add some comments...",value:n==null?void 0:n.comment,onChange:e=>{var t;p({...n,comment:(t=e==null?void 0:e.target)==null?void 0:t.value})}})})]})}),s.jsx(o,{lg:"6",children:s.jsxs(l,{className:"mb-3",children:[s.jsx(u,{className:"col-sm-2 col-form-label text-end",children:"Select Date"}),s.jsx(o,{sm:"10",children:s.jsx(G,{value:n==null?void 0:n.date,onChange:e=>{const a=e[0].toISOString().split("T")[0];p({...n,date:a})},className:"form-control",options:{dateFormat:"Y-m-d"}})})]})}),s.jsx(o,{lg:"6",children:s.jsxs(l,{className:"mb-3",children:[s.jsx(u,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Drawing"}),s.jsx(o,{sm:"10",children:s.jsx(g,{multiple:!1,options:T,getOptionLabel:e=>e.name,value:n==null?void 0:n.drawing,onChange:(e,t)=>{p({...n,drawing:t})},renderInput:e=>s.jsx(h,{...e,variant:"outlined",placeholder:"Search and select drawing..."}),renderTags:(e,t)=>e.map((a,r)=>s.jsx(j,{label:a.name,...t({index:r})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),s.jsx(o,{lg:"6",children:s.jsx(l,{className:"",children:(N=(b=n==null?void 0:n.drawing)==null?void 0:b.mainDrawings)==null?void 0:N.map((e,t)=>s.jsxs("div",{className:"me-2 mb-2 text-center",onClick:()=>{const a=e.original;x({show:!0,pdfFile:`${m}/uploads/${e.stored}`,name:a})},style:{cursor:"pointer"},children:[s.jsx("i",{className:"fas fa-file-pdf",style:{fontSize:"2rem",color:"#dc3545"}}),s.jsx("div",{className:"small text-muted",children:e.original})]},`main-${t}`))})}),((y=(S=n==null?void 0:n.drawing)==null?void 0:S.childDrawings)==null?void 0:y.length)>0&&s.jsx(o,{lg:"6",children:s.jsx(l,{className:"",children:(v=(w=n==null?void 0:n.drawing)==null?void 0:w.childDrawings)==null?void 0:v.map((e,t)=>s.jsxs("div",{className:"me-2 mb-2 text-center",onClick:()=>{const a=e.original;x({show:!0,pdfFile:`${m}/uploads/${e.stored}`,name:a})},style:{cursor:"pointer"},children:[s.jsx("i",{className:"fas fa-file-pdf",style:{fontSize:"2rem",color:"#dc3545"}}),s.jsx("div",{className:"small text-muted",children:e.original})]},`child-${t}`))})}),(d==null?void 0:d.show)&&s.jsx(U,{pdfUrl:d.pdfFile,onClose:()=>x({show:!1,pdfFile:null}),onSave:e=>{F(t=>({...t,[d.name.endsWith(".png")?d.name:`${d.name}.png`]:e})),x({show:!1,pdfFile:null})}}),s.jsx(l,{className:"mb-3 d-flex justify-content-center",children:s.jsx(o,{sm:"12",className:"d-flex justify-content-end",children:s.jsx(Y,{variant:"primary",className:"me-1",disabled:C,onClick:L,children:"Submit"})})})]})})})})}export{be as default};
