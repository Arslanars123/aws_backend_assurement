import{r as i,b as U,a as z,j as e,R as o,C as l}from"./index-Bhcfarzr.js";import{C as H}from"./ComponentContainerCard-CdRpaZOK.js";import{P as W}from"./PageMetaData-D1yst4PP.js";import{B as x}from"./urls-BhGeBsON.js";import{F as m}from"./FormLabel-DMds24G0.js";import{F as p}from"./FormSelect-D2SUClsr.js";import{F as q}from"./FormControl-7WYzlHOA.js";import{I as E}from"./Image-C3Ku7nKI.js";import{B as S}from"./Button-COOVOJrI.js";import"./Card-CWpROabE.js";import"./divWithClassName-DTdHczRx.js";const le=()=>{const[r,h]=i.useState(null),[F,P]=i.useState(!1),[I,R]=i.useState(!0),[y,G]=i.useState(null),[J,$]=i.useState(null),[j,w]=i.useState([]),[g,N]=i.useState([]),{staticId:f}=U(),A=z();i.useRef(null);const v=i.useRef(null),[_,C]=i.useState([]);i.useEffect(()=>{f&&fetch(`${x}/get-static-detail/${f}`).then(async t=>{const s=await t.json();h({...s,picture2:s.picture,pictures2:s.pictures}),s.picture&&s.picture!=="null"&&$(`https://147.93.94.31/uploads/${s.picture}`),s.pictures&&s.pictures.length>0&&C(s.pictures.map(a=>`https://147.93.94.31/uploads/${a}`))}).catch(t=>console.error(t)).finally(()=>R(!1))},[f]);const d=t=>{const{name:s,value:a,multiple:n,options:c}=t.target;if(n){const u=Array.from(c).filter(b=>b.selected).map(b=>b.value);h({...r,[s]:u})}else h({...r,[s]:a})};i.useEffect(()=>{(async()=>{try{const a=await(await fetch(`${x}/get-projects`)).json();V(a)}catch(s){console.error("Error fetching projects:",s)}})()},[]);const[L,V]=i.useState([]),D=t=>{const s=Array.from(t.target.files),a=[...j,...s],n=[...g,...s.map(c=>URL.createObjectURL(c))];w(a),N(n)},B=t=>{const s=j.filter((c,u)=>u!==t),a=g.filter((c,u)=>u!==t);w(s),N(a);const n=new DataTransfer;s.forEach(c=>n.items.add(c)),v.current&&(v.current.files=n.files)},T=async t=>{t.preventDefault(),P(!0);const s=new FormData;Object.keys(r).forEach(a=>{s.append(a,r[a])}),y&&s.append("picture",y),j.forEach(a=>{s.append("pictures",a)});try{const a=await fetch(`${x}/update-static/${f}`,{method:"POST",body:s});if(a.ok){const n=await a.json();A("/dashboard/statics",{state:{success:"static updated successfully!"}})}else console.error("Error:",a.statusText)}catch(a){console.error("Fetch error:",a)}P(!1)},k=t=>{C(s=>s.filter((a,n)=>n!==t)),h(s=>{if(!s)return null;const a=s.pictures2.filter((n,c)=>c!==t);return{...s,pictures2:a.length>0?a:[]}})};i.useEffect(()=>{(async()=>{try{const a=await(await fetch(`${x}/get-professions`)).json();O(a)}catch(s){console.error("Error fetching professions:",s)}})()},[]);const[M,O]=i.useState([]);return e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"Edit Static Report"}),I?null:e.jsx("form",{onSubmit:T,children:e.jsx(o,{className:"justify-content-center",children:e.jsx(l,{children:e.jsx(H,{title:"Edit Static Report",children:e.jsxs(o,{children:[e.jsx(l,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Activity"}),e.jsx(l,{sm:"10",children:e.jsxs(p,{value:r==null?void 0:r.activity,name:"activity",onChange:d,children:[e.jsx("option",{defaultValue:"",children:"Select Activity"}),e.jsx("option",{value:"admin",children:"Admin"})]})})]})}),e.jsx(l,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Control Plan"}),e.jsx(l,{sm:"10",children:e.jsxs(p,{value:r==null?void 0:r.controlPlan,name:"controlPlan",onChange:d,children:[e.jsx("option",{defaultValue:"",children:"Select Control Plan"}),e.jsx("option",{value:"admin",children:"Admin"})]})})]})}),e.jsx(l,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Item"}),e.jsx(l,{sm:"10",children:e.jsxs(p,{value:r==null?void 0:r.items,name:"items",onChange:d,children:[e.jsx("option",{defaultValue:"",children:"Select Item"}),e.jsx("option",{value:"admin",children:"Admin"})]})})]})}),e.jsx(l,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Projects"}),e.jsx(l,{sm:"10",children:e.jsxs(p,{value:r.projectsId,name:"projectsId",onChange:d,multiple:!0,children:[e.jsx("option",{defaultValue:"",children:"Select Projects"}),L.map(t=>e.jsxs("option",{value:t._id,children:[t.name," "]},t.id))]})})]})}),e.jsx(l,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(m,{htmlFor:"multiple-file-input",className:"col-sm-2 col-form-label text-end",children:"Pictures"}),e.jsxs(l,{sm:"10",children:[e.jsx(q,{type:"file",id:"multiple-file-input",name:"pictures",onChange:D,accept:"image/*",multiple:!0,ref:v}),e.jsxs("div",{className:"mt-3 d-flex flex-wrap",children:[g.map((t,s)=>e.jsxs("div",{className:"position-relative me-2 mb-2",children:[e.jsx(E,{src:t,alt:`Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),e.jsx(S,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>B(s),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]},s)),_.map((t,s)=>e.jsxs("div",{className:"position-relative me-2 mb-2",children:[e.jsx(E,{src:t,alt:`Existing Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),e.jsx(S,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>k(s),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]},`existing-${s}`))]})]})]})}),e.jsx(l,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select profession"}),e.jsx(l,{sm:"10",children:e.jsxs(p,{value:r.professionId,name:"professionId",onChange:d,children:[e.jsx("option",{defaultValue:"",children:"Select profession"}),M.map(t=>e.jsx("option",{value:t._id,children:t.name},t.id))]})})]})}),e.jsx(o,{className:"mb-3 d-flex justify-content-center",children:e.jsx(l,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(S,{disabled:F,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{le as default};
