import{r as u,a as W,b as L,j as e,R as r,C as s}from"./index-CFC_skDo.js";import{C as U}from"./ComponentContainerCard-BgtLXH2x.js";import{P as B}from"./PageMetaData--AH9Un1H.js";import{B as x}from"./urls-BhGeBsON.js";import{F as o}from"./FormLabel-S5bDb0w7.js";import{F as d}from"./FormControl-CiIjeg_-.js";import{F as _}from"./FormSelect-D_Be58Ty.js";import{I as M}from"./Image-xOOuaExf.js";import{B as f}from"./Button-2F6J7aEx.js";import{A as z,T as H,C as J}from"./TextField-IDun-2ph.js";import"./Card-DSVzyJ_p.js";import"./divWithClassName-Dn3DrZ5P.js";import"./useSlot-CMJ6u0xq.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-BcofISFZ.js";const Y={username:"",password:"",role:"Advisor",phone:"",case:"",startDate:"",name:"",address:"",postalCode:"",city:"",type:null},ie=()=>{const[l,b]=u.useState(Y),[y,g]=u.useState(!1),h=W(),[v,N]=u.useState(null),[C,F]=u.useState(null),j=u.useRef(null),[w,A]=u.useState([]),[S,P]=u.useState([]),{companyId:m,projectId:i}=L(),p=t=>{const{name:a,value:n}=t.target;b({...l,[a]:n})},I=t=>{const a=t.target.files[0];if(N(a),a){const n=URL.createObjectURL(a);F(n)}},k=async t=>{if(t.preventDefault(),!m){alert("You must select company"),h("/dashboard/companies");return}g(!0);try{const a=new FormData;Object.keys(l).forEach(c=>{a.append(c,l[c])}),v&&a.append("picture",v),a.append("companyId",m),a.append("projectsId",i);const n=await fetch(`${x}/store-user`,{method:"POST",body:a});if(n.ok){const c=await n.json();h(`/dashboard/companies/view/${m}`,{state:{success:"Advisor added successfully!"}})}else console.error("Error:",n.statusText)}catch(a){console.error("Fetch error:",a)}g(!1)},T=t=>{l[t.target.name]=t.target.value,b({...l})},E=()=>{N(null),F(null),j.current&&(j.current.value="")};u.useEffect(()=>{m&&i&&R()},[m,i]);const R=async()=>{try{const a=await(await fetch(`${x}/get-advisors?companyId=${m}`)).json(),c=await(await fetch(`${x}/get-advisors?companyId=${m}&projectId=${i}`)).json(),$=a.filter(D=>!c.some(O=>O._id===D._id));A($)}catch(t){console.error("Error fetching workers:",t)}},V=async()=>{try{if(!i)return;const a={userIds:S.map(c=>c._id),projectId:i},n=await fetch(`${x}/updateUser`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(n.ok){const c=await n.json();h(`/dashboard/companies/view/${m}/projects/view/${i}`,{state:{success:"Advisor added successfully!"}})}else console.error("Error:",n.statusText)}catch(t){console.log("Error adding Advisor to project:",t)}};return e.jsxs(e.Fragment,{children:[e.jsx(B,{title:"Add Advisor"}),!i&&e.jsx("form",{onSubmit:k,children:e.jsx(r,{className:"justify-content-center",children:e.jsx(s,{children:e.jsx(U,{title:"Add Advisor",children:e.jsxs(r,{children:[e.jsx(s,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Email"}),e.jsx(s,{sm:"10",children:e.jsx(d,{value:l.username,onChange:p,name:"username",type:"email",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(s,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Name"}),e.jsx(s,{sm:"10",children:e.jsx(d,{value:l.name,onChange:p,name:"name",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(s,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Phone"}),e.jsx(s,{sm:"10",children:e.jsx(d,{value:l.phone,onChange:p,name:"phone",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(s,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Password"}),e.jsx(s,{sm:"10",children:e.jsx(d,{value:l.password,onChange:p,name:"password",type:"password",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(s,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Address"}),e.jsx(s,{sm:"10",children:e.jsx(d,{value:l.address,onChange:p,name:"address",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(s,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"City"}),e.jsx(s,{sm:"10",children:e.jsx(d,{value:l.city,onChange:p,name:"city",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(s,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Post Code"}),e.jsx(s,{sm:"10",children:e.jsx(d,{value:l.postalCode,onChange:p,name:"postalCode",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(s,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Start Date"}),e.jsx(s,{sm:"10",children:e.jsx(d,{value:l.startDate,onChange:p,name:"startDate",type:"date",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(s,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(o,{className:"col-sm-2 col-form-label text-end",children:"Select Type"}),e.jsx(s,{sm:"10",children:e.jsxs(_,{value:l.type,name:"type",onChange:T,children:[e.jsx("option",{defaultValue:"",children:"Select Type"}),e.jsx("option",{value:"Architecture",children:"Architecture"}),e.jsx("option",{value:"Engineer",children:"Engineer"}),e.jsx("option",{value:"Fire",children:"Fire"}),e.jsx("option",{value:"Acoustics",children:"Acoustics"}),e.jsx("option",{value:"Technical Subject",children:"Technical Subject"})]})})]})}),e.jsx(s,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(o,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Picture"}),e.jsxs(s,{sm:"10",children:[e.jsx(d,{type:"file",id:"file-input",name:"picture",onChange:I,accept:"image/*",ref:j}),C&&e.jsxs("div",{className:"mt-3 position-relative",children:[e.jsx(M,{src:C,alt:"Preview",fluid:!0,rounded:!0,style:{maxWidth:"200px",maxHeight:"200px"}}),e.jsx(f,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:E,style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"Ã—"})]})]})]})}),e.jsx(r,{className:"mb-3 d-flex justify-content-center",children:e.jsx(s,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(f,{disabled:y,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})}),i&&e.jsxs(r,{className:"mb-3",children:[e.jsx(o,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Select Advisor for this Project"}),e.jsxs(s,{sm:"10",children:[e.jsx(z,{multiple:!0,options:w,getOptionLabel:t=>t.name,value:S,onChange:(t,a)=>{P(a)},renderInput:t=>e.jsx(H,{...t,variant:"outlined",placeholder:"Search and select Advisor..."}),renderTags:(t,a)=>t.map((n,c)=>e.jsx(J,{label:n.name,...a({index:c})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}}),e.jsx(r,{className:"mb-3 mt-3 d-flex justify-content-center",children:e.jsx(s,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(f,{disabled:y,type:"submit",variant:"primary",className:"me-1",onClick:V,children:"Submit"})})})]})]})]})};export{ie as default};
