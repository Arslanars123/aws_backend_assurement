import{r as m,b as R,a as A,ab as B,j as e,R as c,C as r}from"./index-BaEXYFjf.js";import{C as I}from"./ComponentContainerCard-r7D-7GT6.js";import{B as i}from"./urls-D3INM0xz.js";import{D as z}from"./DetailPage-HliMF9Wi.js";import{P as U}from"./page-C1NjKvsI.js";import{F as x}from"./FormLabel-BbxHmEpm.js";import{B as p}from"./Button-CHKoWH3g.js";import"./Card-Dy9P-MVM.js";import"./divWithClassName-C80pLmVh.js";import"./Modal-BD-tspKu.js";import"./useWindow-CC4Mdgns.js";import"./useEventCallback-BlKFiCyd.js";import"./DataKey-COGXBUcQ.js";import"./NoopTransition-BzGmN_3P.js";import"./Image-CFc3DKY_.js";import"./FormRange-CU4CgP6g.js";import"./FormContext-kuoxlIs5.js";import"./PDFButton-DhybE3n4.js";function te(){var w,D,$,k,P,v,C;const[g,j]=m.useState({}),[a,y]=m.useState({}),[u,N]=m.useState({show:!1,pdfFile:null,name:null}),{projectId:h,taskId:l}=R(),b=A(),[S]=B(),d=S.get("report");if(!g)return e.jsx("p",{children:"No task data available."});const F=async()=>{try{const s=h?`${i}/get-project-task?projectId=${h}&taskId=${l}`:`${i}/get-task-detail/${l}`,o=await(await fetch(s)).json();if(h){y(o);const n={...o};delete n["Documentation Requirements"],delete n.annotatedPdfs,delete n.drawing,delete n.pictureObjects,delete n.pictures,j(n)}else j(o)}catch(s){console.error("Error fetching task:",s)}};m.useEffect(()=>{l&&F()},[l]);const E=()=>{const s=d?`/dashboard/tasks/edit/${l}?report=${d}`:`/dashboard/tasks/edit/${l}`;b(s)},O=async()=>{try{const s=await fetch(`${i}/delete-task/${l}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(s.ok){const t=await s.json(),o=d?`/dashboard/projects?report=${d}`:"/dashboard/tasks";b(o),console.log("Success:",t)}else console.error("Error:",s.statusText)}catch(s){console.error("Fetch error:",s)}},f=(s,t)=>{N({show:!0,pdfFile:s,name:t})};return e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"justify-content-center",children:e.jsx(r,{lg:"12",children:e.jsx(I,{title:"Task Details",children:e.jsxs(c,{children:[e.jsx(z,{data:g,handleEdit:E,handleDelete:O}),(a==null?void 0:a.drawing)&&e.jsxs(e.Fragment,{children:[e.jsx(r,{lg:"12",children:e.jsxs(c,{className:"mb-2",children:[e.jsx(x,{className:"col-sm-2 col-form-label text-end",children:"Main Drawings"}),e.jsx(r,{sm:"10",children:(D=(w=a==null?void 0:a.drawing)==null?void 0:w.mainDrawings)==null?void 0:D.map((s,t)=>e.jsxs("div",{className:"mb-2 d-flex align-items-center",children:[e.jsx(p,{variant:"link",className:"p-0 me-2",onClick:()=>f(`${i}/uploads/${s.stored}`,s.original),children:e.jsx("i",{className:"fas fa-file-pdf",style:{fontSize:"2rem",color:"#dc3545"}})}),e.jsx("div",{className:"small text-muted",children:s.original})]},t))})]})}),((k=($=a==null?void 0:a.drawing)==null?void 0:$.childDrawings)==null?void 0:k.length)>0&&e.jsx(r,{lg:"12",children:e.jsxs(c,{className:"mb-2",children:[e.jsx(x,{className:"col-sm-2 col-form-label text-end",children:"Child Drawings"}),e.jsx(r,{sm:"10",children:(v=(P=a==null?void 0:a.drawing)==null?void 0:P.childDrawings)==null?void 0:v.map((s,t)=>e.jsxs("div",{className:"mb-2 d-flex align-items-center",children:[e.jsx(p,{variant:"link",className:"p-0 me-2",onClick:()=>f(`${i}/uploads/${s.stored}`,s.original),children:e.jsx("i",{className:"fas fa-file-pdf",style:{fontSize:"2rem",color:"#dc3545"}})}),e.jsx("div",{className:"small text-muted",children:s.original})]},t))})]})})]}),(a==null?void 0:a.annotatedPdfs)&&a.annotatedPdfs.length>0&&e.jsx(r,{lg:"12",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(x,{className:"col-sm-2 col-form-label text-end",children:"Annotated Drawings"}),e.jsx(r,{sm:"10",className:"d-flex flex-wrap",children:(C=a==null?void 0:a.annotatedPdfs)==null?void 0:C.map((s,t)=>e.jsxs("div",{className:"mb-2 d-flex align-items-center",children:[e.jsx(p,{variant:"link",className:"p-0 me-2",onClick:()=>f(`${i}/uploads/${s.filename}`,s.originalName),children:e.jsx("i",{className:"fas fa-file-pdf",style:{fontSize:"2rem",color:"#dc3545"}})}),e.jsx("div",{className:"small text-muted",children:s.originalName})]},t))})]})})]})})})}),u.show&&e.jsx(U,{drawDotsOnPdf:u,setDrawDotsOnPdf:N,readOnly:!0})]})}export{te as default};
