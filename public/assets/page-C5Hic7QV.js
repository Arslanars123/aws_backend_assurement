import{r as c,a as K,b as Q,j as e,R as l,C as n}from"./index-y2AWh0VN.js";import{C as X}from"./ComponentContainerCard-WVgzLRCL.js";import{P as Y}from"./PageMetaData-C9BjEYqK.js";import{B as h}from"./urls-BhGeBsON.js";import{D as Z}from"./page-GkYNIA8m.js";import{F as m}from"./FormLabel-B8nDnblu.js";import{F as C}from"./FormControl-BCsmvP-o.js";import{F as ee}from"./FormSelect-RXFBsqyf.js";import{A as g,C as j,T as f}from"./TextField-CHOGXvH3.js";import{B as te}from"./Button-CUrgqYc1.js";import"./Card-pTEwvOBz.js";import"./divWithClassName-BLHGuKp8.js";import"./Modal-DUmHr7nc.js";import"./useWindow-BUTI6O21.js";import"./DataKey-BZN51oXa.js";import"./NoopTransition-1KXwFEeZ.js";import"./FormRange-CO87Iy6V.js";import"./useFormControl-C5hsiBKt.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-C8K2eoCJ.js";const se={supplementory:"",time:"",item:null,selectedDrawing:null,projectManager:null,recipients:null},Se=()=>{var v,S,N,D;const[s,i]=c.useState(se),[A,w]=c.useState(!1),[I,k]=c.useState([]),[u,F]=c.useState({show:!1,imgUrl:null}),M=c.useRef(),[b,T]=c.useState(null),[O,$]=c.useState([]),[E,P]=c.useState([]),[R,B]=c.useState([]),[U,L]=c.useState(10),z=K(),{companyId:p,projectId:d}=Q(),y=t=>{const{name:a,value:r}=t.target;i({...s,[a]:r})};c.useEffect(()=>{J(),W(),q()},[d]);const J=async()=>{try{const a=await(await fetch(`${h}/get-draws?companyId=${p}&projectId=${d}`)).json();k(a)}catch(t){console.error("Error fetching workers:",t)}},V=t=>{const{name:a,value:r,multiple:o,options:_}=t.target;if(o){const G=Array.from(_).filter(x=>x.selected).map(x=>x.value);i({...s,[a]:G})}else i({...s,[a]:r})},W=async()=>{try{const t=`${h}/get-project-managers?companyId=${p}&projectId=${d}`,r=await(await fetch(t)).json();$(r)}catch(t){console.error("Error fetching project managers:",t)}},q=async()=>{try{const t=`${h}/get-filter-users`,o=await(await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({companyId:p,projectId:d})})).json();P(o)}catch(t){console.error("Error fetching users:",t)}},H=async t=>{t.preventDefault(),w(!0);try{const a=new FormData;Object.keys(s).forEach(o=>{o==="projectManager"||o==="selectedDrawing"||o==="recipients"||a.append(o,s[o])}),a.append("companyId",p),a.append("projectsId",d),a.append("drawing",JSON.stringify(s.selectedDrawing)),a.append("projectManager",JSON.stringify(s.projectManager)),a.append("recipients",JSON.stringify(s.recipients)),b&&a.append("annotatedImage",b);const r=await fetch(`${h}/store-new`,{method:"POST",body:a});if(r.ok){const o=await r.json();z(`/dashboard/companies/view/${p}/projects/view/${d}`,{state:{success:"New Aggrement added successfully!"}})}else console.error("Error:",r.statusText)}catch(a){console.error("Fetch error:",a)}w(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(Y,{title:"Add New Aggrement"}),e.jsx("form",{onSubmit:H,children:e.jsx(l,{className:"justify-content-center",children:e.jsx(n,{children:e.jsx(X,{title:"Add New Aggrement",children:e.jsxs(l,{children:[e.jsx(n,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(m,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Extra info"}),e.jsx(n,{sm:"10",children:e.jsx(C,{value:s.supplementory,onChange:y,name:"supplementory",type:"text",id:"example-text-input"})})]})}),e.jsx(n,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(m,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Days | Hours"}),e.jsx(n,{sm:"10",children:e.jsx(C,{value:s.time,onChange:y,name:"time",type:"text",id:"example-text-input"})})]})}),e.jsx(n,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Item"}),e.jsx(n,{sm:"10",children:e.jsxs(ee,{value:s.item,name:"item",onChange:V,children:[e.jsx("option",{defaultValue:"",children:"Select Item"}),e.jsx("option",{value:"A new agreement has been concluded with construction management today.",children:"A new agreement has been concluded with construction management today."}),e.jsx("option",{value:"Change work has been notified.",children:"Change work has been notified."}),e.jsx("option",{value:"Forced work must be agreed, due to delays from other contractors",children:"Forced work must be agreed, due to delays from other contractors"}),e.jsx("option",{value:"The construction management has instructed a change in the work that must be carried out in accounting work.",children:"The construction management has instructed a change in the work that must be carried out in accounting work."}),e.jsx("option",{value:"Work that has been necessary for safety or for the sake of construction.",children:"Work that has been necessary for safety or for the sake of construction."}),e.jsx("option",{value:"Someone has destroyed my work after final inspection.",children:"Someone has destroyed my work after final inspection."})]})})]})}),e.jsx(n,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(m,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Recipients"}),e.jsx(n,{sm:"10",children:e.jsx(g,{multiple:!1,options:E,getOptionLabel:t=>t.name,value:s==null?void 0:s.recipients,onChange:(t,a)=>{i({...s,recipients:a})},renderInput:t=>e.jsx(f,{...t,variant:"outlined",placeholder:"Search and select Project Users..."}),renderTags:(t,a)=>t.map((r,o)=>e.jsx(j,{label:r.name,...a({index:o})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(n,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(m,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Project Manager"}),e.jsx(n,{sm:"10",children:e.jsx(g,{multiple:!1,options:O,getOptionLabel:t=>t.name,value:s==null?void 0:s.projectManager,onChange:(t,a)=>{i({...s,projectManager:a})},renderInput:t=>e.jsx(f,{...t,variant:"outlined",placeholder:"Search and select Project Manager..."}),renderTags:(t,a)=>t.map((r,o)=>e.jsx(j,{label:r.name,...a({index:o})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(n,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(m,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Drawing"}),e.jsx(n,{sm:"10",children:e.jsx(g,{multiple:!1,options:I,getOptionLabel:t=>t.name,value:s==null?void 0:s.selectedDrawing,onChange:(t,a)=>{i({...s,selectedDrawing:a})},renderInput:t=>e.jsx(f,{...t,variant:"outlined",placeholder:"Search and select drawing..."}),renderTags:(t,a)=>t.map((r,o)=>e.jsx(j,{label:r.name,...a({index:o})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),(s==null?void 0:s.selectedDrawing)&&e.jsxs(n,{lg:"12",className:"mb-4",children:[e.jsx("h5",{children:"Main Drawings"}),e.jsx("div",{className:"d-flex flex-wrap",children:(S=(v=s==null?void 0:s.selectedDrawing)==null?void 0:v.mainDrawings)==null?void 0:S.map((t,a)=>e.jsxs("div",{className:"me-2 mb-2 text-center",children:[e.jsx("i",{className:"fas fa-file-pdf",style:{fontSize:"2rem",color:"#dc3545"}}),e.jsx("div",{className:"small text-muted",children:t==null?void 0:t.original})]},`main-${a}`))})]}),(s==null?void 0:s.selectedDrawing)&&e.jsxs(n,{lg:"12",children:[e.jsx("h5",{children:"Child Drawings"}),e.jsx("div",{className:"d-flex flex-wrap",children:(D=(N=s==null?void 0:s.selectedDrawing)==null?void 0:N.childDrawings)==null?void 0:D.map((t,a)=>e.jsxs("div",{className:"me-2 mb-2 text-center",children:[e.jsx("i",{className:"fas fa-file-pdf",style:{fontSize:"2rem",color:"#dc3545"}}),e.jsx("div",{className:"small text-muted",children:t==null?void 0:t.original})]},`child-${a}`))})]}),(u==null?void 0:u.show)&&e.jsx(n,{lg:"6",children:e.jsx(l,{children:e.jsx("div",{className:"position-relative",style:{maxWidth:"100%",height:"auto"},children:e.jsx(Z,{ref:M,drawDotsOnImage:u,setDrawDotsAnImage:F,onSave:t=>{T(t)},setMarkers:B,markers:R,dotSize:U,setDotSize:L})})})}),e.jsx(l,{className:"mb-3 d-flex justify-content-center",children:e.jsx(n,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(te,{disabled:A,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{Se as default};
