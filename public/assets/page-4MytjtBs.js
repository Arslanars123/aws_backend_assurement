import{r as m,b as z,a as G,c as H,j as e,R as n,C as a}from"./index-CEbbE1Sf.js";import{C as J}from"./ComponentContainerCard-BpYspYtC.js";import{P as Y}from"./PageMetaData-qE4R9bbS.js";import{B as p}from"./urls-CvG9cD6N.js";import{F as o}from"./FormLabel-WQTNbj7P.js";import{F as c}from"./FormControl-DFJ9Ydzw.js";import{A as _,C as q,T as K}from"./TextField-CeDJPKh1.js";import{F as Q}from"./FormSelect-Dmi-PE_I.js";import{I as $}from"./Image-ULHo9GWi.js";import{B as h}from"./Button-CWQV4UHt.js";import"./Card-mt6mV6AB.js";import"./divWithClassName-CT9nWrpT.js";import"./FormContext-CSwRqVJr.js";import"./useFormControl-BPpZZpE7.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-C8K2eoCJ.js";const pe=()=>{const[r,j]=m.useState({username:"",role:"Subcontractor",phone:"",startDate:"",name:"",address:"",postalCode:"",city:"",isProjectManager:null,cvr:"",contactPerson:"",contactPhone:""}),{companyId:f,subcontractorId:x}=z(),[E,M]=m.useState([]),[v,N]=m.useState([]),[y,S]=m.useState(null),[F,g]=m.useState(null),[R,w]=m.useState(null),[D,b]=m.useState(null),P=m.useRef(null),C=m.useRef(null),I=G(),{setLoading:d}=H(),V=async()=>{try{const t=await(await fetch(`${p}/get-company-professions?companyId=${f}`)).json();M(t)}catch(s){console.error("Error fetching professions:",s)}},i=s=>{const{name:t,value:l}=s.target;j({...r,[t]:l})},A=s=>{const{name:t,value:l}=s.target;j({...r,[t]:l})},L=s=>{const t=s.target.files[0];if(t){S(t);const l=new FileReader;l.onload=u=>{g(u.target.result)},l.readAsDataURL(t)}},O=s=>{const t=s.target.files[0];if(t){w(t);const l=new FileReader;l.onload=u=>{b(u.target.result)},l.readAsDataURL(t)}},U=()=>{S(null),g(null),P.current&&(P.current.value="")},T=()=>{w(null),b(null),C.current&&(C.current.value="")};m.useEffect(()=>{x&&(d(!0),V(),fetch(`${p}/get-user-detail/${x}`).then(async s=>{const t=await s.json();if(j({username:t.username||"",role:t.role||"Subcontractor",phone:t.phone||"",startDate:t.startDate||"",name:t.name||"",address:t.address||"",postalCode:t.postalCode||"",city:t.city||"",isProjectManager:t.isProjectManager||null,cvr:t.cvr||"",contactPerson:t.contactPerson||"",contactPhone:t.contactPhone||""}),t.userProfession&&Array.isArray(t.userProfession)&&N(t.userProfession),t.picture){const l=t.picture.startsWith("http")?t.picture:`${p.replace("/api","")}/uploads/${t.picture}`;g(l)}if(t.contactPicture){const l=t.contactPicture.startsWith("http")?t.contactPicture:`${p.replace("/api","")}/uploads/${t.contactPicture}`;b(l)}console.log("Subcontractor data for form:",t)}).catch(s=>console.error(s)).finally(()=>d(!1)))},[x,d]);const B=async()=>{d(!0);const s=new FormData;Object.keys(r).forEach(t=>{t==="picture"&&y?s.append("picture",y):t==="contactPicture"&&R?s.append("contactPicture",R):t==="isProjectManager"||t==="userProfession"?s.append(t,JSON.stringify(r[t])):s.append(t,r[t])}),s.append("userProfession",JSON.stringify(v));try{const t=await fetch(`${p}/update-user/${x}`,{method:"POST",body:s});t.ok?I(`/dashboard/companies/view/${f}`):console.error("Error:",t.statusText)}catch(t){console.error("Fetch error:",t)}d(!1)},W=()=>{I(`/dashboard/companies/view/${f}`)};return e.jsxs(e.Fragment,{children:[e.jsx(Y,{title:"Edit Sub Contractor"}),e.jsx("form",{onSubmit:s=>{s.preventDefault(),B()},children:e.jsx(n,{className:"justify-content-center",children:e.jsx(a,{children:e.jsx(J,{title:"Edit Sub Contractor Details",children:e.jsxs(n,{children:[e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Email"}),e.jsx(a,{sm:"10",children:e.jsx(c,{value:r.username,onChange:i,name:"username",type:"email",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Name"}),e.jsx(a,{sm:"10",children:e.jsx(c,{value:r.name,onChange:i,name:"name",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Phone"}),e.jsx(a,{sm:"10",children:e.jsx(c,{value:r.phone,onChange:i,name:"phone",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Address"}),e.jsx(a,{sm:"10",children:e.jsx(c,{value:r.address,onChange:i,name:"address",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"City"}),e.jsx(a,{sm:"10",children:e.jsx(c,{value:r.city,onChange:i,name:"city",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Post Code"}),e.jsx(a,{sm:"10",children:e.jsx(c,{value:r.postalCode,onChange:i,name:"postalCode",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Profession"}),e.jsx(a,{sm:"10",children:e.jsx(_,{multiple:!0,options:E,getOptionLabel:s=>s.GroupName,value:v,onChange:(s,t)=>{N(t)},renderInput:s=>e.jsx(K,{...s,variant:"outlined",placeholder:"Search and select professions..."}),renderTags:(s,t)=>s.map((l,u)=>e.jsx(q,{label:l.GroupName,...t({index:u})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Start Date"}),e.jsx(a,{sm:"10",children:e.jsx(c,{value:r.startDate,onChange:i,name:"startDate",type:"date",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{className:"col-sm-2 col-form-label text-end",children:"Is project Manager"}),e.jsx(a,{sm:"10",children:e.jsxs(Q,{value:r.isProjectManager,name:"isProjectManager",onChange:A,children:[e.jsx("option",{defaultValue:"",children:"Select"}),e.jsx("option",{value:"yes",children:"Yes"}),e.jsx("option",{value:"No",children:"No"})]})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{className:"col-sm-2 col-form-label text-end",children:"CVR. NR."}),e.jsx(a,{sm:"10",children:e.jsx(c,{value:r.cvr,onChange:i,name:"cvr",type:"text",id:"cvr-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{className:"col-sm-2 col-form-label text-end",children:"Contact Person"}),e.jsx(a,{sm:"10",children:e.jsx(c,{value:r.contactPerson,onChange:i,name:"contactPerson",type:"text",id:"contact-person-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{className:"col-sm-2 col-form-label text-end",children:"Phone (Contact)"}),e.jsx(a,{sm:"10",children:e.jsx(c,{value:r.contactPhone,onChange:i,name:"contactPhone",type:"text",id:"contact-phone-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Picture"}),e.jsxs(a,{sm:"10",children:[e.jsx(c,{type:"file",id:"file-input",name:"picture",onChange:L,accept:"image/*",ref:P}),F&&e.jsxs("div",{className:"mt-3 position-relative",children:[e.jsx($,{src:F,alt:"Preview",fluid:!0,rounded:!0,style:{maxWidth:"200px",maxHeight:"200px"}}),e.jsx(h,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:U,style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]})]})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{className:"col-sm-2 col-form-label text-end",children:"Picture (Contact)"}),e.jsxs(a,{sm:"10",children:[e.jsx(c,{type:"file",id:"contact-picture-input",name:"contactPicture",onChange:O,accept:"image/*",ref:C}),D&&e.jsxs("div",{className:"mt-3 position-relative",children:[e.jsx($,{src:D,alt:"Contact Preview",fluid:!0,rounded:!0,style:{maxWidth:"200px",maxHeight:"200px"}}),e.jsx(h,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:T,style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]})]})]})}),e.jsx(n,{className:"mb-3 d-flex justify-content-center",children:e.jsxs(a,{sm:"12",className:"d-flex justify-content-end",children:[e.jsx(h,{type:"button",variant:"secondary",className:"me-2",onClick:W,children:"Cancel"}),e.jsx(h,{type:"submit",variant:"primary",children:"Update Sub Contractor"})]})})]})})})})})]})};export{pe as default};
