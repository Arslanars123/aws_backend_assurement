import{r as u,a as P,a9 as v,an as L,ao as I,G as E,j as e,C as h,h as g,am as F}from"./index-CRUsPvgo.js";import{I as k}from"./IconifyIcon-CSuLoCyn.js";import{P as T}from"./PasswordFormInput-CyvP7I6_.js";import{T as A}from"./TextFormInput-C2DspZf-.js";import{c as B,a as p,u as G,o as R}from"./index.esm-CfFuZcJT.js";import{B as U}from"./urls-BhGeBsON.js";import{l as $}from"./jpo-Ci11ADWT.js";import{P as D}from"./PageMetaData-DH--1BrT.js";import{C as O}from"./Card-Bhvh6y0G.js";import"./FormControl-BDBioXn6.js";import"./FormLabel-BGcO0FaX.js";import"./FormGroup-DNsBnA1C.js";import"./divWithClassName-C1rBczNJ.js";const q=()=>{const[t,n]=u.useState(!1),a=P(),{saveSession:x}=v(),[f]=L(),{showNotification:i}=I(),j=B({username:p(),password:p().required("Please enter your password")}),{control:b,handleSubmit:y}=G({resolver:R(j),defaultValues:{username:"",password:""}}),N=()=>{const o=f.get("redirectTo");a(o||"/dashboard/companies")},{companies:M,projects:V,selectedCompany:_,selectedProject:z,setSelectedCompany:w,setSelectedProject:H}=u.useContext(E),C=y(async o=>{var c,m,l,d;try{fetch(`${U}/users/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then(async s=>{if(!s.ok){const S=await s.json();throw new Error(S.error||"Login failed")}const r=await s.json();r.token&&(r.user.role=="Admin"&&w(r.user.companyId),x(r),N(),i({message:"Successfully logged in. Redirecting....",variant:"success"}))}).catch(s=>{i({message:s.message,variant:"danger"}),console.log("Error occurred:",s.message)})}catch(s){(m=(c=s.response)==null?void 0:c.data)!=null&&m.error&&i({message:(d=(l=s.response)==null?void 0:l.data)==null?void 0:d.error,variant:"danger"})}finally{n(!1)}});return{loading:t,login:C,control:b}},J=()=>{const{loading:t,login:n,control:a}=q();return e.jsxs("form",{onSubmit:n,className:"my-4",children:[e.jsx(A,{control:a,name:"username",label:"Username",containerClassName:"form-group mb-2",placeholder:"Enter your username"}),e.jsx(T,{control:a,name:"password",label:"Password",containerClassName:"form-group",placeholder:"Enter your password"}),e.jsx("div",{className:"form-group mb-0 row",children:e.jsx(h,{xs:12,children:e.jsx("div",{className:"d-grid mt-3",children:e.jsxs("button",{className:"btn btn-primary flex-centered",type:"submit",disabled:t,children:["Log In ",e.jsx(k,{icon:"fa6-solid:right-to-bracket",className:"ms-1"})]})})})})]})},ie=()=>e.jsxs(e.Fragment,{children:[e.jsx(D,{title:"Login"}),e.jsx(h,{lg:4,className:"mx-auto",children:e.jsxs(O,{children:[e.jsx(g,{className:"p-0 auth-header-box rounded-top",style:{backgroundColor:"#1F2C68"},children:e.jsxs("div",{className:"text-center p-3",children:[e.jsx(F,{to:"/",className:"logo logo-admin",children:e.jsx("img",{src:$,height:50,alt:"logo",className:"auth-logo"})}),e.jsx("h4",{className:"mt-3 mb-1 fw-semibold text-white fs-18",children:"Let's Get Started"}),e.jsx("p",{className:"text-muted fw-medium mb-0",children:"Sign in to continue to Assurement."})]})}),e.jsx(g,{className:"pt-0",children:e.jsx(J,{})})]})})]});export{ie as default};
