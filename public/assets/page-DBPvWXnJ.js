import{r,b as M,a as z,j as e,R as c,C as n}from"./index-CFC_skDo.js";import{C as H}from"./ComponentContainerCard-BgtLXH2x.js";import{P as W}from"./PageMetaData--AH9Un1H.js";import{B as f}from"./urls-BhGeBsON.js";import{F as m}from"./FormLabel-S5bDb0w7.js";import{F as p}from"./FormControl-CiIjeg_-.js";import{F as N}from"./FormSelect-D_Be58Ty.js";import{I as E}from"./Image-xOOuaExf.js";import{B as y}from"./Button-2F6J7aEx.js";import"./Card-DSVzyJ_p.js";import"./divWithClassName-Dn3DrZ5P.js";const ae=()=>{const[l,d]=r.useState(null),[F,P]=r.useState(!1),[R,I]=r.useState(!0);r.useState(null),r.useState(null);const[x,S]=r.useState([]),[g,D]=r.useState([]),{drawId:h}=M(),$=z();r.useRef(null);const b=r.useRef(null),[_,C]=r.useState([]);r.useEffect(()=>{h&&fetch(`${f}/get-draw-detail/${h}`).then(async s=>{const t=await s.json();d({...t,picture2:t.picture,pictures2:t.pictures}),t.pictures&&t.pictures.length>0&&C(t.pictures.map(a=>`https://147.93.94.31/uploads/${a}`))}).catch(s=>console.error(s)).finally(()=>I(!1))},[h]);const j=s=>{const{name:t,value:a}=s.target;d({...l,[t]:a})},w=s=>{const{name:t,value:a,multiple:i,options:o}=s.target;if(i){const u=Array.from(o).filter(v=>v.selected).map(v=>v.value);d({...l,[t]:u})}else d({...l,[t]:a})};r.useEffect(()=>{(async()=>{try{const a=await(await fetch(`${f}/get-projects`)).json();k(a)}catch(t){console.error("Error fetching projects:",t)}})()},[]);const[L,k]=r.useState([]),B=s=>{const t=Array.from(s.target.files),a=[...x,...t],i=[...g,...t.map(o=>URL.createObjectURL(o))];S(a),D(i)},O=s=>{const t=x.filter((o,u)=>u!==s),a=g.filter((o,u)=>u!==s);S(t),D(a);const i=new DataTransfer;t.forEach(o=>i.items.add(o)),b.current&&(b.current.files=i.files)},T=async s=>{s.preventDefault(),P(!0);const t=new FormData;Object.keys(l).forEach(a=>{t.append(a,l[a])}),x.length>0&&x.forEach(a=>{t.append("pictures",a)});try{const a=await fetch(`${f}/update-draw/${h}`,{method:"POST",body:t});if(a.ok){const i=await a.json();$("/dashboard/draws",{state:{success:"Drawing & Document updated successfully!"}})}else console.error("Error:",a.statusText)}catch(a){console.error("Fetch error:",a)}P(!1)},U=s=>{C(t=>t.filter((a,i)=>i!==s)),d(t=>{if(!t)return null;const a=t.pictures2.filter((i,o)=>o!==s);return{...t,pictures2:a.length>0?a:[]}})};r.useEffect(()=>{(async()=>{try{const a=await(await fetch(`${f}/get-plans`)).json();A(a)}catch(t){console.error("Error fetching plans:",t)}})()},[]);const[V,A]=r.useState([]);return e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"Edit Drawing & Document"}),R?null:e.jsx("form",{onSubmit:T,children:e.jsx(c,{className:"justify-content-center",children:e.jsx(n,{children:e.jsx(H,{title:"Edit Drawing & Document",children:e.jsxs(c,{children:[e.jsx(n,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Name"}),e.jsx(n,{sm:"10",children:e.jsx(p,{value:l==null?void 0:l.name,onChange:j,name:"name",type:"text",id:"example-text-input"})})]})}),e.jsx(n,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Description"}),e.jsx(n,{sm:"10",children:e.jsx(p,{value:l==null?void 0:l.description,onChange:j,name:"description",type:"text",id:"example-text-input"})})]})}),e.jsx(n,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Date"}),e.jsx(n,{sm:"10",children:e.jsx(p,{value:l==null?void 0:l.date,onChange:j,name:"date",type:"date",id:"example-text-input"})})]})}),e.jsx(n,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Updated Date"}),e.jsx(n,{sm:"10",children:e.jsx(p,{value:l==null?void 0:l.updatedDate,onChange:j,name:"updatedDate",type:"date",id:"example-text-input"})})]})}),e.jsx(n,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Drawing Or Document"}),e.jsx(n,{sm:"10",children:e.jsxs(N,{value:l==null?void 0:l.checkbox,name:"checkbox",onChange:w,children:[e.jsx("option",{defaultValue:"",children:"Select"}),e.jsx("option",{value:"Drawing",children:"Drawing"}),e.jsx("option",{value:"Document",children:"Document"})]})})]})}),e.jsx(n,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Plan"}),e.jsx(n,{sm:"10",children:e.jsxs(N,{value:l.planId,name:"planId",onChange:w,children:[e.jsx("option",{defaultValue:"",children:"Select plan"}),V.map(s=>e.jsx("option",{value:s._id,children:s.name},s.id))]})})]})}),e.jsx(n,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Projects"}),e.jsx(n,{sm:"10",children:e.jsxs(N,{value:l.projectsId,name:"projectsId",onChange:w,multiple:!0,children:[e.jsx("option",{defaultValue:"",children:"Select Projects"}),L.map(s=>e.jsxs("option",{value:s._id,children:[s.name," "]},s.id))]})})]})}),e.jsx(n,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{htmlFor:"multiple-file-input",className:"col-sm-2 col-form-label text-end",children:"Pictures"}),e.jsxs(n,{sm:"10",children:[e.jsx(p,{type:"file",id:"multiple-file-input",name:"pictures",onChange:B,accept:"image/*",multiple:!0,ref:b}),e.jsxs("div",{className:"mt-3 d-flex flex-wrap",children:[g.map((s,t)=>e.jsxs("div",{className:"position-relative me-2 mb-2",children:[e.jsx(E,{src:s,alt:`Preview ${t}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),e.jsx(y,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>O(t),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]},t)),_.map((s,t)=>e.jsxs("div",{className:"position-relative me-2 mb-2",children:[e.jsx(E,{src:s,alt:`Existing Preview ${t}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),e.jsx(y,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>U(t),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]},`existing-${t}`))]})]})]})}),e.jsx(c,{className:"mb-3 d-flex justify-content-center",children:e.jsx(n,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(y,{disabled:F,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{ae as default};
