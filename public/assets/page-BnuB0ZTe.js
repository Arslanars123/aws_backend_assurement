import{r,b as U,a as z,j as t,R as o,C as i}from"./index-CFC_skDo.js";import{C as H}from"./ComponentContainerCard-BgtLXH2x.js";import{P as V}from"./PageMetaData--AH9Un1H.js";import{B as g}from"./urls-BhGeBsON.js";import{F as d}from"./FormLabel-S5bDb0w7.js";import{F as b}from"./FormControl-CiIjeg_-.js";import{F as W}from"./FormSelect-D_Be58Ty.js";import{I as E}from"./Image-xOOuaExf.js";import{B as P}from"./Button-2F6J7aEx.js";import"./Card-DSVzyJ_p.js";import"./divWithClassName-Dn3DrZ5P.js";const le=()=>{const[l,m]=r.useState(null),[C,v]=r.useState(!1),[R,I]=r.useState(!0),[y,q]=r.useState(null),[G,$]=r.useState(null),[f,S]=r.useState([]),[h,N]=r.useState([]),{planId:p}=U(),D=z();r.useRef(null);const x=r.useRef(null),[L,w]=r.useState([]);r.useEffect(()=>{p&&fetch(`${g}/get-plan-detail/${p}`).then(async s=>{const e=await s.json();m({...e,picture2:e.picture,pictures2:e.pictures}),e.picture&&e.picture!=="null"&&$(`https://147.93.94.31/uploads/${e.picture}`),e.pictures&&e.pictures.length>0&&w(e.pictures.map(a=>`https://147.93.94.31/uploads/${a}`))}).catch(s=>console.error(s)).finally(()=>I(!1))},[p]);const F=s=>{const{name:e,value:a}=s.target;m({...l,[e]:a})},_=s=>{const e=Array.from(s.target.files),a=[...f,...e],n=[...h,...e.map(c=>URL.createObjectURL(c))];S(a),N(n)},B=s=>{const e=f.filter((c,u)=>u!==s),a=h.filter((c,u)=>u!==s);S(e),N(a);const n=new DataTransfer;e.forEach(c=>n.items.add(c)),x.current&&(x.current.files=n.files)},T=async s=>{s.preventDefault(),v(!0);const e=new FormData;Object.keys(l).forEach(a=>{e.append(a,l[a])}),y&&e.append("picture",y),f.forEach(a=>{e.append("pictures",a)});try{const a=await fetch(`${g}/update-plan/${p}`,{method:"POST",body:e});if(a.ok){const n=await a.json();D("/dashboard/plans",{state:{success:"Plan updated successfully!"}})}else console.error("Error:",a.statusText)}catch(a){console.error("Fetch error:",a)}v(!1)},k=s=>{w(e=>e.filter((a,n)=>n!==s)),m(e=>{if(!e)return null;const a=e.pictures2.filter((n,c)=>c!==s);return{...e,pictures2:a.length>0?a:[]}})},A=s=>{const{name:e,value:a,multiple:n,options:c}=s.target;if(n){const u=Array.from(c).filter(j=>j.selected).map(j=>j.value);m({...l,[e]:u})}else m({...l,[e]:a})};r.useEffect(()=>{(async()=>{try{const a=await(await fetch(`${g}/get-projects`)).json();O(a)}catch(e){console.error("Error fetching projects:",e)}})()},[]);const[M,O]=r.useState([]);return t.jsxs(t.Fragment,{children:[t.jsx(V,{title:"Edit Plan"}),R?null:t.jsx("form",{onSubmit:T,children:t.jsx(o,{className:"justify-content-center",children:t.jsx(i,{children:t.jsx(H,{title:"Edit Plan",children:t.jsxs(o,{children:[t.jsx(i,{lg:"6",children:t.jsxs(o,{className:"mb-3",children:[t.jsx(d,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Name"}),t.jsx(i,{sm:"10",children:t.jsx(b,{value:l==null?void 0:l.name,onChange:F,name:"name",type:"text",id:"example-text-input"})})]})}),t.jsx(i,{lg:"6",children:t.jsxs(o,{className:"mb-3",children:[t.jsx(d,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Description"}),t.jsx(i,{sm:"10",children:t.jsx(b,{value:l==null?void 0:l.description,onChange:F,name:"description",type:"text",id:"example-text-input"})})]})}),t.jsx(i,{lg:"6",children:t.jsxs(o,{className:"mb-3",children:[t.jsx(d,{className:"col-sm-2 col-form-label text-end",children:"Select Projects"}),t.jsx(i,{sm:"10",children:t.jsxs(W,{value:l.projectsId,name:"projectsId",onChange:A,multiple:!0,children:[t.jsx("option",{defaultValue:"",children:"Select Projects"}),M.map(s=>t.jsxs("option",{value:s._id,children:[s.name," "]},s.id))]})})]})}),t.jsx(i,{lg:"6",children:t.jsxs(o,{className:"mb-3",children:[t.jsx(d,{htmlFor:"multiple-file-input",className:"col-sm-2 col-form-label text-end",children:"Pictures"}),t.jsxs(i,{sm:"10",children:[t.jsx(b,{type:"file",id:"multiple-file-input",name:"pictures",onChange:_,accept:"image/*",multiple:!0,ref:x}),t.jsxs("div",{className:"mt-3 d-flex flex-wrap",children:[h.map((s,e)=>t.jsxs("div",{className:"position-relative me-2 mb-2",children:[t.jsx(E,{src:s,alt:`Preview ${e}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),t.jsx(P,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>B(e),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]},e)),L.map((s,e)=>t.jsxs("div",{className:"position-relative me-2 mb-2",children:[t.jsx(E,{src:s,alt:`Existing Preview ${e}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),t.jsx(P,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>k(e),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]},`existing-${e}`))]})]})]})}),t.jsx(o,{className:"mb-3 d-flex justify-content-center",children:t.jsx(i,{sm:"12",className:"d-flex justify-content-end",children:t.jsx(P,{disabled:C,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{le as default};
