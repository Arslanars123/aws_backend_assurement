import{r as d,j as e,R as g,C as l,c as U,G as V,b as M,ab as J}from"./index-CAFh8Qe-.js";import{C as K}from"./ComponentContainerCard-BHLb5dlU.js";import{B as z,U as O}from"./urls-D84fNQqS.js";import{D as H}from"./DetailPage-Do78Mp91.js";import{P as W}from"./page-DuGu7686.js";import{F as B,d as q,e as Q,g as X}from"./index-CFsCAHnL.js";import{C as G}from"./Card-B6ongrnB.js";import{F as p}from"./Form-cPeREZGd.js";import{I as _}from"./InputGroup-_lRh4Xq5.js";import{B as T}from"./Button-DUm19Z6r.js";import{B as N}from"./Badge-V0dRfUVq.js";import{L as R}from"./ListGroup-BROxnyp_.js";import"./FormLabel-DJooOqJq.js";import"./FormContext-CVQotS7s.js";import"./Modal-CXhHI7_p.js";import"./useWindow-9TrldcIQ.js";import"./useEventCallback-CZjKJ66g.js";import"./DataKey-COGXBUcQ.js";import"./NoopTransition-Cm1DoMSP.js";import"./divWithClassName-Ds10gy6J.js";import"./Image-CbaU3Ogc.js";import"./FormRange-BHW8Q9KG.js";import"./PDFButton-DgNvtDdV.js";import"./FormCheck-woMCjg_3.js";import"./FormControl-D6Fi2fvk.js";import"./FormGroup-C4HhIO73.js";import"./FormSelect-DckZIl1p.js";import"./InputGroupContext-BDYJ7d5E.js";import"./hook-f2Z_u6VT.js";import"./Nav-BEWRMUE8.js";import"./NavContext-qBVxADE6.js";const Y=({staticReportId:x,projectId:f})=>{const[t,w]=d.useState([]),[b,y]=d.useState([]),[P,C]=d.useState(!1),[u,v]=d.useState([]),[j,k]=d.useState(""),[m,L]=d.useState(""),[h,A]=d.useState(!1);d.useEffect(()=>{f&&E()},[f]),d.useEffect(()=>{x&&f&&D()},[x,f,j,h]),d.useEffect(()=>{F()},[t,m,j]);const E=async()=>{try{const n=await(await fetch(`${z}/get-project-detail`,{method:"POST",body:JSON.stringify({projectId:f}),headers:{"Content-Type":"application/json"}})).json(),c=Object.keys((n==null?void 0:n.professionAssociatedData)||{}).map(r=>{var a,o,S,I;return{key:r,name:((o=(a=n.professionAssociatedData[r])==null?void 0:a.profession)==null?void 0:o.GroupName)||r,id:((I=(S=n.professionAssociatedData[r])==null?void 0:S.profession)==null?void 0:I.SubjectMatterId)||r}});v(c)}catch(s){console.error("Error fetching professions:",s)}},D=async()=>{C(!0);try{let s=`${z}/get-static-report-entries?projectId=${f}`;j&&(s+=`&professionId=${j}`);const c=await(await fetch(s)).json();if(console.log("API Response:",c),console.log("Looking for static report ID:",x),console.log("Available entry IDs:",c.map(r=>r.staticReportId)||[]),Array.isArray(c)){let r=c;x&&!h?(r=c.filter(a=>a.staticReportId===x),console.log("Found entries for static report:",x,r.length)):console.log("Showing all entries:",r.length),w(r)}else console.log("No entries found in response"),w([])}catch(s){console.error("Error fetching entries:",s),w([])}finally{C(!1)}},F=()=>{let s=t;m&&(s=s.filter(n=>{var c,r;return(((c=n.user)==null?void 0:c.name)||"").toLowerCase().includes(m.toLowerCase())||(((r=n.independentController)==null?void 0:r.name)||"").toLowerCase().includes(m.toLowerCase())||(n.comment||"").toLowerCase().includes(m.toLowerCase())||(n.controlPlan||"").toLowerCase().includes(m.toLowerCase())||(n.professionName||"").toLowerCase().includes(m.toLowerCase())||(n.staticReportId||"").toLowerCase().includes(m.toLowerCase())||(n.projectName||"").toLowerCase().includes(m.toLowerCase())})),y(s)},$=s=>s?new Date(s).toLocaleString():"N/A",i=(s,n)=>{window.open(`${O}/uploads/${s}`,"_blank")};return e.jsxs(G,{className:"mt-4",children:[e.jsx(G.Header,{children:e.jsx("h5",{className:"mb-0",children:"Static Report Entries"})}),e.jsxs(G.Body,{children:[e.jsxs(g,{className:"mb-3",children:[e.jsx(l,{md:3,children:e.jsxs(p.Group,{children:[e.jsx(p.Label,{children:"Select Profession"}),e.jsxs(p.Select,{value:j,onChange:s=>k(s.target.value),children:[e.jsx("option",{value:"",children:"All Professions"}),u.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.id,")"]},s.key))]})]})}),e.jsx(l,{md:6,children:e.jsxs(p.Group,{children:[e.jsx(p.Label,{children:"Search Entries"}),e.jsxs(_,{children:[e.jsx(_.Text,{children:e.jsx(B,{icon:q})}),e.jsx(p.Control,{type:"text",placeholder:"Search by submitter, comment, control plan, or profession...",value:m,onChange:s=>L(s.target.value)})]})]})}),e.jsx(l,{md:3,children:e.jsxs(p.Group,{children:[e.jsx(p.Label,{children:"Â "}),e.jsx("div",{children:e.jsx(T,{variant:h?"primary":"outline-primary",size:"sm",onClick:()=>A(!h),className:"w-100",children:h?"Show This Report Only":"Show All Entries"})})]})})]}),P?e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{children:"Loading entries..."})}):b.length>0?e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("h6",{children:["Found ",b.length," entries",!h&&x&&e.jsx("span",{className:"text-muted ms-2",children:"(for this static report)"}),h&&e.jsx("span",{className:"text-muted ms-2",children:"(all project entries)"})]}),e.jsxs("div",{children:[e.jsx(N,{bg:"info",className:"me-2",children:j||"All Professions"}),h&&e.jsx(N,{bg:"warning",children:"All Entries"})]})]}),e.jsx(R,{children:b.map((s,n)=>{var c,r;return e.jsx(R.Item,{className:"mb-3",children:e.jsxs(g,{children:[e.jsxs(l,{md:8,children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Submitted by:"})," ",((c=s.user)==null?void 0:c.name)||((r=s.independentController)==null?void 0:r.name)||"N/A",s.user&&e.jsx(N,{bg:"secondary",className:"ms-2",children:"Project Manager/Worker"}),s.independentController&&e.jsx(N,{bg:"info",className:"ms-2",children:"Independent Controller"}),h&&e.jsxs(e.Fragment,{children:[e.jsx(N,{bg:"primary",className:"ms-2",children:s.professionName}),e.jsx(N,{bg:"dark",className:"ms-2",children:s.projectName})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Date:"})," ",$(s.date)]}),s.comment&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Comment:"}),e.jsx("p",{className:"mb-0 text-muted",children:s.comment})]}),s.controlPlan&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Control Plan:"}),e.jsx("p",{className:"mb-0 text-muted",children:s.controlPlan})]}),s.drawing&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Drawing:"}),e.jsx("p",{className:"mb-0 text-muted",children:s.drawing.name})]})]}),e.jsx(l,{md:4,children:e.jsxs("div",{className:"text-end",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Entry ID:"})," ",s.staticReportId]}),s.annotatedPdfs&&s.annotatedPdfs.length>0&&e.jsxs("div",{children:[e.jsxs("strong",{children:["Annotated PDFs (",s.annotatedPdfs.length,"):"]}),e.jsx("div",{className:"mt-2",children:s.annotatedPdfs.map((a,o)=>e.jsx("div",{className:"mb-1",children:e.jsxs(T,{variant:"outline-primary",size:"sm",onClick:()=>i(a.filename,a.originalName),className:"w-100",children:[e.jsx(B,{icon:Q,className:"me-1"}),a.originalName||a.filename]})},o))})]}),s.pictures&&s.pictures.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("strong",{children:["Pictures (",s.pictures.length,"):"]}),e.jsx("div",{className:"mt-2",children:s.pictures.map((a,o)=>e.jsxs("div",{className:"mb-1",children:[e.jsxs(T,{variant:"outline-success",size:"sm",onClick:()=>i(a.filename,a.originalName),className:"w-100",children:[e.jsx(B,{icon:X,className:"me-1"}),a.originalName||a.filename]}),a.description&&e.jsx("small",{className:"text-muted d-block",children:a.description})]},o))})]})]})})]})},n)})})]}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-muted",children:t.length===0?"No entries found for this static report.":"No entries match your search criteria."})})]})]})},Fe=()=>{var L,h,A,E,D,F,$;const{setLoading:x}=U(),{selectedProfessionKey:f}=d.useContext(V),[t,w]=d.useState(null),[b,y]=d.useState(null),[P,C]=d.useState({show:!1,pdfFile:null,name:null}),{staticId:u,projectId:v}=M(),[j]=J();j.get("report");const k=async()=>{var i;try{x(!0);const n=await(await fetch(`${z}/get-project-detail`,{method:"POST",body:JSON.stringify({projectId:v}),headers:{"Content-Type":"application/json"}})).json(),c=f||Object.keys(n==null?void 0:n.professionAssociatedData)[0],r=n==null?void 0:n.professionAssociatedData[c],a=(i=r==null?void 0:r.staticReportRegistration)==null?void 0:i.find(o=>{var S;return((S=o==null?void 0:o._id)==null?void 0:S.toString())===(u==null?void 0:u.toString())});if(a){w(a);const o={...a};delete o._id,delete o.annotatedPdfs,delete o.drawing,delete o.pictureObjects,delete o.pictures,y(o)}}catch(s){console.error("Error fetching static report:",s)}finally{x(!1)}};d.useEffect(()=>{k()},[f]);const m=(i,s)=>{C({show:!0,pdfFile:i,name:s})};return e.jsxs(g,{className:"justify-content-center",children:[e.jsx(l,{lg:"12",children:e.jsx(K,{title:"View static",children:e.jsxs(g,{children:[e.jsx(H,{data:b}),(t==null?void 0:t.drawing)&&e.jsxs(e.Fragment,{children:[e.jsx(l,{lg:"12",children:e.jsxs(g,{className:"mb-2",children:[e.jsx(l,{sm:"2",className:"text-end",children:e.jsx("strong",{children:"Main Drawings:"})}),e.jsx(l,{sm:"10",children:(h=(L=t==null?void 0:t.drawing)==null?void 0:L.mainDrawings)==null?void 0:h.map((i,s)=>e.jsxs("div",{className:"mb-2 d-flex align-items-center",children:[e.jsx("div",{className:"me-2 cursor-pointer",onClick:()=>m(`${O}/uploads/${i.stored}`,i.original),children:e.jsx("i",{className:"fas fa-file-pdf",style:{fontSize:"2rem",color:"#dc3545"}})}),e.jsx("div",{className:"small text-muted",children:i.original})]},s))})]})}),((E=(A=t==null?void 0:t.drawing)==null?void 0:A.childDrawings)==null?void 0:E.length)>0&&e.jsx(l,{lg:"12",children:e.jsxs(g,{className:"mb-2",children:[e.jsx(l,{sm:"2",className:"text-end",children:e.jsx("strong",{children:"Child Drawings:"})}),e.jsx(l,{sm:"10",children:(F=(D=t==null?void 0:t.drawing)==null?void 0:D.childDrawings)==null?void 0:F.map((i,s)=>e.jsxs("div",{className:"mb-2 d-flex align-items-center",children:[e.jsx("div",{className:"me-2 cursor-pointer",onClick:()=>m(`${O}/uploads/${i.stored}`,i.original),children:e.jsx("i",{className:"fas fa-file-pdf",style:{fontSize:"2rem",color:"#dc3545"}})}),e.jsx("div",{className:"small text-muted",children:i.original})]},s))})]})})]}),(t==null?void 0:t.annotatedPdfs)&&t.annotatedPdfs.length>0&&e.jsx(l,{lg:"12",children:e.jsxs(g,{className:"mb-3",children:[e.jsx(l,{sm:"2",className:"text-end",children:e.jsx("strong",{children:"Annotated PDFs:"})}),e.jsx(l,{sm:"10",className:"d-flex flex-wrap",children:($=t==null?void 0:t.annotatedPdfs)==null?void 0:$.map((i,s)=>e.jsxs("div",{className:"mb-2 d-flex align-items-center",children:[e.jsx("div",{className:"me-2 cursor-pointer",onClick:()=>m(`${O}/uploads/${i.filename}`,i.originalName),children:e.jsx("i",{className:"fas fa-file-pdf",style:{fontSize:"2rem",color:"#dc3545"}})}),e.jsx("div",{className:"small text-muted",children:i.originalName})]},s))})]})})]})})}),e.jsx(l,{lg:"12",className:"mt-4",children:e.jsx(Y,{staticReportId:u,projectId:v})}),P.show&&e.jsx(W,{drawDotsOnPdf:P,setDrawDotsOnPdf:C,readOnly:!0})]})};export{Fe as default};
