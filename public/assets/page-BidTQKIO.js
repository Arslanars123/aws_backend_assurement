import{j as e,R as K,C as z,b as oe,r as s,m as os,a as bs,ab as vs,G as is,c as ls}from"./index-BMHGnWcK.js";import{C as cs}from"./ComponentContainerCard-DqzcDgtW.js";import{P as Ns}from"./PageMetaData-Bgn24qMg.js";import{B as g}from"./urls-CvG9cD6N.js";import{F as ke,a as Fe,b as ws,c as Cs}from"./index-urKZMkfA.js";import{A as Ds}from"./AllDataTables-Bw0WXMDV.js";import{A as As}from"./AllDataTables-stB4qMn0.js";import{A as ks}from"./AllDataTables-TF8z2xJb.js";import{A as Ts}from"./AllDataTables-BeUGRwIo.js";import{A as Es}from"./AllDataTables-DaWWd1HG.js";import{A as Ps}from"./AllDataTables-BZhKxyx9.js";import{A as ts}from"./AllDataTables-CDKfwRgo.js";import{R as Is}from"./index--BG4zqiO.js";import{A as $s}from"./AllDataTables-CPR4jPE7.js";import{A as Ls}from"./AllDataTables-ZbhvUrUN.js";import{A as Fs}from"./AllDataTables-CruuDuY7.js";import{A as Rs}from"./AllDataTables-XSPhYFB6.js";import{I as Z}from"./IconifyIcon-BZrnxXiy.js";import{S as as}from"./index-B4jlKqX0.js";import{F as L}from"./Form-3MPO2ubb.js";import{B as E}from"./Button-Dwvyfso6.js";import{C as ie}from"./Card-BQIi55Il.js";import{T as Ee}from"./Table-B4OyJ1fv.js";import{I as Re}from"./Image-BWlBzfxc.js";import{M as B}from"./Modal-BvTxh5Lm.js";import{A as Oe}from"./Alert-BSTIsewH.js";import{S as ds}from"./index-CBMLUB6q.js";import{S as Te}from"./Spinner-XoudD7db.js";import{F as he}from"./FormGroup-lh_nrrWS.js";import{F as pe}from"./FormLabel-BBJljh0R.js";import{F as ye}from"./FormControl-BhCdWsRE.js";import{B as Ue}from"./Badge-DwbwZlc2.js";import{C as Ms}from"./Collapse-CwsyI0zS.js";import{A as ns,T as rs}from"./TextField-CiuEKT8f.js";import{U as Os}from"./UsersTab-fwz1zRhX.js";import{A as Us}from"./AllDataTables-Dzn6kWCx.js";import{P as Gs}from"./page-BvVNSv9g.js";import{A as _s}from"./AllDataTables-ClfCXwem.js";import{A as Bs}from"./AllDataTables-JUTqLQml.js";import{A as zs}from"./AllDataTables-B4O7xQaZ.js";import{A as qs}from"./AllDataTables-DOKGF0KK.js";import{N as Me}from"./Nav-zc6EGNcM.js";import"./ListGroup-B0llwDPW.js";import"./hook-ShtcephR.js";import"./Nav-S035rggq.js";import"./DataKey-COGXBUcQ.js";import"./NavContext-DnO6Tzn3.js";import"./NoopTransition-Cvueq9hZ.js";import"./useEventCallback-aoYRPbpt.js";import"./FormCheck-CxttwEL4.js";import"./FormContext-_pJuLZf_.js";import"./FormRange-BUeztKfe.js";import"./FormSelect-Dr1VIvZ_.js";import"./divWithClassName-BnTSImTn.js";import"./useWindow-X1vIdSxZ.js";import"./Anchor-BpTvChcP.js";import"./createSuper-rRiq-ZhQ.js";import"./assertThisInitialized-B9jnkVVz.js";import"./useFormControl-78CrNPlx.js";import"./createPopper-C8K2eoCJ.js";import"./AllDataTables-DuFEMI9h.js";import"./AllDataTables-BGGqegVs.js";import"./menu-BecR6qdy.js";import"./AllDataTables-DzwHA9NW.js";import"./AllDataTables-RGeqFkcJ.js";import"./AllDataTables-CJPUJwQO.js";import"./AllDataTables-BIqF5bq-.js";import"./AllDataTables-BEfGgWWL.js";import"./AllDataTables-4T3T0xFT.js";import"./PDFButton-DD11AT0P.js";import"./NavbarContext-Ln_8Cs3r.js";const Hs=[{header:"Comment",accessorKey:"comment"},{header:"Profession",cell:({row:j})=>{var d;const f=(d=j==null?void 0:j.original)==null?void 0:d.profession;return e.jsx("span",{className:"text-primary",children:f==null?void 0:f.GroupName})}},{header:"BuildingParts",cell:({row:j})=>{var d;const f=(d=j==null?void 0:j.original)==null?void 0:d.buildingParts;return e.jsx("span",{className:"text-primary",children:f==null?void 0:f.name})}}],Qs=({specialControle:j,refreshData:f,selectedReport:d})=>{const m=[2,5,10,20,50],{companyId:o,projectId:u}=oe(),h=u?`/dashboard/companies/view/${o}/projects/view/${u}/specialControle/view/`:`/dashboard/companies/view/${o}/specialControle/view/`;return e.jsx(cs,{title:"Special Controle Poin",addUrl:"specialControle/add",children:e.jsx(Is,{refreshData:f,columns:Hs,data:j,viewUrl:h,rowsPerPageList:m,pageSize:10,tableClass:"datatable",theadClass:"table-light",showPagination:!0,searchable:!0,selectedReport:d})})},Js=({specialControle:j,refreshData:f,selectedReport:d})=>e.jsx(e.Fragment,{children:e.jsx(K,{className:"justify-content-center",children:e.jsx(z,{xs:12,children:e.jsx(Qs,{refreshData:f,specialControle:j,selectedReport:d})})})});function Vs(){const{companyId:j,projectId:f}=oe(),[d,m]=s.useState([]),[o,u]=s.useState(!1),[h,r]=s.useState(!1),[S,v]=s.useState(!1),[i,c]=s.useState(null),[p,U]=s.useState(""),[H,W]=s.useState(!1),[D,C]=s.useState({name:"",signature:null});s.useEffect(()=>{O()},[j,f]);const O=async()=>{u(!0);try{const N=await fetch(`${g}/get-name-signatures?companyId=${j}&projectId=${f}`);if(N.ok){const k=await N.json();m(k)}}catch(N){console.error("Error fetching signatures:",N)}finally{u(!1)}},$=N=>{const{name:k,value:X}=N.target;C({...D,[k]:X})},F=()=>{C({name:"",signature:null}),r(!0)},A=N=>{c(N),C({name:N.name||"",signature:null}),v(!0)},R=async N=>{if(N.preventDefault(),!D.name.trim()||!D.signature){alert("Please fill in the name and add a signature");return}W(!0);try{const k=new FormData;k.append("name",D.name),k.append("companyId",j),k.append("projectId",f),k.append("signature",D.signature,"signature.png");const X=S?`${g}/update-name-signature/${i._id}`:`${g}/add-name-signature`,se=await fetch(X,{method:S?"PUT":"POST",body:k});if(se.ok)r(!1),v(!1),C({name:"",signature:null}),c(null),O();else{const le=await se.json();alert(le.error||"Failed to save signature")}}catch(k){console.error("Error saving signature:",k),alert("Failed to save signature")}finally{W(!1)}},I=async N=>{if(window.confirm("Are you sure you want to delete this signature?"))try{const k=await fetch(`${g}/delete-name-signature/${N}`,{method:"DELETE"});if(k.ok)O();else{const X=await k.json();alert(X.error||"Failed to delete signature")}}catch(k){console.error("Error deleting signature:",k),alert("Failed to delete signature")}},ee=d.filter(N=>{var k;return(k=N.name)==null?void 0:k.toLowerCase().includes(p.toLowerCase())});return e.jsxs("div",{children:[e.jsxs(K,{className:"mb-3",children:[e.jsx(z,{md:"6",children:e.jsx(L.Control,{type:"text",placeholder:"Search by name...",value:p,onChange:N=>U(N.target.value)})}),e.jsx(z,{md:"6",className:"text-end",children:e.jsxs(E,{variant:"primary",onClick:F,disabled:o,children:[e.jsx(Z,{icon:"mdi:plus",className:"me-2"}),"Add Name & Signature"]})})]}),e.jsxs(ie,{children:[e.jsx(ie.Header,{children:e.jsx("h5",{className:"mb-0",children:"Name and Signatures"})}),e.jsx(ie.Body,{children:o?e.jsx("div",{className:"text-center py-4",children:e.jsx("div",{className:"spinner-border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):ee.length===0?e.jsx("div",{className:"text-center py-4 text-muted",children:"No signatures found. Add your first signature above."}):e.jsxs(Ee,{responsive:!0,striped:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Signature"}),e.jsx("th",{children:"Created Date"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:ee.map(N=>e.jsxs("tr",{children:[e.jsx("td",{children:N.name}),e.jsx("td",{children:N.signature&&e.jsx(Re,{src:`${g}/uploads/${N.signature}`,alt:"Signature",style:{maxWidth:"100px",maxHeight:"50px"},fluid:!0})}),e.jsx("td",{children:N.createdAt?new Date(N.createdAt).toLocaleDateString():"-"}),e.jsxs("td",{children:[e.jsx(E,{variant:"outline-primary",size:"sm",className:"me-2",onClick:()=>A(N),children:e.jsx(Z,{icon:"mdi:pencil"})}),e.jsx(E,{variant:"outline-danger",size:"sm",onClick:()=>I(N._id),children:e.jsx(Z,{icon:"mdi:delete"})})]})]},N._id))})]})})]}),e.jsxs(B,{show:h,onHide:()=>r(!1),size:"lg",children:[e.jsx(B.Header,{closeButton:!0,children:e.jsx(B.Title,{children:"Add Name & Signature"})}),e.jsxs("form",{onSubmit:R,children:[e.jsxs(B.Body,{children:[e.jsx(K,{children:e.jsx(z,{md:"12",children:e.jsxs(L.Group,{className:"mb-3",children:[e.jsx(L.Label,{children:"Name *"}),e.jsx(L.Control,{type:"text",name:"name",value:D.name,onChange:$,required:!0,placeholder:"Enter full name"})]})})}),e.jsx(K,{children:e.jsx(z,{md:"12",children:e.jsxs(L.Group,{className:"mb-3",children:[e.jsx(L.Label,{children:"Signature *"}),e.jsx(as,{onSave:N=>C({...D,signature:N}),onClear:()=>C({...D,signature:null}),width:400,height:200}),D.signature&&e.jsx("div",{className:"mt-2",children:e.jsx(Re,{src:URL.createObjectURL(D.signature),alt:"Signature Preview",fluid:!0,style:{maxWidth:"200px",maxHeight:"100px"}})})]})})})]}),e.jsxs(B.Footer,{children:[e.jsx(E,{variant:"secondary",onClick:()=>r(!1),children:"Cancel"}),e.jsx(E,{variant:"primary",type:"submit",disabled:H||!D.name.trim()||!D.signature,children:H?"Saving...":"Save Signature"})]})]})]}),e.jsxs(B,{show:S,onHide:()=>v(!1),size:"lg",children:[e.jsx(B.Header,{closeButton:!0,children:e.jsx(B.Title,{children:"Edit Name & Signature"})}),e.jsxs("form",{onSubmit:R,children:[e.jsxs(B.Body,{children:[e.jsx(K,{children:e.jsx(z,{md:"12",children:e.jsxs(L.Group,{className:"mb-3",children:[e.jsx(L.Label,{children:"Name *"}),e.jsx(L.Control,{type:"text",name:"name",value:D.name,onChange:$,required:!0,placeholder:"Enter full name"})]})})}),e.jsx(K,{children:e.jsx(z,{md:"12",children:e.jsxs(L.Group,{className:"mb-3",children:[e.jsx(L.Label,{children:"Signature *"}),e.jsx(as,{onSave:N=>C({...D,signature:N}),onClear:()=>C({...D,signature:null}),width:400,height:200}),(D.signature||(i==null?void 0:i.signature))&&e.jsx("div",{className:"mt-2",children:e.jsx(Re,{src:D.signature?URL.createObjectURL(D.signature):`${g}/uploads/${i.signature}`,alt:"Signature Preview",fluid:!0,style:{maxWidth:"200px",maxHeight:"100px"}})})]})})})]}),e.jsxs(B.Footer,{children:[e.jsx(E,{variant:"secondary",onClick:()=>v(!1),children:"Cancel"}),e.jsx(E,{variant:"primary",type:"submit",disabled:H||!D.name.trim(),children:H?"Saving...":"Update Signature"})]})]})]})]})}function Ks(){const{companyId:j,projectId:f}=oe(),[d,m]=s.useState(""),[o,u]=s.useState(null),[h,r]=s.useState(!1),[S,v]=s.useState(!1),[i,c]=s.useState(!1),[p,U]=s.useState({show:!1,message:"",variant:"success"});s.useEffect(()=>{H()},[f]);const H=async()=>{r(!0);try{const A=await fetch(`${g}/get-project-special-text?projectId=${f}`);if(A.ok){const R=await A.json();R.success&&R.data&&(u(R.data),m(R.data.specialText||""))}}catch(A){console.error("Error fetching special text:",A)}finally{r(!1)}},W=A=>{m(A.target.value)},D=async()=>{if(!d.trim()){U({show:!0,message:"Please enter some text before saving.",variant:"danger"});return}c(!0);try{const A=await fetch(`${g}/save-project-special-text`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:f,specialText:d.trim()})});if(A.ok){const R=await A.json();U({show:!0,message:R.message,variant:"success"}),u({projectId:f,specialText:d.trim()}),v(!1),H()}else{const R=await A.json();U({show:!0,message:R.error||"Failed to save special text",variant:"danger"})}}catch(A){console.error("Error saving special text:",A),U({show:!0,message:"An error occurred while saving special text",variant:"danger"})}finally{c(!1)}},C=async()=>{if(o&&window.confirm("Are you sure you want to delete the special text? This action cannot be undone.")){c(!0);try{const A=await fetch(`${g}/delete-project-special-text?projectId=${f}`,{method:"DELETE"});if(A.ok)U({show:!0,message:"Special text deleted successfully",variant:"success"}),u(null),m(""),v(!1);else{const R=await A.json();U({show:!0,message:R.error||"Failed to delete special text",variant:"danger"})}}catch(A){console.error("Error deleting special text:",A),U({show:!0,message:"An error occurred while deleting special text",variant:"danger"})}finally{c(!1)}}},O=()=>{v(!0)},$=()=>{m(""),v(!0)},F=()=>{v(!1),m((o==null?void 0:o.specialText)||"")};return h?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"200px"},children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):e.jsxs("div",{children:[e.jsx(K,{children:e.jsx(z,{lg:"12",children:e.jsxs(ie,{children:[e.jsxs(ie.Header,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h5",{className:"mb-0",children:"Project Special Text"}),e.jsxs(E,{variant:o?"outline-primary":"primary",onClick:o?O:$,disabled:i,children:[e.jsx(Z,{icon:"mdi:plus",className:"me-1"}),o?"Edit Special Text":"Add Special Text"]})]}),e.jsxs(ie.Body,{children:[p.show&&e.jsx(Oe,{variant:p.variant,dismissible:!0,onClose:()=>U({show:!1,message:"",variant:"success"}),className:"mb-3",children:p.message}),o?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Current Special Text:"}),e.jsx("div",{className:"border rounded p-3 bg-light",children:e.jsx("p",{className:"mb-0",style:{whiteSpace:"pre-wrap"},children:o.specialText})})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(E,{variant:"outline-primary",onClick:O,disabled:i,children:[e.jsx(Z,{icon:"mdi:pencil",className:"me-1"}),"Edit"]}),e.jsxs(E,{variant:"outline-danger",onClick:C,disabled:i,children:[e.jsx(Z,{icon:"mdi:delete",className:"me-1"}),"Delete"]})]})]}):e.jsxs("div",{className:"text-center py-5",children:[e.jsx(Z,{icon:"mdi:text-box-outline",className:"text-muted",style:{fontSize:"3rem"}}),e.jsx("h6",{className:"text-muted mt-3",children:"No Special Text Added"}),e.jsx("p",{className:"text-muted",children:'Click "Add Special Text" to add special text for this project.'})]})]})]})})}),e.jsxs(B,{show:S,onHide:F,size:"lg",children:[e.jsx(B.Header,{closeButton:!0,children:e.jsx(B.Title,{children:o?"Edit Special Text":"Add Special Text"})}),e.jsx(B.Body,{children:e.jsx(L,{children:e.jsxs(L.Group,{className:"mb-3",children:[e.jsx(L.Label,{children:"Special Text *"}),e.jsx(L.Control,{as:"textarea",rows:8,value:d,onChange:W,placeholder:"Enter special text for this project...",disabled:i}),e.jsx(L.Text,{className:"text-muted",children:"Enter any special notes, instructions, or additional information for this project."})]})})}),e.jsxs(B.Footer,{children:[e.jsx(E,{variant:"secondary",onClick:F,disabled:i,children:"Cancel"}),e.jsx(E,{variant:"primary",onClick:D,disabled:i||!d.trim(),children:i?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{icon:"mdi:content-save",className:"me-1"}),o?"Update":"Save"]})})]})]})]})}const Ws=({show:j,onHide:f,companyId:d,projectId:m,subjectMatterId:o})=>{console.log("StaticReportSignaturesModal props:",{show:j,companyId:d,projectId:m,subjectMatterId:o});const[u,h]=s.useState(null),[r,S]=s.useState({1:null,2:null,3:null}),[v,i]=s.useState({name:"",description:"",signatureType:1}),[c,p]=s.useState({}),[U,H]=s.useState([]),[W,D]=s.useState(!1),[C,O]=s.useState(!1),[$,F]=s.useState(null),[A,R]=s.useState("list"),[I,ee]=s.useState(1),N=s.useCallback(async()=>{try{const M=(await(await fetch(`${g}/get-gammas?companyId=${d}&projectId=${m}`)).json()).map(J=>J.profession);H(M)}catch(l){console.error("Error loading professions:",l),F({type:"danger",text:"Error loading professions"})}},[d,m]),k=s.useCallback(async l=>{if(!l){S({1:null,2:null,3:null});return}try{console.log("Loading signatures for profession:",l),console.log("Selected profession SubjectMatterId:",l.SubjectMatterId),console.log("Searching with:",{companyId:d,projectId:m,subjectMatterId:l.SubjectMatterId});const M=await(await fetch(`${g}/get-static-report-signatures`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({companyId:d,projectId:m})})).json();console.log("ALL signatures for company/project:",M);const J=M.filter(ae=>ae.subjectMatterId===l.SubjectMatterId);console.log("Filtered by subjectMatterId:",J);const te={1:null,2:null,3:null};J.forEach(ae=>{console.log("Processing signature:",ae),te[ae.signatureType]=ae}),console.log("Organized signatures:",te),S(te)}catch(y){console.error("Error loading signatures:",y),F({type:"danger",text:"Error loading signatures"})}},[d,m]);s.useEffect(()=>{console.log("Modal useEffect triggered:",{show:j,companyId:d,projectId:m}),j&&d&&m&&(console.log("Loading professions..."),D(!0),N().finally(()=>D(!1)))},[j,d,m,N]),s.useEffect(()=>{u&&k(u)},[u,k]);const X=l=>{const y=U.find(M=>M._id===l);h(y),R("list")},se=s.useCallback((l,y)=>{console.log("Input change:",{field:l,value:y}),i(M=>{const J={...M,[l]:y};return console.log("New form data:",J),J})},[]),le=s.useCallback((l,y)=>{y&&p(M=>M[l]===y?M:{...M,[l]:y})},[]),ce=s.useCallback(l=>{c[l]&&c[l].clear()},[c]),ge=s.useCallback(async()=>{var l,y,M,J;if(console.log("Save signature called with:",{selectedProfession:u,formData:v,activeTab:I,companyId:d,projectId:m}),console.log("Form data details:",{name:v.name,nameLength:(l=v.name)==null?void 0:l.length,nameTrimmed:(y=v.name)==null?void 0:y.trim(),nameTrimmedLength:(J=(M=v.name)==null?void 0:M.trim())==null?void 0:J.length,description:v.description}),!u){F({type:"danger",text:"Please select a profession first"});return}if(!d||!m){F({type:"danger",text:"Missing company or project ID"});return}if(!v.name.trim()){F({type:"danger",text:"Name is required"});return}if(!c[I]){F({type:"danger",text:"Signature pad not ready. Please try again."});return}if(c[I].isEmpty()){F({type:"danger",text:"Signature is required"});return}O(!0),F(null);try{if(await new Promise(Ne=>setTimeout(Ne,200)),!c[I]){F({type:"danger",text:"Signature pad not ready. Please try again."});return}const te=c[I].toDataURL(),ae={companyId:d,projectId:m,subjectMatterId:u.SubjectMatterId,signatureType:I,name:v.name,description:v.description,profession:u._id,signature:te,signatureDate:new Date().toISOString()};console.log("Sending payload:",ae),console.log("Payload validation:",{companyId:!!d,projectId:!!m,signatureType:!!I,name:!!v.name,profession:!!u._id});const re=r[I],Pe=re?`${g}/update-static-report-signature/${re._id}`:`${g}/create-static-report-signature`,ve=await fetch(Pe,{method:re?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ae)});if(ve.ok)F({type:"success",text:`Signature ${I} ${re?"updated":"created"} successfully`}),await k(u),R("list"),i({name:"",description:"",signatureType:I}),c[I]&&c[I].clear();else{const Ne=await ve.json();F({type:"danger",text:Ne.error||"Error saving signature"})}}catch(te){console.error("Error saving signature:",te),F({type:"danger",text:"Error saving signature"})}finally{O(!1)}},[u,v,I,c,r,d,m,k]),fe=s.useCallback(async l=>{const y=r[l];if(y&&window.confirm(`Are you sure you want to delete Signature ${l}?`))try{const M=await fetch(`${g}/delete-static-report-signature/${y._id}`,{method:"DELETE"});if(M.ok)F({type:"success",text:`Signature ${l} deleted successfully`}),await k(u);else{const J=await M.json();F({type:"danger",text:J.error||"Error deleting signature"})}}catch(M){console.error("Error deleting signature:",M),F({type:"danger",text:"Error deleting signature"})}},[r,u,k]),de=s.useCallback(l=>{const y=r[l];ee(l),i({name:(y==null?void 0:y.name)||"",description:(y==null?void 0:y.description)||"",signatureType:l}),R("form"),setTimeout(()=>{c[l]&&c[l].clear()},100)},[r,c]),ue=s.useCallback(l=>{console.log("Adding signature for type:",l),console.log("Selected profession:",u),console.log("Company ID:",d),console.log("Project ID:",m),ee(l),i({name:"",description:"",signatureType:l}),R("form")},[u,d,m]),a=()=>e.jsx("div",{className:"mb-4",children:e.jsxs(he,{children:[e.jsx(pe,{children:"Select Profession"}),e.jsxs(ye,{as:"select",value:(u==null?void 0:u._id)||"",onChange:l=>X(l.target.value),children:[e.jsx("option",{value:"",children:"Choose a profession..."}),U.map(l=>e.jsxs("option",{value:l._id,children:[l.GroupName," (",l.SubjectMatterId,")"]},l._id))]})]})}),x=()=>u?e.jsxs("div",{children:[e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-3",children:e.jsxs("h5",{children:["Signatures for ",u.GroupName," (",u.SubjectMatterId,")"]})}),e.jsxs(Ee,{striped:!0,bordered:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Signature Type"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Subject Matter ID"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:[1,2,3].map(l=>{const y=r[l];return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs(Ue,{bg:y?"success":"secondary",children:["Signature ",l]})}),e.jsx("td",{children:y?y.name:"-"}),e.jsx("td",{children:y?y.description:"-"}),e.jsx("td",{children:y?y.subjectMatterId:"-"}),e.jsx("td",{children:y?new Date(y.signatureDate).toLocaleDateString():"-"}),e.jsx("td",{children:e.jsx("div",{className:"d-flex gap-2",children:y?e.jsxs(e.Fragment,{children:[e.jsx(E,{size:"sm",variant:"outline-primary",onClick:()=>de(l),children:"Edit"}),e.jsx(E,{size:"sm",variant:"outline-danger",onClick:()=>fe(l),children:"Delete"})]}):e.jsx(E,{size:"sm",variant:"success",onClick:()=>ue(l),children:"Add"})})})]},l)})})]})]}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{children:"Please select a profession to view signatures"})}),Q=()=>u?e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("h5",{children:["Signature ",I," - ",u.GroupName," (",u.SubjectMatterId,")"]}),e.jsx(E,{variant:"outline-secondary",onClick:()=>R("list"),children:"Back to List"})]}),e.jsxs(L,{children:[e.jsxs(K,{children:[e.jsx(z,{md:6,children:e.jsxs(he,{className:"mb-3",children:[e.jsx(pe,{children:"Name *"}),e.jsx(ye,{type:"text",value:v.name,onChange:l=>se("name",l.target.value),placeholder:"Enter name"})]})}),e.jsx(z,{md:6,children:e.jsxs(he,{className:"mb-3",children:[e.jsx(pe,{children:"Description"}),e.jsx(ye,{type:"text",value:v.description,onChange:l=>se("description",l.target.value),placeholder:"Enter description"})]})})]}),e.jsxs(he,{className:"mb-3",children:[e.jsx(pe,{children:"Signature *"}),e.jsx(ie,{children:e.jsxs(os,{children:[e.jsx(ds,{ref:l=>le(I,l),canvasProps:{width:500,height:200,className:"signature-canvas"}},`signature-pad-${I}`),e.jsx("div",{className:"mt-2",children:e.jsx(E,{size:"sm",variant:"outline-secondary",onClick:()=>ce(I),children:"Clear"})})]})})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(E,{variant:"primary",onClick:ge,disabled:C,children:C?e.jsx(Te,{size:"sm"}):"Save Signature"}),e.jsx(E,{variant:"outline-secondary",onClick:()=>R("list"),children:"Cancel"})]})]})]}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{children:"Please select a profession first"})});return W?e.jsxs(e.Fragment,{children:[e.jsx(Te,{animation:"border"}),e.jsx("p",{className:"mt-2",children:"Loading..."})]}):e.jsxs(e.Fragment,{children:[$&&e.jsx(Oe,{variant:$.type,className:"mb-3",children:$.text}),a(),A==="list"?x():Q()]})},Xs=({show:j,onHide:f,companyId:d,projectId:m})=>{console.log("QualityAssuranceSignaturesModal props:",{show:j,companyId:d,projectId:m});const[o,u]=s.useState(null),[h,r]=s.useState(null),[S,v]=s.useState({name:"",description:""}),[i,c]=s.useState(null),[p,U]=s.useState([]),[H,W]=s.useState(!1),[D,C]=s.useState(!1),[O,$]=s.useState(null),[F,A]=s.useState("list"),R=s.useCallback(async()=>{try{console.log("Loading professions for project:",{companyId:d,projectId:m});const x=await(await fetch(`${g}/get-project-professions?companyId=${d}&projectId=${m}`)).json();console.log("Project professions response:",x),U(x)}catch(a){console.error("Error loading professions:",a),$({type:"danger",text:"Error loading professions"})}},[d,m]),I=s.useCallback(async a=>{if(!a){r(null);return}try{console.log("Loading signature for profession:",a);const Q=await(await fetch(`${g}/get-quality-assurance-signature`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({companyId:d,projectId:m,subjectMatterId:a.SubjectMatterId||a._id})})).json();console.log("Signature response:",Q),r(Q.length>0?Q[0]:null)}catch(x){console.error("Error loading signature:",x),$({type:"danger",text:"Error loading signature"})}},[d,m]);s.useEffect(()=>{console.log("Modal useEffect triggered:",{show:j,companyId:d,projectId:m}),j&&d&&m&&(console.log("Loading professions..."),W(!0),R().finally(()=>W(!1)))},[j,d,m,R]),s.useEffect(()=>{o&&I(o)},[o,I]);const ee=a=>{const x=p.find(Q=>Q._id===a);u(x),A("list")},N=s.useCallback((a,x)=>{console.log("Input change:",{field:a,value:x}),v(Q=>{const l={...Q,[a]:x};return console.log("New form data:",l),l})},[]),k=s.useCallback(a=>{a&&c(x=>x===a?x:a)},[]),X=s.useCallback(()=>{i&&i.clear()},[i]),se=s.useCallback(async()=>{var a,x,Q,l;if(console.log("Save signature called with:",{selectedProfession:o,formData:S,companyId:d,projectId:m}),console.log("Form data details:",{name:S.name,nameLength:(a=S.name)==null?void 0:a.length,nameTrimmed:(x=S.name)==null?void 0:x.trim(),nameTrimmedLength:(l=(Q=S.name)==null?void 0:Q.trim())==null?void 0:l.length,description:S.description}),!o){$({type:"danger",text:"Please select a profession first"});return}if(!d||!m){$({type:"danger",text:"Missing company or project ID"});return}if(!S.name.trim()){$({type:"danger",text:"Name is required"});return}if(!i){$({type:"danger",text:"Signature pad not ready. Please try again."});return}if(i.isEmpty()){$({type:"danger",text:"Signature is required"});return}C(!0),$(null);try{if(await new Promise(re=>setTimeout(re,200)),!i){$({type:"danger",text:"Signature pad not ready. Please try again."});return}const y=i.toDataURL(),M={companyId:d,projectId:m,professionId:o._id,subjectMatterId:o.SubjectMatterId||o._id,professionName:o.name||o.GroupName,name:S.name,description:S.description,profession:o._id,signature:y,signatureDate:new Date().toISOString()};console.log("Sending payload:",M),console.log("Payload validation:",{companyId:!!d,projectId:!!m,professionId:!!o._id,name:!!S.name,profession:!!o._id});const J=h?`${g}/update-quality-assurance-signature/${h._id}`:`${g}/create-quality-assurance-signature`,ae=await fetch(J,{method:h?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(M)});if(ae.ok)$({type:"success",text:`Signature ${h?"updated":"created"} successfully`}),await I(o),A("list"),v({name:"",description:""}),i&&i.clear();else{const re=await ae.json();$({type:"danger",text:re.error||"Error saving signature"})}}catch(y){console.error("Error saving signature:",y),$({type:"danger",text:"Error saving signature"})}finally{C(!1)}},[o,S,i,h,d,m,I]),le=s.useCallback(async()=>{if(h&&window.confirm("Are you sure you want to delete this signature?"))try{const a=await fetch(`${g}/delete-quality-assurance-signature/${h._id}`,{method:"DELETE"});if(a.ok)$({type:"success",text:"Signature deleted successfully"}),await I(o);else{const x=await a.json();$({type:"danger",text:x.error||"Error deleting signature"})}}catch(a){console.error("Error deleting signature:",a),$({type:"danger",text:"Error deleting signature"})}},[h,o,I]),ce=s.useCallback(()=>{h&&(v({name:h.name||"",description:h.description||""}),A("form"),setTimeout(()=>{i&&i.clear()},100))},[h,i]),ge=s.useCallback(()=>{console.log("Adding signature"),console.log("Selected profession:",o),console.log("Company ID:",d),console.log("Project ID:",m),v({name:"",description:""}),A("form")},[o,d,m]),fe=()=>e.jsx("div",{className:"mb-4",children:e.jsxs(he,{children:[e.jsx(pe,{children:"Select Profession"}),e.jsxs(ye,{as:"select",value:(o==null?void 0:o._id)||"",onChange:a=>ee(a.target.value),children:[e.jsx("option",{value:"",children:"Choose a profession..."}),p.map(a=>e.jsxs("option",{value:a._id,children:[a.name||a.GroupName," (",a.SubjectMatterId||a._id,")"]},a._id))]})]})}),de=()=>o?e.jsxs("div",{children:[e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-3",children:e.jsxs("h5",{children:["Signature for ",o.name||o.GroupName]})}),e.jsxs(Ee,{striped:!0,bordered:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(Ue,{bg:h?"success":"secondary",children:h?"Signed":"Not Signed"})}),e.jsx("td",{children:h?h.name:"-"}),e.jsx("td",{children:h?h.description:"-"}),e.jsx("td",{children:h?new Date(h.signatureDate).toLocaleDateString():"-"}),e.jsx("td",{children:e.jsx("div",{className:"d-flex gap-2",children:h?e.jsxs(e.Fragment,{children:[e.jsx(E,{size:"sm",variant:"outline-primary",onClick:ce,children:"Edit"}),e.jsx(E,{size:"sm",variant:"outline-danger",onClick:le,children:"Delete"})]}):e.jsx(E,{size:"sm",variant:"success",onClick:ge,children:"Add"})})})]})})]})]}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{children:"Please select a profession to view signature"})}),ue=()=>o?e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("h5",{children:["Signature - ",o.name||o.GroupName]}),e.jsx(E,{variant:"outline-secondary",onClick:()=>A("list"),children:"Back to List"})]}),e.jsxs(L,{children:[e.jsxs(K,{children:[e.jsx(z,{md:6,children:e.jsxs(he,{className:"mb-3",children:[e.jsx(pe,{children:"Name *"}),e.jsx(ye,{type:"text",value:S.name,onChange:a=>N("name",a.target.value),placeholder:"Enter name"})]})}),e.jsx(z,{md:6,children:e.jsxs(he,{className:"mb-3",children:[e.jsx(pe,{children:"Description"}),e.jsx(ye,{type:"text",value:S.description,onChange:a=>N("description",a.target.value),placeholder:"Enter description"})]})})]}),e.jsxs(he,{className:"mb-3",children:[e.jsx(pe,{children:"Signature *"}),e.jsx(ie,{children:e.jsxs(os,{children:[e.jsx(ds,{ref:k,canvasProps:{width:500,height:200,className:"signature-canvas"}},"quality-assurance-signature-pad"),e.jsx("div",{className:"mt-2",children:e.jsx(E,{size:"sm",variant:"outline-secondary",onClick:X,children:"Clear"})})]})})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(E,{variant:"primary",onClick:se,disabled:D,children:D?e.jsx(Te,{size:"sm"}):"Save Signature"}),e.jsx(E,{variant:"outline-secondary",onClick:()=>A("list"),children:"Cancel"})]})]})]}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{children:"Please select a profession first"})});return H?e.jsxs(e.Fragment,{children:[e.jsx(Te,{animation:"border"}),e.jsx("p",{className:"mt-2",children:"Loading..."})]}):e.jsxs(e.Fragment,{children:[O&&e.jsx(Oe,{variant:O.type,className:"mb-3",children:O.text}),fe(),F==="list"?de():ue()]})};function Ys(){const j=bs(),[f,d]=vs(),{setClickTask:m,selectedProfessionKey:o,setSelectedProfessionKey:u}=s.useContext(is),{loading:h,setLoading:r}=ls(),[S,v]=s.useState({"Any Report":!0,"Quality Assurance":!1,"Static Report":!1,"Final Report":!1}),{companyId:i,projectId:c}=oe(),[p,U]=s.useState(()=>f.get("report")||"Address Notes"),[H,W]=s.useState([]),[D,C]=s.useState([]),[O,$]=s.useState([]),[F,A]=s.useState([]),[R,I]=s.useState([]),[ee,N]=s.useState([]),[k,X]=s.useState([]),[se,le]=s.useState([]),[ce,ge]=s.useState([]),[fe,de]=s.useState([]),[ue,a]=s.useState([]),[x,Q]=s.useState([]),[l,y]=s.useState([]),[M,J]=s.useState([]),[te,ae]=s.useState([]),[re,Pe]=s.useState([]),[Ie,ve]=s.useState([]),[Ne,us]=s.useState([]),[ms,Ge]=s.useState(!1),[hs,_e]=s.useState(!1),[me,je]=s.useState([]),[we,rt]=s.useState(""),[be,Be]=s.useState("DK"),[Ce,De]=s.useState([]),G=o||we;s.useEffect(()=>{we&&u(we)},[we,u]),s.useEffect(()=>{const t=f.get("report");if(t&&t!==p){U(t);const n=Object.keys(Se).find(b=>Se[b].includes(t));n&&v(b=>({...b,[n]:!0}))}},[f,p]);const ps=t=>{v(n=>{const b=!n[t];return Object.keys(n).reduce((P,_)=>(P[_]=_===t?b:!1,P),{})})},$e=t=>{if(U(t),d({report:t}),t==="Static Report Signatures"){Ge(!0);return}if(t==="Quality Assurance Signatures"){_e(!0);return}const n=Object.keys(Se).find(b=>Se[b].includes(t));n&&v(b=>({...b,[n]:!0}))},Se={"Any Report":["Address Notes","New Agreement","Saftey Mention","Technical Request"],"Quality Assurance":["CONTROLPLAN","Supervision note Report","Deviation In Quality Assurance","Name and Signature","Quality Assurance Signatures"],"Static Report":["Static Document Checklist","Static Report Registration","Static control plan","Deviation In Static Report","Special Control Point","Static Report Signatures"],"Final Report":[]},ze=async()=>{try{r(!0);const n=await(await fetch(`${g}/get-notes?companyId=${i}&projectId=${c}`)).json();W(n)}catch(t){console.error("Error fetching workers:",t)}finally{r(!1)}},qe=async()=>{try{r(!0);const n=await(await fetch(`${g}/get-news?companyId=${i}&projectId=${c}`)).json();C(n)}catch(t){console.error("Error fetching workers:",t)}finally{r(!1)}},He=async()=>{try{r(!0);const n=await(await fetch(`${g}/get-mentions?companyId=${i}&projectId=${c}`)).json();$(n)}catch(t){console.error("Error fetching workers:",t)}finally{r(!1)}},Qe=async()=>{try{r(!0);const n=await(await fetch(`${g}/get-requests?companyId=${i}&projectId=${c}`)).json();A(n)}catch(t){console.error("Error fetching workers:",t)}finally{r(!1)}},Le=async()=>{var t,n;try{r(!0);const P=await(await fetch(`${g}/get-project-detail`,{method:"POST",body:JSON.stringify({projectId:c}),headers:{"Content-Type":"application/json"}})).json(),_=[...new Set(((t=P==null?void 0:P.tasks)==null?void 0:t.map(Y=>Y.SubjectMatterId).filter(Y=>Y!=null))||[])],T=new URLSearchParams;T.append("companyId",i),T.append("projectId",c),_.forEach(Y=>T.append("SubjectMatterId[]",Y));const q=await(await fetch(`${g}/get-company-professions?${T}`)).json();je(q),u((n=q==null?void 0:q[0])==null?void 0:n.SubjectMatterId),N((P==null?void 0:P.tasks)||[]),_.length>0&&Ze(_[0])}catch(b){console.error("Error fetching task:",b)}finally{r(!1)}},Je=async()=>{try{r(!0);const n=await(await fetch(`${g}/get-supers?companyId=${i}&projectId=${c}`)).json();X(n)}catch(t){console.error("Error fetching workers:",t)}finally{r(!1)}},Ve=async()=>{try{r(!0);const n=await(await fetch(`${g}/get-deviations?companyId=${i}&projectId=${c}&type=Quality Assurance`)).json();le(n)}catch(t){console.error("Error fetching workers:",t)}finally{r(!1)}},Ke=async()=>{try{r(!0);const n=await(await fetch(`${g}/get-deviations?companyId=${i}&projectId=${c}&type=Static Report`)).json();ge(n)}catch(t){console.error("Error fetching workers:",t)}finally{r(!1)}},We=async()=>{try{r(!0);const n=await(await fetch(`${g}/get-special-control?companyId=${i}&projectId=${c}`)).json();de(n)}catch(t){console.error("Error fetching workers:",t)}finally{r(!1)}},Xe=async()=>{var t;try{r(!0);const b=await(await fetch(`${g}/get-project-detail`,{method:"POST",body:JSON.stringify({projectId:c}),headers:{"Content-Type":"application/json"}})).json();if(b!=null&&b.professionAssociatedData){const P=b.professionAssociatedData;Q(P);const _=Object.keys(P),T=_[0];je(_),u(T);const w=((t=P[T])==null?void 0:t.staticDocumentCheckList)||[];a(w),w.length>0&&c?(console.log("Calling fetchSubmittedStatus from staticDocumentChecklistTableApi..."),Ye(T,w)):console.log("Not calling fetchSubmittedStatus from staticDocumentChecklistTableApi - conditions not met:",{checklistDataLength:w.length,projectId:c})}else{const P=`${g}/get-checklist`,T=await(await fetch(P)).json();a(T==null?void 0:T.data)}}catch(n){console.error("Error fetching workers:",n)}finally{r(!1)}};s.useEffect(()=>{G&&p==="Static Document Checklist"&&gs(G),G&&p==="Static Report Registration"&&fs(G),G&&p==="CONTROLPLAN"&&Ze(G)},[G,ee,x]);const gs=t=>{var b;console.log("fetchChecklistForProfession called with key:",t);const n=((b=x==null?void 0:x[t])==null?void 0:b.staticDocumentCheckList)||[];console.log("checklistData length:",n.length),a(n),u(t),n.length>0&&c?(console.log("Calling fetchSubmittedStatus..."),Ye(t,n)):console.log("Not calling fetchSubmittedStatus - conditions not met:",{checklistDataLength:n.length,projectId:c})},Ye=async(t,n)=>{var b;try{console.log("fetchSubmittedStatus called with:",{professionKey:t,checklistDataLength:n.length,projectId:c});const P=x==null?void 0:x[t];console.log("professionData:",P);const _=(P==null?void 0:P.SubjectMatterId)||((b=P==null?void 0:P.profession)==null?void 0:b.SubjectMatterId);if(console.log("professionId (SubjectMatterId):",_),!_){console.log("No profession SubjectMatterId found, returning early");return}const T=n.map(ne=>ne._id);console.log("checklistIds:",T);const w=`${g}/check-static-document-checklist-status?projectId=${c}&professionId=${_}&checklistIds=${JSON.stringify(T)}`;console.log("Making API call to:",w);const Y=await(await fetch(w)).json();console.log("API response:",Y),Y.success&&(y(Y.submittedChecklistIds),console.log("Set submittedChecklistIds:",Y.submittedChecklistIds))}catch(P){console.error("Error fetching submitted status:",P)}},fs=t=>{var b;const n=((b=te==null?void 0:te[t])==null?void 0:b.staticReportRegistration)||[];J(n),u(t)},Ze=t=>{const n=ee.filter(b=>b.SubjectMatterId&&t&&b.SubjectMatterId.toLowerCase()===t.toLowerCase());I(n),u(t)},Ae=async()=>{try{if(r(!0),me.length===0||Ce.length===0)try{const w=await(await fetch(`${g}/get-project-detail/${c}`)).json();if(w!=null&&w.professionAssociatedData){const q=Object.keys(w.professionAssociatedData).map(ne=>{const V=w.professionAssociatedData[ne];return console.log("=== EXTRACTING PROFESSION DATA ==="),console.log("Profession key:",ne),console.log("Raw profession data:",V),console.log("All keys in profData:",Object.keys(V)),console.log("EuroCode field (EuroCode):",V.EuroCode),console.log("EuroCode field (euroCode):",V.euroCode),console.log("EuroCode field (eurocode):",V.eurocode),console.log("EuroCode field (Eurocode):",V.Eurocode),console.log("=== END EXTRACTING ==="),{name:ne,SubjectMatterId:V.SubjectMatterId||V.subjectMatterId||ne,GroupName:V.GroupName||V.groupName||ne,euroCode:V.EuroCode||V.euroCode||V.eurocode||V.Eurocode||[]}});console.log("=== LOADING PROJECT PROFESSIONS ==="),console.log("Raw project data:",w.professionAssociatedData),console.log("Extracted project professions:",q),console.log("Sample profession structure:",q[0]),console.log("=== END LOADING PROJECT PROFESSIONS ==="),De(q);const Y=q.map(ne=>ne.name);je(Y),Y.length>0&&!G&&u(Y[0])}else{const ne=(await(await fetch(`${g}/get-company-professions?companyId=${i}`)).json()).map(xe=>({...xe,euroCode:xe.EuroCode||xe.euroCode||[]}));De(ne);const V=ne.map(xe=>xe.name||xe.professionName||xe._id);je(V),V.length>0&&!G&&u(V[0])}}catch(T){console.error("Error loading professions:",T)}const t=new URLSearchParams;let n=null;G&&(n=Ce.find(T=>(T.name||T.professionName||T._id)===G),console.log("=== DEBUGGING PROFESSION SELECTION ==="),console.log("Selected profession key:",G),console.log("Found profession data:",n),console.log("=== COMPLETE PROFESSION OBJECT ==="),console.log("Complete profession object (JSON):",JSON.stringify(n,null,2)),console.log("Complete profession object (console):",n),console.log("=== END COMPLETE OBJECT ==="),console.log("All available professions:",Ce),console.log("Profession data keys:",n?Object.keys(n):"No profession found"),n!=null&&n.euroCode&&n.euroCode.length>0?(console.log("✅ EuroCode found:",n.euroCode),console.log("EuroCode type:",typeof n.euroCode),console.log("EuroCode length:",n.euroCode.length)):(console.log("❌ No euroCode found for profession:",G),console.log("Available fields in profession:",n?Object.keys(n):"No profession"),console.log("EuroCode field value:",n==null?void 0:n.euroCode),console.log("Using empty euroCode array as fallback")),console.log("=== END DEBUGGING ==="));const b={subjectMatterId:(n==null?void 0:n.SubjectMatterId)||G,language:be,projectId:c};console.log("POST body:",b);const _=await(await fetch(`${g}/get-controls-of-static-report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)})).json();if(console.log("API Response received:",_),_.entries&&Array.isArray(_.entries)){const T=_.entries.map((w,q)=>({_id:w._id||`entry_${q}`,pos:w.pos||"N/A",checkingThe:w.checkingThe||"N/A",subject:w.subject||"N/A",constructionPart:w.constructionPart||"N/A",basis:w.basis||"N/A",controlMethod:w.controlMethod||"N/A",circumference:w.circumference||"N/A",acceptanceCriteria:w.acceptanceCriteria||"N/A",time:w.time||"N/A",rowIndex:w.rowIndex||"N/A",language:be,subjectMatterId:(n==null?void 0:n.SubjectMatterId)||G,entries:[w]}));console.log("Transformed data:",T),J(T)}else console.error("Invalid API response format:",_),J([])}catch(t){console.error("Error fetching static report registration:",t),J([])}finally{r(!1)}},es=async()=>{try{r(!0);const n=await(await fetch(`${g}/get-gammas?companyId=${i}&projectId=${c}`)).json();Pe(n)}catch(t){console.error("Error fetching workers:",t)}finally{r(!1)}},xs=async(t,n)=>{try{r(!0);const b={taskId:t,projectId:c,isActive:n};(await fetch(`${g}/approv-task`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)})).ok&&await Le()}catch(b){console.error("Error fetching workers:",b)}finally{r(!1)}},ss=async()=>{try{r(!0);const n=await(await fetch(`${g}/get-signatures?companyId=${i}&projectId=${c}`)).json();ve(n)}catch(t){console.error("Error fetching signatures:",t)}finally{r(!1)}},js=async()=>{try{r(!0);const n=await(await fetch(`${g}/get-name-signatures?companyId=${i}&projectId=${c}`)).json();us(n)}catch(t){console.error("Error fetching name signatures:",t)}finally{r(!1)}},Ss=async t=>{t==="Address Notes"&&await ze(),t==="New Agreement"&&await qe(),t==="Saftey Mention"&&await He(),t==="Technical Request"&&await Qe(),t==="CONTROLPLAN"&&await Le(),t==="Supervision note Report"&&await Je(),t==="Deviation In Quality Assurance"&&await Ve(),t==="Name and Signature"&&await js(),t==="Deviation In Static Report"&&await Ke(),t==="Special Control Point"&&await We(),t==="Static Document Checklist"&&await Xe(),t==="Static Report Registration"&&await Ae(),t==="Static control plan"&&await es()};s.useEffect(()=>{p&&(p==="Signatures"?ss():Ss(p)),m(null)},[p]),s.useEffect(()=>{p==="Static Report Registration"&&(G||be)&&Ae()},[G,be]),s.useEffect(()=>{i&&c&&me.length===0&&(async()=>{try{const b=await(await fetch(`${g}/get-project-detail/${c}`)).json();if(b!=null&&b.professionAssociatedData){const P=Object.keys(b.professionAssociatedData).map(T=>{const w=b.professionAssociatedData[T];return{name:T,SubjectMatterId:w.SubjectMatterId||w.subjectMatterId,GroupName:w.GroupName||w.groupName,euroCode:w.EuroCode||w.euroCode||[]}});De(P);const _=P.map(T=>T.name);je(_),_.length>0&&!G&&u(_[0])}else{const T=(await(await fetch(`${g}/get-company-professions?companyId=${i}`)).json()).map(q=>({...q,euroCode:q.EuroCode||q.euroCode||[]}));De(T);const w=T.map(q=>q.name||q.professionName||q._id);je(w),w.length>0&&!G&&u(w[0])}}catch(n){console.error("Error loading professions:",n)}})()},[i,c]);const ys=()=>{if(p==="Signatures")return Ie?e.jsx(Rs,{refreshData:ss,signatures:Ie,selectedReport:p}):null;if(p==="Special Text")return e.jsx(Ks,{});switch(p){case"Address Notes":return H?e.jsx(Ds,{refreshData:ze,notes:H,selectedReport:p}):null;case"New Agreement":return D?e.jsx(As,{refreshData:qe,news:D,selectedReport:p}):null;case"Saftey Mention":return O?e.jsx(ks,{refreshData:He,mentions:O,selectedReport:p}):null;case"Technical Request":return F?e.jsx(Ts,{refreshData:Qe,requests:F,selectedReport:p}):null;case"CONTROLPLAN":return R?e.jsxs(e.Fragment,{children:[me.length>0&&e.jsx(ns,{options:me,getOptionLabel:t=>`${t.SubjectMatterId} ${t.GroupName}`,value:me.find(t=>t.SubjectMatterId===G)||null,onChange:(t,n)=>{u(n==null?void 0:n.SubjectMatterId)},disableClearable:!0,renderInput:t=>e.jsx(rs,{...t,label:"Select Profession",variant:"outlined",size:"small"}),style:{maxWidth:300,marginBottom:20}}),e.jsx(Es,{refreshData:Le,tasks:R,navigate:j,options:{showSubmitAction:!0,setClickTask:m,aprovedTask:xs},projectId:c,selectedReport:p})]}):null;case"Supervision note Report":return k?e.jsx(Ps,{refreshData:Je,supers:k,selectedReport:p}):null;case"Deviation In Quality Assurance":return se?e.jsx(ts,{refreshData:Ve,deviations:se,selectedReport:p}):null;case"Name and Signature":return e.jsx(Vs,{});case"Deviation In Static Report":return ce?e.jsx(ts,{refreshData:Ke,deviations:ce,selectedReport:p}):null;case"Special Control Point":return ce?e.jsx(Js,{refreshData:We,specialControle:fe,selectedReport:p}):null;case"Static Document Checklist":return ue?e.jsxs(e.Fragment,{children:[me.length>0&&e.jsx(ns,{options:me,value:G,onChange:(t,n)=>{u(n)},disableClearable:!0,renderInput:t=>e.jsx(rs,{...t,label:"Select Profession",variant:"outlined",size:"small"}),style:{maxWidth:300,marginBottom:20}}),e.jsx($s,{refreshData:Xe,checkList:ue,navigate:j,options:{showSubmitAction:!0,submittedChecklistIds:l},selectedReport:p})]}):null;case"Static Report Registration":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"alert alert-info mb-3",children:[e.jsx("strong",{children:"Debug Info:"}),e.jsx("br",{}),"Company ID: ",i||"Not found",e.jsx("br",{}),"Project ID: ",c||"Not found",e.jsx("br",{}),"Loading: ",h?"Yes":"No",e.jsx("br",{}),"Selected Profession: ",G||"None",e.jsx("br",{}),"Professions Data: ",Ce.length," items",e.jsx("br",{}),"Static Report Data: ",M?M.length:"No data"," items",e.jsx("br",{}),e.jsx("strong",{children:"Status:"})," IDs are being passed to StaticReportRegistration component"]}),M?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card mb-4",children:[e.jsx("div",{className:"card-header",children:e.jsx("h6",{className:"mb-0",children:"Filters"})}),e.jsx("div",{className:"card-body",children:e.jsxs(K,{children:[e.jsx(z,{md:4,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Profession"}),e.jsxs("select",{className:"form-select",value:G||"",onChange:t=>u(t.target.value),children:[e.jsx("option",{value:"",children:"All Professions"}),me.map(t=>e.jsx("option",{value:t,children:t},t))]})]})}),e.jsx(z,{md:4,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Language"}),e.jsxs("select",{className:"form-select",value:be,onChange:t=>Be(t.target.value),children:[e.jsx("option",{value:"DK",children:"Danish (DK)"}),e.jsx("option",{value:"EN",children:"English (EN)"})]})]})}),e.jsx(z,{md:4,className:"d-flex align-items-end",children:e.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>{u(""),Be("")},children:"Clear Filters"})})]})})]}),e.jsx(Ls,{refreshData:Ae,staticsReport:M,navigate:j,options:{showSubmitAction:!0},selectedReport:p,companyId:i,projectId:c})]}):e.jsxs("div",{className:"alert alert-warning",children:[e.jsx("strong",{children:"No static report data available."}),e.jsx("br",{}),h?"Loading...":'Click "Refresh Data" to load data.',e.jsx("button",{className:"btn btn-primary ms-3",onClick:Ae,disabled:h,children:h?"Loading...":"Refresh Data"})]})]});case"Static control plan":return re?e.jsx(Fs,{refreshData:es,gammas:re,selectedReport:p}):null;case"Static Report Signatures":return e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsx("div",{className:"text-center",children:e.jsx(Ws,{show:ms,onHide:()=>Ge(!1),companyId:i,projectId:c,subjectMatterId:G})})});case"Quality Assurance Signatures":return e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsx("div",{className:"text-center",children:e.jsx(Xs,{show:hs,onHide:()=>_e(!1),companyId:i,projectId:c})})});default:return e.jsxs("p",{children:["Content for ",p," will be displayed here."]})}};return console.log("selectedProfessionKey",G),e.jsxs("div",{children:[e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-3",children:e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",children:"Reports"}),e.jsx("p",{className:"text-muted mb-0",children:"All profession are listed below"})]})}),e.jsx("hr",{className:"my-3"}),e.jsxs(K,{children:[e.jsx(z,{md:3,className:"border-end",children:e.jsxs("div",{className:"nav flex-column bg-light p-3 rounded",children:[Object.keys(Se).map(t=>e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex align-items-center bg-light text-primary rounded p-2",onClick:()=>ps(t),style:{cursor:"pointer"},children:[e.jsx(ke,{icon:Fe,className:"me-2 text-primary"}),e.jsx("span",{className:"flex-grow-1",children:t}),e.jsx(ke,{icon:S[t]?ws:Cs,className:"ms-auto"})]}),e.jsx(Ms,{in:S[t],children:e.jsx("div",{className:"ps-4 ms-2 border-start border-2 mt-2",children:Se[t].map(n=>e.jsx("div",{className:`py-2 ps-3 ${p===n?"bg-light text-primary fw-medium":"text-secondary"}`,onClick:()=>$e(n),style:{cursor:"pointer"},children:n},n))})})]},t)),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:`d-flex align-items-center bg-light rounded p-2 ${p==="Signatures"?"text-primary fw-medium":"text-secondary"}`,onClick:()=>$e("Signatures"),style:{cursor:"pointer"},children:[e.jsx(ke,{icon:Fe,className:"me-2"}),e.jsx("span",{className:"flex-grow-1",children:"Signatures"})]})}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:`d-flex align-items-center bg-light rounded p-2 ${p==="Special Text"?"text-primary fw-medium":"text-secondary"}`,onClick:()=>$e("Special Text"),style:{cursor:"pointer"},children:[e.jsx(ke,{icon:Fe,className:"me-2"}),e.jsx("span",{className:"flex-grow-1",children:"Special Text"})]})})]})}),e.jsx(z,{md:9,children:p?e.jsx("div",{children:ys()}):e.jsx("div",{className:"d-flex align-items-center justify-content-center h-100",children:e.jsx("p",{className:"text-muted",children:"Select a report type from the sidebar to view details"})})})]})]})}function Zs(){const{companyId:j,projectId:f}=oe(),[d,m]=s.useState([]),[o,u]=s.useState(""),h=async()=>{try{const S=await(await fetch(`${g}/get-draws?companyId=${j}&projectId=${f}`)).json();m(S)}catch(r){console.error("Error fetching workers:",r)}};return s.useEffect(()=>{h()},[]),e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",children:"Drawing"}),e.jsx("p",{className:"text-muted mb-0",children:"All Drawing that are in this project are listed below"})]}),e.jsx("div",{className:"d-flex align-items-center",children:e.jsxs("div",{className:"d-flex align-items-center me-3",children:[e.jsx("label",{htmlFor:"tradeType",className:"text-nowrap me-2 mb-0",children:"Search"}),e.jsx("input",{type:"text",id:"tradeType",className:"form-control",value:o,onChange:r=>u(r.target.value),placeholder:"Search by project name"})]})})]}),e.jsx("hr",{className:"my-3"}),e.jsx(K,{children:e.jsx(z,{md:12,children:e.jsx(Us,{refreshData:h,draws:d,globalFilter:o})})})]})}function et(){const{companyId:j,projectId:f}=oe(),[d,m]=s.useState([]),[o,u]=s.useState(""),[h,r]=s.useState(!1),[S,v]=s.useState(!1),[i,c]=s.useState([]),[p,U]=s.useState(""),[H,W]=s.useState(""),[D,C]=s.useState(!1),[O,$]=s.useState(null),[F,A]=s.useState({show:!1,pdfFile:"",name:""}),[R,I]=s.useState({}),[ee,N]=s.useState(8),k=[{value:"contracts",label:"Contracts"},{value:"permits",label:"Permits"},{value:"specifications",label:"Specifications"},{value:"reports",label:"Reports"},{value:"certificates",label:"Certificates"},{value:"other",label:"Other"}],X=async()=>{try{const x=await(await fetch(`${g}/get-documents?companyId=${j}&projectId=${f}`)).json();m(x)}catch(a){console.error("Error fetching documents:",a)}};s.useEffect(()=>{X()},[j,f]);const se=a=>{const x=Array.from(a.target.files);c(x)},le=async()=>{if(i.length===0||!p){alert("Please select files and choose a category");return}v(!0);const a=new FormData;a.append("companyId",j),a.append("projectsId",f),a.append("category",p),a.append("description",H),i.forEach(x=>{a.append("documents",x)});try{(await fetch(`${g}/store-documents`,{method:"POST",body:a})).ok?(r(!1),c([]),U(""),W(""),X(),alert("Documents uploaded successfully!")):alert("Failed to upload documents")}catch(x){console.error("Upload error:",x),alert("Error uploading documents")}finally{v(!1)}},ce=a=>{const x=`${g}/uploads/${a.storedName}`,Q=a.originalName||"Document",l=Q.split(".").pop().toLowerCase();l==="pdf"?A({show:!0,pdfFile:x,name:Q}):(["jpg","jpeg","png","gif","bmp","webp"].includes(l),window.open(x,"_blank"))},ge=a=>{$(a),C(!0)},fe=async()=>{if(O)try{(await fetch(`${g}/delete-document/${O._id}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})).ok?(C(!1),$(null),X(),alert("Document deleted successfully!")):alert("Failed to delete document")}catch(a){console.error("Delete error:",a),alert("Error deleting document")}},de=d.filter(a=>{var x,Q,l;return((x=a.category)==null?void 0:x.toLowerCase().includes(o.toLowerCase()))||((Q=a.description)==null?void 0:Q.toLowerCase().includes(o.toLowerCase()))||((l=a.originalName)==null?void 0:l.toLowerCase().includes(o.toLowerCase()))}),ue=a=>({contracts:"primary",permits:"success",specifications:"info",reports:"warning",certificates:"danger",other:"secondary"})[a]||"secondary";return e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",children:"Documents"}),e.jsx("p",{className:"text-muted mb-0",children:"All documents uploaded to this project are listed below"})]}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{className:"d-flex align-items-center me-3",children:[e.jsx("label",{htmlFor:"searchDocuments",className:"text-nowrap me-2 mb-0",children:"Search"}),e.jsx("input",{type:"text",id:"searchDocuments",className:"form-control",value:o,onChange:a=>u(a.target.value),placeholder:"Search documents..."})]}),e.jsxs(E,{variant:"primary",onClick:()=>r(!0),className:"d-flex align-items-center",children:[e.jsx(Z,{icon:"mdi:upload",className:"me-2"}),"Upload Documents"]})]})]}),e.jsx("hr",{className:"my-3"}),e.jsx(ie,{children:e.jsx(ie.Body,{children:e.jsxs(Ee,{responsive:!0,striped:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Document Name"}),e.jsx("th",{children:"Category"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Upload Date"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:de.length>0?de.map((a,x)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(Z,{icon:"mdi:file-document",className:"me-2 text-primary"}),a.originalName||"Untitled Document"]})}),e.jsx("td",{children:e.jsx(Ue,{bg:ue(a.category),children:a.category||"Uncategorized"})}),e.jsx("td",{children:a.description||"No description"}),e.jsx("td",{children:a.uploadedAt?new Date(a.uploadedAt).toLocaleDateString():"Unknown"}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(E,{variant:"outline-info",size:"sm",onClick:()=>ce(a),title:"View Document",children:e.jsx(Z,{icon:"mdi:eye"})}),e.jsx(E,{variant:"outline-danger",size:"sm",onClick:()=>ge(a),title:"Delete Document",children:e.jsx(Z,{icon:"mdi:delete"})})]})})]},a._id||x)):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center text-muted",children:"No documents found"})})})]})})}),e.jsxs(B,{show:h,onHide:()=>r(!1),size:"lg",children:[e.jsx(B.Header,{closeButton:!0,children:e.jsx(B.Title,{children:"Upload Documents"})}),e.jsx(B.Body,{children:e.jsxs(L,{children:[e.jsxs(L.Group,{className:"mb-3",children:[e.jsx(L.Label,{children:"Document Category"}),e.jsxs(L.Select,{value:p,onChange:a=>U(a.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select a category"}),k.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]}),e.jsxs(L.Group,{className:"mb-3",children:[e.jsx(L.Label,{children:"Description (Optional)"}),e.jsx(L.Control,{as:"textarea",rows:3,value:H,onChange:a=>W(a.target.value),placeholder:"Enter document description..."})]}),e.jsxs(L.Group,{className:"mb-3",children:[e.jsx(L.Label,{children:"Select Files"}),e.jsx(L.Control,{type:"file",multiple:!0,onChange:se,accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png"}),e.jsx(L.Text,{className:"text-muted",children:"Supported formats: PDF, DOC, DOCX, TXT, JPG, JPEG, PNG"})]}),i.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:"Selected Files:"}),e.jsx("ul",{className:"list-unstyled",children:i.map((a,x)=>e.jsxs("li",{className:"text-muted",children:[e.jsx(Z,{icon:"mdi:file",className:"me-2"}),a.name," (",(a.size/1024/1024).toFixed(2)," MB)"]},x))})]})]})}),e.jsxs(B.Footer,{children:[e.jsx(E,{variant:"secondary",onClick:()=>r(!1),children:"Cancel"}),e.jsx(E,{variant:"primary",onClick:le,disabled:S||i.length===0||!p,children:S?e.jsxs(e.Fragment,{children:[e.jsx(Z,{icon:"mdi:loading",className:"me-2",spin:!0}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{icon:"mdi:upload",className:"me-2"}),"Upload Documents"]})})]})]}),e.jsxs(B,{show:D,onHide:()=>C(!1),children:[e.jsx(B.Header,{closeButton:!0,children:e.jsx(B.Title,{children:"Confirm Deletion"})}),e.jsxs(B.Body,{children:['Are you sure you want to delete the document "',O==null?void 0:O.originalName,'"? This action cannot be undone.']}),e.jsxs(B.Footer,{children:[e.jsx(E,{variant:"secondary",onClick:()=>C(!1),children:"Cancel"}),e.jsx(E,{variant:"danger",onClick:fe,children:"Yes, Delete"})]})]}),F.show&&e.jsx(Gs,{drawDotsOnPdf:F,setDrawDotsOnPdf:A,markers:R,setMarkers:I,dotSize:ee,setDotSize:N,readOnly:!0})]})}function st(){const{companyId:j,projectId:f}=oe(),[d,m]=s.useState([]),[o,u]=s.useState(""),h=async()=>{try{const O=await(await fetch(`${g}/get-project-detail`,{method:"POST",body:JSON.stringify({projectId:f}),headers:{"Content-Type":"application/json"}})).json();m(O==null?void 0:O.checks)}catch(C){console.error("Error fetching workers:",C)}};s.useEffect(()=>{h()},[]);const[r,S]=s.useState(!1),[v,i]=s.useState(null),[c,p]=s.useState(""),[U,H]=s.useState(!1),W=async C=>{i(C),p(""),S(!0)},D=async()=>{if(!c.trim()){alert("Please enter a note before approving");return}H(!0);try{const C={checkId:v,projectId:f,note:c.trim()};(await fetch(`${g}/submit-checklist`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(C)})).ok?(S(!1),i(null),p(""),h(),alert("Checklist approved successfully!")):alert("Failed to approve checklist")}catch(C){console.log("error",C),alert("Error approving checklist")}finally{H(!1)}};return e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",children:"Checklist"}),e.jsx("p",{className:"text-muted mb-0",children:"All Checklist that are in this project are listed below"})]}),e.jsx("div",{className:"d-flex align-items-center",children:e.jsxs("div",{className:"d-flex align-items-center me-3",children:[e.jsx("label",{htmlFor:"tradeType",className:"text-nowrap me-2 mb-0",children:"Search"}),e.jsx("input",{type:"text",id:"tradeType",className:"form-control",value:o,onChange:C=>u(C.target.value),placeholder:"Search by project name"})]})})]}),e.jsx("hr",{className:"my-3"}),e.jsx(K,{children:e.jsx(z,{md:12,children:e.jsx(_s,{refreshData:h,checks:d,globalFilter:o,aprovedCheckList:W,options:{showAprovedAction:!0}})})}),r&&e.jsx("div",{className:"modal fade show",style:{display:"block"},tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"mdi mdi-check-circle text-primary me-2"}),"Approve Checklist"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>S(!1)})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"approvalNote",className:"form-label",children:["Approval Note ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("textarea",{id:"approvalNote",className:"form-control",rows:"4",value:c,onChange:C=>p(C.target.value),placeholder:"Enter your approval note...",required:!0})]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>S(!1),disabled:U,children:"Cancel"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:D,disabled:U||!c.trim(),children:U?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status"}),"Approving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"mdi mdi-check-circle me-2"}),"Approve"]})})]})]})})}),r&&e.jsx("div",{className:"modal-backdrop fade show"})]})}function tt(){const{companyId:j,projectId:f}=oe(),[d,m]=s.useState([]),[o,u]=s.useState(""),h=async()=>{try{const S=await(await fetch(`${g}/get-plans?companyId=${j}&projectId=${f}`)).json();m(S)}catch(r){console.error("Error fetching workers:",r)}};return s.useEffect(()=>{h()},[]),e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",children:"Plans"}),e.jsx("p",{className:"text-muted mb-0",children:"All Plans that are in this project are listed below"})]}),e.jsx("div",{className:"d-flex align-items-center",children:e.jsxs("div",{className:"d-flex align-items-center me-3",children:[e.jsx("label",{htmlFor:"tradeType",className:"text-nowrap me-2 mb-0",children:"Search"}),e.jsx("input",{type:"text",id:"tradeType",className:"form-control",value:o,onChange:r=>u(r.target.value),placeholder:"Search by project name"})]})})]}),e.jsx("hr",{className:"my-3"}),e.jsx(K,{children:e.jsx(z,{md:12,children:e.jsx(Bs,{refreshData:h,plans:d,globalFilter:o})})})]})}const at=()=>{const{companyId:j,projectId:f}=oe(),[d,m]=s.useState([]),[o,u]=s.useState(""),h=async()=>{try{const S=await(await fetch(`${g}/get-company-professions?companyId=${j}&projectId=${f}`)).json();m(S)}catch(r){console.error("Error fetching workers:",r)}};return s.useEffect(()=>{h()},[]),e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",children:"Professions"}),e.jsx("p",{className:"text-muted mb-0",children:"All Professions list is listed below"})]}),e.jsx("div",{className:"d-flex align-items-center",children:e.jsxs("div",{className:"d-flex align-items-center me-3",children:[e.jsx("label",{htmlFor:"tradeType",className:"text-nowrap me-2 mb-0",children:"Search"}),e.jsx("input",{type:"text",id:"tradeType",className:"form-control",value:o,onChange:r=>u(r.target.value),placeholder:"Search by professions name"})]})})]}),e.jsx("hr",{className:"my-3"}),e.jsx(K,{children:e.jsx(z,{md:12,children:e.jsx(zs,{refreshData:h,professions:d,globalFilter:o})})})]})};function nt(){const{companyId:j,projectId:f}=oe(),[d,m]=s.useState([]),[o,u]=s.useState(""),h=async()=>{try{const S=await(await fetch(`${g}/get-schemes?companyId=${j}&projectId=${f}`)).json();m(S)}catch(r){console.error("Error fetching workers:",r)}};return s.useEffect(()=>{h()},[]),e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",children:"Certificate Schemes "}),e.jsx("p",{className:"text-muted mb-0",children:"All Certificate Schemes that are in this project are listed below"})]}),e.jsx("div",{className:"d-flex align-items-center",children:e.jsxs("div",{className:"d-flex align-items-center me-3",children:[e.jsx("label",{htmlFor:"tradeType",className:"text-nowrap me-2 mb-0",children:"Search"}),e.jsx("input",{type:"text",id:"tradeType",className:"form-control",value:o,onChange:r=>u(r.target.value),placeholder:"Search by project name"})]})})]}),e.jsx("hr",{className:"my-3"}),e.jsx(K,{children:e.jsx(z,{md:12,children:e.jsx(qs,{refreshData:h,schemes:d,globalFilter:o})})})]})}const Na=()=>{const{setLoading:j}=ls(),[f,d]=s.useState(null),{companyId:m,projectId:o}=oe(),{selectedProjectDetailPageTab:u,setSelectedProjectDetailPageTab:h,setSelectedCompany:r}=s.useContext(is);s.useEffect(()=>{r(m)},[m,o]);const S=[{id:"reports",label:"Reports",content:e.jsx(Ys,{})},{id:"users",label:"Users",content:e.jsx(Os,{})},{id:"drawingAndDocument",label:"Drawing",content:e.jsx(Zs,{})},{id:"documents",label:"Documents",content:e.jsx(et,{})},{id:"checkList",label:"Check List",content:e.jsx(st,{})},{id:"plans",label:"Plans",content:e.jsx(tt,{})},{id:"professions",label:"Professions",content:e.jsx(at,{})},{id:"certificateSchemes",label:"Certificate Schemes",content:e.jsx(nt,{})}];s.useEffect(()=>{(async()=>{if(o){j(!0);try{const p=await(await fetch(`${g}/get-project-detail/${o}`)).json();d(p)}catch(c){console.error("Error fetching project details:",c)}finally{j(!1)}}})()},[m,o]);const v=()=>{const i=S.find(c=>c.id===u);return i?i.content:null};return e.jsxs(e.Fragment,{children:[e.jsx(Ns,{title:(f==null?void 0:f.name)||"Project Details"}),e.jsx(K,{className:"justify-content-center",children:e.jsx(z,{lg:"12",children:e.jsxs(cs,{title:(f==null?void 0:f.name)||"Companies Name",children:[e.jsx(Me,{variant:"tabs",className:"custom-tabs mb-3",children:S.map(i=>e.jsx(Me.Item,{children:e.jsx(Me.Link,{active:u===i.id,onClick:()=>h(i.id),className:u===i.id?"fw-bold":"",children:i.label})},i.id))}),e.jsx("div",{className:"tab-content",children:e.jsx("div",{className:"tab-pane fade show active",children:v()})})]})})})]})};export{Na as default};
