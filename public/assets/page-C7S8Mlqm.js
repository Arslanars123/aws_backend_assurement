import{r as l,a as X,c as Y,b as Z,j as e,R as i,C as o}from"./index-Bhcfarzr.js";import{C as ee}from"./ComponentContainerCard-CdRpaZOK.js";import{P as se}from"./PageMetaData-D1yst4PP.js";import{B as m}from"./urls-BhGeBsON.js";import{D as te}from"./page-DsBsX5T8.js";import{F as p}from"./FormLabel-DMds24G0.js";import{F}from"./FormControl-7WYzlHOA.js";import{A as b,T as v,C as y}from"./TextField-Cu90f4AT.js";import{I as A}from"./Image-C3Ku7nKI.js";import{B as R}from"./Button-COOVOJrI.js";import"./Card-CWpROabE.js";import"./divWithClassName-DTdHczRx.js";import"./Modal-Bdr1VgJM.js";import"./useWindow-Bs6pFJHF.js";import"./DataKey-COGXBUcQ.js";import"./NoopTransition-f-8MxV6X.js";import"./FormRange-PkgODM1Q.js";import"./useSlot-B59Th0xZ.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-BcofISFZ.js";const ae={comment:"",profession:null,selectBuildingParts:null,selectedDrawing:null},Ce=()=>{var I,$;const[n,u]=l.useState(ae),k=X(),[B,E]=l.useState([]),[O,L]=l.useState(10),{setLoading:S}=Y(),[g,C]=l.useState([]),[j,N]=l.useState([]),[T,M]=l.useState([]),[U,z]=l.useState([]),[J,W]=l.useState([]),[x,P]=l.useState({show:!1,imgUrl:null}),[D,_]=l.useState(null),w=l.useRef(null),{companyId:f,projectId:h}=Z(),G=l.useRef(),H=t=>{const{name:s,value:r}=t.target;u({...n,[s]:r})};l.useEffect(()=>{const t=async()=>{try{const d=(await(await fetch(`${m}/get-gammas?companyId=${f}&projectId=${h}&point=yes`)).json()).map(Q=>Q.profession);M(d)}catch(a){console.error("Error fetching professions:",a)}},s=async()=>{try{const a=`${m}/get-parts`,d=await(await fetch(a)).json();z(d)}catch(a){console.log(a)}},r=async()=>{try{const c=await(await fetch(`${m}/get-draws?companyId=${f}&projectId=${h}`)).json();W(c)}catch(a){console.error("Error fetching workers:",a)}};s(),t(),r()},[]);const V=t=>{const s=Array.from(t.target.files),r=[...g,...s],a=[...j,...s.map(c=>URL.createObjectURL(c))];C(r),N(a)},q=t=>{const s=g.filter((c,d)=>d!==t),r=j.filter((c,d)=>d!==t);C(s),N(r);const a=new DataTransfer;s.forEach(c=>a.items.add(c)),w.current&&(w.current.files=a.files)},K=async t=>{t.preventDefault();try{S(!0);const s=new FormData;s.append("companyId",f),s.append("projectId",h),s.append("comment",n.comment),s.append("profession",JSON.stringify(n.profession)),s.append("buildingParts",JSON.stringify(n.selectBuildingParts)),s.append("drawing",JSON.stringify(n.selectedDrawing)),D&&s.append("annotatedImage",D),g.forEach(a=>{s.append("pictures",a)});const r=await fetch(`${m}/store-special-control`,{method:"POST",body:s});if(r.ok)k(`/dashboard/companies/view/${f}/projects/view/${h}`);else{const a=await r.json();alert(`Error: ${a.message||"Failed to update task."}`)}}catch(s){console.error("Fetch error:",s)}finally{S(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(se,{title:"Add Special Control"}),e.jsx("form",{onSubmit:K,children:e.jsx(i,{className:"justify-content-center",children:e.jsx(o,{children:e.jsx(ee,{title:"Add Special Control",children:e.jsxs(i,{children:[e.jsx(o,{lg:"6",children:e.jsxs(i,{className:"mb-3",children:[e.jsx(p,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Comment"}),e.jsx(o,{sm:"10",children:e.jsx(F,{value:n.comment,onChange:H,name:"comment",type:"text",id:"example-text-input"})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(i,{className:"mb-3",children:[e.jsx(p,{className:"col-sm-2 col-form-label text-end",children:"Select Profession"}),e.jsx(o,{sm:"10",children:e.jsx(b,{multiple:!1,options:T,getOptionLabel:t=>t.GroupName,value:n.profession??null,onChange:(t,s)=>{u({...n,profession:s})},renderInput:t=>e.jsx(v,{...t,variant:"outlined",placeholder:"Search and select worker..."}),renderTags:(t,s)=>t.map((r,a)=>e.jsx(y,{label:r.GroupName,...s({index:a})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(i,{className:"mb-3",children:[e.jsx(p,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Building Parts"}),e.jsx(o,{sm:"10",children:e.jsx(b,{multiple:!1,options:U,getOptionLabel:t=>t.name,value:n.selectBuildingParts,onChange:(t,s)=>{u({...n,selectBuildingParts:s})},renderInput:t=>e.jsx(v,{...t,variant:"outlined",placeholder:"Search and select building parts..."}),renderTags:(t,s)=>t.map((r,a)=>e.jsx(y,{label:r.name,...s({index:a})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(i,{className:"mb-3",children:[e.jsx(p,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Drawing"}),e.jsx(o,{sm:"10",children:e.jsx(b,{multiple:!1,options:J,getOptionLabel:t=>t.name,value:n==null?void 0:n.selectedDrawing,onChange:(t,s)=>{u({...n,selectedDrawing:s})},renderInput:t=>e.jsx(v,{...t,variant:"outlined",placeholder:"Search and select drawing..."}),renderTags:(t,s)=>t.map((r,a)=>e.jsx(y,{label:r.name,...s({index:a})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(o,{lg:"6",children:e.jsx(i,{className:"",children:($=(I=n==null?void 0:n.selectedDrawing)==null?void 0:I.pictures)==null?void 0:$.map((t,s)=>e.jsx("div",{className:"position-relative me-2 mb-2",children:e.jsx(A,{src:`${m}/uploads/${t}`,onClick:()=>{P({show:!0,imgUrl:`${m}/uploads/${t}`})},alt:`Existing Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}})},`existing-${s}`))})}),(x==null?void 0:x.show)&&e.jsx(o,{lg:"6",children:e.jsx(i,{children:e.jsx("div",{className:"position-relative",style:{maxWidth:"100%",height:"auto"},children:e.jsx(te,{ref:G,drawDotsOnImage:x,setDrawDotsAnImage:P,onSave:t=>{_(t)},setMarkers:E,markers:B,dotSize:O,setDotSize:L})})})}),e.jsx(o,{lg:"6",children:e.jsxs(i,{className:"mb-3",children:[e.jsx(p,{htmlFor:"multiple-file-input",className:"col-sm-2 col-form-label text-end",children:"Pictures"}),e.jsxs(o,{sm:"10",children:[e.jsx(F,{type:"file",id:"multiple-file-input",name:"pictures",onChange:V,accept:"image/*",multiple:!0,ref:w}),e.jsx("div",{className:"mt-3 d-flex flex-wrap",children:j.map((t,s)=>e.jsxs("div",{className:"position-relative me-2 mb-2",children:[e.jsx(A,{src:t,alt:`Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),e.jsx(R,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>q(s),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"Ã—"})]},s))})]})]})}),e.jsx(i,{className:"mb-3 d-flex justify-content-center",children:e.jsx(o,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(R,{disabled:!(n!=null&&n.profession),type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{Ce as default};
