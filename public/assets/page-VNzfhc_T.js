import{r as d,b as w,a as E,c as R,j as e,R as l,C as a}from"./index-CEbbE1Sf.js";import{C as $}from"./ComponentContainerCard-BpYspYtC.js";import{P as I}from"./PageMetaData-qE4R9bbS.js";import{B as h}from"./urls-CvG9cD6N.js";import{F as n}from"./FormLabel-WQTNbj7P.js";import{F as o}from"./FormControl-DFJ9Ydzw.js";import{I as V}from"./Image-ULHo9GWi.js";import{B as f}from"./Button-CWQV4UHt.js";import"./Card-mt6mV6AB.js";import"./divWithClassName-CT9nWrpT.js";import"./FormContext-CSwRqVJr.js";const _=()=>{const[r,j]=d.useState({username:"",role:"Safety Coordinator",phone:"",startDate:"",name:"",address:"",postalCode:"",city:"",safetyCertification:""}),{companyId:y,safetycoordinatorId:x}=w(),[C,g]=d.useState(null),[b,u]=d.useState(null),p=d.useRef(null),N=E(),{setLoading:m}=R(),i=s=>{const{name:t,value:c}=s.target;j({...r,[t]:c})},v=s=>{const t=s.target.files[0];if(t){g(t);const c=new FileReader;c.onload=P=>{u(P.target.result)},c.readAsDataURL(t)}},F=()=>{g(null),u(null),p.current&&(p.current.value="")};d.useEffect(()=>{x&&(m(!0),fetch(`${h}/get-user-detail/${x}`).then(async s=>{const t=await s.json();if(j({username:t.username||"",role:t.role||"Safety Coordinator",phone:t.phone||"",startDate:t.startDate||"",name:t.name||"",address:t.address||"",postalCode:t.postalCode||"",city:t.city||"",safetyCertification:t.safetyCertification||""}),t.picture){const c=t.picture.startsWith("http")?t.picture:`${h.replace("/api","")}/uploads/${t.picture}`;u(c)}console.log("Safety Coordinator data for form:",t)}).catch(s=>console.error(s)).finally(()=>m(!1)))},[x,m]);const S=async()=>{m(!0);const s=new FormData;Object.keys(r).forEach(t=>{t==="picture"&&C?s.append("picture",C):s.append(t,r[t])});try{const t=await fetch(`${h}/update-user/${x}`,{method:"POST",body:s});t.ok?N(`/dashboard/companies/view/${y}`):console.error("Error:",t.statusText)}catch(t){console.error("Fetch error:",t)}m(!1)},D=()=>{N(`/dashboard/companies/view/${y}`)};return e.jsxs(e.Fragment,{children:[e.jsx(I,{title:"Edit Safety Coordinator"}),e.jsx("form",{onSubmit:s=>{s.preventDefault(),S()},children:e.jsx(l,{className:"justify-content-center",children:e.jsx(a,{children:e.jsx($,{title:"Edit Safety Coordinator Details",children:e.jsxs(l,{children:[e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(n,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Email"}),e.jsx(a,{sm:"10",children:e.jsx(o,{value:r.username,onChange:i,name:"username",type:"email",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(n,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Name"}),e.jsx(a,{sm:"10",children:e.jsx(o,{value:r.name,onChange:i,name:"name",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(n,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Phone"}),e.jsx(a,{sm:"10",children:e.jsx(o,{value:r.phone,onChange:i,name:"phone",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(n,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Address"}),e.jsx(a,{sm:"10",children:e.jsx(o,{value:r.address,onChange:i,name:"address",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(n,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"City"}),e.jsx(a,{sm:"10",children:e.jsx(o,{value:r.city,onChange:i,name:"city",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(n,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Post Code"}),e.jsx(a,{sm:"10",children:e.jsx(o,{value:r.postalCode,onChange:i,name:"postalCode",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(n,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Start Date"}),e.jsx(a,{sm:"10",children:e.jsx(o,{value:r.startDate,onChange:i,name:"startDate",type:"date",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(n,{className:"col-sm-2 col-form-label text-end",children:"Safety Certification"}),e.jsx(a,{sm:"10",children:e.jsx(o,{value:r.safetyCertification,onChange:i,name:"safetyCertification",type:"text",id:"safety-certification-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(n,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Picture"}),e.jsxs(a,{sm:"10",children:[e.jsx(o,{type:"file",id:"file-input",name:"picture",onChange:v,accept:"image/*",ref:p}),b&&e.jsxs("div",{className:"mt-3 position-relative",children:[e.jsx(V,{src:b,alt:"Preview",fluid:!0,rounded:!0,style:{maxWidth:"200px",maxHeight:"200px"}}),e.jsx(f,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:F,style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"Ã—"})]})]})]})}),e.jsx(l,{className:"mb-3 d-flex justify-content-center",children:e.jsxs(a,{sm:"12",className:"d-flex justify-content-end",children:[e.jsx(f,{type:"button",variant:"secondary",className:"me-2",onClick:D,children:"Cancel"}),e.jsx(f,{type:"submit",variant:"primary",children:"Update Safety Coordinator"})]})})]})})})})})]})};export{_ as default};
