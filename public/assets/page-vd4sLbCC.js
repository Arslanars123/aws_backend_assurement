import{r,b as M,a as z,j as e,R as i,C as n}from"./index-BMHGnWcK.js";import{C as H}from"./ComponentContainerCard-DqzcDgtW.js";import{P as W}from"./PageMetaData-Bgn24qMg.js";import{B as f}from"./urls-CvG9cD6N.js";import{F as m}from"./FormLabel-BBJljh0R.js";import{F as p}from"./FormControl-BhCdWsRE.js";import{F as N}from"./FormSelect-Dr1VIvZ_.js";import{I as C}from"./Image-BWlBzfxc.js";import{B as P}from"./Button-Dwvyfso6.js";import"./Card-BQIi55Il.js";import"./divWithClassName-BnTSImTn.js";import"./FormContext-_pJuLZf_.js";const ce=()=>{const[l,d]=r.useState(null),[E,y]=r.useState(!1),[I,R]=r.useState(!0),[q,G]=r.useState(null),[J,K]=r.useState(null),[x,S]=r.useState([]),[g,D]=r.useState([]),{drawId:h}=M(),$=z();r.useRef(null);const b=r.useRef(null),[_,F]=r.useState([]);r.useEffect(()=>{h&&fetch(`${f}/get-draw-detail/${h}`).then(async s=>{const t=await s.json();d({...t,picture2:t.picture,pictures2:t.pictures}),t.pictures&&t.pictures.length>0&&F(t.pictures.map(a=>`https://147.93.94.31/uploads/${a}`))}).catch(s=>console.error(s)).finally(()=>R(!1))},[h]);const j=s=>{const{name:t,value:a}=s.target;d({...l,[t]:a})},w=s=>{const{name:t,value:a,multiple:c,options:o}=s.target;if(c){const u=Array.from(o).filter(v=>v.selected).map(v=>v.value);d({...l,[t]:u})}else d({...l,[t]:a})};r.useEffect(()=>{(async()=>{try{const a=await(await fetch(`${f}/get-projects`)).json();k(a)}catch(t){console.error("Error fetching projects:",t)}})()},[]);const[L,k]=r.useState([]),B=s=>{const t=Array.from(s.target.files),a=[...x,...t],c=[...g,...t.map(o=>URL.createObjectURL(o))];S(a),D(c)},O=s=>{const t=x.filter((o,u)=>u!==s),a=g.filter((o,u)=>u!==s);S(t),D(a);const c=new DataTransfer;t.forEach(o=>c.items.add(o)),b.current&&(b.current.files=c.files)},T=async s=>{s.preventDefault(),y(!0);const t=new FormData;Object.keys(l).forEach(a=>{t.append(a,l[a])}),x.length>0&&x.forEach(a=>{t.append("pictures",a)});try{const a=await fetch(`${f}/update-draw/${h}`,{method:"POST",body:t});if(a.ok){const c=await a.json();$("/dashboard/draws",{state:{success:"Drawing updated successfully!"}})}else console.error("Error:",a.statusText)}catch(a){console.error("Fetch error:",a)}y(!1)},U=s=>{F(t=>t.filter((a,c)=>c!==s)),d(t=>{if(!t)return null;const a=t.pictures2.filter((c,o)=>o!==s);return{...t,pictures2:a.length>0?a:[]}})};r.useEffect(()=>{(async()=>{try{const a=await(await fetch(`${f}/get-plans`)).json();A(a)}catch(t){console.error("Error fetching plans:",t)}})()},[]);const[V,A]=r.useState([]);return e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"Edit Drawing"}),I?null:e.jsx("form",{onSubmit:T,children:e.jsx(i,{className:"justify-content-center",children:e.jsx(n,{children:e.jsx(H,{title:"Edit Drawing",children:e.jsxs(i,{children:[e.jsx(n,{lg:"6",children:e.jsxs(i,{className:"mb-3",children:[e.jsx(m,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Name"}),e.jsx(n,{sm:"10",children:e.jsx(p,{value:l==null?void 0:l.name,onChange:j,name:"name",type:"text",id:"example-text-input"})})]})}),e.jsx(n,{lg:"6",children:e.jsxs(i,{className:"mb-3",children:[e.jsx(m,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Description"}),e.jsx(n,{sm:"10",children:e.jsx(p,{value:l==null?void 0:l.description,onChange:j,name:"description",type:"text",id:"example-text-input"})})]})}),e.jsx(n,{lg:"6",children:e.jsxs(i,{className:"mb-3",children:[e.jsx(m,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Date"}),e.jsx(n,{sm:"10",children:e.jsx(p,{value:l==null?void 0:l.date,onChange:j,name:"date",type:"date",id:"example-text-input"})})]})}),e.jsx(n,{lg:"6",children:e.jsxs(i,{className:"mb-3",children:[e.jsx(m,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Updated Date"}),e.jsx(n,{sm:"10",children:e.jsx(p,{value:l==null?void 0:l.updatedDate,onChange:j,name:"updatedDate",type:"date",id:"example-text-input"})})]})}),e.jsx(n,{lg:"6",children:e.jsxs(i,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Drawing Or Document"}),e.jsx(n,{sm:"10",children:e.jsxs(N,{value:l==null?void 0:l.checkbox,name:"checkbox",onChange:w,children:[e.jsx("option",{defaultValue:"",children:"Select"}),e.jsx("option",{value:"Drawing",children:"Drawing"}),e.jsx("option",{value:"Document",children:"Document"})]})})]})}),e.jsx(n,{lg:"6",children:e.jsxs(i,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Plan"}),e.jsx(n,{sm:"10",children:e.jsxs(N,{value:l.planId,name:"planId",onChange:w,children:[e.jsx("option",{defaultValue:"",children:"Select plan"}),V.map(s=>e.jsx("option",{value:s._id,children:s.name},s.id))]})})]})}),e.jsx(n,{lg:"6",children:e.jsxs(i,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Projects"}),e.jsx(n,{sm:"10",children:e.jsxs(N,{value:l.projectsId,name:"projectsId",onChange:w,multiple:!0,children:[e.jsx("option",{defaultValue:"",children:"Select Projects"}),L.map(s=>e.jsxs("option",{value:s._id,children:[s.name," "]},s.id))]})})]})}),e.jsx(n,{lg:"6",children:e.jsxs(i,{className:"mb-3",children:[e.jsx(m,{htmlFor:"multiple-file-input",className:"col-sm-2 col-form-label text-end",children:"Pictures"}),e.jsxs(n,{sm:"10",children:[e.jsx(p,{type:"file",id:"multiple-file-input",name:"pictures",onChange:B,accept:"image/*",multiple:!0,ref:b}),e.jsxs("div",{className:"mt-3 d-flex flex-wrap",children:[g.map((s,t)=>e.jsxs("div",{className:"position-relative me-2 mb-2",children:[e.jsx(C,{src:s,alt:`Preview ${t}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),e.jsx(P,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>O(t),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]},t)),_.map((s,t)=>e.jsxs("div",{className:"position-relative me-2 mb-2",children:[e.jsx(C,{src:s,alt:`Existing Preview ${t}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),e.jsx(P,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>U(t),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]},`existing-${t}`))]})]})]})}),e.jsx(i,{className:"mb-3 d-flex justify-content-center",children:e.jsx(n,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(P,{disabled:E,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{ce as default};
