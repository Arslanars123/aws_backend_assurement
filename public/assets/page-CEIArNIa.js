import{r,a as U,b as G,j as s,R as i,C as a}from"./index-DBwHp2gR.js";import{C as W}from"./ComponentContainerCard-CGy0xqPX.js";import{B as p}from"./urls-CXtk4x-h.js";import{D as _}from"./index-BBUw7yaP.js";import{D as z}from"./page-xesca2ZZ.js";import{F as m}from"./FormLabel-fYqbV-Jd.js";import{A as x,C as g,T as h}from"./TextField-_NGDJNXi.js";import{I as Y}from"./Image-BAuz27ql.js";import{B as H}from"./Button-CssCL-wi.js";import"./Card-Du3hs8TN.js";import"./divWithClassName-Ur-ytTby.js";import"./Modal-DrKyHEFw.js";import"./useWindow-DTXX-IZs.js";import"./DataKey-BlFA_sew.js";import"./NoopTransition-D3hOWpSm.js";import"./FormRange-B6yzJUuH.js";import"./useFormControl-a8c0_1tF.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-C8K2eoCJ.js";const q={profession:null,user:null,controlPlan:null,comment:null,date:null,drawing:null},K=["understood and is buildable","Approved","is not clearly described","Accepted","Follows the project material"];function fe(){var S,v;const[o,d]=r.useState(q),[y,N]=r.useState(!0),C=U(),{companyId:u,projectId:c,staticReportId:I}=G(),[w,D]=r.useState([]),[f,j]=r.useState({show:!1,imgUrl:null}),[b,P]=r.useState(null),[$,O]=r.useState([]),[k,A]=r.useState(10),R=r.useRef(),[T,E]=r.useState([]),[M,F]=r.useState([]);r.useEffect(()=>{(async()=>{try{const n=await(await fetch(`${p}/get-company-professions?companyId=${u}&projectId=${c}`)).json();E(n)}catch(t){console.error("Error fetching professions:",t)}})()},[]),r.useEffect(()=>{o.profession&&o.controlPlan&&o.comment&&o.date&&o.drawing&&N(!1),o.profession&&B()},[o]);const B=async()=>{var e;try{const t={companyId:u,projectId:c,professionsIds:[(e=o==null?void 0:o.profession)==null?void 0:e._id],roles:["Sub Contractor","Worker"]},l=await(await fetch(`${p}/get-filter-users`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();D(l)}catch(t){console.error("Error fetching project managers:",t)}},J=async()=>{try{const t=await(await fetch(`${p}/get-draws?companyId=${u}&projectId=${c}`)).json();F(t)}catch(e){console.error("Error fetching workers:",e)}};r.useEffect(()=>{c&&J()},[u,c]);const L=async()=>{try{const e=new FormData;e.append("projectId",c),e.append("staticReportId",I),e.append("profession",JSON.stringify(o.profession)),e.append("user",JSON.stringify(o.user)),e.append("controlPlan",JSON.stringify(o.controlPlan)),e.append("comment",o.comment),e.append("date",o.date),e.append("drawing",JSON.stringify(o.drawing)),b&&e.append("annotatedImage",b),(await fetch(`${p}/submit-static-report`,{method:"POST",body:e})).ok&&C(`/dashboard/companies/view/${u}/projects/view/${c}`)}catch(e){console.log("error",e)}};return s.jsx(i,{className:"justify-content-center",children:s.jsx(a,{children:s.jsx(W,{title:"Static Reports Submit",children:s.jsxs(i,{children:[s.jsx(a,{lg:"6",children:s.jsxs(i,{className:"mb-3",children:[s.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Profession"}),s.jsx(a,{sm:"10",children:s.jsx(x,{multiple:!1,options:T,getOptionLabel:e=>e.GroupName,value:o.profession??null,onChange:(e,t)=>{var n;((n=t==null?void 0:t.EuroCode)==null?void 0:n.length)>0&&(t==null?void 0:t.Static_report)==="Y"||!t?d({...o,profession:t}):alert("you can't submit this checklist against this profession")},renderInput:e=>s.jsx(h,{...e,variant:"outlined",placeholder:"Search and select profession..."}),renderTags:(e,t)=>e.map((n,l)=>s.jsx(g,{label:n.GroupName,...t({index:l})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),s.jsx(a,{lg:"6",children:s.jsxs(i,{className:"mb-3",children:[s.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select User"}),s.jsx(a,{sm:"10",children:s.jsx(x,{multiple:!1,options:w,getOptionLabel:e=>{var t;return`${e.name} (${(t=e.userProfession)==null?void 0:t.map(n=>n.GroupName).join(", ")})`},value:o.user??null,onChange:(e,t)=>{d({...o,user:t})},renderInput:e=>s.jsx(h,{...e,variant:"outlined",placeholder:"Search and select project Manager..."}),renderTags:(e,t)=>e.map((n,l)=>s.jsx(g,{label:n.name,...t({index:l})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),s.jsx(a,{lg:"6",children:s.jsxs(i,{className:"mb-3",children:[s.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Item"}),s.jsx(a,{sm:"10",children:s.jsx(x,{multiple:!1,options:K,value:o.controlPlan??null,onChange:(e,t)=>{d({...o,controlPlan:t})},renderInput:e=>s.jsx(h,{...e,variant:"outlined",placeholder:"Search and select worker..."}),renderTags:(e,t)=>e.map((n,l)=>s.jsx(g,{label:n,...t({index:l})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),s.jsx(a,{lg:"6",children:s.jsxs(i,{className:"mb-3",children:[s.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Comment"}),s.jsx(a,{sm:"10",children:s.jsx(h,{variant:"outlined",placeholder:"Add some comments...",value:o==null?void 0:o.comment,onChange:e=>{var t;d({...o,comment:(t=e==null?void 0:e.target)==null?void 0:t.value})}})})]})}),s.jsx(a,{lg:"6",children:s.jsxs(i,{className:"mb-3",children:[s.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Date"}),s.jsx(a,{sm:"10",children:s.jsx(_,{value:o==null?void 0:o.date,onChange:e=>{const n=e[0].toISOString().split("T")[0];d({...o,date:n})},className:"form-control",options:{dateFormat:"Y-m-d"}})})]})}),s.jsx(a,{lg:"6",children:s.jsxs(i,{className:"mb-3",children:[s.jsx(m,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Drawing"}),s.jsx(a,{sm:"10",children:s.jsx(x,{multiple:!1,options:M,getOptionLabel:e=>e.name,value:o==null?void 0:o.drawing,onChange:(e,t)=>{d({...o,drawing:t})},renderInput:e=>s.jsx(h,{...e,variant:"outlined",placeholder:"Search and select drawing..."}),renderTags:(e,t)=>e.map((n,l)=>s.jsx(g,{label:n.name,...t({index:l})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),s.jsx(a,{lg:"6",children:s.jsx(i,{className:"",children:(v=(S=o==null?void 0:o.drawing)==null?void 0:S.pictures)==null?void 0:v.map((e,t)=>s.jsx("div",{className:"position-relative me-2 mb-2",children:s.jsx(Y,{src:`${p}/uploads/${e}`,onClick:()=>{j({show:!0,imgUrl:`${p}/uploads/${e}`})},alt:`Existing Preview ${t}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}})},`existing-${t}`))})}),(f==null?void 0:f.show)&&s.jsx(a,{lg:"6",children:s.jsx(i,{children:s.jsx("div",{className:"position-relative",style:{maxWidth:"100%",height:"auto"},children:s.jsx(z,{ref:R,drawDotsOnImage:f,setDrawDotsAnImage:j,onSave:e=>{P(e)},setMarkers:O,markers:$,dotSize:k,setDotSize:A})})})}),s.jsx(i,{className:"mb-3 d-flex justify-content-center",children:s.jsx(a,{sm:"12",className:"d-flex justify-content-end",children:s.jsx(H,{variant:"primary",className:"me-1",disabled:y,onClick:L,children:"Submit"})})})]})})})})}export{fe as default};
