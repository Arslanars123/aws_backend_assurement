import{r as l,b as O,a as A,j as e,R as r,C as s}from"./index-CcXmhF8I.js";import{C as $}from"./ComponentContainerCard-DfOGF2MZ.js";import{P as k}from"./PageMetaData-_VBvv3yh.js";import{B as h}from"./urls-BhGeBsON.js";import{F as i}from"./FormLabel-ur_7HqrZ.js";import{F as m}from"./FormControl-IaSihKBy.js";import{I as L}from"./Image-BA0SNZ1J.js";import{B as j}from"./Button-Bb5NLKr0.js";import{A as U,C as B,T as _}from"./TextField-DX6iEtHg.js";import"./Card-BbEwloSO.js";import"./divWithClassName-stAqo3H6.js";import"./useFormControl-DAPC7iVt.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-C8K2eoCJ.js";const D={name:"",username:"",role:"Independent Controller",cvr:"",contactPerson:"",contactPhone:""},te=()=>{const[a,P]=l.useState(D),[I,N]=l.useState([]),[f,w]=l.useState([]),[C,y]=l.useState(null),[b,g]=l.useState(null),x=l.useRef(null),{companyId:d,projectId:c=null}=O(),v=A(),p=t=>{const{name:n,value:o}=t.target;P({...a,[n]:o})},F=t=>{const n=t.target.files[0];if(y(n),n){const o=URL.createObjectURL(n);g(o)}},R=()=>{y(null),g(null),x.current&&(x.current.value="")},S=async()=>{try{const t=new FormData;Object.keys(a).forEach(o=>{t.append(o,a[o])}),t.append("companyId",d),t.append("projectsId",c),C&&t.append("contactPicture",C);const n=await fetch(`${h}/store-user`,{method:"POST",body:t});if(n.ok){const o=await n.json();v(`/dashboard/companies/view/${d}`,{state:{success:"IndependentController added successfully!"}})}else console.error("Error:",n.statusText)}catch(t){console.error("Fetch error:",t)}},E=async()=>{try{const n=await(await fetch(`${h}/get-independent-controller?companyId=${d}`)).json();N(n)}catch(t){console.log("error",t)}};l.useEffect(()=>{d&&c&&E()},[d,c]);const T=async()=>{try{const n={userIds:f.map(u=>u._id),projectId:c},o=await fetch(`${h}/updateUser`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(o.ok){const u=await o.json();v(`/dashboard/companies/view/${d}/projects/view/${c}`,{state:{success:"Advisor added successfully!"}})}else console.error("Error:",o.statusText)}catch(t){console.log("Error adding Advisor to project:",t)}};return e.jsxs(e.Fragment,{children:[e.jsx(k,{title:"Add Independent Controller"}),!c&&e.jsx(r,{className:"justify-content-center",children:e.jsx(s,{children:e.jsxs($,{title:"Add Independent Controller",children:[e.jsxs(r,{children:[e.jsx(s,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(i,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Name"}),e.jsx(s,{sm:"10",children:e.jsx(m,{value:a==null?void 0:a.name,onChange:p,name:"name",type:"text",id:"example-text-input"})})]})}),e.jsx(s,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(i,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Email"}),e.jsx(s,{sm:"10",children:e.jsx(m,{value:a==null?void 0:a.username,onChange:p,name:"username",type:"text",id:"example-text-input"})})]})}),e.jsx(s,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(i,{className:"col-sm-2 col-form-label text-end",children:"CVR. NR."}),e.jsx(s,{sm:"10",children:e.jsx(m,{value:a.cvr,onChange:p,name:"cvr",type:"text",id:"cvr-input"})})]})}),e.jsx(s,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(i,{className:"col-sm-2 col-form-label text-end",children:"Contact Person"}),e.jsx(s,{sm:"10",children:e.jsx(m,{value:a.contactPerson,onChange:p,name:"contactPerson",type:"text",id:"contact-person-input"})})]})}),e.jsx(s,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(i,{className:"col-sm-2 col-form-label text-end",children:"Phone (Contact)"}),e.jsx(s,{sm:"10",children:e.jsx(m,{value:a.contactPhone,onChange:p,name:"contactPhone",type:"text",id:"contact-phone-input"})})]})}),e.jsx(s,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(i,{className:"col-sm-2 col-form-label text-end",children:"Picture (Contact)"}),e.jsxs(s,{sm:"10",children:[e.jsx(m,{type:"file",id:"contact-picture-input",name:"contactPicture",onChange:F,accept:"image/*",ref:x}),b&&e.jsxs("div",{className:"mt-3 position-relative",children:[e.jsx(L,{src:b,alt:"Preview",fluid:!0,rounded:!0,style:{maxWidth:"200px",maxHeight:"200px"}}),e.jsx(j,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:R,style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"Ã—"})]})]})]})})]}),e.jsx(r,{className:"mb-3 d-flex justify-content-center",children:e.jsx(s,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(j,{onClick:S,variant:"primary",className:"me-1",children:"Submit"})})})]})})}),c&&e.jsxs(r,{className:"mb-3",children:[e.jsx(i,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Select Independent Controller for this Project"}),e.jsx(s,{sm:"10",children:e.jsx(U,{multiple:!0,options:I,getOptionLabel:t=>t.name,isOptionEqualToValue:(t,n)=>t._id===n._id,value:f,onChange:(t,n)=>{w(n)},renderInput:t=>e.jsx(_,{...t,variant:"outlined",placeholder:"Search and select Inspector..."}),renderTags:(t,n)=>t.map((o,u)=>e.jsx(B,{label:o.name,...n({index:u})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})}),e.jsx(r,{className:"mb-3 mt-3 d-flex justify-content-center",children:e.jsx(s,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(j,{type:"submit",variant:"primary",className:"me-1",onClick:T,children:"Submit"})})})]})]})};export{te as default};
