import{r as l,a as q,b as K,j as e,R as o,C as a}from"./index-CFC_skDo.js";import{C as Q}from"./ComponentContainerCard-BgtLXH2x.js";import{P as X}from"./PageMetaData--AH9Un1H.js";import{B as h}from"./urls-BhGeBsON.js";import{F as d}from"./FormLabel-S5bDb0w7.js";import{F as p}from"./FormControl-CiIjeg_-.js";import{F as Z}from"./FormSelect-D_Be58Ty.js";import{A as I,T as W,C as O}from"./TextField-IDun-2ph.js";import{I as ee}from"./Image-xOOuaExf.js";import{B as g}from"./Button-2F6J7aEx.js";import"./Card-DSVzyJ_p.js";import"./divWithClassName-Dn3DrZ5P.js";import"./useSlot-CMJ6u0xq.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-BcofISFZ.js";const se={username:"",password:"",role:"Worker",phone:"",startDate:"",name:"",address:"",postalCode:"",city:"",isProjectManager:null},te=()=>{const[n,b]=l.useState(se),[y,N]=l.useState(!1),f=q(),[v,C]=l.useState(null),[P,w]=l.useState(null),j=l.useRef(null),[x,R]=l.useState([]),[S,T]=l.useState([]),[$,E]=l.useState([]),[k,V]=l.useState([]),F=l.useRef(!1),{companyId:m,projectId:i}=K(),u=t=>{const{name:s,value:r}=t.target;b({...n,[s]:r})},A=t=>{const s=t.target.files[0];if(C(s),s){const r=URL.createObjectURL(s);w(r)}},D=async t=>{t.preventDefault();for(const[s,r]of Object.entries(n))if(r===""||r===null){alert(`Please fill out the "${s}" field.`);return}N(!0);try{const s=new FormData;Object.keys(n).forEach(c=>{s.append(c,n[c])}),v&&s.append("picture",v),s.append("companyId",m),s.append("projectsId",i),s.append("userProfession",JSON.stringify(S));const r=await fetch(`${h}/store-user`,{method:"POST",body:s});if(r.ok){const c=await r.json();f(`/dashboard/companies/view/${m}`,{state:{success:"Worker added successfully!"}})}else console.error("Error:",r.statusText)}catch(s){console.error("Fetch error:",s)}N(!1)},M=t=>{n[t.target.name]=t.target.value,b({...n})},L=()=>{C(null),w(null),j.current&&(j.current.value="")},U=async()=>{try{const s=await(await fetch(`${h}/get-company-professions?companyId=${m}&projectId=${i}`)).json();if(!(s!=null&&s.length)&&!F.current){if(F.current=!0,i){alert("You did not have any Profession so need to add Profession in a Project"),f(`/dashboard/companies/view/${m}/projects/view/${i}`);return}alert("You did not have any Profession so need to add Profession in a Company"),f(`/dashboard/companies/view/${m}`);return}R(s)}catch(t){console.error("Error fetching professions:",t)}},_=async t=>{try{const s={companyId:m,professionsIds:t,roles:["Worker"]},c=await(await fetch(`${h}/get-filter-users`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json(),J={companyId:m,professionsIds:t,projectId:i,roles:["Worker"]},Y=await(await fetch(`${h}/get-filter-users`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(J)})).json(),G=c.filter(z=>!Y.some(H=>H._id===z._id));E(G)}catch(s){console.error("Error fetching workers:",s)}};l.useEffect(()=>{m&&U()},[m,i]),l.useEffect(()=>{if(x!=null&&x.length&&m&&i){const t=x.map(s=>s._id);_(t)}},[x]);const B=async()=>{try{if(!i)return;const s={userIds:k.map(c=>c._id),projectId:i},r=await fetch(`${h}/updateUser`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(r.ok){const c=await r.json();f(`/dashboard/companies/view/${m}/projects/view/${i}`,{state:{success:"Worker added successfully!"}})}else console.error("Error:",r.statusText)}catch(t){console.log("Error adding worker to project:",t)}};return e.jsxs(e.Fragment,{children:[e.jsx(X,{title:"Add Worker"}),!i&&e.jsx("form",{onSubmit:D,children:e.jsx(o,{className:"justify-content-center",children:e.jsx(a,{children:e.jsx(Q,{title:"Add Worker",children:e.jsxs(o,{children:[e.jsx(a,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(d,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Email"}),e.jsx(a,{sm:"10",children:e.jsx(p,{value:n.username,onChange:u,name:"username",type:"email",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(d,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Name"}),e.jsx(a,{sm:"10",children:e.jsx(p,{value:n.name,onChange:u,name:"name",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(d,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Phone"}),e.jsx(a,{sm:"10",children:e.jsx(p,{value:n.phone,onChange:u,name:"phone",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(d,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Password"}),e.jsx(a,{sm:"10",children:e.jsx(p,{value:n.password,onChange:u,name:"password",type:"password",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(d,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Address"}),e.jsx(a,{sm:"10",children:e.jsx(p,{value:n.address,onChange:u,name:"address",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(d,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"City"}),e.jsx(a,{sm:"10",children:e.jsx(p,{value:n.city,onChange:u,name:"city",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(d,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Post Code"}),e.jsx(a,{sm:"10",children:e.jsx(p,{value:n.postalCode,onChange:u,name:"postalCode",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(d,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Start Date"}),e.jsx(a,{sm:"10",children:e.jsx(p,{value:n.startDate,onChange:u,name:"startDate",type:"date",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(d,{className:"col-sm-2 col-form-label text-end",children:"Is project Manager"}),e.jsx(a,{sm:"10",children:e.jsxs(Z,{value:n.isProjectManager,name:"isProjectManager",onChange:M,children:[e.jsx("option",{defaultValue:"",children:"Select"}),e.jsx("option",{value:"yes",children:"Yes"}),e.jsx("option",{value:"No",children:"No"})]})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(d,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Profession"}),e.jsx(a,{sm:"10",children:e.jsx(I,{multiple:!0,options:x,getOptionLabel:t=>t.GroupName,value:S,onChange:(t,s)=>{T(s)},renderInput:t=>e.jsx(W,{...t,variant:"outlined",placeholder:"Search and select professions..."}),renderTags:(t,s)=>t.map((r,c)=>e.jsx(O,{label:r.GroupName,...s({index:c})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(d,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Picture"}),e.jsxs(a,{sm:"10",children:[e.jsx(p,{type:"file",id:"file-input",name:"picture",onChange:A,accept:"image/*",ref:j}),P&&e.jsxs("div",{className:"mt-3 position-relative",children:[e.jsx(ee,{src:P,alt:"Preview",fluid:!0,rounded:!0,style:{maxWidth:"200px",maxHeight:"200px"}}),e.jsx(g,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:L,style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"Ã—"})]})]})]})}),e.jsx(o,{className:"mb-3 d-flex justify-content-center",children:e.jsx(a,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(g,{disabled:y,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})}),i&&e.jsxs(o,{className:"mb-3",children:[e.jsx(d,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Select Worker for this Projects"}),e.jsxs(a,{sm:"10",children:[e.jsx(I,{multiple:!0,options:$,getOptionLabel:t=>t.name,value:k,onChange:(t,s)=>{V(s)},renderInput:t=>e.jsx(W,{...t,variant:"outlined",placeholder:"Search and select worker..."}),renderTags:(t,s)=>t.map((r,c)=>e.jsx(O,{label:r.name,...s({index:c})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}}),e.jsx(o,{className:"mb-3 mt-3 d-flex justify-content-center",children:e.jsx(a,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(g,{disabled:y,type:"submit",variant:"primary",className:"me-1",onClick:B,children:"Submit"})})})]})]})]})},be=l.memo(te);export{be as default};
