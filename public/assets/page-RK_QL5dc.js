import{r as p,a as U,b as W,j as e,R as n,C as t}from"./index-B9-Fw72-.js";import{C as L}from"./ComponentContainerCard-CQST7gBQ.js";import{P as B}from"./PageMetaData-D2p2uQ5O.js";import{B as x}from"./urls-BhGeBsON.js";import{F as o}from"./FormLabel-Npy4DC-M.js";import{F as m}from"./FormControl-Di5J9l5P.js";import{F as _}from"./FormSelect-DDDEprLJ.js";import{I as H}from"./Image-BOJ82kyh.js";import{B as j}from"./Button-CN5PJwBC.js";import{A as M,T as z,C as J}from"./TextField-Drl5XZ5s.js";import"./Card-ZzJPZ8wj.js";import"./divWithClassName-COkzKTYF.js";import"./useSlot-aA9odXPU.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-BcofISFZ.js";const q={username:"",password:"",role:"Inspector",phone:"",case:"",startDate:"",name:"",address:"",postalCode:"",city:"",type:null},ie=()=>{const[r,f]=p.useState(q),[b,y]=p.useState(!1),g=U(),[v,N]=p.useState(null),[C,S]=p.useState(null),h=p.useRef(null),[F,w]=p.useState([]),[I,P]=p.useState([]),{companyId:u,projectId:i}=W(),d=s=>{const{name:a,value:l}=s.target;f({...r,[a]:l})},A=s=>{const a=s.target.files[0];if(N(a),a){const l=URL.createObjectURL(a);S(l)}},R=async s=>{s.preventDefault(),y(!0);try{const a=new FormData;Object.keys(r).forEach(c=>{a.append(c,r[c])}),v&&a.append("picture",v),a.append("companyId",u),a.append("projectsId",i);const l=await fetch(`${x}/store-user`,{method:"POST",body:a});if(l.ok){const c=await l.json();g(`/dashboard/companies/view/${u}`,{state:{success:"Inspector added successfully!"}})}else console.error("Error:",l.statusText)}catch(a){console.error("Fetch error:",a)}y(!1)},T=s=>{r[s.target.name]=s.target.value,f({...r})},k=()=>{N(null),S(null),h.current&&(h.current.value="")};p.useEffect(()=>{u&&i&&E()},[u,i]);const E=async()=>{try{const a=await(await fetch(`${x}/get-inspectors?companyId=${u}`)).json(),c=await(await fetch(`${x}/get-inspectors?companyId=${u}&projectId=${i}`)).json(),$=a.filter(D=>!c.some(O=>O._id===D._id));w($)}catch(s){console.error("Error fetching workers:",s)}},V=async()=>{try{if(!i)return;const a={userIds:I.map(c=>c._id),projectId:i},l=await fetch(`${x}/updateUser`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(l.ok){const c=await l.json();g(`/dashboard/companies/view/${u}/projects/view/${i}`,{state:{success:"Inspector added successfully!"}})}else console.error("Error:",l.statusText)}catch(s){console.log("Error adding Inspector to project:",s)}};return e.jsxs(e.Fragment,{children:[e.jsx(B,{title:"Add Inspector"}),!i&&e.jsx("form",{onSubmit:R,children:e.jsx(n,{className:"justify-content-center",children:e.jsx(t,{children:e.jsx(L,{title:"Add Inspector",children:e.jsxs(n,{children:[e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Email"}),e.jsx(t,{sm:"10",children:e.jsx(m,{value:r.username,onChange:d,name:"username",type:"email",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Name"}),e.jsx(t,{sm:"10",children:e.jsx(m,{value:r.name,onChange:d,name:"name",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Phone"}),e.jsx(t,{sm:"10",children:e.jsx(m,{value:r.phone,onChange:d,name:"phone",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Password"}),e.jsx(t,{sm:"10",children:e.jsx(m,{value:r.password,onChange:d,name:"password",type:"password",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Address"}),e.jsx(t,{sm:"10",children:e.jsx(m,{value:r.address,onChange:d,name:"address",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"City"}),e.jsx(t,{sm:"10",children:e.jsx(m,{value:r.city,onChange:d,name:"city",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Post Code"}),e.jsx(t,{sm:"10",children:e.jsx(m,{value:r.postalCode,onChange:d,name:"postalCode",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Start Date"}),e.jsx(t,{sm:"10",children:e.jsx(m,{value:r.startDate,onChange:d,name:"startDate",type:"date",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{className:"col-sm-2 col-form-label text-end",children:"Select Type"}),e.jsx(t,{sm:"10",children:e.jsxs(_,{value:r.type,name:"type",onChange:T,children:[e.jsx("option",{defaultValue:"",children:"Select Type"}),e.jsx("option",{value:"Architecture",children:"Architecture"}),e.jsx("option",{value:"Engineer",children:"Engineer"}),e.jsx("option",{value:"Fire",children:"Fire"}),e.jsx("option",{value:"Acoustics",children:"Acoustics"}),e.jsx("option",{value:"Technical Subject",children:"Technical Subject"}),e.jsx("option",{value:"Health And Safety",children:"Health And Safety"}),e.jsx("option",{value:"Representative",children:"Representative"}),e.jsx("option",{value:"Trade Union Representaive",children:"Trade Union Representaive"}),e.jsx("option",{value:"Substainablity",children:"Substainablity"})]})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Picture"}),e.jsxs(t,{sm:"10",children:[e.jsx(m,{type:"file",id:"file-input",name:"picture",onChange:A,accept:"image/*",ref:h}),C&&e.jsxs("div",{className:"mt-3 position-relative",children:[e.jsx(H,{src:C,alt:"Preview",fluid:!0,rounded:!0,style:{maxWidth:"200px",maxHeight:"200px"}}),e.jsx(j,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:k,style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"Ã—"})]})]})]})}),e.jsx(n,{className:"mb-3 d-flex justify-content-center",children:e.jsx(t,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(j,{disabled:b,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})}),i&&e.jsxs(n,{className:"mb-3",children:[e.jsx(o,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Select Inspector for this Project"}),e.jsxs(t,{sm:"10",children:[e.jsx(M,{multiple:!0,options:F,getOptionLabel:s=>s.name,value:I,onChange:(s,a)=>{P(a)},renderInput:s=>e.jsx(z,{...s,variant:"outlined",placeholder:"Search and select Inspector..."}),renderTags:(s,a)=>s.map((l,c)=>e.jsx(J,{label:l.name,...a({index:c})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}}),e.jsx(n,{className:"mb-3 mt-3 d-flex justify-content-center",children:e.jsx(t,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(j,{disabled:b,type:"submit",variant:"primary",className:"me-1",onClick:V,children:"Submit"})})})]})]})]})};export{ie as default};
