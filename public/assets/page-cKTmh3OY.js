import{r as d,b as _,ab as T,a as U,j as e,R as h,C as r}from"./index-B342vN8a.js";import{C as Q}from"./ComponentContainerCard-BIxSgnld.js";import{P as Y}from"./PageMetaData-__vP5leC.js";import{B as i}from"./urls-CvG9cD6N.js";import{P as q}from"./page-DqQTzhy2.js";import{B as n}from"./Button-BnzdNfRx.js";import{F as t}from"./FormLabel-f-qql_Cp.js";import{I as M}from"./Image-B0PQ6faj.js";import{M as c}from"./Modal-DqlySIHa.js";import"./Card-CI8IuqFE.js";import"./divWithClassName-BnSMb2ls.js";import"./FormRange-C54s6zi2.js";import"./FormContext-BMEMUOIr.js";import"./PDFButton-DL5ySIrG.js";import"./useWindow-CcKraZnY.js";import"./useEventCallback-fNpvZdor.js";import"./DataKey-COGXBUcQ.js";import"./NoopTransition-BaR3suoM.js";const he=()=>{var N,v,w,y,$,D,P,C,k;const[F,S]=d.useState(!0),[s,I]=d.useState(null),{mentionId:o,companyId:p,projectId:u}=_(),[O]=T(),[j,g]=d.useState({show:!1,pdfFile:null,name:null}),[R,W]=d.useState({}),[z,A]=d.useState(8),[B,m]=d.useState(!1),E=U(),f=O.get("report");d.useEffect(()=>{o&&fetch(`${i}/get-mention-detail/${o}`).then(async a=>{const l=await a.json();I(l)}).catch(a=>console.error(a)).finally(()=>S(!1))},[o]);const b=(a,l)=>{g({show:!0,pdfFile:a,name:l})},V=()=>{m(!0)},H=async()=>{try{const a=await fetch(`${i}/delete-mention/${o}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(a.ok){const l=await a.json(),x=u?`/dashboard/companies/view/${p}/projects/view/${u}`:`/dashboard/companies/view/${p}/mentions`,L=f?`?report=${encodeURIComponent(f)}`:"";E(`${x}${L}`,{state:{success:"Mention deleted successfully!"}}),console.log("Success:",l)}else console.error("Error:",a.statusText)}catch(a){console.error("Fetch error:",a)}m(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(Y,{title:"Safety Mention"}),F?null:e.jsx(h,{className:"justify-content-center",children:e.jsx(r,{lg:"12",children:e.jsxs(Q,{title:"View Mention",children:[e.jsx(h,{className:"mb-3",children:e.jsx(r,{className:"d-flex justify-content-end",children:e.jsx(n,{variant:"danger",onClick:V,children:"Delete"})})}),e.jsxs(h,{children:[e.jsx(r,{lg:"6",children:e.jsxs("div",{className:"mb-4",children:[e.jsx(t,{className:"fw-bold text-primary mb-2",children:"Item"}),e.jsx("div",{className:"p-3 bg-light rounded border",children:(s==null?void 0:s.item)||"—"})]})}),e.jsx(r,{lg:"6",children:e.jsxs("div",{className:"mb-4",children:[e.jsx(t,{className:"fw-bold text-primary mb-2",children:"Recipient"}),e.jsx("div",{className:"p-3 bg-light rounded border",children:((N=s==null?void 0:s.recipients)==null?void 0:N.name)||"—"})]})}),e.jsx(r,{lg:"6",children:e.jsxs("div",{className:"mb-4",children:[e.jsx(t,{className:"fw-bold text-primary mb-2",children:"Project Manager"}),e.jsx("div",{className:"p-3 bg-light rounded border",children:((v=s==null?void 0:s.projectManager)==null?void 0:v.name)||"—"})]})}),e.jsx(r,{lg:"6",children:e.jsxs("div",{className:"mb-4",children:[e.jsx(t,{className:"fw-bold text-primary mb-2",children:"Comments"}),e.jsx("div",{className:"p-3 bg-light rounded border",children:(s==null?void 0:s.comment)||"—"})]})}),e.jsx(r,{lg:"6",children:e.jsxs("div",{className:"mb-4",children:[e.jsx(t,{className:"fw-bold text-primary mb-2",children:"Drawing"}),e.jsx("div",{className:"p-3 bg-light rounded border",children:((w=s==null?void 0:s.drawing)==null?void 0:w.name)||"—"})]})}),e.jsx(r,{lg:"12",children:e.jsxs("div",{className:"mb-4",children:[e.jsx(t,{className:"fw-bold text-primary mb-3",children:"Main Drawings"}),e.jsx("div",{className:"p-3 bg-light rounded border",children:(($=(y=s==null?void 0:s.drawing)==null?void 0:y.mainDrawings)==null?void 0:$.length)>0?e.jsx("div",{className:"d-flex flex-wrap gap-3",children:s.drawing.mainDrawings.map((a,l)=>e.jsxs("div",{className:"d-flex flex-column align-items-center p-3 bg-white rounded border",children:[e.jsxs(n,{variant:"outline-primary",className:"mb-2",onClick:()=>b(`${i}/uploads/${a.stored}`,a.original),children:[e.jsx("i",{className:"fas fa-file-pdf me-2"}),"View PDF"]}),e.jsx("div",{className:"small text-muted text-center",style:{maxWidth:"150px"},children:a.original})]},l))}):e.jsx("div",{className:"text-muted",children:"No main drawings available"})})]})}),e.jsx(r,{lg:"12",children:e.jsxs("div",{className:"mb-4",children:[e.jsx(t,{className:"fw-bold text-primary mb-3",children:"Child Drawings"}),e.jsx("div",{className:"p-3 bg-light rounded border",children:((P=(D=s==null?void 0:s.drawing)==null?void 0:D.childDrawings)==null?void 0:P.length)>0?e.jsx("div",{className:"d-flex flex-wrap gap-3",children:s.drawing.childDrawings.map((a,l)=>e.jsxs("div",{className:"d-flex flex-column align-items-center p-3 bg-white rounded border",children:[e.jsxs(n,{variant:"outline-primary",className:"mb-2",onClick:()=>b(`${i}/uploads/${a.stored}`,a.original),children:[e.jsx("i",{className:"fas fa-file-pdf me-2"}),"View PDF"]}),e.jsx("div",{className:"small text-muted text-center",style:{maxWidth:"150px"},children:a.original})]},l))}):e.jsx("div",{className:"text-muted",children:"No child drawings available"})})]})}),e.jsx(r,{lg:"12",children:e.jsxs("div",{className:"mb-4",children:[e.jsx(t,{className:"fw-bold text-primary mb-3",children:"Mark Pictures"}),e.jsx("div",{className:"p-3 bg-light rounded border",children:((C=s==null?void 0:s.pictureObjects)==null?void 0:C.length)>0?e.jsx("div",{className:"d-flex flex-wrap gap-3",children:s.pictureObjects.map((a,l)=>e.jsxs("div",{className:"d-flex flex-column align-items-center p-3 bg-white rounded border",children:[e.jsx(M,{src:`${i}/uploads/${a.filename}`,alt:a.description||`Mark Picture ${l+1}`,fluid:!0,rounded:!0,style:{maxWidth:"150px",maxHeight:"150px",cursor:"pointer",border:"2px solid #dee2e6"},onClick:()=>window.open(`${i}/uploads/${a.filename}`,"_blank"),title:"Click to view full size"}),e.jsx("div",{className:"small text-muted text-center mt-2",style:{maxWidth:"150px"},children:a.description||`Mark Picture ${l+1}`})]},l))}):e.jsx("div",{className:"text-muted",children:"No mark pictures available"})})]})}),(s==null?void 0:s.pictures)&&s.pictures.length>0&&!s.pictureObjects&&e.jsx(r,{lg:"12",children:e.jsxs("div",{className:"mb-4",children:[e.jsx(t,{className:"fw-bold text-primary mb-3",children:"Legacy Pictures"}),e.jsx("div",{className:"p-3 bg-light rounded border",children:e.jsx("div",{className:"d-flex flex-wrap gap-3",children:s.pictures.map((a,l)=>e.jsxs("div",{className:"d-flex flex-column align-items-center p-3 bg-white rounded border",children:[e.jsx(M,{src:`${i}/uploads/${a}`,alt:`Image ${l+1}`,fluid:!0,rounded:!0,style:{maxWidth:"150px",maxHeight:"150px",cursor:"pointer",border:"2px solid #dee2e6"},onClick:()=>window.open(`${i}/uploads/${a}`,"_blank"),title:"Click to view full size"}),e.jsxs("div",{className:"small text-muted text-center mt-2",children:["Image ",l+1]})]},`existing-${l}`))})})]})}),e.jsx(r,{lg:"12",children:e.jsxs("div",{className:"mb-4",children:[e.jsx(t,{className:"fw-bold text-primary mb-3",children:"Marked Drawings (Annotated PDFs)"}),e.jsx("div",{className:"p-3 bg-light rounded border",children:((k=s==null?void 0:s.annotatedPdfs)==null?void 0:k.length)>0?e.jsx("div",{className:"d-flex flex-wrap gap-3",children:s.annotatedPdfs.map((a,l)=>e.jsxs("div",{className:"d-flex flex-column align-items-center p-3 bg-white rounded border",children:[e.jsxs("div",{className:"position-relative",children:[e.jsx("img",{src:`${i}/uploads/${a.filename}`,alt:a.originalName||`Annotated PDF ${l+1}`,className:"img-fluid rounded border",style:{maxWidth:"200px",maxHeight:"200px",cursor:"pointer",border:"2px solid #dee2e6"},onClick:()=>window.open(`${i}/uploads/${a.filename}`,"_blank"),onError:x=>{x.target.style.display="none",x.target.nextSibling.style.display="flex"},title:"Click to view full size"}),e.jsxs("div",{style:{display:"none",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"200px",height:"200px",border:"2px dashed #dee2e6",borderRadius:"8px",backgroundColor:"#f8f9fa"},children:[e.jsx("i",{className:"fas fa-file-pdf fa-3x text-muted mb-2"}),e.jsx("div",{className:"small text-muted text-center",children:"PDF Preview not available"}),e.jsx(n,{variant:"outline-primary",size:"sm",className:"mt-2",onClick:()=>window.open(`${i}/uploads/${a.filename}`,"_blank"),children:"View PDF"})]})]}),e.jsx("div",{className:"small text-muted text-center mt-2",style:{maxWidth:"200px"},children:a.originalName||`Annotated PDF ${l+1}`}),l===0&&e.jsxs("div",{className:"small text-success fw-bold mt-1",children:[e.jsx("i",{className:"fas fa-star me-1"}),"First Index"]})]},l))}):e.jsx("div",{className:"text-muted",children:"No annotated PDFs available"})})]})})]})]})})}),j.show&&e.jsx(q,{drawDotsOnPdf:j,setDrawDotsOnPdf:g,markers:R,setMarkers:W,dotSize:z,setDotSize:A,readOnly:!0}),e.jsxs(c,{show:B,onHide:()=>m(!1),children:[e.jsx(c.Header,{closeButton:!0,children:e.jsx(c.Title,{children:"Confirm Deletion"})}),e.jsx(c.Body,{children:"Are you sure you want to delete this mention?"}),e.jsxs(c.Footer,{children:[e.jsx(n,{variant:"secondary",onClick:()=>m(!1),children:"Cancel"}),e.jsx(n,{variant:"danger",onClick:H,children:"Yes, Delete"})]})]})]})};export{he as default};
