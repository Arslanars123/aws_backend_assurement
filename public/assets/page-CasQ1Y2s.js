import{r as d,a as J,b as Y,j as e,R as n,C as t}from"./index-BfjhYpb5.js";import{C as q}from"./ComponentContainerCard-BbSfpbsX.js";import{P as G}from"./PageMetaData-CFx5C9vJ.js";import{B as p}from"./urls-CXtk4x-h.js";import{F as c}from"./FormLabel-9Op50W6F.js";import{F as o}from"./FormControl-u0lKnE3u.js";import{F as K}from"./FormSelect-CIOplRxv.js";import{I as k}from"./Image-D3CG5EY4.js";import{B as h}from"./Button-0d7iDM-S.js";import{A as Q,T as X,C as Z}from"./TextField-55yUiIyZ.js";import"./Card-CjeZJw7I.js";import"./divWithClassName-CLs3g5aQ.js";import"./useSlot-gx2Y3tCc.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-BcofISFZ.js";const ee={username:"",password:"",role:"Advisor",phone:"",case:"",startDate:"",name:"",address:"",postalCode:"",city:"",type:null,cvr:"",contactPerson:"",contactPhone:""},je=()=>{const[l,g]=d.useState(ee),[v,y]=d.useState(!1),j=J(),[C,N]=d.useState(null),[P,w]=d.useState(null),f=d.useRef(null),[T,E]=d.useState([]),[S,V]=d.useState([]),[F,A]=d.useState(null),[I,R]=d.useState(null),b=d.useRef(null),{companyId:x,projectId:u}=Y(),$=a=>{const s=a.target.files[0];if(A(s),s){const r=URL.createObjectURL(s);R(r)}},O=()=>{A(null),R(null),b.current&&(b.current.value="")},i=a=>{const{name:s,value:r}=a.target;g({...l,[s]:r})},D=a=>{const s=a.target.files[0];if(N(s),s){const r=URL.createObjectURL(s);w(r)}},U=async a=>{if(a.preventDefault(),!x){alert("You must select company"),j("/dashboard/companies");return}y(!0);try{const s=new FormData;Object.keys(l).forEach(m=>{s.append(m,l[m])}),C&&s.append("picture",C),F&&s.append("contactPicture",F),s.append("companyId",x),s.append("projectsId",u);const r=await fetch(`${p}/store-user`,{method:"POST",body:s});if(r.ok){const m=await r.json();j(`/dashboard/companies/view/${x}`,{state:{success:"Advisor added successfully!"}})}else console.error("Error:",r.statusText)}catch(s){console.error("Fetch error:",s)}y(!1)},W=a=>{l[a.target.name]=a.target.value,g({...l})},L=()=>{N(null),w(null),f.current&&(f.current.value="")};d.useEffect(()=>{x&&u&&B()},[x,u]);const B=async()=>{try{const s=await(await fetch(`${p}/get-advisors?companyId=${x}`)).json(),m=await(await fetch(`${p}/get-advisors?companyId=${x}&projectId=${u}`)).json(),z=s.filter(H=>!m.some(M=>M._id===H._id));E(z)}catch(a){console.error("Error fetching workers:",a)}},_=async()=>{try{if(!u)return;const s={userIds:S.map(m=>m._id),projectId:u},r=await fetch(`${p}/updateUser`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(r.ok){const m=await r.json();j(`/dashboard/companies/view/${x}/projects/view/${u}`,{state:{success:"Advisor added successfully!"}})}else console.error("Error:",r.statusText)}catch(a){console.log("Error adding Advisor to project:",a)}};return e.jsxs(e.Fragment,{children:[e.jsx(G,{title:"Add Advisor"}),!u&&e.jsx("form",{onSubmit:U,children:e.jsx(n,{className:"justify-content-center",children:e.jsx(t,{children:e.jsx(q,{title:"Add Advisor",children:e.jsxs(n,{children:[e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Email"}),e.jsx(t,{sm:"10",children:e.jsx(o,{value:l.username,onChange:i,name:"username",type:"email",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Name"}),e.jsx(t,{sm:"10",children:e.jsx(o,{value:l.name,onChange:i,name:"name",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Phone"}),e.jsx(t,{sm:"10",children:e.jsx(o,{value:l.phone,onChange:i,name:"phone",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Password"}),e.jsx(t,{sm:"10",children:e.jsx(o,{value:l.password,onChange:i,name:"password",type:"password",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Address"}),e.jsx(t,{sm:"10",children:e.jsx(o,{value:l.address,onChange:i,name:"address",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"City"}),e.jsx(t,{sm:"10",children:e.jsx(o,{value:l.city,onChange:i,name:"city",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Post Code"}),e.jsx(t,{sm:"10",children:e.jsx(o,{value:l.postalCode,onChange:i,name:"postalCode",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Start Date"}),e.jsx(t,{sm:"10",children:e.jsx(o,{value:l.startDate,onChange:i,name:"startDate",type:"date",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(c,{className:"col-sm-2 col-form-label text-end",children:"Select Type"}),e.jsx(t,{sm:"10",children:e.jsxs(K,{value:l.type,name:"type",onChange:W,children:[e.jsx("option",{defaultValue:"",children:"Select Type"}),e.jsx("option",{value:"Architecture",children:"Architecture"}),e.jsx("option",{value:"Engineer",children:"Engineer"}),e.jsx("option",{value:"Fire",children:"Fire"}),e.jsx("option",{value:"Acoustics",children:"Acoustics"}),e.jsx("option",{value:"Technical Subject",children:"Technical Subject"})]})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(c,{className:"col-sm-2 col-form-label text-end",children:"CVR. NR."}),e.jsx(t,{sm:"10",children:e.jsx(o,{value:l.cvr,onChange:i,name:"cvr",type:"text",id:"cvr-input"})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(c,{className:"col-sm-2 col-form-label text-end",children:"Contact Person"}),e.jsx(t,{sm:"10",children:e.jsx(o,{value:l.contactPerson,onChange:i,name:"contactPerson",type:"text",id:"contact-person-input"})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(c,{className:"col-sm-2 col-form-label text-end",children:"Phone (Contact)"}),e.jsx(t,{sm:"10",children:e.jsx(o,{value:l.contactPhone,onChange:i,name:"contactPhone",type:"text",id:"contact-phone-input"})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(c,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Picture"}),e.jsxs(t,{sm:"10",children:[e.jsx(o,{type:"file",id:"file-input",name:"picture",onChange:D,accept:"image/*",ref:f}),P&&e.jsxs("div",{className:"mt-3 position-relative",children:[e.jsx(k,{src:P,alt:"Preview",fluid:!0,rounded:!0,style:{maxWidth:"200px",maxHeight:"200px"}}),e.jsx(h,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:L,style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]})]})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(c,{className:"col-sm-2 col-form-label text-end",children:"Picture (Contact)"}),e.jsxs(t,{sm:"10",children:[e.jsx(o,{type:"file",id:"contact-picture-input",name:"contactPicture",onChange:$,accept:"image/*",ref:b}),I&&e.jsxs("div",{className:"mt-3 position-relative",children:[e.jsx(k,{src:I,alt:"Preview",fluid:!0,rounded:!0,style:{maxWidth:"200px",maxHeight:"200px"}}),e.jsx(h,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:O,style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]})]})]})}),e.jsx(n,{className:"mb-3 d-flex justify-content-center",children:e.jsx(t,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(h,{disabled:v,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})}),u&&e.jsxs(n,{className:"mb-3",children:[e.jsx(c,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Select Advisor for this Project"}),e.jsxs(t,{sm:"10",children:[e.jsx(Q,{multiple:!0,options:T,getOptionLabel:a=>a.name,value:S,onChange:(a,s)=>{V(s)},renderInput:a=>e.jsx(X,{...a,variant:"outlined",placeholder:"Search and select Advisor..."}),renderTags:(a,s)=>a.map((r,m)=>e.jsx(Z,{label:r.name,...s({index:m})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}}),e.jsx(n,{className:"mb-3 mt-3 d-flex justify-content-center",children:e.jsx(t,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(h,{disabled:v,type:"submit",variant:"primary",className:"me-1",onClick:_,children:"Submit"})})})]})]})]})};export{je as default};
