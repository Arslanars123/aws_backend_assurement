import{r as p,a as D,b as O,j as e,R as n,C as t}from"./index-Dr-g9jBk.js";import{C as W}from"./ComponentContainerCard-Cwzd1Pe9.js";import{P as L}from"./PageMetaData-CD0WkpFn.js";import{B as x}from"./urls-BhGeBsON.js";import{F as c}from"./FormLabel-CTeCMstv.js";import{F as m}from"./FormControl-ChOWD-Qh.js";import{I as U}from"./Image-C4gja7eZ.js";import{B as f}from"./Button-CREwHDWV.js";import{A as B,T as _,C as z}from"./TextField-BYEnEXt8.js";import"./Card-KPqSmBcK.js";import"./divWithClassName-BqeVXCmu.js";import"./useSlot-52VqrUtF.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-BcofISFZ.js";const H={username:"",password:"",role:"Main Constructor",phone:"",case:"",startDate:"",name:"",address:"",postalCode:"",city:""},le=()=>{const[l,F]=p.useState(H),[b,y]=p.useState(!1),h=D(),[g,C]=p.useState(null),[N,v]=p.useState(null),j=p.useRef(null),[S,P]=p.useState([]),[w,I]=p.useState([]),{companyId:d,projectId:i}=O(),u=a=>{const{name:s,value:r}=a.target;F({...l,[s]:r})},k=a=>{const s=a.target.files[0];if(C(s),s){const r=URL.createObjectURL(s);v(r)}},M=async a=>{if(a.preventDefault(),!d){alert("You must select company"),h("/dashboard/companies");return}y(!0);try{const s=new FormData;Object.keys(l).forEach(o=>{s.append(o,l[o])}),g&&s.append("picture",g),s.append("companyId",d),s.append("projectsId",i);const r=await fetch(`${x}/store-user`,{method:"POST",body:s});if(r.ok){const o=await r.json();h(`/dashboard/companies/view/${d}`,{state:{success:"Main Constructor added successfully!"}})}else console.error("Error:",r.statusText)}catch(s){console.error("Fetch error:",s)}y(!1)},R=()=>{C(null),v(null),j.current&&(j.current.value="")};p.useEffect(()=>{d&&i&&E()},[d,i]);const E=async()=>{try{const s=await(await fetch(`${x}/get-mains?companyId=${d}`)).json(),o=await(await fetch(`${x}/get-mains?companyId=${d}&projectId=${i}`)).json(),A=s.filter(T=>!o.some(V=>V._id===T._id));P(A)}catch(a){console.error("Error fetching workers:",a)}},$=async()=>{try{if(!i)return;const s={userIds:w.map(o=>o._id),projectId:i},r=await fetch(`${x}/updateUser`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(r.ok){const o=await r.json();h(`/dashboard/companies/view/${d}/projects/view/${i}`,{state:{success:"Main Constructor added successfully!"}})}else console.error("Error:",r.statusText)}catch(a){console.log("Error adding Main Constructor to project:",a)}};return e.jsxs(e.Fragment,{children:[e.jsx(L,{title:"Add Main Constructor"}),!i&&e.jsx("form",{onSubmit:M,children:e.jsx(n,{className:"justify-content-center",children:e.jsx(t,{children:e.jsx(W,{title:"Add Main Constructor",children:e.jsxs(n,{children:[e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Email"}),e.jsx(t,{sm:"10",children:e.jsx(m,{value:l.username,onChange:u,name:"username",type:"email",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Name"}),e.jsx(t,{sm:"10",children:e.jsx(m,{value:l.name,onChange:u,name:"name",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Phone"}),e.jsx(t,{sm:"10",children:e.jsx(m,{value:l.phone,onChange:u,name:"phone",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Password"}),e.jsx(t,{sm:"10",children:e.jsx(m,{value:l.password,onChange:u,name:"password",type:"password",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Address"}),e.jsx(t,{sm:"10",children:e.jsx(m,{value:l.address,onChange:u,name:"address",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"City"}),e.jsx(t,{sm:"10",children:e.jsx(m,{value:l.city,onChange:u,name:"city",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Post Code"}),e.jsx(t,{sm:"10",children:e.jsx(m,{value:l.postalCode,onChange:u,name:"postalCode",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Start Date"}),e.jsx(t,{sm:"10",children:e.jsx(m,{value:l.startDate,onChange:u,name:"startDate",type:"date",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(t,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(c,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Picture"}),e.jsxs(t,{sm:"10",children:[e.jsx(m,{type:"file",id:"file-input",name:"picture",onChange:k,accept:"image/*",ref:j}),N&&e.jsxs("div",{className:"mt-3 position-relative",children:[e.jsx(U,{src:N,alt:"Preview",fluid:!0,rounded:!0,style:{maxWidth:"200px",maxHeight:"200px"}}),e.jsx(f,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:R,style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"Ã—"})]})]})]})}),e.jsx(n,{className:"mb-3 d-flex justify-content-center",children:e.jsx(t,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(f,{disabled:b,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})}),i&&e.jsxs(n,{className:"mb-3",children:[e.jsx(c,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Select Main Constructor for this Project"}),e.jsxs(t,{sm:"10",children:[e.jsx(B,{multiple:!0,options:S,getOptionLabel:a=>a.name,value:w,onChange:(a,s)=>{I(s)},renderInput:a=>e.jsx(_,{...a,variant:"outlined",placeholder:"Search and select Main Constructor..."}),renderTags:(a,s)=>a.map((r,o)=>e.jsx(z,{label:r.name,...s({index:o})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}}),e.jsx(n,{className:"mb-3 mt-3 d-flex justify-content-center",children:e.jsx(t,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(f,{disabled:b,type:"submit",variant:"primary",className:"me-1",onClick:$,children:"Submit"})})})]})]})]})};export{le as default};
