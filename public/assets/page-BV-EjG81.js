import{r as d,a as W,b as L,j as e,R as l,C as r}from"./index-CAFh8Qe-.js";import{C as B}from"./ComponentContainerCard-BHLb5dlU.js";import{P as _}from"./PageMetaData-BdrMy3rA.js";import{B as x}from"./urls-D84fNQqS.js";import{F as c}from"./FormLabel-DJooOqJq.js";import{F as m}from"./FormControl-D6Fi2fvk.js";import{F as H}from"./FormSelect-DckZIl1p.js";import{I as M}from"./Image-CbaU3Ogc.js";import{B as y}from"./Button-DUm19Z6r.js";import{A as z,C as J,T as Y}from"./TextField-DXeN24BL.js";import"./Card-B6ongrnB.js";import"./divWithClassName-Ds10gy6J.js";import"./FormContext-CVQotS7s.js";import"./useFormControl-BV-vA5Rt.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-C8K2eoCJ.js";const q={username:"",role:"Inspector",phone:"",case:"",startDate:"",name:"",address:"",postalCode:"",city:"",type:null},me=()=>{const[o,h]=d.useState(q),[b,g]=d.useState(!1),v=W(),[C,N]=d.useState(null),[S,j]=d.useState(null),f=d.useRef(null),[w,F]=d.useState([]),[I,P]=d.useState([]),{companyId:p,projectId:i}=L(),u=a=>{const{name:s,value:t}=a.target;h({...o,[s]:t}),s==="username"&&t&&k(t)},k=async a=>{try{const t=await(await fetch(`${x}/check-user-exists?username=${encodeURIComponent(a)}`)).json();if(t.exists&&t.user){if(h(n=>({...n,name:t.user.name||n.name,phone:t.user.phone||n.phone,address:t.user.address||n.address,city:t.user.city||n.city,postalCode:t.user.postalCode||n.postalCode,startDate:t.user.startDate||n.startDate,type:t.user.type||n.type})),t.user.picture){const n=t.user.picture.startsWith("http")?t.user.picture:`${x.replace("/api","")}/uploads/${t.user.picture}`;j(n)}alert(`User with email ${a} already exists. Form has been auto-filled with existing details. You can modify any fields as needed.`)}}catch(s){console.error("Error checking user existence:",s)}},R=a=>{const s=a.target.files[0];if(N(s),s){const t=URL.createObjectURL(s);j(t)}},A=async a=>{a.preventDefault(),g(!0);try{const s=new FormData;Object.keys(o).forEach(n=>{s.append(n,o[n])}),C&&s.append("picture",C),s.append("companyId",p),s.append("projectsId",i);const t=await fetch(`${x}/store-user`,{method:"POST",body:s});if(t.ok){const n=await t.json();v(`/dashboard/companies/view/${p}`,{state:{success:"Inspector added successfully!"}})}else console.error("Error:",t.statusText)}catch(s){console.error("Fetch error:",s)}g(!1)},T=a=>{o[a.target.name]=a.target.value,h({...o})},$=()=>{N(null),j(null),f.current&&(f.current.value="")};d.useEffect(()=>{p&&i&&E()},[p,i]);const E=async()=>{try{const s=await(await fetch(`${x}/get-inspectors?companyId=${p}`)).json(),n=await(await fetch(`${x}/get-inspectors?companyId=${p}&projectId=${i}`)).json(),U=s.filter(V=>!n.some(O=>O._id===V._id));F(U)}catch(a){console.error("Error fetching workers:",a)}},D=async()=>{try{if(!i)return;const s={userIds:I.map(n=>n._id),projectId:i},t=await fetch(`${x}/updateUser`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(t.ok){const n=await t.json();v(`/dashboard/companies/view/${p}/projects/view/${i}`,{state:{success:"Inspector added successfully!"}})}else console.error("Error:",t.statusText)}catch(a){console.log("Error adding Inspector to project:",a)}};return e.jsxs(e.Fragment,{children:[e.jsx(_,{title:"Add Inspector"}),!i&&e.jsx("form",{onSubmit:A,children:e.jsx(l,{className:"justify-content-center",children:e.jsx(r,{children:e.jsx(B,{title:"Add Inspector",children:e.jsxs(l,{children:[e.jsx(r,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Email"}),e.jsx(r,{sm:"10",children:e.jsx(m,{value:o.username,onChange:u,name:"username",type:"email",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(r,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Name"}),e.jsx(r,{sm:"10",children:e.jsx(m,{value:o.name,onChange:u,name:"name",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(r,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Phone"}),e.jsx(r,{sm:"10",children:e.jsx(m,{value:o.phone,onChange:u,name:"phone",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(r,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Address"}),e.jsx(r,{sm:"10",children:e.jsx(m,{value:o.address,onChange:u,name:"address",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(r,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"City"}),e.jsx(r,{sm:"10",children:e.jsx(m,{value:o.city,onChange:u,name:"city",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(r,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Post Code"}),e.jsx(r,{sm:"10",children:e.jsx(m,{value:o.postalCode,onChange:u,name:"postalCode",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(r,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Start Date"}),e.jsx(r,{sm:"10",children:e.jsx(m,{value:o.startDate,onChange:u,name:"startDate",type:"date",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(r,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(c,{className:"col-sm-2 col-form-label text-end",children:"Select Type"}),e.jsx(r,{sm:"10",children:e.jsxs(H,{value:o.type,name:"type",onChange:T,children:[e.jsx("option",{defaultValue:"",children:"Select Type"}),e.jsx("option",{value:"Architecture",children:"Architecture"}),e.jsx("option",{value:"Engineer",children:"Engineer"}),e.jsx("option",{value:"Fire",children:"Fire"}),e.jsx("option",{value:"Acoustics",children:"Acoustics"}),e.jsx("option",{value:"Technical Subject",children:"Technical Subject"}),e.jsx("option",{value:"Health And Safety",children:"Health And Safety"}),e.jsx("option",{value:"Representative",children:"Representative"}),e.jsx("option",{value:"Trade Union Representaive",children:"Trade Union Representaive"}),e.jsx("option",{value:"Substainablity",children:"Substainablity"})]})})]})}),e.jsx(r,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(c,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Picture"}),e.jsxs(r,{sm:"10",children:[e.jsx(m,{type:"file",id:"file-input",name:"picture",onChange:R,accept:"image/*",ref:f}),S&&e.jsxs("div",{className:"mt-3 position-relative",children:[e.jsx(M,{src:S,alt:"Preview",fluid:!0,rounded:!0,style:{maxWidth:"200px",maxHeight:"200px"}}),e.jsx(y,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:$,style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"Ã—"})]})]})]})}),e.jsx(l,{className:"mb-3 d-flex justify-content-center",children:e.jsx(r,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(y,{disabled:b,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})}),i&&e.jsxs(l,{className:"mb-3",children:[e.jsx(c,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Select Inspector for this Project"}),e.jsxs(r,{sm:"10",children:[e.jsx(z,{multiple:!0,options:w,getOptionLabel:a=>a.name,value:I,onChange:(a,s)=>{P(s)},renderInput:a=>e.jsx(Y,{...a,variant:"outlined",placeholder:"Search and select Inspector..."}),renderTags:(a,s)=>a.map((t,n)=>e.jsx(J,{label:t.name,...s({index:n})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}}),e.jsx(l,{className:"mb-3 mt-3 d-flex justify-content-center",children:e.jsx(r,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(y,{disabled:b,type:"submit",variant:"primary",className:"me-1",onClick:D,children:"Submit"})})})]})]})]})};export{me as default};
