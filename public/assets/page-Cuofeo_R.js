import{r as d,a as P,b as E,j as e,R as m,C as c}from"./index-DBwHp2gR.js";import{C as A}from"./ComponentContainerCard-CGy0xqPX.js";import{P as L}from"./PageMetaData-TYj1ypNn.js";import{B as U}from"./urls-CXtk4x-h.js";import{F as N}from"./FormLabel-fYqbV-Jd.js";import{F as f}from"./FormControl-DppOmn_c.js";import{B as u}from"./Button-CssCL-wi.js";import{F as $}from"./FormSelect-CvP3DY7n.js";import"./Card-Du3hs8TN.js";import"./divWithClassName-Ur-ytTby.js";const _={name:"",description:""},J=()=>{const[p,C]=d.useState(_),[D,j]=d.useState(!1),S=P(),[r,g]=d.useState([]),[x,w]=d.useState([]),[i,h]=d.useState([]),{companyId:v,projectId:b}=E(),y=s=>{const{name:t,value:n}=s.target;C({...p,[t]:n})},F=async s=>{s.preventDefault(),j(!0);try{const t=new FormData;Object.entries(p).forEach(([a,l])=>{t.append(a,l)}),t.append("companyId",v),t.append("projectsId",b),r.forEach(a=>{t.append("mainDrawings",a)}),i.forEach(({file:a})=>{t.append("childDrawings",a)}),i.forEach(({parentMainIndex:a})=>{t.append("childToMainMap",a.toString())});const n=await fetch(`${U}/store-draw`,{method:"POST",body:t});n.ok?S(`/dashboard/companies/view/${v}/projects/view/${b}`,{state:{success:"Drawings & Documents added successfully!"}}):console.error("Upload failed:",n.statusText)}catch(t){console.error("Submit error:",t)}j(!1)},R=(s,t)=>{const n=[...i];n[s].parentMainIndex=parseInt(t),h(n)},I=s=>{const t=[...i];t.splice(s,1),h(t)},M=s=>{const t=r.filter((l,o)=>o!==s),n=x.filter((l,o)=>o!==s);g(t),w(n);const a=i.filter(l=>l.parentMainIndex!==s);h(a)};return e.jsxs(e.Fragment,{children:[e.jsx(L,{title:"Add Drawing"}),e.jsx("form",{onSubmit:F,children:e.jsx(m,{className:"justify-content-center",children:e.jsx(c,{children:e.jsx(A,{title:"Add Dwaring",children:e.jsxs(m,{children:[e.jsx(c,{lg:"6",children:e.jsxs(m,{className:"mb-3",children:[e.jsx(N,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Name"}),e.jsx(c,{sm:"10",children:e.jsx(f,{value:p.name,onChange:y,name:"name",type:"text",id:"example-text-input"})})]})}),e.jsx(c,{lg:"6",children:e.jsxs(m,{className:"mb-3",children:[e.jsx(N,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Description"}),e.jsx(c,{sm:"10",children:e.jsx(f,{value:p.description,onChange:y,name:"description",type:"text",id:"example-text-input"})})]})}),e.jsx("h5",{className:"mt-4",children:"Main Drawings"}),e.jsx(f,{type:"file",accept:"application/pdf",multiple:!0,onChange:s=>{const t=Array.from(s.target.files),n=t.map(o=>URL.createObjectURL(o)),a=[...r,...t],l=[...x,...n];g(a),w(l)}}),e.jsx("div",{className:"mt-3 d-flex flex-wrap",children:x.map((s,t)=>e.jsxs("div",{className:"position-relative me-2 mb-2 text-center",children:[e.jsx("div",{style:{width:100,height:100},className:"d-flex align-items-center justify-content-center border rounded bg-light",children:e.jsx("i",{className:"fas fa-file-pdf",style:{fontSize:"2rem",color:"#dc3545"}})}),e.jsx("div",{className:"small text-muted",children:r[t].name.replace(/\.pdf$/i,"")}),e.jsx(u,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>M(t),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"Ã—"})]},t))}),(r==null?void 0:r.length)>0&&e.jsxs(e.Fragment,{children:[e.jsx("h5",{className:"mt-4",children:"Child Drawings"}),e.jsx(f,{type:"file",accept:"application/pdf",multiple:!0,onChange:s=>{const n=Array.from(s.target.files).map(a=>({file:a,preview:URL.createObjectURL(a),parentMainIndex:0}));h([...i,...n])}})]}),i.map((s,t)=>e.jsxs("div",{className:"d-flex align-items-center mt-3",children:[e.jsx("div",{style:{width:80,height:80},className:"d-flex align-items-center justify-content-center border rounded bg-light me-2",children:e.jsx("i",{className:"fas fa-file-pdf",style:{fontSize:"2rem",color:"#dc3545"}})}),e.jsx("div",{className:"me-3 small text-muted",style:{minWidth:100},children:s.file.name.replace(/\.pdf$/i,"")}),e.jsx($,{value:s.parentMainIndex,onChange:n=>R(t,n.target.value),className:"me-2",style:{width:"200px"},children:r.map((n,a)=>e.jsx("option",{value:a,children:r[a].name.replace(/\.pdf$/i,"")},a))}),e.jsx(u,{variant:"danger",size:"sm",onClick:()=>I(t),children:"Remove"})]},t)),e.jsx(m,{className:"mb-3 d-flex justify-content-center",children:e.jsx(c,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(u,{disabled:D,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{J as default};
