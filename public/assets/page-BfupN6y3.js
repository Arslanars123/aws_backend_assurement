import{r as c,a as T,b as k,j as e,R as l,C as r}from"./index-Ccc50bvq.js";import{C as $}from"./ComponentContainerCard-jOvJBIs5.js";import{B as f}from"./urls-BhGeBsON.js";import{D as A}from"./index-kjW9rcrN.js";import{F as m}from"./FormLabel-MCMdPdRI.js";import{A as h,T as u,C as x}from"./TextField-DlT7K7k6.js";import{B as E}from"./Button-Czdzc6_d.js";import"./Card-Bd-5a1Ef.js";import"./divWithClassName-B0s-A9qq.js";import"./useSlot-CggVarzL.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-BcofISFZ.js";const R={profession:null,user:null,controlPlan:null,comment:null,date:null,drawing:null},M=["understood and is buildable","Approved","is not clearly described","Accepted","Follows the project material"];function K(){const[o,d]=c.useState(R),[j,g]=c.useState(!0),b=T(),{companyId:p,projectId:i,staticReportId:S}=k(),[y,C]=c.useState([]),[N,v]=c.useState([]),[P,I]=c.useState([]);c.useEffect(()=>{(async()=>{try{const n=await(await fetch(`${f}/get-company-professions?companyId=${p}&projectId=${i}`)).json();v(n)}catch(t){console.error("Error fetching professions:",t)}})()},[]),c.useEffect(()=>{o.profession&&o.controlPlan&&o.comment&&o.date&&o.drawing&&g(!1),o.profession&&O()},[o]);const O=async()=>{var s;try{const t={companyId:p,projectId:i,professionsIds:[(s=o==null?void 0:o.profession)==null?void 0:s._id],roles:["Sub Contractor","Worker"]},a=await(await fetch(`${f}/get-filter-users`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();C(a)}catch(t){console.error("Error fetching project managers:",t)}},D=async()=>{try{const t=await(await fetch(`${f}/get-draws?companyId=${p}&projectId=${i}`)).json();I(t)}catch(s){console.error("Error fetching workers:",s)}};c.useEffect(()=>{i&&D()},[p,i]);const w=async()=>{try{const s={...o,projectId:i,staticReportId:S};(await fetch(`${f}/submit-static-report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok&&b(`/dashboard/companies/view/${p}/projects/view/${i}`)}catch(s){console.log("error",s)}};return e.jsx(l,{className:"justify-content-center",children:e.jsx(r,{children:e.jsx($,{title:"Static Reports Submit",children:e.jsxs(l,{children:[e.jsx(r,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Profession"}),e.jsx(r,{sm:"10",children:e.jsx(h,{multiple:!1,options:N,getOptionLabel:s=>s.GroupName,value:o.profession??null,onChange:(s,t)=>{var n;((n=t==null?void 0:t.EuroCode)==null?void 0:n.length)>0&&(t==null?void 0:t.Static_report)==="Y"||!t?d({...o,profession:t}):alert("you can't submit this checklist against this profession")},renderInput:s=>e.jsx(u,{...s,variant:"outlined",placeholder:"Search and select profession..."}),renderTags:(s,t)=>s.map((n,a)=>e.jsx(x,{label:n.GroupName,...t({index:a})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(r,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select User"}),e.jsx(r,{sm:"10",children:e.jsx(h,{multiple:!1,options:y,getOptionLabel:s=>{var t;return`${s.name} (${(t=s.userProfession)==null?void 0:t.map(n=>n.GroupName).join(", ")})`},value:o.user??null,onChange:(s,t)=>{d({...o,user:t})},renderInput:s=>e.jsx(u,{...s,variant:"outlined",placeholder:"Search and select project Manager..."}),renderTags:(s,t)=>s.map((n,a)=>e.jsx(x,{label:n.name,...t({index:a})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(r,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Control Plan"}),e.jsx(r,{sm:"10",children:e.jsx(h,{multiple:!1,options:M,value:o.controlPlan??null,onChange:(s,t)=>{d({...o,controlPlan:t})},renderInput:s=>e.jsx(u,{...s,variant:"outlined",placeholder:"Search and select worker..."}),renderTags:(s,t)=>s.map((n,a)=>e.jsx(x,{label:n,...t({index:a})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(r,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Comment"}),e.jsx(r,{sm:"10",children:e.jsx(u,{variant:"outlined",placeholder:"Add some comments...",value:o==null?void 0:o.comment,onChange:s=>{var t;d({...o,comment:(t=s==null?void 0:s.target)==null?void 0:t.value})}})})]})}),e.jsx(r,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Date"}),e.jsx(r,{sm:"10",children:e.jsx(A,{value:o==null?void 0:o.date,onChange:s=>{const n=s[0].toISOString().split("T")[0];d({...o,date:n})},className:"form-control",options:{dateFormat:"Y-m-d"}})})]})}),e.jsx(r,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(m,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Drawing"}),e.jsx(r,{sm:"10",children:e.jsx(h,{multiple:!1,options:P,getOptionLabel:s=>s.name,value:o==null?void 0:o.drawing,onChange:(s,t)=>{d({...o,drawing:t})},renderInput:s=>e.jsx(u,{...s,variant:"outlined",placeholder:"Search and select drawing..."}),renderTags:(s,t)=>s.map((n,a)=>e.jsx(x,{label:n.name,...t({index:a})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(l,{className:"mb-3 d-flex justify-content-center",children:e.jsx(r,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(E,{variant:"primary",className:"me-1",disabled:j,onClick:w,children:"Submit"})})})]})})})})}export{K as default};
