import{r as h,j as e,R as K,C as D,b as L}from"./index-BMHGnWcK.js";import{C as $}from"./ComponentContainerCard-DqzcDgtW.js";import{R as k}from"./index--BG4zqiO.js";import{B,U as v}from"./urls-CvG9cD6N.js";import{M as b}from"./Modal-BvTxh5Lm.js";import{S as F}from"./Spinner-XoudD7db.js";import{A as M}from"./Alert-BSTIsewH.js";import{I as A}from"./Image-BWlBzfxc.js";import{B as y}from"./Button-Dwvyfso6.js";const _=({show:n,onHide:c,staticReportId:u,projectId:i,rowData:s,companyId:t})=>{const[o,m]=h.useState([]),[f,g]=h.useState(!1),[j,l]=h.useState("");h.useEffect(()=>{n&&i&&s&&t&&P()},[n,i,s,t]);const P=async()=>{if(!s||!i||!t){l("Missing required data");return}g(!0),l("");try{console.log("Fetching entries with:",{rowData:s,projectId:i,companyId:t});const a=await(await fetch(`${B}/get-static-report-entries-by-position`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entryDataPos:s.pos,projectId:i,companyId:t,subjectMatterId:s.subjectMatterId})})).json();a.success?(console.log("Entries fetched successfully:",a.entries),m(a.entries||[])):l(a.message||"Failed to fetch entries")}catch(r){console.error("Error fetching entries:",r),l("Failed to fetch entries")}finally{g(!1)}},S=r=>r?new Date(r).toLocaleDateString():"-";return e.jsxs(b,{show:n,onHide:c,size:"xl",dialogClassName:"modal-90w",children:[e.jsx(b.Header,{closeButton:!0,children:e.jsx(b.Title,{children:"Static Report Entries"})}),e.jsxs(b.Body,{children:[e.jsxs("div",{className:"mb-3",children:[s&&e.jsxs("div",{className:"p-3 border rounded bg-info bg-opacity-10",children:[e.jsx("h6",{children:"Searching for entries with:"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Position:"})," ",s.pos]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Subject:"})," ",s.subject]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Profession:"})," ",s.subjectMatterId]})]}),f&&e.jsxs("div",{className:"text-center mt-3",children:[e.jsx(F,{animation:"border"}),e.jsx("p",{className:"mt-2",children:"Loading entries..."})]})]}),j&&e.jsx(M,{variant:"danger",className:"mb-3",children:j}),o.map((r,a)=>{var d,C,N,E,x,p,I;return e.jsxs("div",{className:"mb-5 p-3 border rounded bg-light",children:[e.jsxs("h5",{children:["Entry ",((d=r.staticReportItem)==null?void 0:d.DS_GroupId)||"-"," ",((C=r.staticReportItem)==null?void 0:C.ItemId)||"-"," #",a+1]}),e.jsxs("p",{children:[e.jsx("strong",{children:"User:"})," ",((N=r.user)==null?void 0:N.name)||"—"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Role:"})," ",((E=r.user)==null?void 0:E.userRole)||((x=r.user)==null?void 0:x.role)||"—"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Control Plan:"})," ",r.controlPlan||"—"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Comment:"})," ",r.comment||"—"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",S(r.date)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"}),e.jsx("span",{className:`badge ms-2 ${r.isSubmitted?"bg-success":"bg-warning"}`,children:r.isSubmitted?"Submitted":"Draft"})]}),((p=r.annotatedPdfs)==null?void 0:p.length)>0&&e.jsxs("div",{className:"my-4",children:[e.jsx("h6",{children:"Annotated PDF"}),e.jsx(A,{src:`${v}/uploads/${r.annotatedPdfs[0].filename}`,fluid:!0,style:{width:"100%",maxHeight:"500px",objectFit:"contain",border:"1px solid #ccc"},alt:r.annotatedPdfs[0].originalName})]}),((I=r.pictures)==null?void 0:I.length)>0&&e.jsxs("div",{children:[e.jsx("h6",{children:"Pictures & Mark Descriptions"}),e.jsx(K,{children:r.pictures.map((R,T)=>e.jsxs(D,{xs:12,md:4,className:"mb-4",children:[e.jsx(A,{src:`${v}/uploads/${R.filename}`,thumbnail:!0,alt:R.originalName,style:{width:"100%",height:"auto"}}),e.jsx("p",{className:"mt-2",children:R.description||"No description"})]},T))})]})]},r._id||a)}),!f&&!j&&o.length===0&&e.jsx(M,{variant:"info",children:"No entries found for this position and profession."})]}),e.jsx(b.Footer,{children:e.jsx(y,{variant:"secondary",onClick:c,children:"Close"})})]})},U=(n,c,u)=>{const i=[{header:"Position",accessorKey:"pos"},{header:"Checking The",accessorKey:"checkingThe"},{header:"Subject",accessorKey:"subject"},{header:"Construction Part",accessorKey:"constructionPart"},{header:"Basis",accessorKey:"basis"},{header:"Control Method",accessorKey:"controlMethod"},{header:"Circumference",accessorKey:"circumference"},{header:"Acceptance Criteria",accessorKey:"acceptanceCriteria",cell:({row:s})=>{const t=s.original.acceptanceCriteria;return t&&t.length>100?e.jsxs("div",{title:t,children:[t.substring(0,100),"..."]}):t||"N/A"}},{header:"Time/Status",accessorKey:"time"},{header:"Row Index",accessorKey:"rowIndex"},{header:"Language",accessorKey:"language",cell:({row:s})=>{const t=s.original.language;return t==="DK"?e.jsx("span",{className:"badge bg-primary",children:"Danish"}):t==="GB"||t==="EN"?e.jsx("span",{className:"badge bg-success",children:"English"}):e.jsx("span",{className:"badge bg-secondary",children:t})}},{header:"Subject Matter ID",accessorKey:"subjectMatterId",cell:({row:s})=>{const t=s.original.subjectMatterId;return!t||t==="N/A"?e.jsx("span",{className:"text-muted",children:"N/A"}):e.jsx("span",{className:"badge bg-primary",children:t})}},{header:"EuroCode",accessorKey:"euroCode",cell:({row:s})=>{const t=s.original.euroCode;return!t||t==="N/A"?e.jsx("span",{className:"text-muted",children:"No EuroCode"}):e.jsx("span",{className:"badge bg-info",children:t})}},{header:"Actions",cell:({row:s})=>e.jsx(y,{variant:"outline-primary",size:"sm",onClick:()=>u(s.original._id,s.original),children:"Entries"})}];return c!=null&&c.showSubmitAction&&n&&i.push({header:"Submit Action",cell:({row:s})=>{var o;return((o=s==null?void 0:s.original)==null?void 0:o.isSubmitted)?null:e.jsx(y,{variant:"info",className:"me-2",onClick:()=>{var m;n(`statics/submit/${(m=s==null?void 0:s.original)==null?void 0:m._id}`,{state:{entryData:s.original,selectedProfessionKey:s.original.subjectMatterId||"KP07"}})},children:"Submit Task"})}}),i},w=({staticsReport:n,refreshData:c,navigate:u,options:i,selectedReport:s,companyId:t,projectId:o})=>{const m=[2,5,10,20,50],[f,g]=h.useState(!1),[j,l]=h.useState(null),[P,S]=h.useState(null),r=L(),a=t||r.companyId,d=o||r.projectId,C=d?`/dashboard/companies/view/${a}/projects/view/${d}/statics/view/`:a?`/dashboard/companies/view/${a}/statics/view/`:"/dashboard/statics/view/",N=(x,p)=>{console.log("Entries clicked for:",{staticReportId:x,rowData:p}),l(x),S(p),g(!0)};console.log("StaticDetailTable - IDs from props:",{companyId:t,projectId:o}),console.log("StaticDetailTable - Final IDs:",{finalCompanyId:a,finalProjectId:d});const E=()=>{g(!1),l(null),S(null)};return e.jsxs(e.Fragment,{children:[e.jsx($,{title:"Static Reports",children:e.jsx(k,{url:"get-statics",refreshData:c,viewUrl:C,columns:U(u,i,N),data:n,rowsPerPageList:m,pageSize:10,tableClass:"datatable",theadClass:"table-light",showPagination:!0,searchable:!0,selectedReport:s})}),e.jsx(_,{show:f,onHide:E,staticReportId:j,projectId:d,rowData:P,companyId:a})]})},X=({staticsReport:n,refreshData:c,navigate:u,options:i,selectedReport:s,companyId:t,projectId:o})=>e.jsx(e.Fragment,{children:e.jsx(K,{className:"justify-content-center",children:e.jsx(D,{xs:12,children:e.jsx(w,{refreshData:c,staticsReport:n,navigate:u,options:i,selectedReport:s,companyId:t,projectId:o})})})});export{X as A};
