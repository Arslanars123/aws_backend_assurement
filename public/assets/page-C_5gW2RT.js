import{r as h,a as M,b as U,j as e,R as j,C as u}from"./index-BMHGnWcK.js";import{C as z}from"./ComponentContainerCard-DqzcDgtW.js";import{P as E}from"./PageMetaData-Bgn24qMg.js";import{B as L}from"./urls-CvG9cD6N.js";import{F as D}from"./FormControl-BhCdWsRE.js";import{B as d}from"./Button-Dwvyfso6.js";import"./Card-BQIi55Il.js";import"./divWithClassName-BnTSImTn.js";import"./FormContext-_pJuLZf_.js";const H=()=>{const[x,g]=h.useState(!1),C=M(),[r,o]=h.useState([]),[w,v]=h.useState([]),[y,f]=h.useState([]),{companyId:b,projectId:F}=U(),S=async i=>{i.preventDefault(),g(!0);try{const s=new FormData;s.append("companyId",b),s.append("projectsId",F);const a=r.map((n,l)=>{const N=w.findIndex(c=>c===n.mainFile),p=n.childFiles.map(c=>y.findIndex(P=>P===c)).filter(c=>c!==-1);return{mainIndex:N,childIndices:p}});s.append("mainDrawingGroups",JSON.stringify(a)),w.forEach(n=>{s.append("mainDrawings",n)}),y.forEach(n=>{s.append("childDrawings",n)});const t=await fetch(`${L}/store-draw`,{method:"POST",body:s});t.ok?C(`/dashboard/companies/view/${b}/projects/view/${F}`,{state:{success:"Drawings & Documents added successfully!"}}):console.error("Upload failed:",t.statusText)}catch(s){console.error("Submit error:",s)}g(!1)},R=i=>{const s=Array.from(i.target.files);if(s.length>0){const a=s[0];v(t=>[...t,a]),o(t=>[...t,{mainFile:a,childFiles:[],preview:URL.createObjectURL(a)}])}},A=(i,s)=>{const a=Array.from(s.target.files);a.length>0&&(f(t=>[...t,...a]),o(t=>{const n=[...t];return n[i]={...n[i],childFiles:[...n[i].childFiles,...a]},n}))},k=i=>{const s=r[i];v(a=>a.filter(t=>t!==s.mainFile)),f(a=>a.filter(t=>!s.childFiles.includes(t))),o(a=>a.filter((t,n)=>n!==i))},G=(i,s)=>{const t=r[i].childFiles[s];f(n=>n.filter(l=>l!==t)),o(n=>{const l=[...n];return l[i]={...l[i],childFiles:l[i].childFiles.filter((N,p)=>p!==s)},l})},m=i=>{const s=URL.createObjectURL(i);window.open(s,"_blank")};return e.jsxs(e.Fragment,{children:[e.jsx(E,{title:"Add Drawing"}),e.jsx("form",{onSubmit:S,children:e.jsx(j,{className:"justify-content-center",children:e.jsx(u,{children:e.jsx(z,{title:"Add Drawing Groups",children:e.jsx(j,{children:e.jsxs(u,{lg:"12",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{children:"Add Main Drawing"}),e.jsx(D,{type:"file",accept:"application/pdf",onChange:R}),e.jsx("small",{className:"text-muted",children:"Select a main drawing file (PDF)"})]}),r.map((i,s)=>e.jsxs("div",{className:"border rounded p-3 mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("h6",{children:["Drawing Group ",s+1]}),e.jsx(d,{variant:"danger",size:"sm",onClick:()=>k(s),children:"Remove Group"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Main Drawing:"}),e.jsxs("div",{className:"d-flex align-items-center mt-2",children:[e.jsx("div",{style:{width:80,height:80},className:"d-flex align-items-center justify-content-center border rounded bg-light me-2 cursor-pointer",onClick:()=>m(i.mainFile),title:"Click to view PDF",children:e.jsx("i",{className:"fas fa-file-pdf",style:{fontSize:"2rem",color:"#dc3545"}})}),e.jsx("div",{className:"small text-muted",children:i.mainFile.name.replace(/\.pdf$/i,"")}),e.jsxs(d,{variant:"outline-primary",size:"sm",className:"ms-2",onClick:()=>m(i.mainFile),children:[e.jsx("i",{className:"fas fa-eye me-1"}),"View"]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Child Drawings:"}),e.jsxs("div",{className:"mt-2",children:[e.jsx(D,{type:"file",accept:"application/pdf",multiple:!0,onChange:a=>A(s,a)}),e.jsx("small",{className:"text-muted",children:"Select child drawing files for this main drawing"})]}),i.childFiles.map((a,t)=>e.jsxs("div",{className:"d-flex align-items-center mt-2",children:[e.jsx("div",{style:{width:60,height:60},className:"d-flex align-items-center justify-content-center border rounded bg-light me-2 cursor-pointer",onClick:()=>m(a),title:"Click to view PDF",children:e.jsx("i",{className:"fas fa-file-pdf",style:{fontSize:"1.5rem",color:"#007bff"}})}),e.jsx("div",{className:"small text-muted me-2",style:{minWidth:150},children:a.name.replace(/\.pdf$/i,"")}),e.jsxs(d,{variant:"outline-primary",size:"sm",className:"me-2",onClick:()=>m(a),children:[e.jsx("i",{className:"fas fa-eye me-1"}),"View"]}),e.jsx(d,{variant:"outline-danger",size:"sm",onClick:()=>G(s,t),children:"Remove"})]},t))]})]},s)),e.jsx(j,{className:"mb-3 d-flex justify-content-center",children:e.jsx(u,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(d,{disabled:x||r.length===0,type:"submit",variant:"primary",className:"me-1",children:x?"Uploading...":"Submit"})})})]})})})})})})]})};export{H as default};
