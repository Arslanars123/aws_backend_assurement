import{r as d,b as L,ab as T,a as U,j as e,R as h,C as r}from"./index-BaEXYFjf.js";import{C as _}from"./ComponentContainerCard-r7D-7GT6.js";import{P as Q}from"./PageMetaData-PSLyQQbJ.js";import{B as i}from"./urls-D3INM0xz.js";import{P as Y}from"./page-C1NjKvsI.js";import{B as n}from"./Button-CHKoWH3g.js";import{F as t}from"./FormLabel-BbxHmEpm.js";import{I as q}from"./Image-CFc3DKY_.js";import{M as c}from"./Modal-BD-tspKu.js";import"./Card-Dy9P-MVM.js";import"./divWithClassName-C80pLmVh.js";import"./FormRange-CU4CgP6g.js";import"./FormContext-kuoxlIs5.js";import"./PDFButton-DhybE3n4.js";import"./useWindow-CC4Mdgns.js";import"./useEventCallback-BlKFiCyd.js";import"./DataKey-COGXBUcQ.js";import"./NoopTransition-BzGmN_3P.js";const he=()=>{var v,w,y,D,$,P,C,k,F;const[S,p]=d.useState(!1),[s,M]=d.useState(null),{noteId:o,companyId:j,projectId:u}=L(),[I]=T(),[f,g]=d.useState({show:!1,pdfFile:null,name:null}),[A,B]=d.useState({}),[E,O]=d.useState(8),[R,m]=d.useState(!1),V=U(),b=I.get("report");d.useEffect(()=>{o&&(p(!0),fetch(`${i}/get-note-detail/${o}`).then(async a=>{const l=await a.json();M(l)}).catch(a=>console.error(a)).finally(()=>p(!1)))},[o]);const N=(a,l)=>{g({show:!0,pdfFile:a,name:l})},W=()=>{m(!0)},z=async()=>{try{const a=await fetch(`${i}/delete-note/${o}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(a.ok){const l=await a.json(),x=u?`/dashboard/companies/view/${j}/projects/view/${u}`:`/dashboard/companies/view/${j}/notes`,H=b?`?report=${encodeURIComponent(b)}`:"";V(`${x}${H}`,{state:{success:"Note deleted successfully!"}}),console.log("Success:",l)}else console.error("Error:",a.statusText)}catch(a){console.error("Fetch error:",a)}m(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(Q,{title:"Address Note"}),S?null:e.jsx(h,{className:"justify-content-center",children:e.jsx(r,{lg:"12",children:e.jsxs(_,{title:"View Note",children:[e.jsx(h,{className:"mb-3",children:e.jsx(r,{className:"d-flex justify-content-end",children:e.jsx(n,{variant:"danger",onClick:W,children:"Delete"})})}),e.jsxs(h,{children:[e.jsx(r,{lg:"6",children:e.jsxs("div",{className:"mb-4",children:[e.jsx(t,{className:"fw-bold text-primary mb-2",children:"Item"}),e.jsx("div",{className:"p-3 bg-light rounded border",children:(s==null?void 0:s.item)||"—"})]})}),e.jsx(r,{lg:"6",children:e.jsxs("div",{className:"mb-4",children:[e.jsx(t,{className:"fw-bold text-primary mb-2",children:"Comments"}),e.jsx("div",{className:"p-3 bg-light rounded border",children:(s==null?void 0:s.comment)||"—"})]})}),e.jsx(r,{lg:"6",children:e.jsxs("div",{className:"mb-4",children:[e.jsx(t,{className:"fw-bold text-primary mb-2",children:"User Name"}),e.jsx("div",{className:"p-3 bg-light rounded border",children:((v=s==null?void 0:s.users)==null?void 0:v.name)||"—"})]})}),e.jsx(r,{lg:"6",children:e.jsxs("div",{className:"mb-4",children:[e.jsx(t,{className:"fw-bold text-primary mb-2",children:"Project Manager"}),e.jsx("div",{className:"p-3 bg-light rounded border",children:((w=s==null?void 0:s.projectManager)==null?void 0:w.name)||"—"})]})}),e.jsx(r,{lg:"6",children:e.jsxs("div",{className:"mb-4",children:[e.jsx(t,{className:"fw-bold text-primary mb-2",children:"Drawing"}),e.jsx("div",{className:"p-3 bg-light rounded border",children:((y=s==null?void 0:s.drawing)==null?void 0:y.name)||"—"})]})}),e.jsx(r,{lg:"12",children:e.jsxs("div",{className:"mb-4",children:[e.jsx(t,{className:"fw-bold text-primary mb-3",children:"Main Drawings"}),e.jsx("div",{className:"p-3 bg-light rounded border",children:(($=(D=s==null?void 0:s.drawing)==null?void 0:D.mainDrawings)==null?void 0:$.length)>0?e.jsx("div",{className:"d-flex flex-wrap gap-3",children:s.drawing.mainDrawings.map((a,l)=>e.jsxs("div",{className:"d-flex flex-column align-items-center p-3 bg-white rounded border",children:[e.jsxs(n,{variant:"outline-primary",className:"mb-2",onClick:()=>N(`${i}/uploads/${a.stored}`,a.original),children:[e.jsx("i",{className:"fas fa-file-pdf me-2"}),"View PDF"]}),e.jsx("div",{className:"small text-muted text-center",style:{maxWidth:"150px"},children:a.original})]},l))}):e.jsx("div",{className:"text-muted",children:"No main drawings available"})})]})}),e.jsx(r,{lg:"12",children:e.jsxs("div",{className:"mb-4",children:[e.jsx(t,{className:"fw-bold text-primary mb-3",children:"Child Drawings"}),e.jsx("div",{className:"p-3 bg-light rounded border",children:((C=(P=s==null?void 0:s.drawing)==null?void 0:P.childDrawings)==null?void 0:C.length)>0?e.jsx("div",{className:"d-flex flex-wrap gap-3",children:s.drawing.childDrawings.map((a,l)=>e.jsxs("div",{className:"d-flex flex-column align-items-center p-3 bg-white rounded border",children:[e.jsxs(n,{variant:"outline-primary",className:"mb-2",onClick:()=>N(`${i}/uploads/${a.stored}`,a.original),children:[e.jsx("i",{className:"fas fa-file-pdf me-2"}),"View PDF"]}),e.jsx("div",{className:"small text-muted text-center",style:{maxWidth:"150px"},children:a.original})]},l))}):e.jsx("div",{className:"text-muted",children:"No child drawings available"})})]})}),e.jsx(r,{lg:"12",children:e.jsxs("div",{className:"mb-4",children:[e.jsx(t,{className:"fw-bold text-primary mb-3",children:"Marked Drawings (Annotated PDFs)"}),e.jsx("div",{className:"p-3 bg-light rounded border",children:((k=s==null?void 0:s.annotatedPdfs)==null?void 0:k.length)>0?e.jsx("div",{className:"d-flex flex-wrap gap-3",children:s.annotatedPdfs.map((a,l)=>e.jsxs("div",{className:"d-flex flex-column align-items-center p-3 bg-white rounded border",children:[e.jsxs("div",{className:"position-relative",children:[e.jsx("img",{src:`${i}/uploads/${a.filename}`,alt:a.originalName||`Annotated PDF ${l+1}`,className:"img-fluid rounded border",style:{maxWidth:"200px",maxHeight:"200px",cursor:"pointer",border:"2px solid #dee2e6"},onClick:()=>window.open(`${i}/uploads/${a.filename}`,"_blank"),onError:x=>{x.target.style.display="none",x.target.nextSibling.style.display="flex"},title:"Click to view full size"}),e.jsxs("div",{style:{display:"none",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"200px",height:"200px",border:"2px dashed #dee2e6",borderRadius:"8px",backgroundColor:"#f8f9fa"},children:[e.jsx("i",{className:"fas fa-file-pdf fa-3x text-muted mb-2"}),e.jsx("div",{className:"small text-muted text-center",children:"PDF Preview not available"}),e.jsx(n,{variant:"outline-primary",size:"sm",className:"mt-2",onClick:()=>window.open(`${i}/uploads/${a.filename}`,"_blank"),children:"View PDF"})]})]}),e.jsx("div",{className:"small text-muted text-center mt-2",style:{maxWidth:"200px"},children:a.originalName||`Annotated PDF ${l+1}`}),l===0&&e.jsxs("div",{className:"small text-success fw-bold mt-1",children:[e.jsx("i",{className:"fas fa-star me-1"}),"First Index"]})]},l))}):e.jsx("div",{className:"text-muted",children:"No annotated PDFs available"})})]})}),e.jsx(r,{lg:"12",children:e.jsxs("div",{className:"mb-4",children:[e.jsx(t,{className:"fw-bold text-primary mb-3",children:"Mark Pictures"}),e.jsx("div",{className:"p-3 bg-light rounded border",children:((F=s==null?void 0:s.pictureObjects)==null?void 0:F.length)>0?e.jsx("div",{className:"d-flex flex-wrap gap-3",children:s.pictureObjects.map((a,l)=>e.jsxs("div",{className:"d-flex flex-column align-items-center p-3 bg-white rounded border",children:[e.jsx(q,{src:`${i}/uploads/${a.filename}`,alt:a.description||`Mark Picture ${l+1}`,fluid:!0,rounded:!0,style:{maxWidth:"150px",maxHeight:"150px",cursor:"pointer",border:"2px solid #dee2e6"},onClick:()=>window.open(`${i}/uploads/${a.filename}`,"_blank"),title:"Click to view full size"}),e.jsx("div",{className:"small text-muted text-center mt-2",style:{maxWidth:"150px"},children:a.description||`Mark Picture ${l+1}`})]},l))}):e.jsx("div",{className:"text-muted",children:"No mark pictures available"})})]})})]})]})})}),f.show&&e.jsx(Y,{drawDotsOnPdf:f,setDrawDotsOnPdf:g,markers:A,setMarkers:B,dotSize:E,setDotSize:O,readOnly:!0}),e.jsxs(c,{show:R,onHide:()=>m(!1),children:[e.jsx(c.Header,{closeButton:!0,children:e.jsx(c.Title,{children:"Confirm Deletion"})}),e.jsx(c.Body,{children:"Are you sure you want to delete this note?"}),e.jsxs(c.Footer,{children:[e.jsx(n,{variant:"secondary",onClick:()=>m(!1),children:"Cancel"}),e.jsx(n,{variant:"danger",onClick:z,children:"Yes, Delete"})]})]})]})};export{he as default};
