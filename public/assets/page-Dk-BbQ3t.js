import{r as n,b as L,ab as U,a as Q,j as e,R as h,C as t}from"./index-CEbbE1Sf.js";import{C as Y}from"./ComponentContainerCard-BpYspYtC.js";import{P as G}from"./PageMetaData-qE4R9bbS.js";import{B as i}from"./urls-CvG9cD6N.js";import{P as J}from"./page-DeLyarp-.js";import{B as d}from"./Button-CWQV4UHt.js";import{F as r}from"./FormLabel-WQTNbj7P.js";import{I as M}from"./Image-ULHo9GWi.js";import{M as o}from"./Modal-C5567GrF.js";import"./Card-mt6mV6AB.js";import"./divWithClassName-CT9nWrpT.js";import"./FormRange-MzNiwPri.js";import"./FormContext-CSwRqVJr.js";import"./PDFButton-m7iMGlez.js";import"./useWindow-Bj2vCJZa.js";import"./useEventCallback-C6szz9nn.js";import"./DataKey-COGXBUcQ.js";import"./NoopTransition-PrPCoCM2.js";const pe=()=>{var w,v,y,$,D,P,k,C,F,S;const[I,p]=n.useState(!0),[a,R]=n.useState(null),{requestId:c,companyId:u,projectId:f}=L(),[W]=U(),[j,g]=n.useState({show:!1,pdfFile:null,name:null}),[z,A]=n.useState({}),[B,E]=n.useState(8),[O,m]=n.useState(!1),V=Q(),b=W.get("report");n.useEffect(()=>{c&&(p(!0),fetch(`${i}/get-request-detail/${c}`).then(async s=>{const l=await s.json();R(l)}).catch(s=>console.error(s)).finally(()=>p(!1)))},[c]);const N=(s,l)=>{g({show:!0,pdfFile:s,name:l})},H=()=>{m(!0)},T=async()=>{try{const s=await fetch(`${i}/delete-request/${c}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(s.ok){const l=await s.json(),x=f?`/dashboard/companies/view/${u}/projects/view/${f}`:`/dashboard/companies/view/${u}/requests`,_=b?`?report=${encodeURIComponent(b)}`:"";V(`${x}${_}`,{state:{success:"Request deleted successfully!"}}),console.log("Success:",l)}else console.error("Error:",s.statusText)}catch(s){console.error("Fetch error:",s)}m(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(G,{title:"Technity Request"}),I?null:e.jsx(h,{className:"justify-content-center",children:e.jsx(t,{lg:"12",children:e.jsxs(Y,{title:"View request",children:[e.jsx(h,{className:"mb-3",children:e.jsx(t,{className:"d-flex justify-content-end",children:e.jsx(d,{variant:"danger",onClick:H,children:"Delete"})})}),e.jsxs(h,{children:[e.jsx(t,{lg:"6",children:e.jsxs("div",{className:"mb-4",children:[e.jsx(r,{className:"fw-bold text-primary mb-2",children:"Item"}),e.jsx("div",{className:"p-3 bg-light rounded border",children:(a==null?void 0:a.item)||"—"})]})}),e.jsx(t,{lg:"6",children:e.jsxs("div",{className:"mb-4",children:[e.jsx(r,{className:"fw-bold text-primary mb-2",children:"Recipient"}),e.jsx("div",{className:"p-3 bg-light rounded border",children:((w=a==null?void 0:a.recipients)==null?void 0:w.name)||"—"})]})}),e.jsx(t,{lg:"6",children:e.jsxs("div",{className:"mb-4",children:[e.jsx(r,{className:"fw-bold text-primary mb-2",children:"Project Manager"}),e.jsx("div",{className:"p-3 bg-light rounded border",children:((v=a==null?void 0:a.projectManager)==null?void 0:v.name)||"—"})]})}),e.jsx(t,{lg:"6",children:e.jsxs("div",{className:"mb-4",children:[e.jsx(r,{className:"fw-bold text-primary mb-2",children:"Drawing"}),e.jsx("div",{className:"p-3 bg-light rounded border",children:((y=a==null?void 0:a.drawing)==null?void 0:y.name)||"—"})]})}),e.jsx(t,{lg:"12",children:e.jsxs("div",{className:"mb-4",children:[e.jsx(r,{className:"fw-bold text-primary mb-3",children:"Main Drawings"}),e.jsx("div",{className:"p-3 bg-light rounded border",children:((D=($=a==null?void 0:a.drawing)==null?void 0:$.mainDrawings)==null?void 0:D.length)>0?e.jsx("div",{className:"d-flex flex-wrap gap-3",children:a.drawing.mainDrawings.map((s,l)=>e.jsxs("div",{className:"d-flex flex-column align-items-center p-3 bg-white rounded border",children:[e.jsxs(d,{variant:"outline-primary",className:"mb-2",onClick:()=>N(`${i}/uploads/${s.stored}`,s.original),children:[e.jsx("i",{className:"fas fa-file-pdf me-2"}),"View PDF"]}),e.jsx("div",{className:"small text-muted text-center",style:{maxWidth:"150px"},children:s.original})]},l))}):e.jsx("div",{className:"text-muted",children:"No main drawings available"})})]})}),e.jsx(t,{lg:"12",children:e.jsxs("div",{className:"mb-4",children:[e.jsx(r,{className:"fw-bold text-primary mb-3",children:"Child Drawings"}),e.jsx("div",{className:"p-3 bg-light rounded border",children:((k=(P=a==null?void 0:a.drawing)==null?void 0:P.childDrawings)==null?void 0:k.length)>0?e.jsx("div",{className:"d-flex flex-wrap gap-3",children:a.drawing.childDrawings.map((s,l)=>e.jsxs("div",{className:"d-flex flex-column align-items-center p-3 bg-white rounded border",children:[e.jsxs(d,{variant:"outline-primary",className:"mb-2",onClick:()=>N(`${i}/uploads/${s.stored}`,s.original),children:[e.jsx("i",{className:"fas fa-file-pdf me-2"}),"View PDF"]}),e.jsx("div",{className:"small text-muted text-center",style:{maxWidth:"150px"},children:s.original})]},l))}):e.jsx("div",{className:"text-muted",children:"No child drawings available"})})]})}),e.jsx(t,{lg:"12",children:e.jsxs("div",{className:"mb-4",children:[e.jsx(r,{className:"fw-bold text-primary mb-3",children:"Marked Drawings (Annotated PDFs)"}),e.jsx("div",{className:"p-3 bg-light rounded border",children:((C=a==null?void 0:a.annotatedPdfs)==null?void 0:C.length)>0?e.jsx("div",{className:"d-flex flex-wrap gap-3",children:a.annotatedPdfs.map((s,l)=>e.jsxs("div",{className:"d-flex flex-column align-items-center p-3 bg-white rounded border",children:[e.jsxs("div",{className:"position-relative",children:[e.jsx("img",{src:`${i}/uploads/${s.filename}`,alt:s.originalName||`Annotated PDF ${l+1}`,className:"img-fluid rounded border",style:{maxWidth:"200px",maxHeight:"200px",cursor:"pointer",border:"2px solid #dee2e6"},onClick:()=>window.open(`${i}/uploads/${s.filename}`,"_blank"),onError:x=>{x.target.style.display="none",x.target.nextSibling.style.display="flex"},title:"Click to view full size"}),e.jsxs("div",{style:{display:"none",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"200px",height:"200px",border:"2px dashed #dee2e6",borderRadius:"8px",backgroundColor:"#f8f9fa"},children:[e.jsx("i",{className:"fas fa-file-pdf fa-3x text-muted mb-2"}),e.jsx("div",{className:"small text-muted text-center",children:"PDF Preview not available"}),e.jsx(d,{variant:"outline-primary",size:"sm",className:"mt-2",onClick:()=>window.open(`${i}/uploads/${s.filename}`,"_blank"),children:"View PDF"})]})]}),e.jsx("div",{className:"small text-muted text-center mt-2",style:{maxWidth:"200px"},children:s.originalName||`Annotated PDF ${l+1}`}),l===0&&e.jsxs("div",{className:"small text-success fw-bold mt-1",children:[e.jsx("i",{className:"fas fa-star me-1"}),"First Index"]})]},l))}):e.jsx("div",{className:"text-muted",children:"No annotated PDFs available"})})]})}),e.jsx(t,{lg:"12",children:e.jsxs("div",{className:"mb-4",children:[e.jsx(r,{className:"fw-bold text-primary mb-3",children:"Mark Pictures"}),e.jsx("div",{className:"p-3 bg-light rounded border",children:((F=a==null?void 0:a.pictureObjects)==null?void 0:F.length)>0?e.jsx("div",{className:"d-flex flex-wrap gap-3",children:a.pictureObjects.map((s,l)=>e.jsxs("div",{className:"d-flex flex-column align-items-center p-3 bg-white rounded border",children:[e.jsx(M,{src:`${i}/uploads/${s.filename}`,alt:s.description||`Mark Picture ${l+1}`,fluid:!0,rounded:!0,style:{maxWidth:"150px",maxHeight:"150px",cursor:"pointer",border:"2px solid #dee2e6"},onClick:()=>window.open(`${i}/uploads/${s.filename}`,"_blank"),title:"Click to view full size"}),e.jsx("div",{className:"small text-muted text-center mt-2",style:{maxWidth:"150px"},children:s.description||`Mark Picture ${l+1}`})]},l))}):((S=a==null?void 0:a.pictures)==null?void 0:S.length)>0?e.jsx("div",{className:"d-flex flex-wrap gap-3",children:a.pictures.map((s,l)=>e.jsxs("div",{className:"d-flex flex-column align-items-center p-3 bg-white rounded border",children:[e.jsx(M,{src:`${i}/uploads/${s}`,alt:`Image ${l+1}`,fluid:!0,rounded:!0,style:{maxWidth:"150px",maxHeight:"150px",cursor:"pointer",border:"2px solid #dee2e6"},onClick:()=>window.open(`${i}/uploads/${s}`,"_blank"),title:"Click to view full size"}),e.jsxs("div",{className:"small text-muted text-center mt-2",children:["Image ",l+1]})]},`existing-${l}`))}):e.jsx("div",{className:"text-muted",children:"No mark pictures available"})})]})})]})]})})}),j.show&&e.jsx(J,{drawDotsOnPdf:j,setDrawDotsOnPdf:g,markers:z,setMarkers:A,dotSize:B,setDotSize:E,readOnly:!0}),e.jsxs(o,{show:O,onHide:()=>m(!1),children:[e.jsx(o.Header,{closeButton:!0,children:e.jsx(o.Title,{children:"Confirm Deletion"})}),e.jsx(o.Body,{children:"Are you sure you want to delete this request?"}),e.jsxs(o.Footer,{children:[e.jsx(d,{variant:"secondary",onClick:()=>m(!1),children:"Cancel"}),e.jsx(d,{variant:"danger",onClick:T,children:"Yes, Delete"})]})]})]})};export{pe as default};
