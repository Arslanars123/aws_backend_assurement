import{r as m,b as U,a as A,c as B,j as e,R as n,C as a}from"./index-CEbbE1Sf.js";import{C as W}from"./ComponentContainerCard-BpYspYtC.js";import{P as k}from"./PageMetaData-qE4R9bbS.js";import{B as x}from"./urls-CvG9cD6N.js";import{F as r}from"./FormLabel-WQTNbj7P.js";import{F as c}from"./FormControl-DFJ9Ydzw.js";import{I as E}from"./Image-ULHo9GWi.js";import{B as p}from"./Button-CWQV4UHt.js";import"./Card-mt6mV6AB.js";import"./divWithClassName-CT9nWrpT.js";import"./FormContext-CSwRqVJr.js";const Y=()=>{const[l,b]=m.useState({username:"",role:"Main Constructor",phone:"",startDate:"",name:"",address:"",postalCode:"",city:"",cvr:"",contactPerson:"",contactPhone:""}),{companyId:v,mainconstructorId:u}=U(),[P,N]=m.useState(null),[y,h]=m.useState(null),[F,R]=m.useState(null),[w,j]=m.useState(null),f=m.useRef(null),C=m.useRef(null),D=A(),{setLoading:d}=B(),i=s=>{const{name:t,value:o}=s.target;b({...l,[t]:o})},S=s=>{const t=s.target.files[0];if(t){N(t);const o=new FileReader;o.onload=g=>{h(g.target.result)},o.readAsDataURL(t)}},$=s=>{const t=s.target.files[0];if(t){R(t);const o=new FileReader;o.onload=g=>{j(g.target.result)},o.readAsDataURL(t)}},I=()=>{N(null),h(null),f.current&&(f.current.value="")},M=()=>{R(null),j(null),C.current&&(C.current.value="")};m.useEffect(()=>{u&&(d(!0),fetch(`${x}/get-user-detail/${u}`).then(async s=>{const t=await s.json();if(b({username:t.username||"",role:t.role||"Main Constructor",phone:t.phone||"",startDate:t.startDate||"",name:t.name||"",address:t.address||"",postalCode:t.postalCode||"",city:t.city||"",cvr:t.cvr||"",contactPerson:t.contactPerson||"",contactPhone:t.contactPhone||""}),t.picture){const o=t.picture.startsWith("http")?t.picture:`${x.replace("/api","")}/uploads/${t.picture}`;h(o)}if(t.contactPicture){const o=t.contactPicture.startsWith("http")?t.contactPicture:`${x.replace("/api","")}/uploads/${t.contactPicture}`;j(o)}console.log("Main Constructor data for form:",t)}).catch(s=>console.error(s)).finally(()=>d(!1)))},[u,d]);const V=async()=>{d(!0);const s=new FormData;Object.keys(l).forEach(t=>{t==="picture"&&P?s.append("picture",P):t==="contactPicture"&&F?s.append("contactPicture",F):s.append(t,l[t])});try{const t=await fetch(`${x}/update-user/${u}`,{method:"POST",body:s});t.ok?D(`/dashboard/companies/view/${v}`):console.error("Error:",t.statusText)}catch(t){console.error("Fetch error:",t)}d(!1)},L=()=>{D(`/dashboard/companies/view/${v}`)};return e.jsxs(e.Fragment,{children:[e.jsx(k,{title:"Edit Main Constructor"}),e.jsx("form",{onSubmit:s=>{s.preventDefault(),V()},children:e.jsx(n,{className:"justify-content-center",children:e.jsx(a,{children:e.jsx(W,{title:"Edit Main Constructor Details",children:e.jsxs(n,{children:[e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(r,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Email"}),e.jsx(a,{sm:"10",children:e.jsx(c,{value:l.username,onChange:i,name:"username",type:"email",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(r,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Name"}),e.jsx(a,{sm:"10",children:e.jsx(c,{value:l.name,onChange:i,name:"name",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(r,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Phone"}),e.jsx(a,{sm:"10",children:e.jsx(c,{value:l.phone,onChange:i,name:"phone",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(r,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Address"}),e.jsx(a,{sm:"10",children:e.jsx(c,{value:l.address,onChange:i,name:"address",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(r,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"City"}),e.jsx(a,{sm:"10",children:e.jsx(c,{value:l.city,onChange:i,name:"city",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(r,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Post Code"}),e.jsx(a,{sm:"10",children:e.jsx(c,{value:l.postalCode,onChange:i,name:"postalCode",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(r,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Start Date"}),e.jsx(a,{sm:"10",children:e.jsx(c,{value:l.startDate,onChange:i,name:"startDate",type:"date",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(r,{className:"col-sm-2 col-form-label text-end",children:"CVR. NR."}),e.jsx(a,{sm:"10",children:e.jsx(c,{value:l.cvr,onChange:i,name:"cvr",type:"text",id:"cvr-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(r,{className:"col-sm-2 col-form-label text-end",children:"Contact Person"}),e.jsx(a,{sm:"10",children:e.jsx(c,{value:l.contactPerson,onChange:i,name:"contactPerson",type:"text",id:"contact-person-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(r,{className:"col-sm-2 col-form-label text-end",children:"Phone (Contact)"}),e.jsx(a,{sm:"10",children:e.jsx(c,{value:l.contactPhone,onChange:i,name:"contactPhone",type:"text",id:"contact-phone-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(r,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Picture"}),e.jsxs(a,{sm:"10",children:[e.jsx(c,{type:"file",id:"file-input",name:"picture",onChange:S,accept:"image/*",ref:f}),y&&e.jsxs("div",{className:"mt-3 position-relative",children:[e.jsx(E,{src:y,alt:"Preview",fluid:!0,rounded:!0,style:{maxWidth:"200px",maxHeight:"200px"}}),e.jsx(p,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:I,style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]})]})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(r,{className:"col-sm-2 col-form-label text-end",children:"Picture (Contact)"}),e.jsxs(a,{sm:"10",children:[e.jsx(c,{type:"file",id:"contact-picture-input",name:"contactPicture",onChange:$,accept:"image/*",ref:C}),w&&e.jsxs("div",{className:"mt-3 position-relative",children:[e.jsx(E,{src:w,alt:"Contact Preview",fluid:!0,rounded:!0,style:{maxWidth:"200px",maxHeight:"200px"}}),e.jsx(p,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:M,style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]})]})]})}),e.jsx(n,{className:"mb-3 d-flex justify-content-center",children:e.jsxs(a,{sm:"12",className:"d-flex justify-content-end",children:[e.jsx(p,{type:"button",variant:"secondary",className:"me-2",onClick:L,children:"Cancel"}),e.jsx(p,{type:"submit",variant:"primary",children:"Update Main Constructor"})]})})]})})})})})]})};export{Y as default};
