import{r as n,G as j,j as e,R as k,C as b,u as g,a9 as S}from"./index-BfjhYpb5.js";import{P as v}from"./PageMetaData-CFx5C9vJ.js";import{C as w}from"./ComponentContainerCard-BbSfpbsX.js";import{R as P}from"./index-CraAetOp.js";import{B as u}from"./urls-CXtk4x-h.js";import{A}from"./Alert-CpIKdS3q.js";import"./Card-CjeZJw7I.js";import"./divWithClassName-CLs3g5aQ.js";import"./Button-0d7iDM-S.js";import"./IconifyIcon-CNRZYeXJ.js";import"./Modal-Cs5seNFI.js";import"./useWindow-DCmLp1st.js";import"./DataKey-COGXBUcQ.js";import"./NoopTransition-dAavQWp2.js";import"./Anchor-DBmynvuj.js";const T=({checks:h,refreshData:i,activatedChecks:o})=>{const r=[2,5,10,20,50],{selectedCompany:l,selectedProjects:d}=n.useContext(j),p=async a=>{try{const t=await(await fetch(`${u}/api/activate-check`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({selectedCompany:l,checkId:a,selectedProjects:d})})).json();t.success?i():console.error(t.error)}catch(c){console.error("Activation error",c)}},s=async a=>{try{const t=await(await fetch(`${u}/api/deactivate-check`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({selectedCompany:l,checkId:a,selectedProjects:d})})).json();t.success?i():console.error(t.error)}catch(c){console.error("Deactivation error",c)}},f=[{header:"Name",accessorKey:"name"},{header:"Status",cell:({row:a})=>{const c=a.original,t=o&&o.find(m=>m.checkId===c._id);return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>p(c._id),disabled:!l||!!t,children:"Activate"}),e.jsx("button",{onClick:()=>s(c._id),disabled:!l||!t,children:"Deactivate"})]})}}];return e.jsx(w,{title:"Checklist",addUrl:"/dashboard/checks/add",children:e.jsx(P,{url:"get-checks",refreshData:i,editUrl:"/dashboard/checks/edit/",viewUrl:"/dashboard/checkss/view/",deleteUrl:"delete-check",columns:f,data:h,rowsPerPageList:r,pageSize:10,tableClass:"datatable",theadClass:"table-light",showPagination:!0,searchable:!0})})},L=({checks:h,refreshData:i})=>{const{selectedCompany:o,selectedProjects:r}=n.useContext(j),[l,d]=n.useState([]);return n.useEffect(()=>{if(!o||!r){d([]);return}(async()=>{try{const s=new URLSearchParams;o&&s.append("selectedCompany",o),r&&s.append("selectedProjects",r);const a=await(await fetch(`${u}/api/company-checks?${s.toString()}`)).json();a.success?d(a.data):console.error(a.error)}catch(s){console.error(s)}})()},[o,i,r]),e.jsx(k,{className:"justify-content-center",children:e.jsx(b,{xs:12,children:e.jsx(T,{refreshData:i,checks:h,activatedChecks:l})})})},q=()=>{var m;const[h,i]=n.useState([]),[o,r]=n.useState(!1),l=g(),[d,p]=n.useState(((m=l.state)==null?void 0:m.success)||""),{selectedCompany:s,selectedProjects:f,companies:a,projects:c}=n.useContext(j);S();const t=async()=>{r(!0);try{const C=new URLSearchParams,x=`${u}/get-checks?${C.toString()}`,y=await(await fetch(x)).json();i(y)}catch(C){console.error(C)}finally{r(!1)}};return n.useEffect(()=>{t()},[s]),e.jsxs(e.Fragment,{children:[d&&e.jsx(A,{variant:"success",dismissible:!0,onClose:()=>p(""),children:d}),e.jsx(v,{title:"Data Tables"}),h&&!o&&e.jsx(L,{refreshData:t,checks:h})]})};export{q as default};
