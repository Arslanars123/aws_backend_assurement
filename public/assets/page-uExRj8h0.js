import{r as d,a as V,b as W,j as e,R as o,C as s}from"./index-DPgj8bsv.js";import{C as L}from"./ComponentContainerCard-DoOo3fSv.js";import{P as U}from"./PageMetaData-BOIE4fT1.js";import{B as x}from"./urls-B0CXljtC.js";import{F as i}from"./FormLabel-DrWgYkuA.js";import{F as p}from"./FormControl-B_1Cr1px.js";import{I as B}from"./Image-VbqUsSSH.js";import{B as j}from"./Button-4B-OZ0gB.js";import{A as _,C as M,T as z}from"./TextField-DE-7kN0j.js";import"./Card-uWXaDKgm.js";import"./divWithClassName-CSK1W61z.js";import"./FormContext-D3odgfWO.js";import"./useFormControl-C1C_dqrR.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-C8K2eoCJ.js";const H={username:"",role:"Safety Coordinator",phone:"",case:"",startDate:"",name:"",address:"",postalCode:"",city:""},le=()=>{const[n,F]=d.useState(H),[y,b]=d.useState(!1),h=V(),[g,C]=d.useState(null),[N,S]=d.useState(null),f=d.useRef(null),[w,I]=d.useState([]),[v,P]=d.useState([]),{companyId:m,projectId:c}=W(),u=a=>{const{name:t,value:r}=a.target;F({...n,[t]:r})},k=a=>{const t=a.target.files[0];if(C(t),t){const r=URL.createObjectURL(t);S(r)}},R=async a=>{if(a.preventDefault(),!m){alert("You must select company"),h("/dashboard/companies");return}b(!0);try{const t=new FormData;Object.keys(n).forEach(l=>{t.append(l,n[l])}),g&&t.append("picture",g),t.append("companyId",m),t.append("projectsId",c);const r=await fetch(`${x}/store-user`,{method:"POST",body:t});if(r.ok){const l=await r.json();h(`/dashboard/companies/view/${m}`,{state:{success:"Safety Coordinator added successfully!"}})}else console.error("Error:",r.statusText)}catch(t){console.error("Fetch error:",t)}b(!1)},E=()=>{C(null),S(null),f.current&&(f.current.value="")};d.useEffect(()=>{m&&c&&$()},[m,c]);const $=async()=>{try{const t=await(await fetch(`${x}/get-safety?companyId=${m}`)).json(),l=await(await fetch(`${x}/get-safety?companyId=${m}&projectId=${c}`)).json(),T=t.filter(D=>!l.some(O=>O._id===D._id));I(T)}catch(a){console.error("Error fetching workers:",a)}},A=async()=>{try{if(!c)return;const t={userIds:v.map(l=>l._id),projectId:c},r=await fetch(`${x}/updateUser`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(r.ok){const l=await r.json();h(`/dashboard/companies/view/${m}/projects/view/${c}`,{state:{success:"Safety Coordinator added successfully!"}})}else console.error("Error:",r.statusText)}catch(a){console.log("Error adding Safety Coordinator to project:",a)}};return e.jsxs(e.Fragment,{children:[e.jsx(U,{title:"Add Safety Coordinator"}),!c&&e.jsx("form",{onSubmit:R,children:e.jsx(o,{className:"justify-content-center",children:e.jsx(s,{children:e.jsx(L,{title:"Add Safety Coordinator",children:e.jsxs(o,{children:[e.jsx(s,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(i,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Email"}),e.jsx(s,{sm:"10",children:e.jsx(p,{value:n.username,onChange:u,name:"username",type:"email",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(s,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(i,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Name"}),e.jsx(s,{sm:"10",children:e.jsx(p,{value:n.name,onChange:u,name:"name",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(s,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(i,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Phone"}),e.jsx(s,{sm:"10",children:e.jsx(p,{value:n.phone,onChange:u,name:"phone",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(s,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(i,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Address"}),e.jsx(s,{sm:"10",children:e.jsx(p,{value:n.address,onChange:u,name:"address",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(s,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(i,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"City"}),e.jsx(s,{sm:"10",children:e.jsx(p,{value:n.city,onChange:u,name:"city",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(s,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(i,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Post Code"}),e.jsx(s,{sm:"10",children:e.jsx(p,{value:n.postalCode,onChange:u,name:"postalCode",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(s,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(i,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Start Date"}),e.jsx(s,{sm:"10",children:e.jsx(p,{value:n.startDate,onChange:u,name:"startDate",type:"date",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(s,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(i,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Picture"}),e.jsxs(s,{sm:"10",children:[e.jsx(p,{type:"file",id:"file-input",name:"picture",onChange:k,accept:"image/*",ref:f}),N&&e.jsxs("div",{className:"mt-3 position-relative",children:[e.jsx(B,{src:N,alt:"Preview",fluid:!0,rounded:!0,style:{maxWidth:"200px",maxHeight:"200px"}}),e.jsx(j,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:E,style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"Ã—"})]})]})]})}),e.jsx(o,{className:"mb-3 d-flex justify-content-center",children:e.jsx(s,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(j,{disabled:y,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})}),c&&e.jsxs(o,{className:"mb-3",children:[e.jsx(i,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Select Safety Coordinator for this Project"}),e.jsxs(s,{sm:"10",children:[e.jsx(_,{multiple:!0,options:w,getOptionLabel:a=>a.name,value:v,onChange:(a,t)=>{P(t)},renderInput:a=>e.jsx(z,{...a,variant:"outlined",placeholder:"Search and select Safety Coordinator..."}),renderTags:(a,t)=>a.map((r,l)=>e.jsx(M,{label:r.name,...t({index:l})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}}),e.jsx(o,{className:"mb-3 mt-3 d-flex justify-content-center",children:e.jsx(s,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(j,{disabled:y,type:"submit",variant:"primary",className:"me-1",onClick:A,children:"Submit"})})})]})]})]})};export{le as default};
