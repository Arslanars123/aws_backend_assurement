import{b as k,r as a,j as e,R as g,C as l}from"./index-S4cPkaXI.js";import{P as G}from"./PageMetaData-u0IuTTri.js";import{A as B}from"./AllDataTables-CJboiS_T.js";import{B as L}from"./urls-DHmWp6-I.js";import{C as j}from"./Card-DerqaWgt.js";import{F as n}from"./Form-B6IVgYSx.js";import"./ComponentContainerCard-CPsL5TPV.js";import"./Button-BdLFNPe1.js";import"./index-C5CN5ils.js";import"./IconifyIcon-Ci7BO_Ix.js";import"./index-DW4LpbCk.js";import"./Table-ByaT0vBF.js";import"./Modal-CdPnefrM.js";import"./useWindow-BrvFrb9Q.js";import"./useEventCallback-CbKveW3s.js";import"./DataKey-COGXBUcQ.js";import"./NoopTransition-DS4YuUbl.js";import"./divWithClassName-23-JlBVG.js";import"./Spinner-CZ_ALDwt.js";import"./Alert-BmsiN9DY.js";import"./hook-DAlenwRK.js";import"./Anchor-BFbjON2V.js";import"./Image-C0iuPhbd.js";import"./FormControl-DZh-Msrb.js";import"./FormContext-3vyf8OR-.js";import"./ElementChildren-fnQRsVCu.js";import"./FormGroup-DoXrZngg.js";import"./FormLabel-xT7fLwVI.js";import"./FormRange-Dn1-Ecm8.js";import"./FormSelect--prDjbZc.js";const ue=()=>{const{companyId:o,projectId:i}=k(),s=i,[f,x]=a.useState([]),[b,I]=a.useState(!1),[C,E]=a.useState([]),[c,S]=a.useState(""),[d,y]=a.useState(""),P=async()=>{try{const t=`${L}/get-company-professions?companyId=${o}&projectId=${s}`,N=await(await fetch(t)).json();E(N)}catch(t){console.error("Error loading professions:",t)}},p=async()=>{if(console.log("🔍 refreshUsers called with:",{companyId:o,projectId:s}),!o||!s){console.log("❌ Company ID or Project ID not available"),console.log("❌ Current state:",{companyId:o,projectId:s});return}console.log("✅ Both IDs available, proceeding with API call"),I(!0);try{const t={companyId:o,projectId:s};if(c){const r=C.find(u=>u._id===c);r!=null&&r.SubjectMatterId&&(t.subjectMatterId=r.SubjectMatterId)}d&&(t.language=d);const h=`${L}/get-controls-of-static-report`;console.log("🔍 API Call Details:"),console.log("  URL:",h),console.log("  Request Body:",t),console.log("  Stringified Body:",JSON.stringify(t)),console.log("  companyId type:",typeof o,"value:",o),console.log("  projectId type:",typeof s,"value:",s);const m=await(await fetch(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json(),v=m.entries.map(r=>{var u,w,D;return{_id:r._id,DS_GroupId:r.euroCode||"N/A",SubjectMatterId:t.subjectMatterId||"N/A","Contol of":r.kontrolAf||"N/A",Subject:r.emne||"N/A","Construction part":r.konstruktionsdel||"N/A","Control methode":r.kontrolMetode||"N/A",language:r.language||"N/A",totalEntries:((u=m.meta)==null?void 0:u.entriesCount)||0,entries:[r],euroCodeSource:((w=m.meta)==null?void 0:w.euroCodeSource)||"unknown",projectEuroCodes:((D=m.meta)==null?void 0:D.euroCodes)||[]}});x(v),console.log("Loaded control documents:",v.length)}catch(t){console.error("Error loading control documents:",t),x([])}finally{I(!1)}};a.useEffect(()=>{console.log("🔍 useParams extracted:",{companyId:o,urlProjectId:i,projectId:s}),console.log("🔍 Using fallback project ID:",!i),console.log("🔍 Current URL:",window.location.href),console.log("🔍 Current pathname:",window.location.pathname),console.log("🔍 Current search params:",window.location.search)},[o,i,s]),a.useEffect(()=>{console.log("🔄 Professions useEffect triggered:",{companyId:o,projectId:s}),o&&s?(console.log("✅ Loading professions for:",{companyId:o,projectId:s}),P()):console.log("❌ Missing IDs for professions:",{companyId:o,projectId:s})},[o,s]),a.useEffect(()=>{console.log("🔄 Initial load useEffect triggered:",{companyId:o,projectId:s}),o&&s?(console.log("✅ Initial load of control documents for:",{companyId:o,projectId:s}),p()):console.log("❌ Missing IDs for initial load:",{companyId:o,projectId:s})},[o,s]),a.useEffect(()=>{console.log("🔄 useEffect triggered:",{companyId:o,projectId:s,selectedProfession:c,selectedLanguage:d}),o&&s?(console.log("✅ Both IDs available, calling refreshUsers"),p()):console.log("❌ Missing IDs, skipping refreshUsers:",{companyId:o,projectId:s})},[c,d,o,s]);const A=t=>{S(t.target.value)},R=t=>{y(t.target.value)},M=()=>{S(""),y("")};return e.jsxs(e.Fragment,{children:[e.jsx(G,{title:"Static Reports"}),e.jsx(g,{children:e.jsx(l,{children:e.jsxs(j,{children:[e.jsx(j.Header,{children:e.jsx("h4",{className:"card-title mb-0",children:"Static Reports"})}),e.jsxs(j.Body,{children:[e.jsxs(g,{className:"mb-3",children:[o&&e.jsx(l,{md:3,children:e.jsx(n.Group,{children:e.jsxs(n.Label,{children:["Company ID: ",o||"Not found"]})})}),s&&e.jsx(l,{md:3,children:e.jsx(n.Group,{children:e.jsxs(n.Label,{children:["Project ID: ",s,!i&&e.jsx("span",{className:"text-warning",children:" (Fallback)"})]})})}),o&&s&&e.jsx(l,{md:3,children:e.jsx(n.Group,{children:e.jsxs(n.Label,{children:["Status: ",o&&s?"Ready":"Missing IDs"]})})}),e.jsx(l,{md:3,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{children:" "}),e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-info me-2",onClick:()=>window.location.href="/dashboard/statics/management",children:"📊 Document Entries Management"}),o&&s&&e.jsx("button",{className:"btn btn-success",onClick:()=>window.location.href=`/dashboard/companies/view/${o}/projects/view/${s}/statics/signatures`,children:"✍️ Static Report Signatures"})]})]})})]}),e.jsxs(g,{className:"mb-3",children:[e.jsx(l,{md:4,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{children:"Profession"}),e.jsxs(n.Select,{value:c,onChange:A,children:[e.jsx("option",{value:"",children:"All Professions"}),C.map(t=>e.jsxs("option",{value:t._id,children:[t.GroupName," (",t.SubjectMatterId,")"]},t._id))]})]})}),e.jsx(l,{md:4,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{children:"Language"}),e.jsxs(n.Select,{value:d,onChange:R,children:[e.jsx("option",{value:"",children:"All Languages"}),e.jsx("option",{value:"DK",children:"Danish"}),e.jsx("option",{value:"EN",children:"English"})]})]})}),e.jsx(l,{md:4,children:e.jsxs(n.Group,{children:[e.jsx(n.Label,{children:" "}),e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-secondary me-2",onClick:M,children:"Clear Filters"}),e.jsx("button",{className:"btn btn-primary",onClick:p,disabled:!o||!s,children:"Refresh Data"})]})]})})]}),b&&e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"spinner-border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}),f&&!b&&e.jsx("div",{children:e.jsx(B,{staticsReport:f,refreshData:p,options:{showSubmitAction:!0},companyId:o,projectId:s})})]})]})})})]})};export{ue as default};
