import{r as c,a as q,b as K,j as e,R as n,C as a}from"./index-Bhcfarzr.js";import{C as Q}from"./ComponentContainerCard-CdRpaZOK.js";import{P as X}from"./PageMetaData-D1yst4PP.js";import{B as h}from"./urls-BhGeBsON.js";import{F as i}from"./FormLabel-DMds24G0.js";import{F as u}from"./FormControl-7WYzlHOA.js";import{A as k,T as O,C as R}from"./TextField-Cu90f4AT.js";import{F as Z}from"./FormSelect-D2SUClsr.js";import{I as ee}from"./Image-C3Ku7nKI.js";import{B as b}from"./Button-COOVOJrI.js";import"./Card-CWpROabE.js";import"./divWithClassName-DTdHczRx.js";import"./useSlot-B59Th0xZ.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-BcofISFZ.js";const se={username:"",password:"",role:"Sub Contractor",phone:"",startDate:"",name:"",address:"",postalCode:"",city:"",isProjectManager:null},be=()=>{const[o,g]=c.useState(se),[y,C]=c.useState(!1),f=q(),[N,S]=c.useState(null),[v,P]=c.useState(null),j=c.useRef(null),[x,T]=c.useState([]),[w,E]=c.useState([]),[$,V]=c.useState([]),[F,A]=c.useState([]),I=c.useRef(!1),{companyId:d,projectId:m}=K(),p=t=>{const{name:s,value:r}=t.target;g({...o,[s]:r})},D=t=>{const s=t.target.files[0];if(S(s),s){const r=URL.createObjectURL(s);P(r)}},W=async t=>{if(t.preventDefault(),!d){alert("You must select company"),f("/dashboard/companies");return}for(const[s,r]of Object.entries(o))if(r===""||r===null){alert(`Please fill out the "${s}" field.`);return}C(!0);try{const s=new FormData;Object.keys(o).forEach(l=>{s.append(l,o[l])}),N&&s.append("picture",N),s.append("companyId",d),s.append("projectsId",m),s.append("userProfession",JSON.stringify(w));const r=await fetch(`${h}/store-user`,{method:"POST",body:s});if(r.ok){const l=await r.json();f(`/dashboard/companies/view/${d}`,{state:{success:"Sub Contractor added successfully!"}})}else console.error("Error:",r.statusText)}catch(s){console.error("Fetch error:",s)}C(!1)},M=t=>{o[t.target.name]=t.target.value,g({...o})},L=()=>{S(null),P(null),j.current&&(j.current.value="")},U=async()=>{try{const s=await(await fetch(`${h}/get-company-professions?companyId=${d}&projectId=${m}`)).json();if(!(s!=null&&s.length)&&!I.current){I.current=!0,alert("You did not have any Profession so need to add Profession in a Company"),f(`/dashboard/companies/view/${d}`);return}T(s)}catch(t){console.error("Error fetching professions:",t)}};c.useEffect(()=>{U()},[d,m]),c.useEffect(()=>{if(x!=null&&x.length&&d&&m){const t=x.map(s=>s._id);_(t)}},[x]);const _=async t=>{try{const s={companyId:d,professionsIds:t,roles:["Sub Contractor"]},l=await(await fetch(`${h}/get-filter-users`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json(),J={companyId:d,professionsIds:t,projectId:m,roles:["Sub Contractor"]},Y=await(await fetch(`${h}/get-filter-users`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(J)})).json(),G=l.filter(z=>!Y.some(H=>H._id===z._id));V(G)}catch(s){console.error("Error fetching workers:",s)}},B=async()=>{try{if(!m)return;const s={userIds:F.map(l=>l._id),projectId:m},r=await fetch(`${h}/updateUser`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(r.ok){const l=await r.json();f(`/dashboard/companies/view/${d}/projects/view/${m}`,{state:{success:"Sub Contractor added successfully!"}})}else console.error("Error:",r.statusText)}catch(t){console.log("Error adding Sub Contractor to project:",t)}};return e.jsxs(e.Fragment,{children:[e.jsx(X,{title:"Add Sub Contractor"}),!m&&e.jsx("form",{onSubmit:W,children:e.jsx(n,{className:"justify-content-center",children:e.jsx(a,{children:e.jsx(Q,{title:"Add Sub Contractor",children:e.jsxs(n,{children:[e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(i,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Email"}),e.jsx(a,{sm:"10",children:e.jsx(u,{value:o.username,onChange:p,name:"username",type:"email",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(i,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Name"}),e.jsx(a,{sm:"10",children:e.jsx(u,{value:o.name,onChange:p,name:"name",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(i,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Phone"}),e.jsx(a,{sm:"10",children:e.jsx(u,{value:o.phone,onChange:p,name:"phone",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(i,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Password"}),e.jsx(a,{sm:"10",children:e.jsx(u,{value:o.password,onChange:p,name:"password",type:"password",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(i,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Address"}),e.jsx(a,{sm:"10",children:e.jsx(u,{value:o.address,onChange:p,name:"address",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(i,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"City"}),e.jsx(a,{sm:"10",children:e.jsx(u,{value:o.city,onChange:p,name:"city",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(i,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Post Code"}),e.jsx(a,{sm:"10",children:e.jsx(u,{value:o.postalCode,onChange:p,name:"postalCode",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(i,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Profession"}),e.jsx(a,{sm:"10",children:e.jsx(k,{multiple:!0,options:x,getOptionLabel:t=>t.GroupName,value:w,onChange:(t,s)=>{E(s)},renderInput:t=>e.jsx(O,{...t,variant:"outlined",placeholder:"Search and select professions..."}),renderTags:(t,s)=>t.map((r,l)=>e.jsx(R,{label:r.GroupName,...s({index:l})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(i,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Start Date"}),e.jsx(a,{sm:"10",children:e.jsx(u,{value:o.startDate,onChange:p,name:"startDate",type:"date",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(i,{className:"col-sm-2 col-form-label text-end",children:"Is project Manager"}),e.jsx(a,{sm:"10",children:e.jsxs(Z,{value:o.isProjectManager,name:"isProjectManager",onChange:M,children:[e.jsx("option",{defaultValue:"",children:"Select"}),e.jsx("option",{value:"yes",children:"Yes"}),e.jsx("option",{value:"No",children:"No"})]})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(i,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Picture"}),e.jsxs(a,{sm:"10",children:[e.jsx(u,{type:"file",id:"file-input",name:"picture",onChange:D,accept:"image/*",ref:j}),v&&e.jsxs("div",{className:"mt-3 position-relative",children:[e.jsx(ee,{src:v,alt:"Preview",fluid:!0,rounded:!0,style:{maxWidth:"200px",maxHeight:"200px"}}),e.jsx(b,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:L,style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"Ã—"})]})]})]})}),e.jsx(n,{className:"mb-3 d-flex justify-content-center",children:e.jsx(a,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(b,{disabled:y,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})}),m&&e.jsxs(n,{className:"mb-3",children:[e.jsx(i,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Select Sub Contractor for this Project"}),e.jsxs(a,{sm:"10",children:[e.jsx(k,{multiple:!0,options:$,getOptionLabel:t=>t.name,value:F,onChange:(t,s)=>{A(s)},renderInput:t=>e.jsx(O,{...t,variant:"outlined",placeholder:"Search and select Sub Contractor..."}),renderTags:(t,s)=>t.map((r,l)=>e.jsx(R,{label:r.name,...s({index:l})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}}),e.jsx(n,{className:"mb-3 mt-3 d-flex justify-content-center",children:e.jsx(a,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(b,{disabled:y,type:"submit",variant:"primary",className:"me-1",onClick:B,children:"Submit"})})})]})]})]})};export{be as default};
