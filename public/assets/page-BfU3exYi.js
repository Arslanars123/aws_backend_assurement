import{r as d,j as e,R as g,C as l,c as V,G as _,b as M,ab as J}from"./index-BaEXYFjf.js";import{C as K}from"./ComponentContainerCard-r7D-7GT6.js";import{B as u}from"./urls-D3INM0xz.js";import{D as H}from"./DetailPage-HliMF9Wi.js";import{P as U}from"./page-C1NjKvsI.js";import{F as G,d as W,e as q,g as Q}from"./index-B6wZVkes.js";import{C as T}from"./Card-Dy9P-MVM.js";import{F as p}from"./Form-DRj-Cje_.js";import{I}from"./InputGroup-BkVTh1Pr.js";import{B}from"./Button-CHKoWH3g.js";import{B as w}from"./Badge-CGbEeV-k.js";import{L as R}from"./ListGroup-DNUTY32w.js";import"./FormLabel-BbxHmEpm.js";import"./FormContext-kuoxlIs5.js";import"./Modal-BD-tspKu.js";import"./useWindow-CC4Mdgns.js";import"./useEventCallback-BlKFiCyd.js";import"./DataKey-COGXBUcQ.js";import"./NoopTransition-BzGmN_3P.js";import"./divWithClassName-C80pLmVh.js";import"./Image-CFc3DKY_.js";import"./FormRange-CU4CgP6g.js";import"./PDFButton-DhybE3n4.js";import"./FormControl-ZQh5JFHF.js";import"./ElementChildren-C1IvTjgI.js";import"./FormGroup-CYZ2QzZ_.js";import"./FormSelect-Bf0Zl-q8.js";import"./InputGroupContext-DbP9tqEd.js";import"./hook-D-pj7GmZ.js";import"./Nav-C-5lqCHd.js";import"./NavContext-D56za5xL.js";const X=({staticReportId:x,projectId:f})=>{const[t,b]=d.useState([]),[C,O]=d.useState([]),[P,S]=d.useState(!1),[N,L]=d.useState([]),[j,k]=d.useState(""),[m,E]=d.useState(""),[h,A]=d.useState(!1);d.useEffect(()=>{f&&D()},[f]),d.useEffect(()=>{x&&f&&F()},[x,f,j,h]),d.useEffect(()=>{$()},[t,m,j]);const D=async()=>{try{const n=await(await fetch(`${u}/get-project-detail`,{method:"POST",body:JSON.stringify({projectId:f}),headers:{"Content-Type":"application/json"}})).json(),c=Object.keys((n==null?void 0:n.professionAssociatedData)||{}).map(r=>{var a,o,v,z;return{key:r,name:((o=(a=n.professionAssociatedData[r])==null?void 0:a.profession)==null?void 0:o.GroupName)||r,id:((z=(v=n.professionAssociatedData[r])==null?void 0:v.profession)==null?void 0:z.SubjectMatterId)||r}});L(c)}catch(s){console.error("Error fetching professions:",s)}},F=async()=>{S(!0);try{let s=`${u}/get-static-report-entries?projectId=${f}`;j&&(s+=`&professionId=${j}`);const c=await(await fetch(s)).json();if(console.log("API Response:",c),console.log("Looking for static report ID:",x),console.log("Available entry IDs:",c.map(r=>r.staticReportId)||[]),Array.isArray(c)){let r=c;x&&!h?(r=c.filter(a=>a.staticReportId===x),console.log("Found entries for static report:",x,r.length)):console.log("Showing all entries:",r.length),b(r)}else console.log("No entries found in response"),b([])}catch(s){console.error("Error fetching entries:",s),b([])}finally{S(!1)}},$=()=>{let s=t;m&&(s=s.filter(n=>{var c,r;return(((c=n.user)==null?void 0:c.name)||"").toLowerCase().includes(m.toLowerCase())||(((r=n.independentController)==null?void 0:r.name)||"").toLowerCase().includes(m.toLowerCase())||(n.comment||"").toLowerCase().includes(m.toLowerCase())||(n.controlPlan||"").toLowerCase().includes(m.toLowerCase())||(n.professionName||"").toLowerCase().includes(m.toLowerCase())||(n.staticReportId||"").toLowerCase().includes(m.toLowerCase())||(n.projectName||"").toLowerCase().includes(m.toLowerCase())})),O(s)},y=s=>s?new Date(s).toLocaleString():"N/A",i=(s,n)=>{window.open(`${u}/uploads/${s}`,"_blank")};return e.jsxs(T,{className:"mt-4",children:[e.jsx(T.Header,{children:e.jsx("h5",{className:"mb-0",children:"Static Report Entries"})}),e.jsxs(T.Body,{children:[e.jsxs(g,{className:"mb-3",children:[e.jsx(l,{md:3,children:e.jsxs(p.Group,{children:[e.jsx(p.Label,{children:"Select Profession"}),e.jsxs(p.Select,{value:j,onChange:s=>k(s.target.value),children:[e.jsx("option",{value:"",children:"All Professions"}),N.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.id,")"]},s.key))]})]})}),e.jsx(l,{md:6,children:e.jsxs(p.Group,{children:[e.jsx(p.Label,{children:"Search Entries"}),e.jsxs(I,{children:[e.jsx(I.Text,{children:e.jsx(G,{icon:W})}),e.jsx(p.Control,{type:"text",placeholder:"Search by submitter, comment, control plan, or profession...",value:m,onChange:s=>E(s.target.value)})]})]})}),e.jsx(l,{md:3,children:e.jsxs(p.Group,{children:[e.jsx(p.Label,{children:"Â "}),e.jsx("div",{children:e.jsx(B,{variant:h?"primary":"outline-primary",size:"sm",onClick:()=>A(!h),className:"w-100",children:h?"Show This Report Only":"Show All Entries"})})]})})]}),P?e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{children:"Loading entries..."})}):C.length>0?e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("h6",{children:["Found ",C.length," entries",!h&&x&&e.jsx("span",{className:"text-muted ms-2",children:"(for this static report)"}),h&&e.jsx("span",{className:"text-muted ms-2",children:"(all project entries)"})]}),e.jsxs("div",{children:[e.jsx(w,{bg:"info",className:"me-2",children:j||"All Professions"}),h&&e.jsx(w,{bg:"warning",children:"All Entries"})]})]}),e.jsx(R,{children:C.map((s,n)=>{var c,r;return e.jsx(R.Item,{className:"mb-3",children:e.jsxs(g,{children:[e.jsxs(l,{md:8,children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Submitted by:"})," ",((c=s.user)==null?void 0:c.name)||((r=s.independentController)==null?void 0:r.name)||"N/A",s.user&&e.jsx(w,{bg:"secondary",className:"ms-2",children:"Project Manager/Worker"}),s.independentController&&e.jsx(w,{bg:"info",className:"ms-2",children:"Independent Controller"}),h&&e.jsxs(e.Fragment,{children:[e.jsx(w,{bg:"primary",className:"ms-2",children:s.professionName}),e.jsx(w,{bg:"dark",className:"ms-2",children:s.projectName})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Date:"})," ",y(s.date)]}),s.comment&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Comment:"}),e.jsx("p",{className:"mb-0 text-muted",children:s.comment})]}),s.controlPlan&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Control Plan:"}),e.jsx("p",{className:"mb-0 text-muted",children:s.controlPlan})]}),s.drawing&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Drawing:"}),e.jsx("p",{className:"mb-0 text-muted",children:s.drawing.name})]})]}),e.jsx(l,{md:4,children:e.jsxs("div",{className:"text-end",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Entry ID:"})," ",s.staticReportId]}),s.annotatedPdfs&&s.annotatedPdfs.length>0&&e.jsxs("div",{children:[e.jsxs("strong",{children:["Annotated PDFs (",s.annotatedPdfs.length,"):"]}),e.jsx("div",{className:"mt-2",children:s.annotatedPdfs.map((a,o)=>e.jsx("div",{className:"mb-1",children:e.jsxs(B,{variant:"outline-primary",size:"sm",onClick:()=>i(a.filename,a.originalName),className:"w-100",children:[e.jsx(G,{icon:q,className:"me-1"}),a.originalName||a.filename]})},o))})]}),s.pictures&&s.pictures.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("strong",{children:["Pictures (",s.pictures.length,"):"]}),e.jsx("div",{className:"mt-2",children:s.pictures.map((a,o)=>e.jsxs("div",{className:"mb-1",children:[e.jsxs(B,{variant:"outline-success",size:"sm",onClick:()=>i(a.filename,a.originalName),className:"w-100",children:[e.jsx(G,{icon:Q,className:"me-1"}),a.originalName||a.filename]}),a.description&&e.jsx("small",{className:"text-muted d-block",children:a.description})]},o))})]})]})})]})},n)})})]}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-muted",children:t.length===0?"No entries found for this static report.":"No entries match your search criteria."})})]})]})},De=()=>{var E,h,A,D,F,$,y;const{setLoading:x}=V(),{selectedProfessionKey:f}=d.useContext(_),[t,b]=d.useState(null),[C,O]=d.useState(null),[P,S]=d.useState({show:!1,pdfFile:null,name:null}),{staticId:N,projectId:L}=M(),[j]=J();j.get("report");const k=async()=>{var i;try{x(!0);const n=await(await fetch(`${u}/get-project-detail`,{method:"POST",body:JSON.stringify({projectId:L}),headers:{"Content-Type":"application/json"}})).json(),c=f||Object.keys(n==null?void 0:n.professionAssociatedData)[0],r=n==null?void 0:n.professionAssociatedData[c],a=(i=r==null?void 0:r.staticReportRegistration)==null?void 0:i.find(o=>{var v;return((v=o==null?void 0:o._id)==null?void 0:v.toString())===(N==null?void 0:N.toString())});if(a){b(a);const o={...a};delete o._id,delete o.annotatedPdfs,delete o.drawing,delete o.pictureObjects,delete o.pictures,O(o)}}catch(s){console.error("Error fetching static report:",s)}finally{x(!1)}};d.useEffect(()=>{k()},[f]);const m=(i,s)=>{S({show:!0,pdfFile:i,name:s})};return e.jsxs(g,{className:"justify-content-center",children:[e.jsx(l,{lg:"12",children:e.jsx(K,{title:"View static",children:e.jsxs(g,{children:[e.jsx(H,{data:C}),(t==null?void 0:t.drawing)&&e.jsxs(e.Fragment,{children:[e.jsx(l,{lg:"12",children:e.jsxs(g,{className:"mb-2",children:[e.jsx(l,{sm:"2",className:"text-end",children:e.jsx("strong",{children:"Main Drawings:"})}),e.jsx(l,{sm:"10",children:(h=(E=t==null?void 0:t.drawing)==null?void 0:E.mainDrawings)==null?void 0:h.map((i,s)=>e.jsxs("div",{className:"mb-2 d-flex align-items-center",children:[e.jsx("div",{className:"me-2 cursor-pointer",onClick:()=>m(`${u}/uploads/${i.stored}`,i.original),children:e.jsx("i",{className:"fas fa-file-pdf",style:{fontSize:"2rem",color:"#dc3545"}})}),e.jsx("div",{className:"small text-muted",children:i.original})]},s))})]})}),((D=(A=t==null?void 0:t.drawing)==null?void 0:A.childDrawings)==null?void 0:D.length)>0&&e.jsx(l,{lg:"12",children:e.jsxs(g,{className:"mb-2",children:[e.jsx(l,{sm:"2",className:"text-end",children:e.jsx("strong",{children:"Child Drawings:"})}),e.jsx(l,{sm:"10",children:($=(F=t==null?void 0:t.drawing)==null?void 0:F.childDrawings)==null?void 0:$.map((i,s)=>e.jsxs("div",{className:"mb-2 d-flex align-items-center",children:[e.jsx("div",{className:"me-2 cursor-pointer",onClick:()=>m(`${u}/uploads/${i.stored}`,i.original),children:e.jsx("i",{className:"fas fa-file-pdf",style:{fontSize:"2rem",color:"#dc3545"}})}),e.jsx("div",{className:"small text-muted",children:i.original})]},s))})]})})]}),(t==null?void 0:t.annotatedPdfs)&&t.annotatedPdfs.length>0&&e.jsx(l,{lg:"12",children:e.jsxs(g,{className:"mb-3",children:[e.jsx(l,{sm:"2",className:"text-end",children:e.jsx("strong",{children:"Annotated PDFs:"})}),e.jsx(l,{sm:"10",className:"d-flex flex-wrap",children:(y=t==null?void 0:t.annotatedPdfs)==null?void 0:y.map((i,s)=>e.jsxs("div",{className:"mb-2 d-flex align-items-center",children:[e.jsx("div",{className:"me-2 cursor-pointer",onClick:()=>m(`${u}/uploads/${i.filename}`,i.originalName),children:e.jsx("i",{className:"fas fa-file-pdf",style:{fontSize:"2rem",color:"#dc3545"}})}),e.jsx("div",{className:"small text-muted",children:i.originalName})]},s))})]})})]})})}),e.jsx(l,{lg:"12",className:"mt-4",children:e.jsx(X,{staticReportId:N,projectId:L})}),P.show&&e.jsx(U,{drawDotsOnPdf:P,setDrawDotsOnPdf:S,readOnly:!0})]})};export{De as default};
