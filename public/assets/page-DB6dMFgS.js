import{r as l,a as M,b as k,c as A,j as e,R as r,C as n}from"./index-CAFh8Qe-.js";import{C as O}from"./ComponentContainerCard-BHLb5dlU.js";import{B as h}from"./urls-D84fNQqS.js";import{D as T}from"./index-Dr2mlVQe.js";import{F as d}from"./FormLabel-DJooOqJq.js";import{A as j,C as f,T as p}from"./TextField-DXeN24BL.js";import{B as $}from"./Button-DUm19Z6r.js";import"./Card-B6ongrnB.js";import"./divWithClassName-Ds10gy6J.js";import"./FormContext-CVQotS7s.js";import"./useFormControl-BV-vA5Rt.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-C8K2eoCJ.js";const E={profession:null,controlPlan:null,comment:null,date:null,projectManager:null,approvedDate:null},L=["understood and is buildable","Approved","is not clearly described","Accepted","Follows the project material"];function W(){const[o,c]=l.useState(E),[g,b]=l.useState(!0),S=M(),{companyId:u,projectId:m,staticDocumentCheckListId:C}=k(),{setLoading:x}=A(),[y,v]=l.useState([]),[N,P]=l.useState([]);l.useEffect(()=>{(async()=>{try{const a=await(await fetch(`${h}/get-company-professions?companyId=${u}&projectId=${m}`)).json();P(a)}catch(t){console.error("Error fetching professions:",t)}})(),D()},[]),l.useEffect(()=>{o.profession&&o.controlPlan&&o.comment&&o.date&&(o!=null&&o.projectManager)&&b(!1)},[o]);const I=async()=>{try{const s={...o,projectId:m,staticDocumentCheckListId:C,approvedDate:null};(await fetch(`${h}/submit-static-document-checklist`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok&&S(`/dashboard/companies/view/${u}/projects/view/${m}`)}catch(s){console.log("error",s)}},D=async()=>{x(!0);try{const s=`${h}/get-project-managers?companyId=${u}&projectId=${m}&userRole=Project Manager`,a=await(await fetch(s)).json();Array.isArray(a)&&a.length>0?console.log("First Project Manager ID:",a.length):console.log("No project managers found."),v(a)}catch(s){console.error("Error fetching project managers:",s)}finally{x(!1)}};return e.jsx(r,{className:"justify-content-center",children:e.jsx(n,{children:e.jsx(O,{title:"Submit Static Document Check List Submit",children:e.jsxs(r,{children:[e.jsx(n,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(d,{className:"col-sm-2 col-form-label text-end",children:"Select Profession"}),e.jsx(n,{sm:"10",children:e.jsx(j,{multiple:!1,options:N,getOptionLabel:s=>s.GroupName,value:o.profession??null,onChange:(s,t)=>{var a;((a=t==null?void 0:t.EuroCode)==null?void 0:a.length)>0&&(t==null?void 0:t.Static_report)==="Y"||!t?c({...o,profession:t}):alert("you can't submit this checklist against this profession")},renderInput:s=>e.jsx(p,{...s,variant:"outlined",placeholder:"Search and select profession..."}),renderTags:(s,t)=>s.map((a,i)=>e.jsx(f,{label:a.GroupName,...t({index:i})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(n,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(d,{className:"col-sm-2 col-form-label text-end",children:"Select Control Plan"}),e.jsx(n,{sm:"10",children:e.jsx(j,{multiple:!1,options:L,value:o.controlPlan??null,onChange:(s,t)=>{c({...o,controlPlan:t})},renderInput:s=>e.jsx(p,{...s,variant:"outlined",placeholder:"Search and select worker..."}),renderTags:(s,t)=>s.map((a,i)=>e.jsx(f,{label:a,...t({index:i})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(n,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(d,{className:"col-sm-2 col-form-label text-end",children:"Select Project Manager"}),e.jsx(n,{sm:"10",children:e.jsx(j,{multiple:!1,options:y,getOptionLabel:s=>s.name,value:o.projectManager??null,onChange:(s,t)=>{c({...o,projectManager:t})},renderInput:s=>e.jsx(p,{...s,variant:"outlined",placeholder:"Search and select manager..."}),renderTags:(s,t)=>s.map((a,i)=>e.jsx(f,{label:a,...t({index:i})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(n,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(d,{className:"col-sm-2 col-form-label text-end",children:"Comment"}),e.jsx(n,{sm:"10",children:e.jsx(p,{variant:"outlined",placeholder:"Add some comments...",value:o==null?void 0:o.comment,onChange:s=>{var t;c({...o,comment:(t=s==null?void 0:s.target)==null?void 0:t.value})}})})]})}),e.jsx(n,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(d,{className:"col-sm-2 col-form-label text-end",children:"Select Date"}),e.jsx(n,{sm:"10",children:e.jsx(T,{value:o==null?void 0:o.date,onChange:s=>{const a=s[0].toISOString().split("T")[0];c({...o,date:a})},className:"form-control",options:{dateFormat:"Y-m-d"}})})]})}),e.jsx(r,{className:"mb-3 d-flex justify-content-center",children:e.jsx(n,{sm:"12",className:"d-flex justify-content-end",children:e.jsx($,{variant:"primary",className:"me-1",disabled:g,onClick:I,children:"Submit"})})})]})})})})}export{W as default};
