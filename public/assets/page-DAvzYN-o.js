import{r as o,a as Y,b as Z,j as e,R as l,C as i}from"./index-Ccc50bvq.js";import{C as ee}from"./ComponentContainerCard-jOvJBIs5.js";import{P as te}from"./PageMetaData-CwfTEKnL.js";import{B as p}from"./urls-BhGeBsON.js";import{D as se}from"./page-h5XIzvWu.js";import{F as x}from"./FormLabel-MCMdPdRI.js";import{F as ae}from"./FormSelect-Bt2BskkO.js";import{A as v,T as y,C as S}from"./TextField-DlT7K7k6.js";import{I as P}from"./Image-JoqgvPfO.js";import{F as re}from"./FormControl-CO_Uebzp.js";import{B as $}from"./Button-Czdzc6_d.js";import"./Card-Bd-5a1Ef.js";import"./divWithClassName-B0s-A9qq.js";import"./Modal-p4tRgnEt.js";import"./useWindow-yc1yIKZN.js";import"./DataKey-COGXBUcQ.js";import"./NoopTransition-ClZX65CP.js";import"./FormRange-DAlMXWTQ.js";import"./useSlot-CggVarzL.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-BcofISFZ.js";const ne={item:null,users:null,selectedDrawing:null,projectManager:null,recipients:null},Me=()=>{var A,F;const[a,m]=o.useState(ne),[R,N]=o.useState(!1),O=Y(),{companyId:u,projectId:d}=Z(),[T,k]=o.useState([]),[g,I]=o.useState({show:!1,imgUrl:null}),E=o.useRef(),[C,L]=o.useState(null),[U,B]=o.useState([]),[f,M]=o.useState([]),[j,D]=o.useState([]),b=o.useRef(null),[W,J]=o.useState([]),[z,V]=o.useState([]),_=async()=>{try{const s=await(await fetch(`${p}/get-draws?companyId=${u}&projectId=${d}`)).json();k(s)}catch(t){console.error("Error fetching workers:",t)}},q=async()=>{try{const t=`${p}/get-project-managers?companyId=${u}&projectId=${d}`,n=await(await fetch(t)).json();J(n)}catch(t){console.error("Error fetching project managers:",t)}},H=async()=>{try{const t=`${p}/get-filter-users`,r=await(await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({companyId:u,projectId:d})})).json();V(r)}catch(t){console.error("Error fetching users:",t)}};o.useEffect(()=>{_(),q(),H()},[d]);const G=t=>{const s=Array.from(t.target.files),n=[...f,...s],r=[...j,...s.map(c=>URL.createObjectURL(c))];M(n),D(r)},K=t=>{const s=f.filter((c,h)=>h!==t),n=j.filter((c,h)=>h!==t);M(s),D(n);const r=new DataTransfer;s.forEach(c=>r.items.add(c)),b.current&&(b.current.files=r.files)},Q=t=>{const{name:s,value:n,multiple:r,options:c}=t.target;if(r){const h=Array.from(c).filter(w=>w.selected).map(w=>w.value);m({...a,[s]:h})}else m({...a,[s]:n})},X=async t=>{t.preventDefault(),N(!0);try{const s=new FormData;Object.keys(a).forEach(r=>{r==="projectManager"||r==="selectedDrawing"||r==="recipients"||s.append(r,a[r])}),s.append("companyId",u),s.append("projectsId",d),s.append("drawing",JSON.stringify(a.selectedDrawing)),s.append("projectManager",JSON.stringify(a.projectManager)),s.append("recipients",JSON.stringify(a.recipients)),C&&s.append("annotatedImage",C),f.length>0&&f.forEach(r=>{s.append("pictures",r)});const n=await fetch(`${p}/store-mention`,{method:"POST",body:s});if(n.ok){const r=await n.json();O(`/dashboard/companies/view/${u}/projects/view/${d}`,{state:{success:"Safety Mention added successfully!"}})}else console.error("Error:",n.statusText)}catch(s){console.error("Fetch error:",s)}N(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(te,{title:"Add Safety Mention"}),e.jsx("form",{onSubmit:X,children:e.jsx(l,{className:"justify-content-center",children:e.jsx(i,{children:e.jsx(ee,{title:"Add Safety Mention",children:e.jsxs(l,{children:[e.jsx(i,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(x,{className:"col-sm-2 col-form-label text-end",children:"Select Item"}),e.jsx(i,{sm:"10",children:e.jsxs(ae,{value:a.item,name:"item",onChange:Q,children:[e.jsx("option",{defaultValue:"",children:"Select Item"}),e.jsx("option",{value:"Work has stopped",children:"Work has stopped"}),e.jsx("option",{value:"Shielding is missing here",children:"Shielding is missing here"}),e.jsx("option",{value:"A safety hazard",children:"A safety hazard"}),e.jsx("option",{value:"Lacks cleanup",children:"Lacks cleanup"}),e.jsx("option",{value:"Security shielding inhibits my work",children:"Security shielding inhibits my work"}),e.jsx("option",{value:"Scaffolding is not done appropriately",children:"Scaffolding is not done appropriately"})]})})]})}),e.jsx(i,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(x,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Recipients"}),e.jsx(i,{sm:"10",children:e.jsx(v,{multiple:!1,options:z,getOptionLabel:t=>t.name,value:a==null?void 0:a.recipients,onChange:(t,s)=>{m({...a,recipients:s})},renderInput:t=>e.jsx(y,{...t,variant:"outlined",placeholder:"Search and select Project Users..."}),renderTags:(t,s)=>t.map((n,r)=>e.jsx(S,{label:n.name,...s({index:r})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(i,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(x,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Project Manager"}),e.jsx(i,{sm:"10",children:e.jsx(v,{multiple:!1,options:W,getOptionLabel:t=>t.name,value:a==null?void 0:a.projectManager,onChange:(t,s)=>{m({...a,projectManager:s})},renderInput:t=>e.jsx(y,{...t,variant:"outlined",placeholder:"Search and select Project Manager..."}),renderTags:(t,s)=>t.map((n,r)=>e.jsx(S,{label:n.name,...s({index:r})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(i,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(x,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Drawing"}),e.jsx(i,{sm:"10",children:e.jsx(v,{multiple:!1,options:T,getOptionLabel:t=>t.name,value:a==null?void 0:a.selectedDrawing,onChange:(t,s)=>{m({...a,selectedDrawing:s})},renderInput:t=>e.jsx(y,{...t,variant:"outlined",placeholder:"Search and select drawing..."}),renderTags:(t,s)=>t.map((n,r)=>e.jsx(S,{label:n.name,...s({index:r})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(i,{lg:"6",children:e.jsx(l,{className:"",children:(F=(A=a==null?void 0:a.selectedDrawing)==null?void 0:A.pictures)==null?void 0:F.map((t,s)=>e.jsx("div",{className:"position-relative me-2 mb-2",children:e.jsx(P,{src:`${p}/uploads/${t}`,onClick:()=>{I({show:!0,imgUrl:`${p}/uploads/${t}`})},alt:`Existing Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}})},`existing-${s}`))})}),(g==null?void 0:g.show)&&e.jsx(i,{lg:"6",children:e.jsx(l,{children:e.jsx("div",{className:"position-relative",style:{maxWidth:"100%",height:"auto"},children:e.jsx(se,{ref:E,drawDotsOnImage:g,setDrawDotsAnImage:I,onSave:t=>{L(t)},setMarkers:B,markers:U})})})}),e.jsx(i,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(x,{htmlFor:"multiple-file-input",className:"col-sm-2 col-form-label text-end",children:"Pictures"}),e.jsxs(i,{sm:"10",children:[e.jsx(re,{type:"file",id:"multiple-file-input",name:"pictures",onChange:G,accept:"image/*",multiple:!0,ref:b}),e.jsx("div",{className:"mt-3 d-flex flex-wrap",children:j.map((t,s)=>e.jsxs("div",{className:"position-relative me-2 mb-2",children:[e.jsx(P,{src:t,alt:`Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),e.jsx($,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>K(s),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"Ã—"})]},s))})]})]})}),e.jsx(l,{className:"mb-3 d-flex justify-content-center",children:e.jsx(i,{sm:"12",className:"d-flex justify-content-end",children:e.jsx($,{disabled:R,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{Me as default};
