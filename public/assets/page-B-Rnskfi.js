import{r as a,b as K,a as Q,G as X,j as e,R as c,C as o}from"./index-y2AWh0VN.js";import{C as Y}from"./ComponentContainerCard-WVgzLRCL.js";import{P as Z}from"./PageMetaData-C9BjEYqK.js";import{B as u}from"./urls-BhGeBsON.js";import{F as m}from"./FormLabel-B8nDnblu.js";import{F as y}from"./FormControl-BCsmvP-o.js";import{F as h}from"./FormSelect-RXFBsqyf.js";import{I}from"./Image-CSkiN27t.js";import{B as v}from"./Button-CUrgqYc1.js";import"./Card-pTEwvOBz.js";import"./divWithClassName-BLHGuKp8.js";const xe=()=>{const[r,p]=a.useState(null),[R,S]=a.useState(!1),[$,D]=a.useState(!0),[N,ee]=a.useState(null),[se,A]=a.useState(null),[j,P]=a.useState([]),[g,C]=a.useState([]),{newId:x}=K(),_=Q();a.useRef(null);const w=a.useRef(null),[V,E]=a.useState([]),{selectedCompany:te,selectedProjects:F,selectedProfession:ne,companies:re}=a.useContext(X);a.useEffect(()=>{x&&fetch(`${u}/get-new-detail/${x}`).then(async t=>{const s=await t.json();p({...s,picture2:s.picture,pictures2:s.pictures}),s.picture&&s.picture!=="null"&&A(`https://147.93.94.31/uploads/${s.picture}`),s.pictures&&s.pictures.length>0&&E(s.pictures.map(n=>`https://147.93.94.31/uploads/${n}`))}).catch(t=>console.error(t)).finally(()=>D(!1))},[x]);const k=t=>{const{name:s,value:n}=t.target;p({...r,[s]:n})},d=t=>{const{name:s,value:n,multiple:i,options:l}=t.target;if(i){const f=Array.from(l).filter(b=>b.selected).map(b=>b.value);p({...r,[s]:f})}else p({...r,[s]:n})};a.useEffect(()=>{(async()=>{try{const n=await(await fetch(`${u}/get-projects`)).json();T(n)}catch(s){console.error("Error fetching projects:",s)}})()},[]);const[L,T]=a.useState([]);a.useEffect(()=>{(async()=>{try{const n=await(await fetch(`${u}/get-users?projectId=${F}`)).json();B(n)}catch(s){console.error("Error fetching draws:",s)}})()},[F]);const[U,B]=a.useState([]);a.useEffect(()=>{(async()=>{try{const n=await(await fetch(`${u}/get-draws`)).json();H(n)}catch(s){console.error("Error fetching draws:",s)}})()},[]);const[W,H]=a.useState([]),M=t=>{const s=Array.from(t.target.files),n=[...j,...s],i=[...g,...s.map(l=>URL.createObjectURL(l))];P(n),C(i)},O=t=>{const s=j.filter((l,f)=>f!==t),n=g.filter((l,f)=>f!==t);P(s),C(n);const i=new DataTransfer;s.forEach(l=>i.items.add(l)),w.current&&(w.current.files=i.files)},z=async t=>{t.preventDefault(),S(!0);const s=new FormData;Object.keys(r).forEach(n=>{s.append(n,r[n])}),N&&s.append("picture",N),j.forEach(n=>{s.append("pictures",n)});try{const n=await fetch(`${u}/update-new/${x}`,{method:"POST",body:s});if(n.ok){const i=await n.json();_("/dashboard/news",{state:{success:"New Agreement updated successfully!"}})}else console.error("Error:",n.statusText)}catch(n){console.error("Fetch error:",n)}S(!1)},G=t=>{E(s=>s.filter((n,i)=>i!==t)),p(s=>{if(!s)return null;const n=s.pictures2.filter((i,l)=>l!==t);return{...s,pictures2:n.length>0?n:[]}})};a.useEffect(()=>{(async()=>{try{const n=await(await fetch(`${u}/get-professions`)).json();J(n)}catch(s){console.error("Error fetching professions:",s)}})()},[]);const[q,J]=a.useState([]);return e.jsxs(e.Fragment,{children:[e.jsx(Z,{title:"Edit New Agreement"}),$?null:e.jsx("form",{onSubmit:z,children:e.jsx(c,{className:"justify-content-center",children:e.jsx(o,{children:e.jsx(Y,{title:"Edit New Agreement",children:e.jsxs(c,{children:[e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Extra info"}),e.jsx(o,{sm:"10",children:e.jsx(y,{value:r==null?void 0:r.supplementory,onChange:k,name:"supplementory",type:"text",id:"example-text-input"})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Days | Hours"}),e.jsx(o,{sm:"10",children:e.jsx(y,{value:r==null?void 0:r.time,onChange:k,name:"time",type:"text",id:"example-text-input"})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Item"}),e.jsx(o,{sm:"10",children:e.jsxs(h,{value:r==null?void 0:r.item,name:"item",onChange:d,children:[e.jsx("option",{defaultValue:"",children:"Select Item"}),e.jsx("option",{value:"A new agreement has been concluded with construction management today.",children:"A new agreement has been concluded with construction management today."}),e.jsx("option",{value:"Change work has been notified.",children:"Change work has been notified."}),e.jsx("option",{value:"Forced work must be agreed, due to delays from other contractors",children:"Forced work must be agreed, due to delays from other contractors"}),e.jsx("option",{value:"The construction management has instructed a change in the work that must be carried out in accounting work.",children:"The construction management has instructed a change in the work that must be carried out in accounting work."}),e.jsx("option",{value:"Work that has been necessary for safety or for the sake of construction.",children:"Work that has been necessary for safety or for the sake of construction."}),e.jsx("option",{value:"Someone has destroyed my work after final inspection.",children:"Someone has destroyed my work after final inspection."})]})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Discipline"}),e.jsx(o,{sm:"10",children:e.jsxs(h,{value:r==null?void 0:r.discipline,name:"discipline",onChange:d,children:[e.jsx("option",{defaultValue:"",children:"Select Discipline"}),e.jsx("option",{value:"admin",children:"Admin"})]})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Drawing"}),e.jsx(o,{sm:"10",children:e.jsxs(h,{value:r.drawing,name:"drawing",onChange:d,children:[e.jsx("option",{defaultValue:"",children:"Select drawing"}),W.map(t=>e.jsxs("option",{value:t._id,children:[t.name," "]},t.id))]})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Projects"}),e.jsx(o,{sm:"10",children:e.jsxs(h,{value:r.projectsId,name:"projectsId",onChange:d,multiple:!0,children:[e.jsx("option",{defaultValue:"",children:"Select Projects"}),L.map(t=>e.jsxs("option",{value:t._id,children:[t.name," "]},t.id))]})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{htmlFor:"multiple-file-input",className:"col-sm-2 col-form-label text-end",children:"Pictures"}),e.jsxs(o,{sm:"10",children:[e.jsx(y,{type:"file",id:"multiple-file-input",name:"pictures",onChange:M,accept:"image/*",multiple:!0,ref:w}),e.jsxs("div",{className:"mt-3 d-flex flex-wrap",children:[g.map((t,s)=>e.jsxs("div",{className:"position-relative me-2 mb-2",children:[e.jsx(I,{src:t,alt:`Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),e.jsx(v,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>O(s),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]},s)),V.map((t,s)=>e.jsxs("div",{className:"position-relative me-2 mb-2",children:[e.jsx(I,{src:t,alt:`Existing Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),e.jsx(v,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>G(s),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]},`existing-${s}`))]})]})]})}),e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select profession"}),e.jsx(o,{sm:"10",children:e.jsxs(h,{value:r.profession,name:"profession",onChange:d,children:[e.jsx("option",{defaultValue:"",children:"Select profession"}),q.map(t=>e.jsx("option",{value:t.indexNumber,children:t.indexNumber},t.id))]})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Receipients"}),e.jsx(o,{sm:"10",children:e.jsxs(h,{value:r.users,name:"users",onChange:d,multiple:!0,children:[e.jsx("option",{defaultValue:"",children:"Select"}),U.map(t=>e.jsxs("option",{value:t._id,children:[t.username," "]},t.id))]})})]})}),e.jsx(c,{className:"mb-3 d-flex justify-content-center",children:e.jsx(o,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(v,{disabled:R,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{xe as default};
