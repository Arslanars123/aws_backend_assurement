import{r as l,a as ee,b as te,j as e,R as d,C as o}from"./index-DBwHp2gR.js";import{C as se}from"./ComponentContainerCard-CGy0xqPX.js";import{P as ae}from"./PageMetaData-TYj1ypNn.js";import{B as g}from"./urls-CXtk4x-h.js";import{P as ne}from"./page-OnObdaqm.js";import{F as h}from"./FormLabel-fYqbV-Jd.js";import{F as re}from"./FormSelect-CvP3DY7n.js";import{A as S,C as N,T as w}from"./TextField-_NGDJNXi.js";import{F as oe}from"./FormControl-DppOmn_c.js";import{I as ie}from"./Image-BAuz27ql.js";import{B as O}from"./Button-CssCL-wi.js";import"./Card-Du3hs8TN.js";import"./divWithClassName-Ur-ytTby.js";import"./Modal-DrKyHEFw.js";import"./useWindow-DTXX-IZs.js";import"./DataKey-BlFA_sew.js";import"./NoopTransition-D3hOWpSm.js";import"./FormRange-B6yzJUuH.js";import"./useFormControl-a8c0_1tF.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-C8K2eoCJ.js";const le={item:null,selectedDrawing:null,projectUsers:null,projectManager:null,comment:null},Te=()=>{var k,I,F,$;const[a,p]=l.useState(le),[R,C]=l.useState(!1),[E,U]=l.useState([]),[B,L]=l.useState([]),z=ee(),{companyId:x,projectId:j}=te(),[m,b]=l.useState([]),[v,D]=l.useState([]),[J,V]=l.useState([]),y=l.useRef(null),[u,P]=l.useState({show:!1,pdfFile:null}),[M,_]=l.useState({}),[q,W]=l.useState(10),[H,G]=l.useState({}),[A,T]=l.useState([]);l.useEffect(()=>{const t=async()=>{try{const i=await(await fetch(`${g}/get-draws?companyId=${x}&projectId=${j}`)).json();U(i)}catch(n){console.error("Error fetching workers:",n)}},s=async()=>{try{const n=`${g}/get-filter-users`,f=await(await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({companyId:x,projectId:j})})).json();L(f)}catch(n){console.error("Error fetching users:",n)}};(async()=>{try{const n=`${g}/get-project-managers?companyId=${x}&projectId=${j}`,c=await(await fetch(n)).json();V(c)}catch(n){console.error("Error fetching project managers:",n)}})(),s(),t()},[]);const K=t=>{const s=Array.from(t.target.files),r=s.map(c=>({file:c,description:""})),n=[...m,...r],i=[...v,...s.map(c=>URL.createObjectURL(c))];b(n),D(i)},Q=t=>{const s=m.filter((i,c)=>c!==t),r=v.filter((i,c)=>c!==t);b(s),D(r);const n=new DataTransfer;s.forEach(i=>n.items.add(i.file)),y.current&&(y.current.files=n.files)},X=t=>{const{name:s,value:r,multiple:n,options:i}=t.target;if(n){const c=Array.from(i).filter(f=>f.selected).map(f=>f.value);p({...a,[s]:c})}else p({...a,[s]:r})},Y=(t,s)=>{const r=[...m];r[t].description=s,b(r)},Z=async t=>{t.preventDefault(),C(!0);try{const s=new FormData;s.append("companyId",x),s.append("projectsId",j),s.append("comment",a.comment),s.append("item",a.item),s.append("projectUsers",JSON.stringify(a.projectUsers)),s.append("projectManager",JSON.stringify(a.projectManager)),s.append("drawing",JSON.stringify(a.selectedDrawing)),m.length>0&&m.forEach((n,i)=>{s.append("pictures",n.file),s.append("pictureDescriptions",n.description||"")}),Object.entries(M).forEach(([n,i])=>{s.append("annotatedPdfs",i,n)});const r=await fetch(`${g}/store-note`,{method:"POST",body:s});r.ok?z(`/dashboard/companies/view/${x}/projects/view/${j}`):console.error("Error:",r.statusText)}catch(s){console.error("Fetch error:",s)}C(!1)};return console.log("annotatedPdf",M),e.jsxs(e.Fragment,{children:[e.jsx(ae,{title:"Add Address Note"}),e.jsx("form",{onSubmit:Z,children:e.jsx(d,{className:"justify-content-center",children:e.jsx(o,{children:e.jsx(se,{title:"Add Address Note",children:e.jsxs(d,{children:[e.jsx(o,{lg:"6",children:e.jsxs(d,{className:"mb-3",children:[e.jsx(h,{className:"col-sm-2 col-form-label text-end",children:"Select Item"}),e.jsx(o,{sm:"10",children:e.jsxs(re,{value:a.item,name:"item",onChange:X,children:[e.jsx("option",{defaultValue:"",children:"Select Item"}),e.jsx("option",{value:"The work does not follow the schedule.",children:"The work does not follow the schedule."}),e.jsx("option",{value:"The work is not completed.",children:"The work is not completed."}),e.jsx("option",{value:"The relationship causes delays",children:"The relationship causes delays"}),e.jsx("option",{value:"The interfaces cannot receive in that state.",children:"The interfaces cannot receive in that state."}),e.jsx("option",{value:"Manpower must be provided here if the schedule is to be adhered to.",children:"Manpower must be provided here if the schedule is to be adhered to."}),e.jsx("option",{value:"Someone has destroyed my work after final inspection.",children:"Someone has destroyed my work after final inspection."}),e.jsx("option",{value:"Conditions that are taken up at the next building meeting",children:"Conditions that are taken up at the next building meeting"}),e.jsx("option",{value:"The work is notified to be stopped in 3 days, due to non-payment. cf. AB18",children:"The work is notified to be stopped in 3 days, due to non-payment. cf. AB18"})]})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(d,{className:"mb-3",children:[e.jsx(h,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Project Manager"}),e.jsx(o,{sm:"10",children:e.jsx(S,{multiple:!1,options:J,getOptionLabel:t=>t.name,value:a==null?void 0:a.projectManager,onChange:(t,s)=>{p({...a,projectManager:s})},renderInput:t=>e.jsx(w,{...t,variant:"outlined",placeholder:"Search and select Project Manager..."}),renderTags:(t,s)=>t.map((r,n)=>e.jsx(N,{label:r.name,...s({index:n})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(d,{className:"mb-3",children:[e.jsx(h,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Recipients"}),e.jsx(o,{sm:"10",children:e.jsx(S,{multiple:!1,options:B,getOptionLabel:t=>t.name,value:a==null?void 0:a.projectUsers,onChange:(t,s)=>{p({...a,projectUsers:s})},renderInput:t=>e.jsx(w,{...t,variant:"outlined",placeholder:"search and select the receiver ..."}),renderTags:(t,s)=>t.map((r,n)=>e.jsx(N,{label:r.name,...s({index:n})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(d,{className:"mb-3",children:[e.jsx(h,{className:"col-sm-2 col-form-label text-end",children:"Comment"}),e.jsx(o,{sm:"10",children:e.jsx(w,{variant:"outlined",placeholder:"Add some comments...",value:a==null?void 0:a.comment,onChange:t=>{var s;p({...a,comment:(s=t==null?void 0:t.target)==null?void 0:s.value})}})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(d,{className:"mb-3",children:[e.jsx(h,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Drawing"}),e.jsx(o,{sm:"10",children:e.jsx(S,{multiple:!1,options:E,getOptionLabel:t=>t.name,value:a==null?void 0:a.selectedDrawing,onChange:(t,s)=>{p({...a,selectedDrawing:s})},renderInput:t=>e.jsx(w,{...t,variant:"outlined",placeholder:"Search and select drawing..."}),renderTags:(t,s)=>t.map((r,n)=>e.jsx(N,{label:r.name,...s({index:n})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),(a==null?void 0:a.selectedDrawing)&&e.jsxs(o,{lg:"12",className:"mb-4",children:[e.jsx("h5",{children:"Main Drawings"}),e.jsx("div",{className:"d-flex flex-wrap",children:(I=(k=a==null?void 0:a.selectedDrawing)==null?void 0:k.mainDrawings)==null?void 0:I.map((t,s)=>e.jsxs("div",{className:"me-2 mb-2 text-center",onClick:()=>{const r=t.original;T(H[r]||[]),P({show:!0,pdfFile:`${g}/uploads/${t.stored}`,name:r})},style:{cursor:"pointer"},children:[e.jsx("i",{className:"fas fa-file-pdf",style:{fontSize:"2rem",color:"#dc3545"}}),e.jsx("div",{className:"small text-muted",children:t==null?void 0:t.original})]},`main-${s}`))})]}),(u==null?void 0:u.show)&&e.jsx(ne,{backgroundColor:"red",drawDotsOnPdf:u,setDrawDotsOnPdf:P,dotSize:q,setDotSize:W,markers:A,setMarkers:T,onClose:()=>{G(t=>({...t,[u.name]:A}))},onSave:t=>{_(s=>({...s,[u.name]:t}))}}),(a==null?void 0:a.selectedDrawing)&&e.jsxs(o,{lg:"12",children:[e.jsx("h5",{children:"Child Drawings"}),e.jsx("div",{className:"d-flex flex-wrap",children:($=(F=a==null?void 0:a.selectedDrawing)==null?void 0:F.childDrawings)==null?void 0:$.map((t,s)=>e.jsxs("div",{className:"me-2 mb-2 text-center",children:[e.jsx("i",{className:"fas fa-file-pdf",style:{fontSize:"2rem",color:"#dc3545"}}),e.jsx("div",{className:"small text-muted",children:t==null?void 0:t.original})]},`child-${s}`))})]}),e.jsx(o,{lg:"6",children:e.jsxs(d,{className:"mb-3",children:[e.jsx(h,{htmlFor:"multiple-file-input",className:"col-sm-2 col-form-label text-end",children:"Pictures"}),e.jsxs(o,{sm:"10",children:[e.jsx(oe,{type:"file",id:"multiple-file-input",name:"pictures",onChange:K,accept:"image/*",multiple:!0,ref:y}),e.jsx("div",{className:"mt-3 d-flex flex-wrap",children:v.map((t,s)=>{var r;return e.jsxs("div",{className:"position-relative me-2 mb-3",style:{width:"200px"},children:[e.jsx(ie,{src:t,alt:`Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100%",maxHeight:"100px"}}),e.jsx(w,{variant:"outlined",placeholder:"Add description...",value:((r=m[s])==null?void 0:r.description)||"",onChange:n=>Y(s,n.target.value),fullWidth:!0,size:"small",className:"mt-1"}),e.jsx(O,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>Q(s),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"Ã—"})]},s)})})]})]})}),e.jsx(d,{className:"mb-3 d-flex justify-content-center",children:e.jsx(o,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(O,{disabled:R,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{Te as default};
