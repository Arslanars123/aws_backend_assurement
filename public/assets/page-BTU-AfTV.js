import{r as i,b as H,a as W,ab as q,j as e,R as o,C as l}from"./index-DPgj8bsv.js";import{C as G}from"./ComponentContainerCard-DoOo3fSv.js";import{P as J}from"./PageMetaData-BOIE4fT1.js";import{B as x}from"./urls-B0CXljtC.js";import{F as m}from"./FormLabel-DrWgYkuA.js";import{F as p}from"./FormSelect-BPDON-Nl.js";import{F as K}from"./FormControl-B_1Cr1px.js";import{I as F}from"./Image-VbqUsSSH.js";import{B as S}from"./Button-4B-OZ0gB.js";import"./Card-uWXaDKgm.js";import"./divWithClassName-CSK1W61z.js";import"./FormContext-D3odgfWO.js";const me=()=>{const[r,h]=i.useState(null),[I,P]=i.useState(!1),[R,$]=i.useState(!0),[y,Q]=i.useState(null),[X,A]=i.useState(null),[j,w]=i.useState([]),[g,N]=i.useState([]),{staticId:f}=H(),_=W(),[L]=q(),C=L.get("report");i.useRef(null);const b=i.useRef(null),[V,E]=i.useState([]);i.useEffect(()=>{f&&fetch(`${x}/get-static-detail/${f}`).then(async t=>{const s=await t.json();h({...s,picture2:s.picture,pictures2:s.pictures}),s.picture&&s.picture!=="null"&&A(`https://147.93.94.31/uploads/${s.picture}`),s.pictures&&s.pictures.length>0&&E(s.pictures.map(a=>`https://147.93.94.31/uploads/${a}`))}).catch(t=>console.error(t)).finally(()=>$(!1))},[f]);const d=t=>{const{name:s,value:a,multiple:c,options:n}=t.target;if(c){const u=Array.from(n).filter(v=>v.selected).map(v=>v.value);h({...r,[s]:u})}else h({...r,[s]:a})};i.useEffect(()=>{(async()=>{try{const a=await(await fetch(`${x}/get-projects`)).json();k(a)}catch(s){console.error("Error fetching projects:",s)}})()},[]);const[D,k]=i.useState([]),B=t=>{const s=Array.from(t.target.files),a=[...j,...s],c=[...g,...s.map(n=>URL.createObjectURL(n))];w(a),N(c)},T=t=>{const s=j.filter((n,u)=>u!==t),a=g.filter((n,u)=>u!==t);w(s),N(a);const c=new DataTransfer;s.forEach(n=>c.items.add(n)),b.current&&(b.current.files=c.files)},U=async t=>{t.preventDefault(),P(!0);const s=new FormData;Object.keys(r).forEach(a=>{s.append(a,r[a])}),y&&s.append("picture",y),j.forEach(a=>{s.append("pictures",a)});try{const a=await fetch(`${x}/update-static/${f}`,{method:"POST",body:s});if(a.ok){const c=await a.json(),n=C?`/dashboard/projects?report=${C}`:"/dashboard/statics";_(n,{state:{success:"static updated successfully!"}})}else console.error("Error:",a.statusText)}catch(a){console.error("Fetch error:",a)}P(!1)},M=t=>{E(s=>s.filter((a,c)=>c!==t)),h(s=>{if(!s)return null;const a=s.pictures2.filter((c,n)=>n!==t);return{...s,pictures2:a.length>0?a:[]}})};i.useEffect(()=>{(async()=>{try{const a=await(await fetch(`${x}/get-professions`)).json();z(a)}catch(s){console.error("Error fetching professions:",s)}})()},[]);const[O,z]=i.useState([]);return e.jsxs(e.Fragment,{children:[e.jsx(J,{title:"Edit Static Report"}),R?null:e.jsx("form",{onSubmit:U,children:e.jsx(o,{className:"justify-content-center",children:e.jsx(l,{children:e.jsx(G,{title:"Edit Static Report",children:e.jsxs(o,{children:[e.jsx(l,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Activity"}),e.jsx(l,{sm:"10",children:e.jsxs(p,{value:r==null?void 0:r.activity,name:"activity",onChange:d,children:[e.jsx("option",{defaultValue:"",children:"Select Activity"}),e.jsx("option",{value:"admin",children:"Admin"})]})})]})}),e.jsx(l,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Control Plan"}),e.jsx(l,{sm:"10",children:e.jsxs(p,{value:r==null?void 0:r.controlPlan,name:"controlPlan",onChange:d,children:[e.jsx("option",{defaultValue:"",children:"Select Control Plan"}),e.jsx("option",{value:"admin",children:"Admin"})]})})]})}),e.jsx(l,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Item"}),e.jsx(l,{sm:"10",children:e.jsxs(p,{value:r==null?void 0:r.items,name:"items",onChange:d,children:[e.jsx("option",{defaultValue:"",children:"Select Item"}),e.jsx("option",{value:"admin",children:"Admin"})]})})]})}),e.jsx(l,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select Projects"}),e.jsx(l,{sm:"10",children:e.jsxs(p,{value:r.projectsId,name:"projectsId",onChange:d,multiple:!0,children:[e.jsx("option",{defaultValue:"",children:"Select Projects"}),D.map(t=>e.jsxs("option",{value:t._id,children:[t.name," "]},t.id))]})})]})}),e.jsx(l,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(m,{htmlFor:"multiple-file-input",className:"col-sm-2 col-form-label text-end",children:"Pictures"}),e.jsxs(l,{sm:"10",children:[e.jsx(K,{type:"file",id:"multiple-file-input",name:"pictures",onChange:B,accept:"image/*",multiple:!0,ref:b}),e.jsxs("div",{className:"mt-3 d-flex flex-wrap",children:[g.map((t,s)=>e.jsxs("div",{className:"position-relative me-2 mb-2",children:[e.jsx(F,{src:t,alt:`Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),e.jsx(S,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>T(s),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]},s)),V.map((t,s)=>e.jsxs("div",{className:"position-relative me-2 mb-2",children:[e.jsx(F,{src:t,alt:`Existing Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),e.jsx(S,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>M(s),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]},`existing-${s}`))]})]})]})}),e.jsx(l,{lg:"6",children:e.jsxs(o,{className:"mb-3",children:[e.jsx(m,{className:"col-sm-2 col-form-label text-end",children:"Select profession"}),e.jsx(l,{sm:"10",children:e.jsxs(p,{value:r.professionId,name:"professionId",onChange:d,children:[e.jsx("option",{defaultValue:"",children:"Select profession"}),O.map(t=>e.jsx("option",{value:t._id,children:t.name},t.id))]})})]})}),e.jsx(o,{className:"mb-3 d-flex justify-content-center",children:e.jsx(l,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(S,{disabled:I,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{me as default};
