import{r as l,a as Y,b as Z,j as e,R as d,C as o}from"./index-y2AWh0VN.js";import{C as ee}from"./ComponentContainerCard-WVgzLRCL.js";import{P as te}from"./PageMetaData-C9BjEYqK.js";import{B as w}from"./urls-BhGeBsON.js";import{P as se}from"./page-BwoUE6aX.js";import{F as h}from"./FormLabel-B8nDnblu.js";import{F as ae}from"./FormSelect-RXFBsqyf.js";import{A as S,C as N,T as g}from"./TextField-CHOGXvH3.js";import{F as ne}from"./FormControl-BCsmvP-o.js";import{I as re}from"./Image-CSkiN27t.js";import{B as I}from"./Button-CUrgqYc1.js";import"./Card-pTEwvOBz.js";import"./divWithClassName-BLHGuKp8.js";import"./Modal-DUmHr7nc.js";import"./useWindow-BUTI6O21.js";import"./DataKey-BZN51oXa.js";import"./NoopTransition-1KXwFEeZ.js";import"./FormRange-CO87Iy6V.js";import"./useFormControl-C5hsiBKt.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-C8K2eoCJ.js";const oe={item:null,selectedDrawing:null,projectUsers:null,projectManager:null,comment:null},Ae=()=>{var P,k,A,T;const[a,m]=l.useState(oe),[F,C]=l.useState(!1),[O,R]=l.useState([]),[$,E]=l.useState([]),U=Y(),{companyId:x,projectId:j}=Z(),[u,b]=l.useState([]),[v,D]=l.useState([]),[B,L]=l.useState([]),y=l.useRef(null),[p,z]=l.useState({show:!1,pdfFile:null}),[J,V]=l.useState({}),[_,q]=l.useState(10),[M,W]=l.useState({}),[ie,le]=l.useState([]);l.useEffect(()=>{const s=async()=>{try{const i=await(await fetch(`${w}/get-draws?companyId=${x}&projectId=${j}`)).json();R(i)}catch(n){console.error("Error fetching workers:",n)}},t=async()=>{try{const n=`${w}/get-filter-users`,f=await(await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({companyId:x,projectId:j})})).json();E(f)}catch(n){console.error("Error fetching users:",n)}};(async()=>{try{const n=`${w}/get-project-managers?companyId=${x}&projectId=${j}`,c=await(await fetch(n)).json();L(c)}catch(n){console.error("Error fetching project managers:",n)}})(),t(),s()},[]);const H=s=>{const t=Array.from(s.target.files),r=t.map(c=>({file:c,description:""})),n=[...u,...r],i=[...v,...t.map(c=>URL.createObjectURL(c))];b(n),D(i)},G=s=>{const t=u.filter((i,c)=>c!==s),r=v.filter((i,c)=>c!==s);b(t),D(r);const n=new DataTransfer;t.forEach(i=>n.items.add(i.file)),y.current&&(y.current.files=n.files)},K=s=>{const{name:t,value:r,multiple:n,options:i}=s.target;if(n){const c=Array.from(i).filter(f=>f.selected).map(f=>f.value);m({...a,[t]:c})}else m({...a,[t]:r})},Q=(s,t)=>{const r=[...u];r[s].description=t,b(r)},X=async s=>{s.preventDefault(),C(!0);try{const t=new FormData;t.append("companyId",x),t.append("projectsId",j),t.append("comment",a.comment),t.append("item",a.item),t.append("projectUsers",JSON.stringify(a.projectUsers)),t.append("projectManager",JSON.stringify(a.projectManager)),t.append("drawing",JSON.stringify(a.selectedDrawing)),u.length>0&&u.forEach((n,i)=>{t.append("pictures",n.file),t.append("pictureDescriptions",n.description||"")}),Object.entries(J).forEach(([n,i])=>{t.append("annotatedPdfs",i,n)});const r=await fetch(`${w}/store-note`,{method:"POST",body:t});r.ok?U(`/dashboard/companies/view/${x}/projects/view/${j}`):console.error("Error:",r.statusText)}catch(t){console.error("Fetch error:",t)}C(!1)};return console.log("pdfMarkersMap",M),e.jsxs(e.Fragment,{children:[e.jsx(te,{title:"Add Address Note"}),e.jsx("form",{onSubmit:X,children:e.jsx(d,{className:"justify-content-center",children:e.jsx(o,{children:e.jsx(ee,{title:"Add Address Note",children:e.jsxs(d,{children:[e.jsx(o,{lg:"6",children:e.jsxs(d,{className:"mb-3",children:[e.jsx(h,{className:"col-sm-2 col-form-label text-end",children:"Select Item"}),e.jsx(o,{sm:"10",children:e.jsxs(ae,{value:a.item,name:"item",onChange:K,children:[e.jsx("option",{defaultValue:"",children:"Select Item"}),e.jsx("option",{value:"The work does not follow the schedule.",children:"The work does not follow the schedule."}),e.jsx("option",{value:"The work is not completed.",children:"The work is not completed."}),e.jsx("option",{value:"The relationship causes delays",children:"The relationship causes delays"}),e.jsx("option",{value:"The interfaces cannot receive in that state.",children:"The interfaces cannot receive in that state."}),e.jsx("option",{value:"Manpower must be provided here if the schedule is to be adhered to.",children:"Manpower must be provided here if the schedule is to be adhered to."}),e.jsx("option",{value:"Someone has destroyed my work after final inspection.",children:"Someone has destroyed my work after final inspection."}),e.jsx("option",{value:"Conditions that are taken up at the next building meeting",children:"Conditions that are taken up at the next building meeting"}),e.jsx("option",{value:"The work is notified to be stopped in 3 days, due to non-payment. cf. AB18",children:"The work is notified to be stopped in 3 days, due to non-payment. cf. AB18"})]})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(d,{className:"mb-3",children:[e.jsx(h,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Project Manager"}),e.jsx(o,{sm:"10",children:e.jsx(S,{multiple:!1,options:B,getOptionLabel:s=>s.name,value:a==null?void 0:a.projectManager,onChange:(s,t)=>{m({...a,projectManager:t})},renderInput:s=>e.jsx(g,{...s,variant:"outlined",placeholder:"Search and select Project Manager..."}),renderTags:(s,t)=>s.map((r,n)=>e.jsx(N,{label:r.name,...t({index:n})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(d,{className:"mb-3",children:[e.jsx(h,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Recipients"}),e.jsx(o,{sm:"10",children:e.jsx(S,{multiple:!1,options:$,getOptionLabel:s=>s.name,value:a==null?void 0:a.projectUsers,onChange:(s,t)=>{m({...a,projectUsers:t})},renderInput:s=>e.jsx(g,{...s,variant:"outlined",placeholder:"search and select the receiver ..."}),renderTags:(s,t)=>s.map((r,n)=>e.jsx(N,{label:r.name,...t({index:n})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(d,{className:"mb-3",children:[e.jsx(h,{className:"col-sm-2 col-form-label text-end",children:"Comment"}),e.jsx(o,{sm:"10",children:e.jsx(g,{variant:"outlined",placeholder:"Add some comments...",value:a==null?void 0:a.comment,onChange:s=>{var t;m({...a,comment:(t=s==null?void 0:s.target)==null?void 0:t.value})}})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(d,{className:"mb-3",children:[e.jsx(h,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Drawing"}),e.jsx(o,{sm:"10",children:e.jsx(S,{multiple:!1,options:O,getOptionLabel:s=>s.name,value:a==null?void 0:a.selectedDrawing,onChange:(s,t)=>{m({...a,selectedDrawing:t})},renderInput:s=>e.jsx(g,{...s,variant:"outlined",placeholder:"Search and select drawing..."}),renderTags:(s,t)=>s.map((r,n)=>e.jsx(N,{label:r.name,...t({index:n})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),(a==null?void 0:a.selectedDrawing)&&e.jsxs(o,{lg:"12",className:"mb-4",children:[e.jsx("h5",{children:"Main Drawings"}),e.jsx("div",{className:"d-flex flex-wrap",children:(k=(P=a==null?void 0:a.selectedDrawing)==null?void 0:P.mainDrawings)==null?void 0:k.map((s,t)=>e.jsxs("div",{className:"me-2 mb-2 text-center",style:{cursor:"pointer"},children:[e.jsx("i",{className:"fas fa-file-pdf",style:{fontSize:"2rem",color:"#dc3545"}}),e.jsx("div",{className:"small text-muted",children:s==null?void 0:s.original})]},`main-${t}`))})]}),(p==null?void 0:p.show)&&e.jsx(se,{backgroundColor:"red",drawDotsOnPdf:p,setDrawDotsOnPdf:z,dotSize:_,setDotSize:q,markers:M[p.name]||[],setMarkers:s=>{W(t=>({...t,[p.name]:s}))},onSave:s=>{V(t=>({...t,[p.name]:s}))}}),(a==null?void 0:a.selectedDrawing)&&e.jsxs(o,{lg:"12",children:[e.jsx("h5",{children:"Child Drawings"}),e.jsx("div",{className:"d-flex flex-wrap",children:(T=(A=a==null?void 0:a.selectedDrawing)==null?void 0:A.childDrawings)==null?void 0:T.map((s,t)=>e.jsxs("div",{className:"me-2 mb-2 text-center",children:[e.jsx("i",{className:"fas fa-file-pdf",style:{fontSize:"2rem",color:"#dc3545"}}),e.jsx("div",{className:"small text-muted",children:s==null?void 0:s.original})]},`child-${t}`))})]}),e.jsx(o,{lg:"6",children:e.jsxs(d,{className:"mb-3",children:[e.jsx(h,{htmlFor:"multiple-file-input",className:"col-sm-2 col-form-label text-end",children:"Pictures"}),e.jsxs(o,{sm:"10",children:[e.jsx(ne,{type:"file",id:"multiple-file-input",name:"pictures",onChange:H,accept:"image/*",multiple:!0,ref:y}),e.jsx("div",{className:"mt-3 d-flex flex-wrap",children:v.map((s,t)=>{var r;return e.jsxs("div",{className:"position-relative me-2 mb-3",style:{width:"200px"},children:[e.jsx(re,{src:s,alt:`Preview ${t}`,fluid:!0,rounded:!0,style:{maxWidth:"100%",maxHeight:"100px"}}),e.jsx(g,{variant:"outlined",placeholder:"Add description...",value:((r=u[t])==null?void 0:r.description)||"",onChange:n=>Q(t,n.target.value),fullWidth:!0,size:"small",className:"mt-1"}),e.jsx(I,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>G(t),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"Ã—"})]},t)})})]})]})}),e.jsx(d,{className:"mb-3 d-flex justify-content-center",children:e.jsx(o,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(I,{disabled:F,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{Ae as default};
