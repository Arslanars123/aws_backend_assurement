import{r as c,b as _,a as k,j as e,R as l,C as a}from"./index-Ccc50bvq.js";import{C as O}from"./ComponentContainerCard-jOvJBIs5.js";import{P as T}from"./PageMetaData-CwfTEKnL.js";import{B as h}from"./urls-BhGeBsON.js";import{F as o}from"./FormLabel-MCMdPdRI.js";import{F as i}from"./FormControl-CO_Uebzp.js";import{F as v}from"./FormSelect-Bt2BskkO.js";import{I as z}from"./Image-JoqgvPfO.js";import{B as F}from"./Button-Czdzc6_d.js";import"./Card-Bd-5a1Ef.js";import"./divWithClassName-B0s-A9qq.js";const se=()=>{const[s,m]=c.useState(null),[S,f]=c.useState(!1),[w,I]=c.useState(!0),[g,b]=c.useState(null),[y,u]=c.useState(null),{companyId:P,constructionmanagerId:p}=_(),E=k(),x=c.useRef(null);c.useEffect(()=>{p&&fetch(`${h}/get-user-detail/${p}`).then(async n=>{const t=await n.json();m({...t,picture2:t.picture}),t.picture&&t.picture!="null"&&u(`${h}/uploads/${t.picture}`)}).catch(n=>console.error(n)).finally(()=>I(!1))},[p]);const d=n=>{const{name:t,value:r}=n.target;m({...s,[t]:r})},D=n=>{const t=n.target.files[0];t&&(b(t),u(URL.createObjectURL(t)))},R=async n=>{n.preventDefault(),f(!0);const t=new FormData;t.append("username",s.username),t.append("name",s.name),t.append("phone",s.phone),t.append("password",s.password),t.append("address",s.address),t.append("city",s.city),t.append("postalCode",s.postalCode),t.append("startDate",s.startDate),t.append("picture2",s.picture2),g&&t.append("picture",g);try{const r=await fetch(`${h}/update-user/${p}`,{method:"POST",body:t});if(r.ok){const N=await r.json();E(`/dashboard/companies/view/${P}`)}else console.error("Error:",r.statusText)}catch(r){console.error("Fetch error:",r)}f(!1)},C=n=>{const{name:t,value:r,multiple:N,options:U}=n.target;if(N){const V=Array.from(U).filter(j=>j.selected).map(j=>j.value);m({...s,[t]:V})}else m({...s,[t]:r})};c.useEffect(()=>{(async()=>{try{const r=await(await fetch(`${h}/get-projects`)).json();M(r)}catch(t){console.error("Error fetching projects:",t)}})()},[]);const[$,M]=c.useState([]);c.useEffect(()=>{(async()=>{try{const r=await(await fetch(`${h}/get-mains`)).json();B(r)}catch(t){console.error("Error fetching mains:",t)}})()},[]);const[L,B]=c.useState([]),A=()=>{b(null),u(null),m(n=>({...n,picture2:null})),x.current&&(x.current.value="")};return e.jsxs(e.Fragment,{children:[e.jsx(T,{title:"Edit Construction Manager"}),w?null:e.jsx("form",{onSubmit:R,children:e.jsx(l,{className:"justify-content-center",children:e.jsx(a,{children:e.jsx(O,{title:"Edit Construction Manager Details",children:e.jsxs(l,{children:[e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(o,{htmlFor:"email",className:"col-sm-2 col-form-label text-end",children:"Email"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:s==null?void 0:s.username,onChange:d,name:"username",type:"email",id:"email"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(o,{htmlFor:"name",className:"col-sm-2 col-form-label text-end",children:"Name"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:s==null?void 0:s.name,onChange:d,name:"name",type:"text",id:"name"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(o,{htmlFor:"phone",className:"col-sm-2 col-form-label text-end",children:"Phone"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:s==null?void 0:s.phone,onChange:d,name:"phone",type:"text",id:"phone"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(o,{htmlFor:"password",className:"col-sm-2 col-form-label text-end",children:"Password"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:s==null?void 0:s.password,onChange:d,name:"password",type:"text",id:"password"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(o,{htmlFor:"address",className:"col-sm-2 col-form-label text-end",children:"Address"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:s==null?void 0:s.address,onChange:d,name:"address",type:"text",id:"address"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(o,{htmlFor:"city",className:"col-sm-2 col-form-label text-end",children:"City"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:s==null?void 0:s.city,onChange:d,name:"city",type:"text",id:"city"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(o,{htmlFor:"postalCode",className:"col-sm-2 col-form-label text-end",children:"Post Code"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:s==null?void 0:s.postalCode,onChange:d,name:"postalCode",type:"text",id:"postalCode"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(o,{htmlFor:"startDate",className:"col-sm-2 col-form-label text-end",children:"Start Date"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:s==null?void 0:s.startDate,onChange:d,name:"startDate",type:"text",id:"startDate"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(o,{className:"col-sm-2 col-form-label text-end",children:"Select Projects"}),e.jsx(a,{sm:"10",children:e.jsxs(v,{value:s.projectsId,name:"projectsId",onChange:C,multiple:!0,children:[e.jsx("option",{defaultValue:"",children:"Select Projects"}),$.map(n=>e.jsxs("option",{value:n._id,children:[n.name," "]},n.id))]})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(o,{className:"col-sm-2 col-form-label text-end",children:"Select Main Constructor"}),e.jsx(a,{sm:"10",children:e.jsxs(v,{value:s.mainId,name:"mainId",onChange:C,children:[e.jsx("option",{defaultValue:"",children:"Select Main Constructor"}),L.map(n=>e.jsxs("option",{value:n._id,children:[n.username," "]},n.id))]})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(o,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Picture"}),e.jsxs(a,{sm:"10",children:[e.jsx(i,{type:"file",id:"file-input",name:"picture",onChange:D,accept:"image/*",ref:x}),y&&e.jsxs("div",{className:"mt-3 position-relative",children:[e.jsx(z,{src:y,alt:"Preview",fluid:!0,rounded:!0,style:{maxWidth:"200px",maxHeight:"200px"}}),e.jsx(F,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:A,style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"Ã—"})]})]})]})}),e.jsx(l,{className:"mb-3 d-flex justify-content-center",children:e.jsx(a,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(F,{disabled:S,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{se as default};
