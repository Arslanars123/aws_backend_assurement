import{r as o,a as I,b as $,j as e,R as n,C as r}from"./index-B342vN8a.js";import{C as F}from"./ComponentContainerCard-BIxSgnld.js";import{P}from"./PageMetaData-__vP5leC.js";import{B as h}from"./urls-CvG9cD6N.js";import{F as u}from"./FormLabel-f-qql_Cp.js";import{F as g}from"./FormControl-CJr_RFax.js";import{A as E,C as A,T as O}from"./TextField-BYbQgC-7.js";import{I as b}from"./Image-B0PQ6faj.js";import{B as T}from"./Button-BnzdNfRx.js";import"./Card-CI8IuqFE.js";import"./divWithClassName-BnSMb2ls.js";import"./FormContext-BMEMUOIr.js";import"./useFormControl-CZmJVi9l.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-C8K2eoCJ.js";const M={name:"",description:""},X=()=>{const[i,y]=o.useState(M),[N,j]=o.useState(!1),[w,S]=o.useState([]),[c,v]=o.useState([]),C=I(),{companyId:m,projectId:d}=$();o.useEffect(()=>{(async()=>{try{const a=await(await fetch(`${h}/get-draws?companyId=${m}&projectId=${d}`)).json();S(a)}catch(t){console.error("Error fetching draws:",t)}})()},[m,d]);const f=s=>{const{name:t,value:a}=s.target;y({...i,[t]:a})},D=async s=>{s.preventDefault(),j(!0);try{const t={...i,companyId:m,projectsId:d,drawIds:c.map(l=>l._id)},a=await fetch(`${h}/store-plan`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});a.ok?C(`/dashboard/companies/view/${m}/projects/view/${d}`,{state:{success:"Plan added successfully!"}}):console.error("Error:",a.statusText)}catch(t){console.error("Fetch error:",t)}j(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(P,{title:"Add Plan"}),e.jsx("form",{onSubmit:D,children:e.jsx(n,{className:"justify-content-center",children:e.jsx(r,{children:e.jsx(F,{title:"Add Plan",children:e.jsxs(n,{children:[e.jsx(r,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(u,{className:"col-sm-2 col-form-label text-end",children:"Name"}),e.jsx(r,{sm:"10",children:e.jsx(g,{value:i.name,onChange:f,name:"name",type:"text",placeholder:"Enter Plan Name"})})]})}),e.jsx(r,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(u,{className:"col-sm-2 col-form-label text-end",children:"Description"}),e.jsx(r,{sm:"10",children:e.jsx(g,{value:i.description,onChange:f,name:"description",type:"text",placeholder:"Enter Description"})})]})}),e.jsxs(r,{lg:"12",className:"mb-3",children:[e.jsx(u,{children:"Select Drawings"}),e.jsx(E,{multiple:!0,options:w,getOptionLabel:s=>s.name,value:c,onChange:(s,t)=>{v(t)},renderInput:s=>e.jsx(O,{...s,variant:"outlined",label:"Search and Select Drawings",placeholder:"Start typing..."}),renderTags:(s,t)=>s.map((a,l)=>e.jsx(A,{label:a.name,...t({index:l})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})]}),c.length>0&&e.jsx(e.Fragment,{children:e.jsxs(r,{lg:"12",className:"mb-3",children:[e.jsx("h5",{children:"Selected Drawings"}),c.map((s,t)=>{var a,l;return e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{children:s.name}),e.jsx(n,{children:(a=s.mainDrawings)==null?void 0:a.map((p,x)=>e.jsxs(r,{lg:"2",className:"text-center mb-2",children:[e.jsx(b,{src:`${h}/uploads/${p}`,thumbnail:!0,style:{maxWidth:100,maxHeight:100}}),e.jsxs("div",{className:"small text-muted",children:["Main ",x+1]})]},x))}),e.jsx(n,{className:"mt-2",children:(l=s.childDrawings)==null?void 0:l.map((p,x)=>e.jsxs(r,{lg:"2",className:"text-center mb-2",children:[e.jsx(b,{src:`${h}/uploads/${p.file}`,thumbnail:!0,style:{maxWidth:100,maxHeight:100}}),e.jsxs("div",{className:"small text-muted",children:["Linked to Main ",p.parentMainIndex+1]})]},x))})]},s._id)})]})}),e.jsx(n,{className:"mb-3 d-flex justify-content-center",children:e.jsx(r,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(T,{disabled:N,type:"submit",variant:"primary",children:"Submit"})})})]})})})})})]})};export{X as default};
