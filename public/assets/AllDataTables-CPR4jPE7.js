import{j as e,R as E,C as M,r as m,b as B}from"./index-BMHGnWcK.js";import{C as L}from"./ComponentContainerCard-DqzcDgtW.js";import{R as N}from"./index--BG4zqiO.js";import{B as k}from"./urls-CvG9cD6N.js";import{M as v}from"./Modal-BvTxh5Lm.js";import{F as I}from"./Form-3MPO2ubb.js";import{B as g}from"./Button-Dwvyfso6.js";const P=(l,t,u)=>{const i=[{header:"Special Text",accessorKey:"DS_GroupId"},{header:"Subject Matter",accessorKey:"SubjectMatterId"},{header:"Control Of",accessorKey:"Contol of"},{header:"Subject",accessorKey:"Subject"},{header:"Construction Part",accessorKey:"Construction part"},{header:"Control Method",accessorKey:"Control methode"}];return t!=null&&t.showSubmitAction&&l&&i.push({header:"Submit Action",cell:({row:s})=>{var o,C,b,x,a,S;const n=(b=t==null?void 0:t.submittedChecklistIds)==null?void 0:b.includes((C=(o=s==null?void 0:s.original)==null?void 0:o._id)==null?void 0:C.toString()),j=(S=t==null?void 0:t.approvalStatus)==null?void 0:S[(a=(x=s==null?void 0:s.original)==null?void 0:x._id)==null?void 0:a.toString()],c=(j==null?void 0:j.approvedBy)||!1;return e.jsxs("div",{children:[e.jsx(g,{variant:n?"secondary":"info",className:"me-2",disabled:n,onClick:()=>{var f;n||l(`controls/submit/${(f=s==null?void 0:s.original)==null?void 0:f._id}`)},children:n?"Submitted":"Submit Task"}),n&&e.jsx("span",{className:"badge bg-success ms-2",children:"Submitted"}),n&&!c&&e.jsx(g,{variant:"warning",className:"ms-2",size:"sm",onClick:()=>{u(s.original)},children:"Approve"}),n&&c&&e.jsx("span",{className:"badge bg-primary ms-2",children:"Approved"})]})}}),i},R=({checkList:l,refreshData:t,navigate:u,options:i,selectedReport:s})=>{const n=[2,5,10,20,50],[j,c]=m.useState(!1),[o,C]=m.useState(null),[b,x]=m.useState([]),[a,S]=m.useState(null),[f,A]=m.useState(!1),{companyId:d,projectId:p}=B(),_=p?`/dashboard/companies/view/${d}/projects/view/${p}/controls/view/`:d?`/dashboard/companies/view/${d}/controls/view/`:"/dashboard/controls/view/";m.useEffect(()=>{d&&p&&(async()=>{try{const y=await(await fetch(`${k}/get-independent-controller?companyId=${d}&projectId=${p}`)).json();x(y)}catch(h){console.error("Error fetching independent controllers:",h)}})()},[d,p]);const T=r=>{C(r),c(!0)},$=async()=>{if(!a){alert("Please select an independent controller");return}A(!0);try{const r=await fetch(`${k}/approve-static-document-checklist`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:p,staticDocumentCheckListId:o._id,professionId:o.SubjectMatterId,independentControllerId:a._id})});if(r.ok)c(!1),C(null),S(null),t&&t(),alert("Item approved successfully!");else{const h=await r.json();alert(`Error: ${h.error}`)}}catch(r){console.error("Error approving item:",r),alert("Error approving item")}finally{A(!1)}};return e.jsxs(L,{title:"Static Document Checklist",children:[e.jsx(N,{url:"get-controls",refreshData:t,viewUrl:_,columns:P(u,i,T),data:l,rowsPerPageList:n,pageSize:10,tableClass:"datatable",theadClass:"table-light",showPagination:!0,searchable:!0,selectedReport:s}),e.jsxs(v,{show:j,onHide:()=>c(!1),children:[e.jsx(v.Header,{closeButton:!0,children:e.jsx(v.Title,{children:"Approve Static Document Checklist"})}),e.jsx(v.Body,{children:o&&e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Item:"})," ",o.DS_GroupId," - ",o.Subject]}),e.jsxs(I.Group,{className:"mb-3",children:[e.jsx(I.Label,{children:"Select Independent Controller"}),e.jsxs(I.Select,{value:(a==null?void 0:a._id)||"",onChange:r=>{const h=b.find(y=>y._id===r.target.value);S(h)},children:[e.jsx("option",{value:"",children:"Choose an independent controller..."}),b.map(r=>e.jsxs("option",{value:r._id,children:[r.name," (",r.userRole||"Independent Controller",")"]},r._id))]})]})]})}),e.jsxs(v.Footer,{children:[e.jsx(g,{variant:"secondary",onClick:()=>c(!1),children:"Cancel"}),e.jsx(g,{variant:"primary",onClick:$,disabled:!a||f,children:f?"Approving...":"Approve"})]})]})]})},H=({checkList:l,refreshData:t,navigate:u,options:i,selectedReport:s})=>e.jsx(e.Fragment,{children:e.jsx(E,{className:"justify-content-center",children:e.jsx(M,{xs:12,children:e.jsx(R,{refreshData:t,checkList:l,navigate:u,options:i,selectedReport:s})})})});export{H as A};
