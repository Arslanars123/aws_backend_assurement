import{r as i,a as ee,b as te,j as e,R as l,C as o}from"./index-DzDfv5dy.js";import{C as se}from"./ComponentContainerCard-DyVy1wKC.js";import{P as ae}from"./PageMetaData-6XTMSS85.js";import{B as p}from"./urls-BhGeBsON.js";import{D as ne}from"./page-CTV0a20R.js";import{F as x}from"./FormLabel-CuR2TV5q.js";import{F as re}from"./FormSelect-ComRGaQ7.js";import{A as S,T as v,C as y}from"./TextField-C6nD752S.js";import{I as P}from"./Image-CnOHMWKu.js";import{F as ie}from"./FormControl-CbRQaaPg.js";import{B as $}from"./Button-BlWMkwKA.js";import"./Card-DjAyMdAq.js";import"./divWithClassName-DwZ6sWuB.js";import"./Modal-uXOzMNub.js";import"./useWindow-DUfu7dio.js";import"./DataKey-COGXBUcQ.js";import"./NoopTransition-CQZRN946.js";import"./FormRange-CrTeTF-6.js";import"./useSlot-CeRCLM8d.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-BcofISFZ.js";const oe={item:null,users:null,selectedDrawing:null,projectManager:null,recipients:null},Ae=()=>{var A,F;const[a,m]=i.useState(oe),[R,N]=i.useState(!1),O=ee(),{companyId:u,projectId:d}=te(),[T,k]=i.useState([]),[g,I]=i.useState({show:!1,imgUrl:null}),E=i.useRef(),[C,L]=i.useState(null),[U,B]=i.useState([]),[f,M]=i.useState([]),[j,D]=i.useState([]),b=i.useRef(null),[z,W]=i.useState([]),[J,V]=i.useState([]),[_,q]=i.useState(10),H=async()=>{try{const s=await(await fetch(`${p}/get-draws?companyId=${u}&projectId=${d}`)).json();k(s)}catch(t){console.error("Error fetching workers:",t)}},G=async()=>{try{const t=`${p}/get-project-managers?companyId=${u}&projectId=${d}`,r=await(await fetch(t)).json();W(r)}catch(t){console.error("Error fetching project managers:",t)}},K=async()=>{try{const t=`${p}/get-filter-users`,n=await(await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({companyId:u,projectId:d})})).json();V(n)}catch(t){console.error("Error fetching users:",t)}};i.useEffect(()=>{H(),G(),K()},[d]);const Q=t=>{const s=Array.from(t.target.files),r=[...f,...s],n=[...j,...s.map(c=>URL.createObjectURL(c))];M(r),D(n)},X=t=>{const s=f.filter((c,h)=>h!==t),r=j.filter((c,h)=>h!==t);M(s),D(r);const n=new DataTransfer;s.forEach(c=>n.items.add(c)),b.current&&(b.current.files=n.files)},Y=t=>{const{name:s,value:r,multiple:n,options:c}=t.target;if(n){const h=Array.from(c).filter(w=>w.selected).map(w=>w.value);m({...a,[s]:h})}else m({...a,[s]:r})},Z=async t=>{t.preventDefault(),N(!0);try{const s=new FormData;Object.keys(a).forEach(n=>{n==="projectManager"||n==="selectedDrawing"||n==="recipients"||s.append(n,a[n])}),s.append("companyId",u),s.append("projectsId",d),s.append("drawing",JSON.stringify(a.selectedDrawing)),s.append("projectManager",JSON.stringify(a.projectManager)),s.append("recipients",JSON.stringify(a.recipients)),C&&s.append("annotatedImage",C),f.length>0&&f.forEach(n=>{s.append("pictures",n)});const r=await fetch(`${p}/store-mention`,{method:"POST",body:s});if(r.ok){const n=await r.json();O(`/dashboard/companies/view/${u}/projects/view/${d}`,{state:{success:"Safety Mention added successfully!"}})}else console.error("Error:",r.statusText)}catch(s){console.error("Fetch error:",s)}N(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(ae,{title:"Add Safety Mention"}),e.jsx("form",{onSubmit:Z,children:e.jsx(l,{className:"justify-content-center",children:e.jsx(o,{children:e.jsx(se,{title:"Add Safety Mention",children:e.jsxs(l,{children:[e.jsx(o,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(x,{className:"col-sm-2 col-form-label text-end",children:"Select Item"}),e.jsx(o,{sm:"10",children:e.jsxs(re,{value:a.item,name:"item",onChange:Y,children:[e.jsx("option",{defaultValue:"",children:"Select Item"}),e.jsx("option",{value:"Work has stopped",children:"Work has stopped"}),e.jsx("option",{value:"Shielding is missing here",children:"Shielding is missing here"}),e.jsx("option",{value:"A safety hazard",children:"A safety hazard"}),e.jsx("option",{value:"Lacks cleanup",children:"Lacks cleanup"}),e.jsx("option",{value:"Security shielding inhibits my work",children:"Security shielding inhibits my work"}),e.jsx("option",{value:"Scaffolding is not done appropriately",children:"Scaffolding is not done appropriately"})]})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(x,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Recipients"}),e.jsx(o,{sm:"10",children:e.jsx(S,{multiple:!1,options:J,getOptionLabel:t=>t.name,value:a==null?void 0:a.recipients,onChange:(t,s)=>{m({...a,recipients:s})},renderInput:t=>e.jsx(v,{...t,variant:"outlined",placeholder:"Search and select Project Users..."}),renderTags:(t,s)=>t.map((r,n)=>e.jsx(y,{label:r.name,...s({index:n})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(x,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Project Manager"}),e.jsx(o,{sm:"10",children:e.jsx(S,{multiple:!1,options:z,getOptionLabel:t=>t.name,value:a==null?void 0:a.projectManager,onChange:(t,s)=>{m({...a,projectManager:s})},renderInput:t=>e.jsx(v,{...t,variant:"outlined",placeholder:"Search and select Project Manager..."}),renderTags:(t,s)=>t.map((r,n)=>e.jsx(y,{label:r.name,...s({index:n})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(x,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Drawing"}),e.jsx(o,{sm:"10",children:e.jsx(S,{multiple:!1,options:T,getOptionLabel:t=>t.name,value:a==null?void 0:a.selectedDrawing,onChange:(t,s)=>{m({...a,selectedDrawing:s})},renderInput:t=>e.jsx(v,{...t,variant:"outlined",placeholder:"Search and select drawing..."}),renderTags:(t,s)=>t.map((r,n)=>e.jsx(y,{label:r.name,...s({index:n})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(o,{lg:"6",children:e.jsx(l,{className:"",children:(F=(A=a==null?void 0:a.selectedDrawing)==null?void 0:A.pictures)==null?void 0:F.map((t,s)=>e.jsx("div",{className:"position-relative me-2 mb-2",children:e.jsx(P,{src:`${p}/uploads/${t}`,onClick:()=>{I({show:!0,imgUrl:`${p}/uploads/${t}`})},alt:`Existing Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}})},`existing-${s}`))})}),(g==null?void 0:g.show)&&e.jsx(o,{lg:"6",children:e.jsx(l,{children:e.jsx("div",{className:"position-relative",style:{maxWidth:"100%",height:"auto"},children:e.jsx(ne,{ref:E,drawDotsOnImage:g,setDrawDotsAnImage:I,onSave:t=>{L(t)},setMarkers:B,markers:U,dotSize:_,setDotSize:q})})})}),e.jsx(o,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(x,{htmlFor:"multiple-file-input",className:"col-sm-2 col-form-label text-end",children:"Pictures"}),e.jsxs(o,{sm:"10",children:[e.jsx(ie,{type:"file",id:"multiple-file-input",name:"pictures",onChange:Q,accept:"image/*",multiple:!0,ref:b}),e.jsx("div",{className:"mt-3 d-flex flex-wrap",children:j.map((t,s)=>e.jsxs("div",{className:"position-relative me-2 mb-2",children:[e.jsx(P,{src:t,alt:`Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),e.jsx($,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>X(s),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"Ã—"})]},s))})]})]})}),e.jsx(l,{className:"mb-3 d-flex justify-content-center",children:e.jsx(o,{sm:"12",className:"d-flex justify-content-end",children:e.jsx($,{disabled:R,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{Ae as default};
