import{r as n,G as j,j as e,R as k,C as g,u as S,ab as v}from"./index-DXGzwTDX.js";import{P as w}from"./PageMetaData-DqMiWj9r.js";import{C as P}from"./ComponentContainerCard-BdqSoKWJ.js";import{R as A}from"./index-DnQfOP5A.js";import{B as u}from"./urls-BhGeBsON.js";import{A as T}from"./Alert-BIE78wlt.js";import"./Card-BF03U0a9.js";import"./divWithClassName-WthjuUgX.js";import"./Button-Q8P5klcO.js";import"./IconifyIcon-d0gjGKAl.js";import"./Modal-pNXPnpNb.js";import"./useWindow-D1WaCGvc.js";import"./DataKey-DeFhA7Nw.js";import"./NoopTransition-CDGbDsLX.js";import"./Anchor-OB-3XvKs.js";const L=({checks:h,refreshData:i,activatedChecks:c})=>{const o=[2,5,10,20,50],{selectedCompany:l,selectedProjects:d}=n.useContext(j),p=async s=>{try{const r=await(await fetch(`${u}/api/activate-check`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({selectedCompany:l,checkId:s,selectedProjects:d})})).json();r.success?i():console.error(r.error)}catch(a){console.error("Activation error",a)}},t=async s=>{try{const r=await(await fetch(`${u}/api/deactivate-check`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({selectedCompany:l,checkId:s,selectedProjects:d})})).json();r.success?i():console.error(r.error)}catch(a){console.error("Deactivation error",a)}},f=[{header:"Name",accessorKey:"name"},{header:"Status",cell:({row:s})=>{const a=s.original,r=c&&c.find(m=>m.checkId===a._id);return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>p(a._id),disabled:!l||!!r,children:"Activate"}),e.jsx("button",{onClick:()=>t(a._id),disabled:!l||!r,children:"Deactivate"})]})}}];return e.jsx(P,{title:"Checklist",addUrl:"/dashboard/checks/add",children:e.jsx(A,{url:"get-checks",refreshData:i,editUrl:"/dashboard/checks/edit/",viewUrl:"/dashboard/checkss/view/",deleteUrl:"delete-check",columns:f,data:h,rowsPerPageList:o,pageSize:10,tableClass:"datatable",theadClass:"table-light",showPagination:!0,searchable:!0})})},R=({checks:h,refreshData:i})=>{const{selectedCompany:c,selectedProjects:o}=n.useContext(j),[l,d]=n.useState([]);return n.useEffect(()=>{if(!c||!o){d([]);return}(async()=>{try{const t=new URLSearchParams;c&&t.append("selectedCompany",c),o&&t.append("selectedProjects",o);const s=await(await fetch(`${u}/api/company-checks?${t.toString()}`)).json();s.success?d(s.data):console.error(s.error)}catch(t){console.error(t)}})()},[c,i,o]),e.jsx(k,{className:"justify-content-center",children:e.jsx(g,{xs:12,children:e.jsx(L,{refreshData:i,checks:h,activatedChecks:l})})})},H=()=>{var x;const[h,i]=n.useState([]),[c,o]=n.useState(!1),l=S(),[d,p]=n.useState(((x=l.state)==null?void 0:x.success)||""),{selectedCompany:t,selectedProjects:f,companies:s,projects:a}=n.useContext(j),{user:r}=v(),m=async()=>{o(!0);try{const C=new URLSearchParams,y=`${u}/get-checks?${C.toString()}`,b=await(await fetch(y)).json();i(b)}catch(C){console.error(C)}finally{o(!1)}};return n.useEffect(()=>{m()},[t]),e.jsxs(e.Fragment,{children:[d&&e.jsx(T,{variant:"success",dismissible:!0,onClose:()=>p(""),children:d}),e.jsx(w,{title:"Data Tables"}),h&&!c&&e.jsx(R,{refreshData:m,checks:h})]})};export{H as default};
