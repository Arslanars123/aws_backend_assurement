import{r as n,a as B,b as O,ab as q,j as e,R as t,C as r}from"./index-DPgj8bsv.js";import{C as H}from"./ComponentContainerCard-DoOo3fSv.js";import{P as W}from"./PageMetaData-BOIE4fT1.js";import{B as d}from"./urls-B0CXljtC.js";import{S as N}from"./index-DcNdNY5v.js";import{F as l}from"./FormLabel-DrWgYkuA.js";import{F as f}from"./FormControl-B_1Cr1px.js";import{I as S}from"./Image-VbqUsSSH.js";import{B as L}from"./Button-4B-OZ0gB.js";import"./Card-uWXaDKgm.js";import"./divWithClassName-CSK1W61z.js";import"./FormContext-D3odgfWO.js";const Z=()=>{const[i,b]=n.useState({person1Name:"",person2Name:"",person3Name:""}),[U,v]=n.useState(!1),[R,E]=n.useState(!0),y=B(),{signatureId:p,companyId:$,projectId:C}=O(),[I]=q(),g=I.get("report"),[m,w]=n.useState(null),[c,P]=n.useState(null),[u,F]=n.useState(null),[o,k]=n.useState({signature1:null,signature2:null,signature3:null});n.useEffect(()=>{p&&fetch(`${d}/get-signature-detail/${p}`).then(async a=>{const s=await a.json();b({person1Name:s.person1Name||"",person2Name:s.person2Name||"",person3Name:s.person3Name||""}),k({signature1:s.signature1,signature2:s.signature2,signature3:s.signature3})}).catch(a=>console.error(a)).finally(()=>E(!1))},[p]);const x=a=>{const{name:s,value:h}=a.target;b({...i,[s]:h})},D=async a=>{a.preventDefault(),v(!0);try{const s=new FormData;s.append("person1Name",i.person1Name),s.append("person2Name",i.person2Name),s.append("person3Name",i.person3Name),m&&s.append("signature1",m,"signature1.png"),c&&s.append("signature2",c,"signature2.png"),u&&s.append("signature3",u,"signature3.png");const h=await fetch(`${d}/update-signature/${p}`,{method:"POST",body:s});if(h.ok){const j=g?`/dashboard/projects?report=${g}`:`/dashboard/companies/view/${$}/projects/view/${C}/signatures`;y(j)}else{const j=await h.json();alert(`Failed to update signature: ${j.message||"Unknown error"}`)}}catch(s){console.error("Error updating signature:",s),alert("An error occurred while updating the signature")}finally{v(!1)}};return R?e.jsx("div",{children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"Edit Signature"}),e.jsx(t,{className:"justify-content-center",children:e.jsx(r,{lg:"12",children:e.jsx(H,{title:"Edit Signature",children:e.jsxs("form",{onSubmit:D,children:[e.jsxs(t,{children:[e.jsxs(r,{lg:"4",children:[e.jsxs(t,{className:"mb-3",children:[e.jsx(l,{htmlFor:"person1Name",className:"col-sm-3 col-form-label text-end",children:"Person 1 Name"}),e.jsx(r,{sm:"9",children:e.jsx(f,{id:"person1Name",name:"person1Name",value:i.person1Name,onChange:x,type:"text",required:!0})})]}),e.jsx(t,{className:"mb-3",children:e.jsxs(r,{children:[e.jsx(l,{children:"Person 1 Signature"}),e.jsx(N,{onSave:a=>w(a),onClear:()=>w(null),width:300,height:150}),(m||o.signature1)&&e.jsx("div",{className:"mt-2",children:e.jsx(S,{src:m?URL.createObjectURL(m):`${d}/uploads/${o.signature1}`,alt:"Signature 1",fluid:!0,style:{maxWidth:"200px",maxHeight:"100px"}})})]})})]}),e.jsxs(r,{lg:"4",children:[e.jsxs(t,{className:"mb-3",children:[e.jsx(l,{htmlFor:"person2Name",className:"col-sm-3 col-form-label text-end",children:"Person 2 Name"}),e.jsx(r,{sm:"9",children:e.jsx(f,{id:"person2Name",name:"person2Name",value:i.person2Name,onChange:x,type:"text",required:!0})})]}),e.jsx(t,{className:"mb-3",children:e.jsxs(r,{children:[e.jsx(l,{children:"Person 2 Signature"}),e.jsx(N,{onSave:a=>P(a),onClear:()=>P(null),width:300,height:150}),(c||o.signature2)&&e.jsx("div",{className:"mt-2",children:e.jsx(S,{src:c?URL.createObjectURL(c):`${d}/uploads/${o.signature2}`,alt:"Signature 2",fluid:!0,style:{maxWidth:"200px",maxHeight:"100px"}})})]})})]}),e.jsxs(r,{lg:"4",children:[e.jsxs(t,{className:"mb-3",children:[e.jsx(l,{htmlFor:"person3Name",className:"col-sm-3 col-form-label text-end",children:"Person 3 Name"}),e.jsx(r,{sm:"9",children:e.jsx(f,{id:"person3Name",name:"person3Name",value:i.person3Name,onChange:x,type:"text",required:!0})})]}),e.jsx(t,{className:"mb-3",children:e.jsxs(r,{children:[e.jsx(l,{children:"Person 3 Signature"}),e.jsx(N,{onSave:a=>F(a),onClear:()=>F(null),width:300,height:150}),(u||o.signature3)&&e.jsx("div",{className:"mt-2",children:e.jsx(S,{src:u?URL.createObjectURL(u):`${d}/uploads/${o.signature3}`,alt:"Signature 3",fluid:!0,style:{maxWidth:"200px",maxHeight:"100px"}})})]})})]})]}),e.jsx(t,{className:"mb-3 d-flex justify-content-center",children:e.jsxs(r,{sm:"12",className:"d-flex justify-content-end",children:[e.jsx(L,{variant:"secondary",onClick:()=>{const a=g?`/dashboard/projects?report=${g}`:`/dashboard/companies/view/${$}/projects/view/${C}/signatures`;y(a)},className:"me-2",children:"Cancel"}),e.jsx(L,{disabled:U,type:"submit",variant:"primary",children:"Update"})]})})]})})})})]})};export{Z as default};
