import{r as u,a as k,b as O,j as e,R as l,C as a}from"./index-CEbbE1Sf.js";import{C as T}from"./ComponentContainerCard-BpYspYtC.js";import{P as B}from"./PageMetaData-qE4R9bbS.js";import{B as x}from"./urls-CvG9cD6N.js";import{F as c}from"./FormLabel-WQTNbj7P.js";import{F as d}from"./FormControl-DFJ9Ydzw.js";import{I as L}from"./Image-ULHo9GWi.js";import{B as F}from"./Button-CWQV4UHt.js";import"./Card-mt6mV6AB.js";import"./divWithClassName-CT9nWrpT.js";import"./FormContext-CSwRqVJr.js";const H={username:"",role:"Admin",phone:"",case:"",startDate:"",name:"",address:"",postalCode:"",city:""},Z=()=>{const[s,g]=u.useState(H),[w,y]=u.useState(!1),v=k(),[b,C]=u.useState(null),[N,h]=u.useState(null),f=u.useRef(null),[j,P]=u.useState(null),[A,S]=u.useState(!1),{companyId:D}=O(),m=i=>{const{name:n,value:t}=i.target;g({...s,[n]:t}),n==="username"&&t&&R(t)},R=async i=>{try{const t=await(await fetch(`${x}/check-user-exists?username=${encodeURIComponent(i)}`)).json();if(t.exists&&t.user){const o={name:t.user.name||"",phone:t.user.phone||"",address:t.user.address||"",city:t.user.city||"",postalCode:t.user.postalCode||"",startDate:t.user.startDate||""};if(P(o),S(!0),g(r=>({...r,name:t.user.name||r.name,phone:t.user.phone||r.phone,address:t.user.address||r.address,city:t.user.city||r.city,postalCode:t.user.postalCode||r.postalCode,startDate:t.user.startDate||r.startDate})),t.user.picture){const r=t.user.picture.startsWith("http")?t.user.picture:`${x.replace("/api","")}/uploads/${t.user.picture}`;h(r)}alert(`User with email ${i} already exists. Form has been auto-filled with existing details. You can modify any fields as needed.`)}}catch(n){console.error("Error checking user existence:",n)}},$=()=>{if(!A||!j)return!1;const i={name:s.name,phone:s.phone,address:s.address,city:s.city,postalCode:s.postalCode,startDate:s.startDate};return Object.keys(j).some(n=>j[n]!==i[n])},E=i=>{const n=i.target.files[0];if(C(n),n){const t=URL.createObjectURL(n);h(t)}},U=async i=>{if(i.preventDefault(),$()){if(!window.confirm("Are you sure you want to edit the basic details of the existing user? This will modify the original user's information across all documents."))return;try{const r={name:s.name,phone:s.phone,address:s.address,city:s.city,postalCode:s.postalCode,startDate:s.startDate},p=await fetch(`${x}/update-existing-user`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:s.username,updatedData:r})});if(p.ok){const V=await p.json();alert(`User information updated successfully across ${V.totalDocumentsUpdated} documents!`)}else{alert("Failed to update existing user. Please try again.");return}}catch(r){console.error("Error updating existing user:",r),alert("Error updating existing user. Please try again.");return}}const n=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,t=/^\d{10,15}$/;if(!n.test(s.username)){alert("Please enter a valid email address.");return}if(!t.test(s.phone)){alert("Please enter a valid phone number (10-15 digits).");return}y(!0);try{const o=new FormData;Object.keys(s).forEach(p=>{o.append(p,s[p])}),b&&o.append("picture",b),o.append("companyId",D);const r=await fetch(`${x}/store-user`,{method:"POST",body:o});if(r.ok){const p=await r.json();v(`/dashboard/companies/view/${D}`,{state:{success:"Admin added successfully!"}})}else console.error("Error:",r.statusText)}catch(o){console.error("Fetch error:",o)}y(!1)},I=()=>{C(null),h(null),f.current&&(f.current.value="")};return e.jsxs(e.Fragment,{children:[e.jsx(B,{title:"Add Admin"}),e.jsx("form",{onSubmit:U,children:e.jsx(l,{className:"justify-content-center",children:e.jsx(a,{children:e.jsx(T,{title:"Add Admin",children:e.jsxs(l,{children:[e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Email"}),e.jsx(a,{sm:"10",children:e.jsx(d,{value:s.username,onChange:m,name:"username",type:"email",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Name"}),e.jsx(a,{sm:"10",children:e.jsx(d,{value:s.name,onChange:m,name:"name",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Phone"}),e.jsx(a,{sm:"10",children:e.jsx(d,{value:s.phone,onChange:m,name:"phone",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Address"}),e.jsx(a,{sm:"10",children:e.jsx(d,{value:s.address,onChange:m,name:"address",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"City"}),e.jsx(a,{sm:"10",children:e.jsx(d,{value:s.city,onChange:m,name:"city",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Post Code"}),e.jsx(a,{sm:"10",children:e.jsx(d,{value:s.postalCode,onChange:m,name:"postalCode",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Start Date"}),e.jsx(a,{sm:"10",children:e.jsx(d,{value:s.startDate,onChange:m,name:"startDate",type:"date",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(c,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Picture"}),e.jsxs(a,{sm:"10",children:[e.jsx(d,{type:"file",id:"file-input",name:"picture",onChange:E,accept:"image/*",ref:f}),N&&e.jsxs("div",{className:"mt-3 position-relative",children:[e.jsx(L,{src:N,alt:"Preview",fluid:!0,rounded:!0,style:{maxWidth:"200px",maxHeight:"200px"}}),e.jsx(F,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:I,style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"Ã—"})]})]})]})}),e.jsx(l,{className:"mb-3 d-flex justify-content-center",children:e.jsx(a,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(F,{disabled:w,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{Z as default};
