import{r,b as q,a as J,G as K,j as e,R as c,C as o}from"./index-DBwHp2gR.js";import{C as Q}from"./ComponentContainerCard-CGy0xqPX.js";import{P as X}from"./PageMetaData-TYj1ypNn.js";import{B as d}from"./urls-CXtk4x-h.js";import{F as u}from"./FormLabel-fYqbV-Jd.js";import{F as p}from"./FormSelect-CvP3DY7n.js";import{F as Y}from"./FormControl-DppOmn_c.js";import{I as F}from"./Image-BAuz27ql.js";import{B as v}from"./Button-CssCL-wi.js";import"./Card-Du3hs8TN.js";import"./divWithClassName-Ur-ytTby.js";const fe=()=>{const[a,f]=r.useState(null),[I,y]=r.useState(!1),[R,T]=r.useState(!0),[S,Z]=r.useState(null),[ee,$]=r.useState(null),[j,P]=r.useState([]),[g,N]=r.useState([]),{noteId:x}=q(),k=J();r.useRef(null);const w=r.useRef(null),[D,E]=r.useState([]),{selectedCompany:se,selectedProjects:C,selectedProfession:te,companies:ne}=r.useContext(K);r.useEffect(()=>{x&&fetch(`${d}/get-note-detail/${x}`).then(async t=>{const s=await t.json();f({...s,picture2:s.picture,pictures2:s.pictures}),s.picture&&s.picture!=="null"&&$(`https://147.93.94.31/uploads/${s.picture}`),s.pictures&&s.pictures.length>0&&E(s.pictures.map(n=>`https://147.93.94.31/uploads/${n}`))}).catch(t=>console.error(t)).finally(()=>T(!1))},[x]),r.useEffect(()=>{(async()=>{try{const n=await(await fetch(`${d}/get-users?projectId=${C}`)).json();_(n)}catch(s){console.error("Error fetching draws:",s)}})()},[C]);const[A,_]=r.useState([]);r.useEffect(()=>{(async()=>{try{const n=await(await fetch(`${d}/get-draws`)).json();L(n)}catch(s){console.error("Error fetching draws:",s)}})()},[]);const[B,L]=r.useState([]),U=t=>{const s=Array.from(t.target.files),n=[...j,...s],i=[...g,...s.map(l=>URL.createObjectURL(l))];P(n),N(i)},V=t=>{const s=j.filter((l,h)=>h!==t),n=g.filter((l,h)=>h!==t);P(s),N(n);const i=new DataTransfer;s.forEach(l=>i.items.add(l)),w.current&&(w.current.files=i.files)},M=async t=>{t.preventDefault(),y(!0);const s=new FormData;Object.keys(a).forEach(n=>{s.append(n,a[n])}),S&&s.append("picture",S),j.forEach(n=>{s.append("pictures",n)});try{const n=await fetch(`${d}/update-note/${x}`,{method:"POST",body:s});if(n.ok){const i=await n.json();k("/dashboard/notes",{state:{success:"Address Note updated successfully!"}})}else console.error("Error:",n.statusText)}catch(n){console.error("Fetch error:",n)}y(!1)},O=t=>{E(s=>s.filter((n,i)=>i!==t)),f(s=>{if(!s)return null;const n=s.pictures2.filter((i,l)=>l!==t);return{...s,pictures2:n.length>0?n:[]}})},m=t=>{const{name:s,value:n,multiple:i,options:l}=t.target;if(i){const h=Array.from(l).filter(b=>b.selected).map(b=>b.value);f({...a,[s]:h})}else f({...a,[s]:n})};r.useEffect(()=>{(async()=>{try{const n=await(await fetch(`${d}/get-projects`)).json();G(n)}catch(s){console.error("Error fetching projects:",s)}})()},[]);const[z,G]=r.useState([]);r.useEffect(()=>{(async()=>{try{const n=await(await fetch(`${d}/get-professions`)).json();W(n)}catch(s){console.error("Error fetching professions:",s)}})()},[]);const[H,W]=r.useState([]);return e.jsxs(e.Fragment,{children:[e.jsx(X,{title:"Edit Address Note"}),R?null:e.jsx("form",{onSubmit:M,children:e.jsx(c,{className:"justify-content-center",children:e.jsx(o,{children:e.jsx(Q,{title:"Edit Address Note",children:e.jsxs(c,{children:[e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(u,{className:"col-sm-2 col-form-label text-end",children:"Select Item"}),e.jsx(o,{sm:"10",children:e.jsxs(p,{value:a==null?void 0:a.item,name:"item",onChange:m,children:[e.jsx("option",{defaultValue:"",children:"Select Item"}),e.jsx("option",{value:"The work does not follow the schedule.",children:"The work does not follow the schedule."}),e.jsx("option",{value:"The work is not completed.",children:"The work is not completed."}),e.jsx("option",{value:"The relationship causes delays",children:"The relationship causes delays"}),e.jsx("option",{value:"The interfaces cannot receive in that state.",children:"The interfaces cannot receive in that state."}),e.jsx("option",{value:"Manpower must be provided here if the schedule is to be adhered to.",children:"Manpower must be provided here if the schedule is to be adhered to."}),e.jsx("option",{value:"Someone has destroyed my work after final inspection.",children:"Someone has destroyed my work after final inspection."}),e.jsx("option",{value:"Conditions that are taken up at the next building meeting",children:"Conditions that are taken up at the next building meeting"}),e.jsx("option",{value:"The work is notified to be stopped in 3 days, due to non-payment. cf. AB18",children:"The work is notified to be stopped in 3 days, due to non-payment. cf. AB18"})]})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(u,{className:"col-sm-2 col-form-label text-end",children:"Select Receipients"}),e.jsx(o,{sm:"10",children:e.jsxs(p,{value:a.users,name:"users",onChange:m,multiple:!0,children:[e.jsx("option",{defaultValue:"",children:"Select"}),A.map(t=>e.jsxs("option",{value:t._id,children:[t.username," "]},t.id))]})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(u,{className:"col-sm-2 col-form-label text-end",children:"Select Drawing"}),e.jsx(o,{sm:"10",children:e.jsxs(p,{value:a.drawing,name:"drawing",onChange:m,children:[e.jsx("option",{defaultValue:"",children:"Select drawing"}),B.map(t=>e.jsxs("option",{value:t._id,children:[t.name," "]},t.id))]})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(u,{className:"col-sm-2 col-form-label text-end",children:"Select Projects"}),e.jsx(o,{sm:"10",children:e.jsxs(p,{value:a.projectsId,name:"projectsId",onChange:m,multiple:!0,children:[e.jsx("option",{defaultValue:"",children:"Select Projects"}),z.map(t=>e.jsxs("option",{value:t._id,children:[t.name," "]},t.id))]})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(u,{htmlFor:"multiple-file-input",className:"col-sm-2 col-form-label text-end",children:"Pictures"}),e.jsxs(o,{sm:"10",children:[e.jsx(Y,{type:"file",id:"multiple-file-input",name:"pictures",onChange:U,accept:"image/*",multiple:!0,ref:w}),e.jsxs("div",{className:"mt-3 d-flex flex-wrap",children:[g.map((t,s)=>e.jsxs("div",{className:"position-relative me-2 mb-2",children:[e.jsx(F,{src:t,alt:`Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),e.jsx(v,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>V(s),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]},s)),D.map((t,s)=>e.jsxs("div",{className:"position-relative me-2 mb-2",children:[e.jsx(F,{src:t,alt:`Existing Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),e.jsx(v,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>O(s),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]},`existing-${s}`))]})]})]})}),e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(u,{className:"col-sm-2 col-form-label text-end",children:"Select Profession"}),e.jsx(o,{sm:"10",children:e.jsxs(p,{value:a.profession,name:"profession",onChange:m,children:[e.jsx("option",{defaultValue:"",children:"Select profession"}),H.map(t=>e.jsx("option",{value:t.indexNumber,children:t.indexNumber},t.id))]})})]})}),e.jsx(c,{className:"mb-3 d-flex justify-content-center",children:e.jsx(o,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(v,{disabled:I,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{fe as default};
