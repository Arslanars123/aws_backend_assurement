import{r as i,a as L,b as U,j as e,R as r,C as a}from"./index-CFC_skDo.js";import{C as _}from"./ComponentContainerCard-BgtLXH2x.js";import{P as B}from"./PageMetaData--AH9Un1H.js";import{B as h}from"./urls-BhGeBsON.js";import{F as c}from"./FormLabel-S5bDb0w7.js";import{F as d}from"./FormControl-CiIjeg_-.js";import{F as z}from"./FormSelect-D_Be58Ty.js";import{I as H}from"./Image-xOOuaExf.js";import{B as b}from"./Button-2F6J7aEx.js";import{A as J,T as q,C as G}from"./TextField-IDun-2ph.js";import"./Card-DSVzyJ_p.js";import"./divWithClassName-Dn3DrZ5P.js";import"./useSlot-CMJ6u0xq.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-BcofISFZ.js";const K={username:"",password:"",role:"Construction Manager",phone:"",case:"",startDate:"",name:"",address:"",postalCode:"",city:"",mainId:null},de=()=>{const[l,j]=i.useState(K),[C,N]=i.useState(!1),v=L(),[w,S]=i.useState(null),[F,I]=i.useState(null),f=i.useRef(null),[M,k]=i.useState([]),[P,E]=i.useState([]),{companyId:u,projectId:m}=U(),p=s=>{const{name:t,value:n}=s.target;j({...l,[t]:n})},$=s=>{const t=s.target.files[0];if(S(t),t){const n=URL.createObjectURL(t);I(n)}},R=async s=>{s.preventDefault(),N(!0);try{const t=new FormData;Object.keys(l).forEach(o=>{t.append(o,l[o])}),w&&t.append("picture",w),t.append("companyId",u),t.append("projectsId",m);const n=await fetch(`${h}/store-user`,{method:"POST",body:t});if(n.ok){const o=await n.json();v(`/dashboard/companies/view/${u}`,{state:{success:"Construction Manager added successfully!"}})}else console.error("Error:",n.statusText)}catch(t){console.error("Fetch error:",t)}N(!1)},V=s=>{const{name:t,value:n,multiple:o,options:g}=s.target;if(o){const y=Array.from(g).filter(x=>x.selected).map(x=>x.value);j({...l,[t]:y})}else j({...l,[t]:n})},A=()=>{S(null),I(null),f.current&&(f.current.value="")};i.useEffect(()=>{(async()=>{try{const n=await(await fetch(`${h}/get-mains?companyId=${u}`)).json();D(n)}catch(t){console.error("Error fetching mains:",t)}})()},[]);const[T,D]=i.useState([]);i.useEffect(()=>{u&&m&&O()},[u,m]);const O=async()=>{try{const t=await(await fetch(`${h}/get-cons?companyId=${u}`)).json(),o=await(await fetch(`${h}/get-cons?companyId=${u}&projectId=${m}`)).json(),g=t.filter(y=>!o.some(x=>x._id===y._id));k(g)}catch(s){console.error("Error fetching workers:",s)}},W=async()=>{try{if(!m)return;const t={userIds:P.map(o=>o._id),projectId:m},n=await fetch(`${h}/updateUser`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(n.ok){const o=await n.json();v(`/dashboard/companies/view/${u}/projects/view/${m}`,{state:{success:"Construction Manager added successfully!"}})}else console.error("Error:",n.statusText)}catch(s){console.log("Error adding Construction Manager to project:",s)}};return e.jsxs(e.Fragment,{children:[e.jsx(B,{title:"Add Construction Manager"}),!m&&e.jsx("form",{onSubmit:R,children:e.jsx(r,{className:"justify-content-center",children:e.jsx(a,{children:e.jsx(_,{title:"Add Construction Manager",children:e.jsxs(r,{children:[e.jsx(a,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Email"}),e.jsx(a,{sm:"10",children:e.jsx(d,{value:l.username,onChange:p,name:"username",type:"email",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Name"}),e.jsx(a,{sm:"10",children:e.jsx(d,{value:l.name,onChange:p,name:"name",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Phone"}),e.jsx(a,{sm:"10",children:e.jsx(d,{value:l.phone,onChange:p,name:"phone",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Password"}),e.jsx(a,{sm:"10",children:e.jsx(d,{value:l.password,onChange:p,name:"password",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Address"}),e.jsx(a,{sm:"10",children:e.jsx(d,{value:l.address,onChange:p,name:"address",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"City"}),e.jsx(a,{sm:"10",children:e.jsx(d,{value:l.city,onChange:p,name:"city",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Post Code"}),e.jsx(a,{sm:"10",children:e.jsx(d,{value:l.postalCode,onChange:p,name:"postalCode",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(c,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Start Date"}),e.jsx(a,{sm:"10",children:e.jsx(d,{value:l.startDate,onChange:p,name:"startDate",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(c,{className:"col-sm-2 col-form-label text-end",children:"Select Main Constructor"}),e.jsx(a,{sm:"10",children:e.jsxs(z,{value:l.mainId,name:"mainId",onChange:V,children:[e.jsx("option",{defaultValue:"",children:"Select Main Constructor"}),T.map(s=>e.jsxs("option",{value:s._id,children:[s.username," "]},s.id))]})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(c,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Picture"}),e.jsxs(a,{sm:"10",children:[e.jsx(d,{type:"file",id:"file-input",name:"picture",onChange:$,accept:"image/*",ref:f}),F&&e.jsxs("div",{className:"mt-3 position-relative",children:[e.jsx(H,{src:F,alt:"Preview",fluid:!0,rounded:!0,style:{maxWidth:"200px",maxHeight:"200px"}}),e.jsx(b,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:A,style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"Ã—"})]})]})]})}),e.jsx(r,{className:"mb-3 d-flex justify-content-center",children:e.jsx(a,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(b,{disabled:C,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})}),m&&e.jsxs(r,{className:"mb-3",children:[e.jsx(c,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Select Construction Manager for this Project"}),e.jsxs(a,{sm:"10",children:[e.jsx(J,{multiple:!0,options:M,getOptionLabel:s=>s.name,value:P,onChange:(s,t)=>{E(t)},renderInput:s=>e.jsx(q,{...s,variant:"outlined",placeholder:"Search and select Construction Manager..."}),renderTags:(s,t)=>s.map((n,o)=>e.jsx(G,{label:n.name,...t({index:o})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}}),e.jsx(r,{className:"mb-3 mt-3 d-flex justify-content-center",children:e.jsx(a,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(b,{disabled:C,type:"submit",variant:"primary",className:"me-1",onClick:W,children:"Submit"})})})]})]})]})};export{de as default};
