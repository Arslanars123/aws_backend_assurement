import{r as i,a as X,b as Y,j as e,R as c,C as r}from"./index-CItDa9oU.js";import{C as Z}from"./ComponentContainerCard-DyAqISya.js";import{P as ee}from"./PageMetaData-nkbvOvdN.js";import{B as p}from"./urls-BhGeBsON.js";import{D as te}from"./page-BznXQlyv.js";import{F as u}from"./FormLabel-j7WrMQh4.js";import{F as se}from"./FormSelect-CxlmXlJB.js";import{A as y,C as S,T as b}from"./TextField-25mNyyXO.js";import{I as k}from"./Image-DVbcr1bY.js";import{F as ae}from"./FormControl-LKz46Evr.js";import{B as F}from"./Button-NHMpYk4g.js";import"./Card-BvLctnu1.js";import"./divWithClassName-D5RkLRGN.js";import"./Modal-C4xNCb4M.js";import"./useWindow-Ct6MQvoG.js";import"./DataKey-zFyaFtKi.js";import"./NoopTransition-CqJmAnIb.js";import"./FormRange-CKEc9yNw.js";import"./useFormControl-BwYPH7th.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-C8K2eoCJ.js";const ne={item:null,selectedDrawing:null,projectUsers:null,projectManager:null,comment:null},Ie=()=>{var D,M;const[a,m]=i.useState(ne),[P,N]=i.useState(!1),[$,R]=i.useState([]),[U,O]=i.useState([]),E=X(),{companyId:h,projectId:x}=Y(),[f,C]=i.useState({show:!1,imgUrl:null}),[g,I]=i.useState([]),[w,T]=i.useState([]),[B,L]=i.useState([]),v=i.useRef(null),J=i.useRef(),[A,z]=i.useState(null),[V,W]=i.useState([]),[_,q]=i.useState(10);i.useEffect(()=>{const s=async()=>{try{const l=await(await fetch(`${p}/get-draws?companyId=${h}&projectId=${x}`)).json();R(l)}catch(n){console.error("Error fetching workers:",n)}},t=async()=>{try{const n=`${p}/get-filter-users`,j=await(await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({companyId:h,projectId:x})})).json();O(j)}catch(n){console.error("Error fetching users:",n)}};(async()=>{try{const n=`${p}/get-project-managers?companyId=${h}&projectId=${x}`,d=await(await fetch(n)).json();L(d)}catch(n){console.error("Error fetching project managers:",n)}})(),t(),s()},[]);const H=s=>{const t=Array.from(s.target.files),o=[...g,...t],n=[...w,...t.map(l=>URL.createObjectURL(l))];I(o),T(n)},G=s=>{const t=g.filter((l,d)=>d!==s),o=w.filter((l,d)=>d!==s);I(t),T(o);const n=new DataTransfer;t.forEach(l=>n.items.add(l)),v.current&&(v.current.files=n.files)},K=s=>{const{name:t,value:o,multiple:n,options:l}=s.target;if(n){const d=Array.from(l).filter(j=>j.selected).map(j=>j.value);m({...a,[t]:d})}else m({...a,[t]:o})},Q=async s=>{s.preventDefault(),N(!0);try{const t=new FormData;t.append("companyId",h),t.append("projectsId",x),t.append("comment",a.comment),t.append("item",a.item),t.append("projectUsers",JSON.stringify(a.projectUsers)),t.append("projectManager",JSON.stringify(a.projectManager)),t.append("drawing",JSON.stringify(a.selectedDrawing)),A&&t.append("annotatedImage",A),g.length>0&&g.forEach(n=>{t.append("pictures",n)});const o=await fetch(`${p}/store-note`,{method:"POST",body:t});o.ok?E(`/dashboard/companies/view/${h}/projects/view/${x}`):console.error("Error:",o.statusText)}catch(t){console.error("Fetch error:",t)}N(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(ee,{title:"Add Address Note"}),e.jsx("form",{onSubmit:Q,children:e.jsx(c,{className:"justify-content-center",children:e.jsx(r,{children:e.jsx(Z,{title:"Add Address Note",children:e.jsxs(c,{children:[e.jsx(r,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(u,{className:"col-sm-2 col-form-label text-end",children:"Select Item"}),e.jsx(r,{sm:"10",children:e.jsxs(se,{value:a.item,name:"item",onChange:K,children:[e.jsx("option",{defaultValue:"",children:"Select Item"}),e.jsx("option",{value:"The work does not follow the schedule.",children:"The work does not follow the schedule."}),e.jsx("option",{value:"The work is not completed.",children:"The work is not completed."}),e.jsx("option",{value:"The relationship causes delays",children:"The relationship causes delays"}),e.jsx("option",{value:"The interfaces cannot receive in that state.",children:"The interfaces cannot receive in that state."}),e.jsx("option",{value:"Manpower must be provided here if the schedule is to be adhered to.",children:"Manpower must be provided here if the schedule is to be adhered to."}),e.jsx("option",{value:"Someone has destroyed my work after final inspection.",children:"Someone has destroyed my work after final inspection."}),e.jsx("option",{value:"Conditions that are taken up at the next building meeting",children:"Conditions that are taken up at the next building meeting"}),e.jsx("option",{value:"The work is notified to be stopped in 3 days, due to non-payment. cf. AB18",children:"The work is notified to be stopped in 3 days, due to non-payment. cf. AB18"})]})})]})}),e.jsx(r,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(u,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Project Manager"}),e.jsx(r,{sm:"10",children:e.jsx(y,{multiple:!1,options:B,getOptionLabel:s=>s.name,value:a==null?void 0:a.projectManager,onChange:(s,t)=>{m({...a,projectManager:t})},renderInput:s=>e.jsx(b,{...s,variant:"outlined",placeholder:"Search and select Project Manager..."}),renderTags:(s,t)=>s.map((o,n)=>e.jsx(S,{label:o.name,...t({index:n})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(r,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(u,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Recipients"}),e.jsx(r,{sm:"10",children:e.jsx(y,{multiple:!1,options:U,getOptionLabel:s=>s.name,value:a==null?void 0:a.projectUsers,onChange:(s,t)=>{m({...a,projectUsers:t})},renderInput:s=>e.jsx(b,{...s,variant:"outlined",placeholder:"search and select the receiver ..."}),renderTags:(s,t)=>s.map((o,n)=>e.jsx(S,{label:o.name,...t({index:n})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(r,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(u,{className:"col-sm-2 col-form-label text-end",children:"Comment"}),e.jsx(r,{sm:"10",children:e.jsx(b,{variant:"outlined",placeholder:"Add some comments...",value:a==null?void 0:a.comment,onChange:s=>{var t;m({...a,comment:(t=s==null?void 0:s.target)==null?void 0:t.value})}})})]})}),e.jsx(r,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(u,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Drawing"}),e.jsx(r,{sm:"10",children:e.jsx(y,{multiple:!1,options:$,getOptionLabel:s=>s.name,value:a==null?void 0:a.selectedDrawing,onChange:(s,t)=>{m({...a,selectedDrawing:t})},renderInput:s=>e.jsx(b,{...s,variant:"outlined",placeholder:"Search and select drawing..."}),renderTags:(s,t)=>s.map((o,n)=>e.jsx(S,{label:o.name,...t({index:n})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(r,{lg:"6",children:e.jsx(c,{className:"",children:(M=(D=a==null?void 0:a.selectedDrawing)==null?void 0:D.pictures)==null?void 0:M.map((s,t)=>e.jsx("div",{className:"position-relative me-2 mb-2",children:e.jsx(k,{src:`${p}/uploads/${s}`,onClick:()=>{C({show:!0,imgUrl:`${p}/uploads/${s}`})},alt:`Existing Preview ${t}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}})},`existing-${t}`))})}),(f==null?void 0:f.show)&&e.jsx(r,{lg:"6",children:e.jsx(c,{children:e.jsx("div",{className:"position-relative",style:{maxWidth:"100%",height:"auto"},children:e.jsx(te,{ref:J,drawDotsOnImage:f,setDrawDotsAnImage:C,onSave:s=>{z(s)},setMarkers:W,markers:V,dotSize:_,setDotSize:q})})})}),e.jsx(r,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(u,{htmlFor:"multiple-file-input",className:"col-sm-2 col-form-label text-end",children:"Pictures"}),e.jsxs(r,{sm:"10",children:[e.jsx(ae,{type:"file",id:"multiple-file-input",name:"pictures",onChange:H,accept:"image/*",multiple:!0,ref:v}),e.jsx("div",{className:"mt-3 d-flex flex-wrap",children:w.map((s,t)=>e.jsxs("div",{className:"position-relative me-2 mb-2",children:[e.jsx(k,{src:s,alt:`Preview ${t}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}}),e.jsx(F,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:()=>G(t),style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"Ã—"})]},t))})]})]})}),e.jsx(c,{className:"mb-3 d-flex justify-content-center",children:e.jsx(r,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(F,{disabled:P,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{Ie as default};
