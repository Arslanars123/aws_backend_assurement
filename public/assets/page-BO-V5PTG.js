import{b as Y,a as Z,r as a,j as e,R as l,C as t}from"./index-DPgj8bsv.js";import{B as K}from"./urls-B0CXljtC.js";import{P as ee}from"./PageMetaData-BOIE4fT1.js";import{I as i}from"./IconifyIcon-jTEtCy_D.js";import{C as n}from"./Card-uWXaDKgm.js";import{B as j}from"./Button-4B-OZ0gB.js";import{F as d}from"./Form-DCy6L--M.js";import{I as se}from"./InputGroup-C-eGesp9.js";import{A as te}from"./Alert-zYA9_bIQ.js";import{S as re}from"./Spinner-BTDWBaIC.js";import{T as ne}from"./Table-OWMEWX8Y.js";import{B as N}from"./Badge-CTDsXDut.js";import{M as f}from"./Modal-wZS0_5JS.js";import"./divWithClassName-CSK1W61z.js";import"./FormControl-B_1Cr1px.js";import"./FormContext-D3odgfWO.js";import"./ElementChildren-BDidIMmr.js";import"./FormGroup-BjdBrQcm.js";import"./FormLabel-DrWgYkuA.js";import"./FormRange-CujNJWzu.js";import"./FormSelect-BPDON-Nl.js";import"./InputGroupContext-CiSygEsu.js";import"./hook-DZftRZuP.js";import"./Anchor-BOgA51IJ.js";import"./useEventCallback-BytfugQP.js";import"./useWindow-Bg5-wBF6.js";import"./DataKey-COGXBUcQ.js";import"./NoopTransition-CP8B-7eK.js";const Te=()=>{const{companyId:S,projectId:$}=Y(),W=Z(),I=$||"68adb9b3a8c5323f1b948c6e",[m,O]=a.useState([]),[C,A]=a.useState([]),[x,_]=a.useState([]),[M,D]=a.useState(""),[u,T]=a.useState(""),[L,P]=a.useState(!1),[k,w]=a.useState(null),[v,F]=a.useState(""),[c,q]=a.useState(null),[J,B]=a.useState(!1),U=async()=>{try{const r=await(await fetch(`${K}/get-global-professions`)).json();_(r)}catch(s){console.error("Error loading subject matters:",s),w("Failed to load subject matters")}},G=async()=>{P(!0),w(null);try{const s=[];for(const r of x)try{const o={companyId:S,projectId:I,subjectMatterId:r.SubjectMatterId},p=await fetch(`${K}/get-controls-of-static-report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(p.ok){const h=await p.json();if(h.entries&&h.entries.length>0){const y=h.entries.map(E=>{var g,b,H;return{...E,subjectMatterId:r.SubjectMatterId,subjectMatterName:r.GroupName,euroCode:((b=(g=h.meta)==null?void 0:g.euroCodes)==null?void 0:b[0])||"N/A",totalEntries:((H=h.meta)==null?void 0:H.entriesCount)||0}});s.push(...y)}}}catch(o){console.error(`Error loading entries for ${r.SubjectMatterId}:`,o)}O(s),A(s)}catch(s){console.error("Error loading document entries:",s),w("Failed to load document entries")}finally{P(!1)}},V=()=>{let s=[...m];if(M&&(s=s.filter(r=>r.subjectMatterId===M)),u&&(u==="DK"?s=s.filter(r=>r.language==="DK"):u==="EN"&&(s=s.filter(r=>r.language==="GB"||r.language==="EN"))),v){const r=v.toLowerCase();s=s.filter(o=>{var p,h,y,E,g,b;return((p=o.subject)==null?void 0:p.toLowerCase().includes(r))||((h=o.checkingThe)==null?void 0:h.toLowerCase().includes(r))||((y=o.constructionPart)==null?void 0:y.toLowerCase().includes(r))||((E=o.controlMethod)==null?void 0:E.toLowerCase().includes(r))||((g=o.acceptanceCriteria)==null?void 0:g.toLowerCase().includes(r))||((b=o.subjectMatterName)==null?void 0:b.toLowerCase().includes(r))})}A(s)},Q=s=>{q(s),B(!0)},R=s=>{switch(s){case"DK":return"primary";case"GB":case"EN":return"success";default:return"secondary"}},z=s=>{switch(s){case"DK":return"Danish";case"GB":case"EN":return"English";default:return s}},X=()=>{D(""),T(""),F(""),A(m)};return a.useEffect(()=>{S&&I&&U()},[S,I]),a.useEffect(()=>{x.length>0&&G()},[x]),a.useEffect(()=>{V()},[M,u,v,m]),e.jsxs(e.Fragment,{children:[e.jsx(ee,{title:"Static Reports Management"}),e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"container-fluid",children:e.jsx(l,{children:e.jsx(t,{children:e.jsxs(n,{children:[e.jsx(n.Header,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h4",{className:"card-title mb-0",children:[e.jsx(i,{icon:"mdi:file-document-multiple",className:"me-2"}),"Static Reports Management"]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(j,{variant:"outline-primary",onClick:G,disabled:L,children:[e.jsx(i,{icon:"mdi:refresh",className:"me-1"}),"Refresh"]}),e.jsxs(j,{variant:"primary",onClick:()=>W("/dashboard/statics"),children:[e.jsx(i,{icon:"mdi:arrow-left",className:"me-1"}),"Back to Static Reports"]})]})]})}),e.jsxs(n.Body,{children:[e.jsxs(l,{className:"mb-4",children:[e.jsx(t,{md:3,children:e.jsx(n,{className:"text-center",children:e.jsxs(n.Body,{children:[e.jsx(i,{icon:"mdi:file-document",size:24,className:"text-primary mb-2"}),e.jsx("h5",{children:m.length}),e.jsx("p",{className:"text-muted mb-0",children:"Total Entries"})]})})}),e.jsx(t,{md:3,children:e.jsx(n,{className:"text-center",children:e.jsxs(n.Body,{children:[e.jsx(i,{icon:"mdi:filter",size:24,className:"text-info mb-2"}),e.jsx("h5",{children:C.length}),e.jsx("p",{className:"text-muted mb-0",children:"Filtered Entries"})]})})}),e.jsx(t,{md:3,children:e.jsx(n,{className:"text-center",children:e.jsxs(n.Body,{children:[e.jsx(i,{icon:"mdi:tag",size:24,className:"text-success mb-2"}),e.jsx("h5",{children:x.length}),e.jsx("p",{className:"text-muted mb-0",children:"Subject Matters"})]})})}),e.jsx(t,{md:3,children:e.jsx(n,{className:"text-center",children:e.jsxs(n.Body,{children:[e.jsx(i,{icon:"mdi:building",size:24,className:"text-warning mb-2"}),e.jsx("h5",{children:S?"Connected":"Not Connected"}),e.jsx("p",{className:"text-muted mb-0",children:"Company Status"})]})})})]}),e.jsxs(n,{className:"mb-4",children:[e.jsx(n.Header,{children:e.jsxs("h5",{className:"mb-0",children:[e.jsx(i,{icon:"mdi:filter",className:"me-2"}),"Filters"]})}),e.jsx(n.Body,{children:e.jsxs(l,{children:[e.jsx(t,{md:4,children:e.jsxs(d.Group,{children:[e.jsx(d.Label,{children:"Subject Matter ID"}),e.jsxs(d.Select,{value:M,onChange:s=>D(s.target.value),children:[e.jsx("option",{value:"",children:"All Subject Matters"}),x.map(s=>e.jsxs("option",{value:s.SubjectMatterId,children:[s.SubjectMatterId," - ",s.GroupName]},s._id))]})]})}),e.jsx(t,{md:3,children:e.jsxs(d.Group,{children:[e.jsx(d.Label,{children:"Language"}),e.jsxs(d.Select,{value:u,onChange:s=>T(s.target.value),children:[e.jsx("option",{value:"",children:"All Languages"}),e.jsx("option",{value:"DK",children:"Danish"}),e.jsx("option",{value:"EN",children:"English"})]})]})}),e.jsx(t,{md:4,children:e.jsxs(d.Group,{children:[e.jsx(d.Label,{children:"Search"}),e.jsxs(se,{children:[e.jsx(d.Control,{type:"text",placeholder:"Search in subject, method, criteria...",value:v,onChange:s=>F(s.target.value)}),e.jsx(j,{variant:"outline-secondary",children:e.jsx(i,{icon:"mdi:magnify"})})]})]})}),e.jsx(t,{md:1,children:e.jsxs(d.Group,{children:[e.jsx(d.Label,{children:"Â "}),e.jsx("div",{children:e.jsx(j,{variant:"outline-secondary",onClick:X,className:"w-100",children:e.jsx(i,{icon:"mdi:close"})})})]})})]})})]}),k&&e.jsxs(te,{variant:"danger",className:"mb-4",children:[e.jsx(i,{icon:"mdi:alert-circle",className:"me-2"}),k]}),L&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx(re,{animation:"border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-2",children:"Loading document entries..."})]}),!L&&e.jsxs(n,{children:[e.jsx(n.Header,{children:e.jsxs("h5",{className:"mb-0",children:[e.jsx(i,{icon:"mdi:table",className:"me-2"}),"Document Entries (",C.length,")"]})}),e.jsx(n.Body,{children:C.length>0?e.jsx("div",{className:"table-responsive",children:e.jsxs(ne,{striped:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Position"}),e.jsx("th",{children:"Subject Matter"}),e.jsx("th",{children:"Subject"}),e.jsx("th",{children:"Construction Part"}),e.jsx("th",{children:"Control Method"}),e.jsx("th",{children:"Language"}),e.jsx("th",{children:"Euro Code"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:C.map((s,r)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(N,{bg:"info",children:s.pos||"N/A"})}),e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("strong",{children:s.subjectMatterId}),e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:s.subjectMatterName})]})}),e.jsx("td",{children:e.jsx("div",{style:{maxWidth:"200px"},children:s.subject||"N/A"})}),e.jsx("td",{children:e.jsx("div",{style:{maxWidth:"150px"},children:s.constructionPart||"N/A"})}),e.jsx("td",{children:e.jsx("div",{style:{maxWidth:"150px"},children:s.controlMethod||"N/A"})}),e.jsx("td",{children:e.jsx(N,{bg:R(s.language),children:z(s.language)})}),e.jsx("td",{children:e.jsx(N,{bg:"secondary",children:s.euroCode})}),e.jsx("td",{children:e.jsx(j,{variant:"outline-primary",size:"sm",onClick:()=>Q(s),children:e.jsx(i,{icon:"mdi:eye"})})})]},`${s.subjectMatterId}-${r}`))})]})}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(i,{icon:"mdi:file-document-outline",size:48,className:"text-muted mb-3"}),e.jsx("h5",{children:"No document entries found"}),e.jsx("p",{className:"text-muted",children:m.length===0?"No entries available. Try refreshing the data.":"No entries match your current filters. Try adjusting your search criteria."})]})})]})]})]})})})})}),e.jsxs(f,{show:J,onHide:()=>B(!1),size:"lg",children:[e.jsx(f.Header,{closeButton:!0,children:e.jsxs(f.Title,{children:[e.jsx(i,{icon:"mdi:file-document",className:"me-2"}),"Entry Details"]})}),e.jsx(f.Body,{children:c&&e.jsxs("div",{children:[e.jsxs(l,{className:"mb-3",children:[e.jsxs(t,{md:6,children:[e.jsx("strong",{children:"Subject Matter ID:"}),e.jsx("p",{children:c.subjectMatterId})]}),e.jsxs(t,{md:6,children:[e.jsx("strong",{children:"Subject Matter Name:"}),e.jsx("p",{children:c.subjectMatterName})]})]}),e.jsxs(l,{className:"mb-3",children:[e.jsxs(t,{md:6,children:[e.jsx("strong",{children:"Position:"}),e.jsx("p",{children:c.pos||"N/A"})]}),e.jsxs(t,{md:6,children:[e.jsx("strong",{children:"Language:"}),e.jsx("p",{children:e.jsx(N,{bg:R(c.language),children:z(c.language)})})]})]}),e.jsxs(l,{className:"mb-3",children:[e.jsxs(t,{md:6,children:[e.jsx("strong",{children:"Euro Code:"}),e.jsx("p",{children:e.jsx(N,{bg:"secondary",children:c.euroCode})})]}),e.jsxs(t,{md:6,children:[e.jsx("strong",{children:"Row Index:"}),e.jsx("p",{children:c.rowIndex||"N/A"})]})]}),e.jsx(l,{className:"mb-3",children:e.jsxs(t,{md:12,children:[e.jsx("strong",{children:"Subject:"}),e.jsx("p",{children:c.subject||"N/A"})]})}),e.jsx(l,{className:"mb-3",children:e.jsxs(t,{md:12,children:[e.jsx("strong",{children:"Checking The:"}),e.jsx("p",{children:c.checkingThe||"N/A"})]})}),e.jsx(l,{className:"mb-3",children:e.jsxs(t,{md:12,children:[e.jsx("strong",{children:"Construction Part:"}),e.jsx("p",{children:c.constructionPart||"N/A"})]})}),e.jsx(l,{className:"mb-3",children:e.jsxs(t,{md:12,children:[e.jsx("strong",{children:"Basis:"}),e.jsx("p",{children:c.basis||"N/A"})]})}),e.jsx(l,{className:"mb-3",children:e.jsxs(t,{md:12,children:[e.jsx("strong",{children:"Control Method:"}),e.jsx("p",{children:c.controlMethod||"N/A"})]})}),e.jsxs(l,{className:"mb-3",children:[e.jsxs(t,{md:6,children:[e.jsx("strong",{children:"Circumference:"}),e.jsx("p",{children:c.circumference||"N/A"})]}),e.jsxs(t,{md:6,children:[e.jsx("strong",{children:"Time/Status:"}),e.jsx("p",{children:c.time||"N/A"})]})]}),e.jsx(l,{className:"mb-3",children:e.jsxs(t,{md:12,children:[e.jsx("strong",{children:"Acceptance Criteria:"}),e.jsx("div",{className:"border p-3 rounded bg-light",children:e.jsx("p",{className:"mb-0",children:c.acceptanceCriteria||"N/A"})})]})})]})}),e.jsx(f.Footer,{children:e.jsx(j,{variant:"secondary",onClick:()=>B(!1),children:"Close"})})]})]})};export{Te as default};
