import{r as d,b as D,a as w,c as R,j as e,R as n,C as a}from"./index-CAFh8Qe-.js";import{C as V}from"./ComponentContainerCard-BHLb5dlU.js";import{P as $}from"./PageMetaData-BdrMy3rA.js";import{B as j}from"./urls-D84fNQqS.js";import{F as r}from"./FormLabel-DJooOqJq.js";import{F as i}from"./FormControl-D6Fi2fvk.js";import{F as B}from"./FormSelect-DckZIl1p.js";import{I as A}from"./Image-CbaU3Ogc.js";import{B as f}from"./Button-DUm19Z6r.js";import"./Card-B6ongrnB.js";import"./divWithClassName-Ds10gy6J.js";import"./FormContext-CVQotS7s.js";const J=()=>{const[l,u]=d.useState({username:"",role:"Inspector",phone:"",startDate:"",name:"",address:"",postalCode:"",city:"",type:""}),{companyId:g,inspectorId:p}=D(),[b,y]=d.useState(null),[v,x]=d.useState(null),h=d.useRef(null),C=w(),{setLoading:m}=R(),c=s=>{const{name:t,value:o}=s.target;u({...l,[t]:o})},N=s=>{const{name:t,value:o}=s.target;u({...l,[t]:o})},F=s=>{const t=s.target.files[0];if(t){y(t);const o=new FileReader;o.onload=P=>{x(P.target.result)},o.readAsDataURL(t)}},S=()=>{y(null),x(null),h.current&&(h.current.value="")};d.useEffect(()=>{p&&(m(!0),fetch(`${j}/get-user-detail/${p}`).then(async s=>{const t=await s.json();if(u({username:t.username||"",role:t.role||"Inspector",phone:t.phone||"",startDate:t.startDate||"",name:t.name||"",address:t.address||"",postalCode:t.postalCode||"",city:t.city||"",type:t.type||""}),t.picture){const o=t.picture.startsWith("http")?t.picture:`${j.replace("/api","")}/uploads/${t.picture}`;x(o)}console.log("Inspector data for form:",t)}).catch(s=>console.error(s)).finally(()=>m(!1)))},[p,m]);const E=async()=>{m(!0);const s=new FormData;Object.keys(l).forEach(t=>{t==="picture"&&b?s.append("picture",b):s.append(t,l[t])});try{const t=await fetch(`${j}/update-user/${p}`,{method:"POST",body:s});t.ok?C(`/dashboard/companies/view/${g}`):console.error("Error:",t.statusText)}catch(t){console.error("Fetch error:",t)}m(!1)},I=()=>{C(`/dashboard/companies/view/${g}`)};return e.jsxs(e.Fragment,{children:[e.jsx($,{title:"Edit Inspector"}),e.jsx("form",{onSubmit:s=>{s.preventDefault(),E()},children:e.jsx(n,{className:"justify-content-center",children:e.jsx(a,{children:e.jsx(V,{title:"Edit Inspector Details",children:e.jsxs(n,{children:[e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(r,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Email"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:l.username,onChange:c,name:"username",type:"email",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(r,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Name"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:l.name,onChange:c,name:"name",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(r,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Phone"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:l.phone,onChange:c,name:"phone",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(r,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Address"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:l.address,onChange:c,name:"address",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(r,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"City"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:l.city,onChange:c,name:"city",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(r,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Post Code"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:l.postalCode,onChange:c,name:"postalCode",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(r,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Start Date"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:l.startDate,onChange:c,name:"startDate",type:"date",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(r,{className:"col-sm-2 col-form-label text-end",children:"Select Type"}),e.jsx(a,{sm:"10",children:e.jsxs(B,{value:l.type,name:"type",onChange:N,children:[e.jsx("option",{defaultValue:"",children:"Select Type"}),e.jsx("option",{value:"Building",children:"Building"}),e.jsx("option",{value:"Electrical",children:"Electrical"}),e.jsx("option",{value:"Plumbing",children:"Plumbing"}),e.jsx("option",{value:"HVAC",children:"HVAC"}),e.jsx("option",{value:"Fire Safety",children:"Fire Safety"}),e.jsx("option",{value:"Structural",children:"Structural"}),e.jsx("option",{value:"Environmental",children:"Environmental"}),e.jsx("option",{value:"Substainablity",children:"Substainablity"})]})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(n,{className:"mb-3",children:[e.jsx(r,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Picture"}),e.jsxs(a,{sm:"10",children:[e.jsx(i,{type:"file",id:"file-input",name:"picture",onChange:F,accept:"image/*",ref:h}),v&&e.jsxs("div",{className:"mt-3 position-relative",children:[e.jsx(A,{src:v,alt:"Preview",fluid:!0,rounded:!0,style:{maxWidth:"200px",maxHeight:"200px"}}),e.jsx(f,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:S,style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"Ã—"})]})]})]})}),e.jsx(n,{className:"mb-3 d-flex justify-content-center",children:e.jsxs(a,{sm:"12",className:"d-flex justify-content-end",children:[e.jsx(f,{type:"button",variant:"secondary",className:"me-2",onClick:I,children:"Cancel"}),e.jsx(f,{type:"submit",variant:"primary",children:"Update Inspector"})]})})]})})})})})]})};export{J as default};
