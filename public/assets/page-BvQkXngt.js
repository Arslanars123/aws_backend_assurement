import{r,a as E,G as k,j as e,R as l,C as c}from"./index-DPgj8bsv.js";import{C as N}from"./ComponentContainerCard-DoOo3fSv.js";import{P as F}from"./PageMetaData-BOIE4fT1.js";import{B as u}from"./urls-B0CXljtC.js";import{F as x}from"./FormLabel-DrWgYkuA.js";import{F as S}from"./FormSelect-BPDON-Nl.js";import{B as I}from"./Button-4B-OZ0gB.js";import"./Card-uWXaDKgm.js";import"./divWithClassName-CSK1W61z.js";import"./FormContext-D3odgfWO.js";const R={project:null,worker:null,projectId:null,professionId:null},K=()=>{const[n,g]=r.useState(R),[b,m]=r.useState(!1),p=E(),[f,G]=r.useState(null),[W,A]=r.useState(null);r.useRef(null);const{selectedCompany:i,selectedProjects:d,companies:B,projects:D}=r.useContext(k),[h,$]=r.useState([]),[L,V]=r.useState([]);r.useRef(null),r.useEffect(()=>{},[]);const j=t=>{n[t.target.name]=t.target.value,g({...n})},P=async t=>{if(t.preventDefault(),!d||d.length===0){alert("You must select company and project"),p("/dashboard/companies");return}m(!0);try{const s=new FormData;Object.keys(n).forEach(o=>{s.append(o,n[o])}),f&&s.append("picture",f),s.append("companyId",i),s.append("projectsId",d),h.length>0&&h.forEach(o=>{s.append("pictures",o)});const a=await fetch(`${u}/store-group`,{method:"POST",body:s});if(a.ok){const o=await a.json();p("/dashboard/groups",{state:{success:"Group added successfully!"}})}else console.error("Error:",a.statusText)}catch(s){console.error("Fetch error:",s)}m(!1)};r.useEffect(()=>{(async()=>{try{const a=await(await fetch(`${u}/get-professions`)).json();y(a)}catch(s){console.error("Error fetching projects:",s)}})()},[]);const[w,y]=r.useState([]);r.useEffect(()=>{(async()=>{try{const s=new URLSearchParams;i&&s.append("companyId",i);const o=await(await fetch(`${u}/get-workers?${s.toString()}`)).json();C(o)}catch(s){console.error("Error fetching workers:",s)}})()},[i]);const[v,C]=r.useState([]);return e.jsxs(e.Fragment,{children:[e.jsx(F,{title:"Add Group"}),e.jsx("form",{onSubmit:P,children:e.jsx(l,{className:"justify-content-center",children:e.jsx(c,{children:e.jsx(N,{title:"Add Group",children:e.jsxs(l,{children:[e.jsx(c,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(x,{className:"col-sm-2 col-form-label text-end",children:"Select Profession"}),e.jsx(c,{sm:"10",children:e.jsxs(S,{value:n.professionId,name:"professionId",onChange:j,children:[e.jsx("option",{defaultValue:"",children:"Select Profession"}),w.map(t=>e.jsxs("option",{value:t._id,children:[t.name," "]},t.id))]})})]})}),e.jsx(c,{lg:"6",children:e.jsxs(l,{className:"mb-3",children:[e.jsx(x,{className:"col-sm-2 col-form-label text-end",children:"Select Worker"}),e.jsx(c,{sm:"10",children:e.jsxs(S,{value:n.worker,name:"worker",onChange:j,children:[e.jsx("option",{defaultValue:"",children:"Select Worker"}),v.map(t=>e.jsx("option",{value:t._id,children:t.username},t.id))]})})]})}),e.jsx(l,{className:"mb-3 d-flex justify-content-center",children:e.jsx(c,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(I,{disabled:b,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{K as default};
