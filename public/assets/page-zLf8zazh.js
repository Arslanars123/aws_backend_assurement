import{r as c,a as ae,b as ne,j as e,R as r,C as a}from"./index-B9-Fw72-.js";import{C as re}from"./ComponentContainerCard-CQST7gBQ.js";import{P as oe}from"./PageMetaData-D2p2uQ5O.js";import{B as h}from"./urls-BhGeBsON.js";import{F as l}from"./FormLabel-Npy4DC-M.js";import{F as i}from"./FormControl-Di5J9l5P.js";import{A as $,T as V,C as A}from"./TextField-Drl5XZ5s.js";import{F as le}from"./FormSelect-DDDEprLJ.js";import{I as W}from"./Image-BOJ82kyh.js";import{B as f}from"./Button-CN5PJwBC.js";import"./Card-ZzJPZ8wj.js";import"./divWithClassName-COkzKTYF.js";import"./useSlot-aA9odXPU.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-BcofISFZ.js";const ce={username:"",password:"",role:"Sub Contractor",phone:"",startDate:"",name:"",address:"",postalCode:"",city:"",isProjectManager:null,cvr:"",contactPerson:"",contactPhone:""},Se=()=>{const[o,y]=c.useState(ce),[C,v]=c.useState(!1),j=ae(),[N,P]=c.useState(null),[S,w]=c.useState(null),b=c.useRef(null),[x,D]=c.useState([]),[F,L]=c.useState([]),[U,M]=c.useState([]),[I,_]=c.useState([]),[R,k]=c.useState(null),[O,T]=c.useState(null),g=c.useRef(null),E=c.useRef(!1),{companyId:u,projectId:p}=ne(),m=s=>{const{name:t,value:n}=s.target;y({...o,[t]:n})},B=s=>{const t=s.target.files[0];if(P(t),t){const n=URL.createObjectURL(t);w(n)}},J=async s=>{if(s.preventDefault(),!u){alert("You must select company"),j("/dashboard/companies");return}for(const[t,n]of Object.entries(o))if(n===""||n===null){alert(`Please fill out the "${t}" field.`);return}v(!0);try{const t=new FormData;Object.keys(o).forEach(d=>{t.append(d,o[d])}),N&&t.append("picture",N),R&&t.append("contactPicture",R),t.append("companyId",u),t.append("projectsId",p),t.append("userProfession",JSON.stringify(F));const n=await fetch(`${h}/store-user`,{method:"POST",body:t});if(n.ok){const d=await n.json();j(`/dashboard/companies/view/${u}`,{state:{success:"Sub Contractor added successfully!"}})}else console.error("Error:",n.statusText)}catch(t){console.error("Fetch error:",t)}v(!1)},Y=s=>{o[s.target.name]=s.target.value,y({...o})},z=()=>{P(null),w(null),b.current&&(b.current.value="")},G=s=>{const t=s.target.files[0];if(k(t),t){const n=URL.createObjectURL(t);T(n)}},H=()=>{k(null),T(null),g.current&&(g.current.value="")},q=async()=>{try{const t=await(await fetch(`${h}/get-company-professions?companyId=${u}&projectId=${p}`)).json();if(!(t!=null&&t.length)&&!E.current){E.current=!0,alert("You did not have any Profession so need to add Profession in a Company"),j(`/dashboard/companies/view/${u}`);return}D(t)}catch(s){console.error("Error fetching professions:",s)}};c.useEffect(()=>{q()},[u,p]),c.useEffect(()=>{if(x!=null&&x.length&&u&&p){const s=x.map(t=>t._id);K(s)}},[x]);const K=async s=>{try{const t={companyId:u,professionsIds:s,roles:["Sub Contractor"]},d=await(await fetch(`${h}/get-filter-users`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json(),X={companyId:u,professionsIds:s,projectId:p,roles:["Sub Contractor"]},Z=await(await fetch(`${h}/get-filter-users`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(X)})).json(),ee=d.filter(te=>!Z.some(se=>se._id===te._id));M(ee)}catch(t){console.error("Error fetching workers:",t)}},Q=async()=>{try{if(!p)return;const t={userIds:I.map(d=>d._id),projectId:p},n=await fetch(`${h}/updateUser`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(n.ok){const d=await n.json();j(`/dashboard/companies/view/${u}/projects/view/${p}`,{state:{success:"Sub Contractor added successfully!"}})}else console.error("Error:",n.statusText)}catch(s){console.log("Error adding Sub Contractor to project:",s)}};return e.jsxs(e.Fragment,{children:[e.jsx(oe,{title:"Add Sub Contractor"}),!p&&e.jsx("form",{onSubmit:J,children:e.jsx(r,{className:"justify-content-center",children:e.jsx(a,{children:e.jsx(re,{title:"Add Sub Contractor",children:e.jsxs(r,{children:[e.jsx(a,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(l,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Email"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:o.username,onChange:m,name:"username",type:"email",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(l,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Name"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:o.name,onChange:m,name:"name",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(l,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Phone"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:o.phone,onChange:m,name:"phone",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(l,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Password"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:o.password,onChange:m,name:"password",type:"password",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(l,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Address"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:o.address,onChange:m,name:"address",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(l,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"City"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:o.city,onChange:m,name:"city",type:"text",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(l,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Post Code"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:o.postalCode,onChange:m,name:"postalCode",type:"number",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(l,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Profession"}),e.jsx(a,{sm:"10",children:e.jsx($,{multiple:!0,options:x,getOptionLabel:s=>s.GroupName,value:F,onChange:(s,t)=>{L(t)},renderInput:s=>e.jsx(V,{...s,variant:"outlined",placeholder:"Search and select professions..."}),renderTags:(s,t)=>s.map((n,d)=>e.jsx(A,{label:n.GroupName,...t({index:d})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(l,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Start Date"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:o.startDate,onChange:m,name:"startDate",type:"date",defaultValue:"",id:"example-text-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(l,{className:"col-sm-2 col-form-label text-end",children:"Is project Manager"}),e.jsx(a,{sm:"10",children:e.jsxs(le,{value:o.isProjectManager,name:"isProjectManager",onChange:Y,children:[e.jsx("option",{defaultValue:"",children:"Select"}),e.jsx("option",{value:"yes",children:"Yes"}),e.jsx("option",{value:"No",children:"No"})]})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(l,{className:"col-sm-2 col-form-label text-end",children:"CVR. NR."}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:o.cvr,onChange:m,name:"cvr",type:"text",id:"cvr-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(l,{className:"col-sm-2 col-form-label text-end",children:"Contact Person"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:o.contactPerson,onChange:m,name:"contactPerson",type:"text",id:"contact-person-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(l,{className:"col-sm-2 col-form-label text-end",children:"Phone (Contact)"}),e.jsx(a,{sm:"10",children:e.jsx(i,{value:o.contactPhone,onChange:m,name:"contactPhone",type:"text",id:"contact-phone-input"})})]})}),e.jsx(a,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(l,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Picture"}),e.jsxs(a,{sm:"10",children:[e.jsx(i,{type:"file",id:"file-input",name:"picture",onChange:B,accept:"image/*",ref:b}),S&&e.jsxs("div",{className:"mt-3 position-relative",children:[e.jsx(W,{src:S,alt:"Preview",fluid:!0,rounded:!0,style:{maxWidth:"200px",maxHeight:"200px"}}),e.jsx(f,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:z,style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]})]})]})}),e.jsx(a,{lg:"6",children:e.jsxs(r,{className:"mb-3",children:[e.jsx(l,{className:"col-sm-2 col-form-label text-end",children:"Picture (Contact)"}),e.jsxs(a,{sm:"10",children:[e.jsx(i,{type:"file",id:"contact-picture-input",name:"contactPicture",onChange:G,accept:"image/*",ref:g}),O&&e.jsxs("div",{className:"mt-3 position-relative",children:[e.jsx(W,{src:O,alt:"Preview",fluid:!0,rounded:!0,style:{maxWidth:"200px",maxHeight:"200px"}}),e.jsx(f,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0",onClick:H,style:{transform:"translate(50%, -50%)",borderRadius:"50%"},children:"×"})]})]})]})}),e.jsx(r,{className:"mb-3 d-flex justify-content-center",children:e.jsx(a,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(f,{disabled:C,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})}),p&&e.jsxs(r,{className:"mb-3",children:[e.jsx(l,{htmlFor:"file-input",className:"col-sm-2 col-form-label text-end",children:"Select Sub Contractor for this Project"}),e.jsxs(a,{sm:"10",children:[e.jsx($,{multiple:!0,options:U,getOptionLabel:s=>s.name,value:I,onChange:(s,t)=>{_(t)},renderInput:s=>e.jsx(V,{...s,variant:"outlined",placeholder:"Search and select Sub Contractor..."}),renderTags:(s,t)=>s.map((n,d)=>e.jsx(A,{label:n.name,...t({index:d})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}}),e.jsx(r,{className:"mb-3 mt-3 d-flex justify-content-center",children:e.jsx(a,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(f,{disabled:C,type:"submit",variant:"primary",className:"me-1",onClick:Q,children:"Submit"})})})]})]})]})};export{Se as default};
