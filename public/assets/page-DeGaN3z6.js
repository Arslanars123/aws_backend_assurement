import{r as i,a as H,b as _,j as e,R as c,C as o}from"./index-Ccc50bvq.js";import{C as z}from"./ComponentContainerCard-jOvJBIs5.js";import{P as G}from"./PageMetaData-CwfTEKnL.js";import{B as m}from"./urls-BhGeBsON.js";import{D as K}from"./page-h5XIzvWu.js";import{F as p}from"./FormLabel-MCMdPdRI.js";import{F as C}from"./FormControl-CO_Uebzp.js";import{F as Q}from"./FormSelect-Bt2BskkO.js";import{A as g,T as j,C as f}from"./TextField-DlT7K7k6.js";import{I as X}from"./Image-JoqgvPfO.js";import{B as Y}from"./Button-Czdzc6_d.js";import"./Card-Bd-5a1Ef.js";import"./divWithClassName-B0s-A9qq.js";import"./Modal-p4tRgnEt.js";import"./useWindow-yc1yIKZN.js";import"./DataKey-COGXBUcQ.js";import"./NoopTransition-ClZX65CP.js";import"./FormRange-DAlMXWTQ.js";import"./useSlot-CggVarzL.js";import"./assertThisInitialized-B9jnkVVz.js";import"./createPopper-BcofISFZ.js";const Z={supplementory:"",time:"",item:null,selectedDrawing:null,projectManager:null,recipients:null},ye=()=>{var S,N;const[n,l]=i.useState(Z),[I,b]=i.useState(!1),[A,D]=i.useState([]),[h,w]=i.useState({show:!1,imgUrl:null}),k=i.useRef(),[y,F]=i.useState(null),[M,$]=i.useState([]),[T,O]=i.useState([]),[P,E]=i.useState([]),R=H(),{companyId:u,projectId:d}=_(),v=t=>{const{name:s,value:a}=t.target;l({...n,[s]:a})};i.useEffect(()=>{B(),L(),J()},[d]);const B=async()=>{try{const s=await(await fetch(`${m}/get-draws?companyId=${u}&projectId=${d}`)).json();D(s)}catch(t){console.error("Error fetching workers:",t)}},U=t=>{const{name:s,value:a,multiple:r,options:V}=t.target;if(r){const q=Array.from(V).filter(x=>x.selected).map(x=>x.value);l({...n,[s]:q})}else l({...n,[s]:a})},L=async()=>{try{const t=`${m}/get-project-managers?companyId=${u}&projectId=${d}`,a=await(await fetch(t)).json();$(a)}catch(t){console.error("Error fetching project managers:",t)}},J=async()=>{try{const t=`${m}/get-filter-users`,r=await(await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({companyId:u,projectId:d})})).json();O(r)}catch(t){console.error("Error fetching users:",t)}},W=async t=>{t.preventDefault(),b(!0);try{const s=new FormData;Object.keys(n).forEach(r=>{r==="projectManager"||r==="selectedDrawing"||r==="recipients"||s.append(r,n[r])}),s.append("companyId",u),s.append("projectsId",d),s.append("drawing",JSON.stringify(n.selectedDrawing)),s.append("projectManager",JSON.stringify(n.projectManager)),s.append("recipients",JSON.stringify(n.recipients)),y&&s.append("annotatedImage",y);const a=await fetch(`${m}/store-new`,{method:"POST",body:s});if(a.ok){const r=await a.json();R(`/dashboard/companies/view/${u}/projects/view/${d}`,{state:{success:"New Aggrement added successfully!"}})}else console.error("Error:",a.statusText)}catch(s){console.error("Fetch error:",s)}b(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(G,{title:"Add New Aggrement"}),e.jsx("form",{onSubmit:W,children:e.jsx(c,{className:"justify-content-center",children:e.jsx(o,{children:e.jsx(z,{title:"Add New Aggrement",children:e.jsxs(c,{children:[e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(p,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Supplementory"}),e.jsx(o,{sm:"10",children:e.jsx(C,{value:n.supplementory,onChange:v,name:"supplementory",type:"text",id:"example-text-input"})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(p,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Days | Hours"}),e.jsx(o,{sm:"10",children:e.jsx(C,{value:n.time,onChange:v,name:"time",type:"text",id:"example-text-input"})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(p,{className:"col-sm-2 col-form-label text-end",children:"Select Item"}),e.jsx(o,{sm:"10",children:e.jsxs(Q,{value:n.item,name:"item",onChange:U,children:[e.jsx("option",{defaultValue:"",children:"Select Item"}),e.jsx("option",{value:"A new agreement has been concluded with construction management today.",children:"A new agreement has been concluded with construction management today."}),e.jsx("option",{value:"Change work has been notified.",children:"Change work has been notified."}),e.jsx("option",{value:"Forced work must be agreed, due to delays from other contractors",children:"Forced work must be agreed, due to delays from other contractors"}),e.jsx("option",{value:"The construction management has instructed a change in the work that must be carried out in accounting work.",children:"The construction management has instructed a change in the work that must be carried out in accounting work."}),e.jsx("option",{value:"Work that has been necessary for safety or for the sake of construction.",children:"Work that has been necessary for safety or for the sake of construction."}),e.jsx("option",{value:"Someone has destroyed my work after final inspection.",children:"Someone has destroyed my work after final inspection."})]})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(p,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Recipients"}),e.jsx(o,{sm:"10",children:e.jsx(g,{multiple:!1,options:T,getOptionLabel:t=>t.name,value:n==null?void 0:n.recipients,onChange:(t,s)=>{l({...n,recipients:s})},renderInput:t=>e.jsx(j,{...t,variant:"outlined",placeholder:"Search and select Project Users..."}),renderTags:(t,s)=>t.map((a,r)=>e.jsx(f,{label:a.name,...s({index:r})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(p,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Project Manager"}),e.jsx(o,{sm:"10",children:e.jsx(g,{multiple:!1,options:M,getOptionLabel:t=>t.name,value:n==null?void 0:n.projectManager,onChange:(t,s)=>{l({...n,projectManager:s})},renderInput:t=>e.jsx(j,{...t,variant:"outlined",placeholder:"Search and select Project Manager..."}),renderTags:(t,s)=>t.map((a,r)=>e.jsx(f,{label:a.name,...s({index:r})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(o,{lg:"6",children:e.jsxs(c,{className:"mb-3",children:[e.jsx(p,{htmlFor:"example-text-input",className:"col-sm-2 col-form-label text-end",children:"Select Drawing"}),e.jsx(o,{sm:"10",children:e.jsx(g,{multiple:!1,options:A,getOptionLabel:t=>t.name,value:n==null?void 0:n.selectedDrawing,onChange:(t,s)=>{l({...n,selectedDrawing:s})},renderInput:t=>e.jsx(j,{...t,variant:"outlined",placeholder:"Search and select drawing..."}),renderTags:(t,s)=>t.map((a,r)=>e.jsx(f,{label:a.name,...s({index:r})})),sx:{"& .MuiOutlinedInput-root":{borderRadius:"6px",backgroundColor:"#f8f9fa",padding:"5px"}}})})]})}),e.jsx(o,{lg:"6",children:e.jsx(c,{className:"",children:(N=(S=n==null?void 0:n.selectedDrawing)==null?void 0:S.pictures)==null?void 0:N.map((t,s)=>e.jsx("div",{className:"position-relative me-2 mb-2",children:e.jsx(X,{src:`${m}/uploads/${t}`,onClick:()=>{w({show:!0,imgUrl:`${m}/uploads/${t}`})},alt:`Existing Preview ${s}`,fluid:!0,rounded:!0,style:{maxWidth:"100px",maxHeight:"100px"}})},`existing-${s}`))})}),(h==null?void 0:h.show)&&e.jsx(o,{lg:"6",children:e.jsx(c,{children:e.jsx("div",{className:"position-relative",style:{maxWidth:"100%",height:"auto"},children:e.jsx(K,{ref:k,drawDotsOnImage:h,setDrawDotsAnImage:w,onSave:t=>{F(t)},setMarkers:E,markers:P})})})}),e.jsx(c,{className:"mb-3 d-flex justify-content-center",children:e.jsx(o,{sm:"12",className:"d-flex justify-content-end",children:e.jsx(Y,{disabled:I,type:"submit",variant:"primary",className:"me-1",children:"Submit"})})})]})})})})})]})};export{ye as default};
